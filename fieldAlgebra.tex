\documentclass{article}
\input{default_preamble}

%%%%%%%%%%%%%%%%%%%%%%%%% Additional Packages %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Used to get bibliogrpahy options that I want
\usepackage[comma,super,sort&compress]{natbib}

% Used to get nice physics macros
\usepackage{physics}

% Used to get tables that span page breaks
\usepackage{longtable}

%%%%%%%%%%%%%%%%%%%%%%%%%%% New Commands %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                  
% Used to place references in text
\newcommand{\citen}[1]{
	\begingroup
		\hspace{-18pt}
		\setcitestyle{numbers} % cite style is no longer superscript
		\cite{#1}
		\hspace{-6.5pt}
	\endgroup
}

\begin{document}

\title{Derivations of the Fields of a Nonmagnetic, Second-Order Nonlinear Dielectric Sphere}
\author{Jacob A Busche}
\maketitle

\section{Nonlinear Wave Equation First Principles}\label{sec:nonlinearFirstPrinciplesClassical}

We begin from Maxwell's equations in the presence of a second-order nonlinear, nonmagnetic, isotropic, local dielectric medium:
\begin{equation}
\begin{split}
\nabla\cdot\mathbf{D}(\mathbf{r},\omega) &= 4\pi\rho(\mathbf{r},\omega),\\
\nabla\cdot\mathbf{B}(\mathbf{r},\omega) &= 0,\\
\nabla\times\mathbf{E}(\mathbf{r},\omega) &= \frac{\mathrm{i}\omega}{c}\mathbf{B}(\mathbf{r},\omega),\\
\nabla\times\mathbf{B}(\mathbf{r},\omega) &= \frac{4\pi}{c}\mathbf{J}(\mathbf{r},\omega) - \frac{\mathrm{i}\omega}{c}\mathbf{D}(\mathbf{r},\omega),
\end{split}
\end{equation}
where the electric displacement field is given by
\begin{equation}
\mathbf{D}(\mathbf{r},\omega) = \mathbf{E}(\mathbf{r},\omega) + 4\pi\left[\mathbf{P}^{(1)}(\mathbf{r},\omega) + \mathbf{P}^{(2)}(\mathbf{r},\omega)\right]
\end{equation}
with linear and nonlinear polarization fields
\begin{equation}
\begin{split}
\mathbf{P}^{(1)}(\mathbf{r},\omega) &= \chi^{(1)}(\mathbf{r},\omega)\mathbf{E}(\mathbf{r},\omega),\\
\mathbf{P}^{(2)}(\mathbf{r},\omega) &= \int_{-\infty}^\infty\mathbf{E}(\mathbf{r},\omega - \omega')\cdot\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega')\cdot\mathbf{E}(\mathbf{r},\omega')\;\frac{\mathrm{d}\omega'}{2\pi}.
\end{split}
\end{equation}


Taking the curl of Faraday's law delivers, immediately,
\begin{equation}
\nabla\times\nabla\times\mathbf{E}(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{D}(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}(\mathbf{r},\omega),
\end{equation}
such that the free current $\mathbf{J}(\mathbf{r},\omega)$ accounts for all of the driving effects of the electric field and the free charges $\rho(\mathbf{r},\omega)$ can be ignored. This equation is not simple to solve, however, as $\mathbf{D}$ does not depend linearly on $\mathbf{E}$. To make our lives easier, we can, in the limit where $\chi^{(2)}(\mathbf{r},\omega)$ is sufficiently small everywhere, expand the fields and susceptibilities such that
\begin{equation}
\mathbf{E}(\mathbf{r},\omega) = \sum_{n= 1}^\infty\lambda^{n - 1}\bar{\mathbf{E}}^{(n)}(\mathbf{r},\omega)
\end{equation}
and
\begin{equation}
\begin{split}
\chi^{(1)}(\mathbf{r},\omega) &= \bar{\chi}^{(1)}(\mathbf{r},\omega),\\
\bm{\chi}^{(2)}(\mathbf{r},\omega) &= \lambda\bar{\bm{\chi}}^{(2)}(\mathbf{r};\omega',\omega - \omega').
\end{split}
\end{equation}
Here, $\lambda^n$ is a small constant such that $\lambda^{n+1}\ll\lambda^n$ and the barred fields and susceptibilities have similar magnitudes for all $n$. In other words, we have assumed that all higher-order terms are small and pulled the ``small'' part out as a constant.

Expanding in powers of $\lambda$ and assuming that the driving current is large such that $\mathbf{J}\propto\lambda^0$, we find that
\begin{equation}\label{eq:nonLinWaveEq1}
\begin{split}
\nabla\times\nabla\times\mathbf{E}^{(1)}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(1)}(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}(\mathbf{r},\omega),\\
\nabla\times\nabla\times\mathbf{E}^{(2)}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(2)}(\mathbf{r},\omega) &= \\
&\hspace{-0.2\textwidth}4\pi\frac{\omega^2}{c^2}\int_{-\infty}^\infty\mathbf{E}^{(1)}(\mathbf{r},\omega')\cdot\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega')\cdot\mathbf{E}^{(1)}(\mathbf{r},\omega - \omega')\;\frac{\mathrm{d}\omega'}{2\pi},\\
&\hspace{0.0125\textwidth}\vdots
\end{split}
\end{equation}
wherein $\epsilon(\mathbf{r},\omega) = 1 + 4\pi\chi^{(1)}(\mathbf{r},\omega)$. These are the coupled second-order nonlinear wave equations.







\subsection{Separation Into Components}\label{sec:fieldSep}

The wave equations of Eq. \eqref{eq:nonLinWaveEq1} can be simplified by recognizing that every wave equation in the presence of a source can be modified to separately describe both the response fields of the nearby polarized media and the free fields of the source in accordance with the principle of superposition. In other words, the sources set up electric fields as if the media were not present that obey the wave equation
\begin{equation}\label{eq:waveEqFreeOrderN}
\nabla\times\nabla\times\mathbf{E}_\infty^{(n)}(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{E}_\infty^{(n)}(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^{(n)}(\mathbf{r},\omega),
\end{equation}
and the media then polarize and set up their own fields in response. The expansion orders of the fields have been left as the general $n$ and $\infty$ denotes the fields' validity throughout the universe. Further, the current term is $\mathbf{J}^{(n)}(\mathbf{r},\omega) = -\Theta_{n>1}\mathrm{i}\omega\mathbf{P}^{(n)}(\mathbf{r},\omega) + \delta_{n1}\mathbf{J}(\mathbf{r},\omega)$.

The original wave equation must describe the sum of Eq. \eqref{eq:waveEqFreeOrderN} and a wave equation that describes the response of the media, such that $\mathbf{E}^{(n)}(\mathbf{r},\omega) = \mathbf{E}_\infty^{(n)}(\mathbf{r},\omega) + \mathbf{E}_\mathrm{res}^{(n)}(\mathbf{r},\omega)$ where $\mathbf{E}^{(n)}(\mathbf{r},\omega)$ is taken to be any of the field terms from Eq. \eqref{eq:nonLinWaveEq1} and $\mathbf{E}^{(n)}_\mathrm{res}(\mathbf{r},\omega)$ is the $n^\mathrm{th}$-order term of the field set up by the polarized dielectric. Thus, we have
\begin{equation}\label{eq:waveEqOrderN}
\nabla\times\nabla\times\mathbf{E}^{(n)}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(n)}(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^{(n)}(\mathbf{r},\omega)
\end{equation}
and
\begin{equation}\label{eq:waveEqResOrderN}
\nabla\times\nabla\times\mathbf{E}^{(n)}_\mathrm{res}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(n)}_\mathrm{res}(\mathbf{r},\omega) = 4\pi\frac{\omega^2}{c^2}\chi^{(1)}(\mathbf{r},\omega)\mathbf{E}^{(n)}_\infty(\mathbf{r},\omega).
\end{equation}
Simple addition of Eqs. \eqref{eq:waveEqResOrderN} and \eqref{eq:waveEqFreeOrderN} reproduces Eq. \eqref{eq:waveEqOrderN}.

In summary, the wave equation at $n^\mathrm{th}$-order can be broken into a term that describes the free fields of the $n^\mathrm{th}$-order current and an equation that describes the material response. Intuitively, the driving term for the latter equation is proportional to $\chi^{(1)}(\mathbf{r},\omega)$, highlighting that the response field is set up by a region of polarized matter and that, in the case where the linear electric susceptibility goes to zero everywhere, the response fields similarly vanish. 









\newpage
\section{Second Harmonic Generation with a Monochromatic Plane Wave Source (Classical)}\label{sec:SHGclassical}

We begin our analysis of the second-order nonlinear behavior of a spherical $\chi^{(2)}$-material from the Green's function (or integral) representations of the coupled equations of Eq. \eqref{eq:nonLinWaveEq1}. Explicitly,
\begin{equation}
\begin{split}
\mathbf{E}^{(1)}(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}(\mathbf{r},\omega)}{c}\;\mathrm{d}^3\mathbf{r}',\\
\mathbf{E}^{(2)}(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r},\omega)}{c}\;\mathrm{d}^3\mathbf{r}',\\
&\hspace{0.0125\textwidth}\vdots
\end{split}
\end{equation}
where we have let $\mathbf{J}^{(2)}(\mathbf{r},\omega) = -\mathrm{i}\omega\int\mathbf{E}^{(1)}(\mathbf{r},\omega')\cdot\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega')\cdot\mathbf{E}^{(1)}(\mathbf{r},\omega - \omega')\;\mathrm{d}\omega'/2\pi$. The details of the Green's function $\mathbf{G}$ are left for Appendix \ref{app:greenFuncDetails}, but we will suffice to say that it takes a different form depending on whether the source coordinate $\mathbf{r}$ and observer coordinate $\mathbf{r}'$ are located within the sphere or outside the sphere's surface. To be precise, we will let the set of points outside the material be labeled $\mathbb{V}_1$ and the points inside be labeled $\mathbb{V}_2$, such that
\begin{equation}
\mathbf{G}(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_1(\mathbf{r},\mathbf{r}';\omega) + \mathbf{G}_2(\mathbf{r},\mathbf{r}';\omega)
\end{equation}
and
\begin{equation}
\mathbf{G}_{i}(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_{i1}(\mathbf{r},\mathbf{r}';\omega) + \mathbf{G}_{i2}(\mathbf{r},\mathbf{r}';\omega).
\end{equation}
Here, the individual Green's function components have been labeled with the index convention $\mathbf{G}_\mathrm{region-of-observer}$ or $\mathbf{G}_\mathrm{region-of-observer,region-of-source}$ and are defined using Heaviside functions $\Theta(\mathbf{r}\in\mathbb{V}_i)$, etc.










\subsection{First-order Solution}\label{sec:firstOrderSolution}

A plane-wave source will in general be composed of a current $\mathbf{J}(\mathbf{r},\omega)$ that is unknown to an experimentalist or, reciprocally, an electric field that we can call $\mathbf{E}_0(\mathbf{r},\omega)$ that is known but isn't explicitly represented in Eq. \ref{eq:nonLinWaveEq1}. However, we can use the tricks of Section \ref{sec:fieldSep} to see that
\begin{equation}
\nabla\times\nabla\times\mathbf{E}_0(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{E}_0(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}(\mathbf{r},\omega)
\end{equation}
such that the first-order response fields are given by
\begin{equation}
\nabla\times\nabla\times\mathbf{E}^{(1)}_\mathrm{res}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(1)}_\mathrm{res}(\mathbf{r},\omega) = 4\pi\frac{\omega^2}{c^2}\chi^{(1)}(\mathbf{r},\omega)\mathbf{E}_0(\mathbf{r},\omega).
\end{equation}
Using the simplest model of a plane wave oscillating at frequency $\omega_0$, travelling in the $z$-direction, and polarized along the $x$-axis, we can say
\begin{equation}
\begin{split}
\mathbf{E}_0(\mathbf{r},\omega) &= E_0\hat{\mathbf{x}}\pi\left[\mathrm{e}^{\mathrm{i}\omega_0z/c}\delta(\omega - \omega_0) + \mathrm{e}^{-\mathrm{i}\omega_0z/c}\delta(\omega + \omega_0)\right]\\[1.0em]
&= E_0\pi\delta(\omega - \omega_0)\sum_\ell\mathrm{i}^\ell\sqrt{\frac{2\ell + 1}{2\ell(\ell + 1)}\frac{(\ell + 1)!}{(\ell - 1)!}}\left[\mathbf{M}_{1\ell1}(\mathbf{r},k_0) - \mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},k_0)\right]\\
&+ E_0\pi\delta(\omega + \omega_0)\sum_\ell\mathrm{i}^\ell\sqrt{\frac{2\ell + 1}{2\ell(\ell + 1)}\frac{(\ell + 1)!}{(\ell - 1)!}}\left[\mathbf{M}_{1\ell1}(\mathbf{r},-k_0) - \mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},-k_0)\right],
\end{split}
\end{equation}
wherein $k_0 = \omega_0/c$ and the expansion of $\hat{\mathbf{x}}\exp(\pm\mathrm{i}k_0z)$ into vector spherical harmonics is useful for matching the plane wave expression to the symmetry of the sphere.

The value of this symmetry matching rests on the orthogonality conditions of Eq. \ref{eq:vectorSphericalHarmonicOrthogonality}. First looking at the response fields exterior to the sphere, we can see that their solution is given by
\begin{equation}
\begin{split}
\mathbf{E}_\mathrm{res,1}^{(1)}(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}_{1}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{1}{c}\left[\frac{c^2}{4\pi\mathrm{i}\omega}4\pi\frac{\omega^2}{c^2}\chi^{(1)}(\mathbf{r}',\omega)\mathbf{E}_0(\mathbf{r}',\omega)\right]\mathrm{d}^3\mathbf{r}'\\
&= \frac{4\pi\omega^2}{c^2}\int_{\mathbb{V}_2}\mathbf{G}_{12}(\mathbf{r},\mathbf{r}';\omega)\chi^{(1)}(\omega)\\
&\quad\cdot\left(E_0\pi\delta(\omega - \omega_0)\sum_\ell\mathrm{i}^\ell\sqrt{\frac{2\ell + 1}{2\ell(\ell + 1)}\frac{(\ell + 1)!}{(\ell - 1)!}}\left[\mathbf{M}_{1\ell 1}(\mathbf{r}',k_0) - \mathrm{i}\mathbf{N}_{0\ell 1}(\mathbf{r}',k_0)\right] + \mathrm{c.c.r.}\right)\;\mathrm{d}^3\mathbf{r}',\\
\end{split}
\end{equation}
where we have let $\chi^{(1)}(\mathbf{r},\omega) = \chi^{(1)}(\omega)\Theta(\mathbf{r}\in\mathbb{V}_2)$ and used the shorthand ``c.c.r.'' to designate the second term in the expansion of the incident field, which is simply the complex conjugate reverse (in frequency) of the first. Expanding the Green's function, we find that
\begin{equation}
\begin{split}
\mathbf{E}_\mathrm{res,1}^{(1)}(\mathbf{r},\omega) &= 4\pi k^2\chi^{(1)}(\omega)E_0\pi\delta(\omega - \omega_0)\int_{\mathbb{V}_2}\frac{\mathrm{i}k\sqrt{\epsilon(\omega)}}{4\pi}\sum_{p\ell m}\left[A_{p\ell m}^<(\omega)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)\mathbf{M}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right.\\
&\quad+\left.B_{p\ell m}^<(\omega)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)\mathbf{N}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right]\cdot\sum_{\ell'}\mathrm{i}^{\ell'}\sqrt{\frac{2\ell'+1}{2\ell'(\ell'+1)}\frac{(\ell'+1)!}{(\ell'-1)!}}\left[\mathbf{M}_{1\ell'1}(\mathbf{r}',k_0)\right.\\
&\quad-\left.\mathrm{i}\mathbf{N}_{0\ell'1}(\mathbf{r}',k_0)\right]\;\mathrm{d}^3\mathbf{r}' + \mathrm{c.c.r.}\\[1.0em]
&=\mathrm{i}k^3\chi^{(1)}(\omega)\sqrt{\epsilon(\omega)}E_0\pi\delta(\omega - \omega_0)\sum_{p\ell m,\ell'}\mathrm{i}^{\ell'}\sqrt{\frac{2\ell'+1}{2\ell'(\ell'+1)}\frac{(\ell'+1)!}{(\ell'-1)!}}\\
&\quad\times\left(A_{p\ell m}^<(\omega)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)2\pi(1 - \delta_{p1}\delta_{m0})\frac{1 + \delta_{m0}}{2 - \delta_{m0}}\delta_{p1}\delta_{\ell\ell'}\delta_{m1}R_\ell^<(\sqrt{\epsilon(\omega)}k,k_0;0,a)\right.\\
&\quad-\mathrm{i}B_{p\ell m}^<(\omega)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)2\pi(1 - \delta_{p1}\delta_{m0})\frac{1 + \delta_{m0}}{2 - \delta_{m0}}\delta_{p0}\delta_{\ell\ell'}\delta_{m1}\left[\frac{\ell + 1}{2\ell + 1}R^<_{\ell - 1}(\sqrt{\epsilon(\omega)}k,k_0;0,a)\right.\\
&\quad\left.\left.+ \frac{\ell}{2\ell + 1}R^<_{\ell + 1}(\sqrt{\epsilon(\omega)}k,k_0;0,a)\right]\right) + \mathrm{c.c.r.}\\[1.0em]
&= \mathrm{i}k^3\chi^{(1)}(\omega)\sqrt{\epsilon(\omega)}E_0\pi^2\delta(\omega - \omega_0)\sum_\ell\mathrm{i}^{\ell}\sqrt{\frac{2\ell+1}{2\ell(\ell+1)}\frac{(\ell+1)!}{(\ell-1)!}}\\
&\quad\times\left( \vphantom{\frac{\ell + 1}{2\ell + 1}} A_{1\ell1}^<(\omega)\bm{\mathcal{M}}_{1\ell1}(\mathbf{r},k)R_\ell^<(\sqrt{\epsilon(\omega)}k,k_0;0,a) - \mathrm{i}B_{0\ell1}^<(\omega)\bm{\mathcal{N}}_{0\ell1}(\mathbf{r},k)\right.\\
&\quad\times\left.\left[\frac{\ell + 1}{2\ell + 1}R_{\ell -1}^<(\sqrt{\epsilon(\omega)}k,k_0;0,a) + \frac{\ell}{2\ell + 1}R_{\ell + 1}^<(\sqrt{\epsilon(\omega)}k,k;0,a)\right]\right) + \mathrm{c.c.r.}
\end{split}
\end{equation}
where we have let the radius of the sphere be $a$ and noted from the symmetry properties of the Green's function and electric susceptibility that the total expression for $\mathbf{E}_\mathrm{res}^{(1)}$ separates into two sums that are conjugate reverses of one another.

The calculation of the response fields inside the sphere is similar and produces a similarly cumbersome result,
\begin{equation}
\begin{split}
\mathbf{E}_\mathrm{res,2}^{(1)}(\mathbf{r},\omega) &= 4\pi k^2\chi^{(1)}(\omega)E_0\pi\delta(\omega - \omega_0)\int_{\mathbb{V}_2}\frac{\mathrm{i}k\sqrt{\epsilon(\omega)}}{4\pi}\sum_{p\ell m}\left[C_{p\ell m}^<(\omega)\mathbf{M}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right.\\
&\quad+\left.D_{p\ell m}^<(\omega)\mathbf{N}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right]\cdot\sum_{\ell'}\mathrm{i}^{\ell'}\sqrt{\frac{2\ell'+1}{2\ell'(\ell'+1)}\frac{(\ell'+1)!}{(\ell'-1)!}}\left[\mathbf{M}_{1\ell'1}(\mathbf{r}',k_0)\right.\\
&\quad-\left.\mathrm{i}\mathbf{N}_{0\ell'1}(\mathbf{r}',k_0)\right]\;\mathrm{d}^3\mathbf{r}' + \mathrm{c.c.r.}\\
&\quad+ 4\pi k^2\chi^{(1)}(\omega)\int_{\mathbb{V}_2}\mathbf{G}_0(\mathbf{r},\mathbf{r}';\sqrt{\epsilon(\omega)}\omega)\cdot\mathbf{E}_0(\mathbf{r}',\omega)\;\mathrm{d}^3\mathbf{r}'\\[1.0em] 
&= \mathrm{i}k^3\chi^{(1)}(\omega)\sqrt{\epsilon(\omega)}E_0\pi^2\delta(\omega - \omega_0)\sum_\ell\mathrm{i}^{\ell}\sqrt{\frac{2\ell+1}{2\ell(\ell+1)}\frac{(\ell+1)!}{(\ell-1)!}}\\
&\quad\times\left( \vphantom{\frac{\ell + 1}{2\ell + 1}} C_{1\ell1}^<(\omega)\mathbf{M}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)R_\ell^{><}(\sqrt{\epsilon(\omega)}k,k_0;0,a) - \mathrm{i}D_{0\ell1}^<(\omega)\mathbf{N}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\right.\\
&\quad\times\left.\left[\frac{\ell + 1}{2\ell + 1}R_{\ell -1}^{><}(\sqrt{\epsilon(\omega)}k,k_0;0,a) + \frac{\ell}{2\ell + 1}R_{\ell + 1}^{><}(\sqrt{\epsilon(\omega)}k,k_0;0,a)\right]\right) + \mathrm{c.c.r.}\\[0.5em]
&\quad+ 4\pi k^2\chi^{(1)}(\omega)\int_{\mathbb{V}_2}\mathbf{G}_0(\mathbf{r},\mathbf{r}';\sqrt{\epsilon(\omega)}\omega)\cdot\mathbf{E}_0(\mathbf{r}',\omega)\;\mathrm{d}^3\mathbf{r}',
\end{split}
\end{equation}
where the additional term on the last line details the formation of free-space-like waves in the polarization of the sphere. Expanding this term, we find
\begin{equation}
\begin{split}
&4\pi k^2\chi^{(1)}(\omega)\int_{\mathbb{V}_2}\mathbf{G}_0(\mathbf{r},\mathbf{r}';\sqrt{\epsilon(\omega)}\omega)\cdot\mathbf{E}_0(\mathbf{r}',\omega)\;\mathrm{d}^3\mathbf{r}' = \\
&4\pi k^2\chi^{(1)}(\omega)\int_{\mathbb{V}_2}\frac{\mathrm{i}\sqrt{\epsilon(\omega)}k}{4\pi}\sum_{p\ell m}\left( \vphantom{\frac{1}{2}} \left[\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\mathbf{M}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right.\right.\\
&\left.\quad+ \bm{\mathcal{N}}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\mathbf{N}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right]\Theta(r - r') +\left[\mathbf{M}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right.\\
&\quad+\left.\left. \mathbf{N}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right]\Theta(r' - r) \vphantom{\frac{1}{2}} \right)\cdot\left(E_0\pi\delta(\omega - \omega_0)\sum_{\ell'}\mathrm{i}^{\ell'}\sqrt{\frac{2\ell'+1}{2\ell'(\ell'+1)}\frac{(\ell'+1)!}{(\ell'-1)!}}\right.\\
&\quad\left.\times\left[\mathbf{M}_{1\ell'1}(\mathbf{r}',k_0) - \mathrm{i}\mathbf{N}_{0\ell'1}(\mathbf{r}',k_0)\right] + \mathrm{c.c.r.} \vphantom{\sum_{\ell'}} \right)\;\mathrm{d}^3\mathbf{r}'\\[1.0em]
&= \mathrm{i}k^3\chi^{(1)}(\omega)\sqrt{\epsilon(\omega)}E_0\pi^2\delta(\omega - \omega_0)\sum_\ell\mathrm{i}^\ell\sqrt{\frac{2\ell + 1}{2\ell(\ell + 1)}\frac{(\ell + 1)!}{(\ell - 1)!}}\\
&\quad\times\left[\bm{\mathcal{M}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)R_\ell^<(\sqrt{\epsilon(\omega)}k,k_0;0,r) + \mathbf{M}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)R_\ell^{><}(\sqrt{\epsilon(\omega)}k,k_0;r,a)\right.\\
&\quad-\mathrm{i}\bm{\mathcal{N}}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\left(\frac{\ell + 1}{2\ell + 1}R_{\ell - 1}^<(\sqrt{\epsilon(\omega)}k,k_0;0,r) + \frac{\ell}{2\ell + 1}R_{\ell+1}^<(\sqrt{\epsilon(\omega)}k,k_0;0,r)\right)\\
&\left.\quad-\mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\left(\frac{\ell + 1}{2\ell + 1}R_{\ell - 1}^{><}(\sqrt{\epsilon(\omega)}k,k_0;r,a) + \frac{\ell}{2\ell + 1}R_{\ell+1}^{><}(\sqrt{\epsilon(\omega)}k,k_0;r,a)\right)\right]\\
&\quad+\mathrm{c.c.r.}
\end{split}
\end{equation}
where in the last equation we note that $R_\ell^<(\sqrt{\epsilon(\omega)}k,k_0;0,r)$ falls of faster as $r\to0$ than any component of $\bm{\mathcal{M}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)$ or $\bm{\mathcal{N}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)$ blows up, such than none of the terms above diverge for any $\mathbf{r}\in\mathbb{V}_2$.

We can now finalize our analysis. However, because the expressions for the first-order fields are so cumbersome, this process benefits from some updates to the notation. First, we will shorten the ever-present constant inside the sums over $\ell$ to
\begin{equation}
\kappa_\ell = \mathrm{i}^\ell\sqrt{\frac{2\ell + 1}{2\ell(\ell + 1)}\frac{(\ell + 1)!}{(\ell - 1)!}}.
\end{equation}
Next, we can define modified expansion coefficients
\begin{equation}
\begin{split}
a_{p\ell m}^<(\omega) &= A_{p\ell m}^<(\omega)R_\ell^<(\sqrt{\epsilon(\omega)}k,k_0;0,a),\\
c_{p\ell m}^<(\omega) &= C_{p\ell m}^<(\omega)R_\ell^{><}(\sqrt{\epsilon(\omega)}k,k_0;0,a),\\
b_{p\ell m}^<(\omega) &= B_{p\ell m}^<(\omega)\left[\frac{\ell + 1}{2\ell + 1}R_{\ell - 1}^<(\sqrt{\epsilon(\omega)}k,k_0;0,a) + \frac{\ell}{2\ell + 1}R_{\ell + 1}^<(\sqrt{\epsilon(\omega)}k,k_0;0,a)\right],\\
d_{p\ell m}^<(\omega) &= D_{p\ell m}^<(\omega)\left[\frac{\ell + 1}{2\ell + 1}R_{\ell - 1}^{><}(\sqrt{\epsilon(\omega)}k,k_0;0,a) + \frac{\ell}{2\ell + 1}R_{\ell + 1}^{><}(\sqrt{\epsilon(\omega)}k,k_0;0,a)\right]
\end{split}
\end{equation}
to simplify the response field inside the sphere. We can further define a pair of ``intermediate'' harmonics
\begin{equation}
\begin{split}
\widebar{\mathbf{M}}_{p\ell m}(\mathbf{r},k) &= k_0^3\left[\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)R_\ell^<(k,k_0;0,r) + \mathbf{M}_{p\ell m}(\mathbf{r},k)R_\ell^{><}(k,k_0;r,a)\right],\\
\widebar{\mathbf{N}}_{p\ell m}(\mathbf{r},k) &= k_0^3\left[\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)\left(\frac{\ell + 1}{2\ell + 1}R_{\ell-1}^<(k,k_0;0,r) + \frac{\ell}{2\ell + 1}R_{\ell+1}^<(k,k_0;0,r)\right)\right.\\
&\left.\quad+\mathbf{N}_{p\ell m}(\mathbf{r},k)\left(\frac{\ell + 1}{2\ell + 1}R_{\ell-1}^{><}(k,k_0;r,a) + \frac{\ell}{2\ell + 1}R_{\ell+1}^{><}(k,k_0;r,a)\right)\right]
\end{split}
\end{equation}
to further simplify the term in $\mathbf{E}^{(1)}_{\mathrm{res},2}$ arising from the term proportional $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\sqrt{\epsilon(\omega)}\omega)$ in $\mathbf{G}_{22}(\mathbf{r},\mathbf{r}';\omega)$. These new functions are simply superpositions of the internal and external harmonics with radius-dependent weights set by the radial integral factors $R_\ell^<(k,k_0;0,r)$, etc. The purpose of the prefactors $k_0^3$ is to cancel the units of volume carried by the radial integrals (see Appendix \ref{app:greenFuncDetails}) such that the intermediate harmonics are unitless. Thus, we have
\begin{equation}\label{eq:firstOrderSolution}
\begin{split}
\mathbf{E}_0(\mathbf{r},\omega) &= E_0\pi\delta(\omega - \omega_0)\sum_\ell\kappa_\ell\left[\mathbf{M}_{1\ell1}(\mathbf{r},k_0) - \mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},k_0)\right] + \mathrm{c.c.r.},\\
\mathbf{E}^{(1)}_{\mathrm{res},1}(\mathbf{r},\omega) &= \mathrm{i}\pi k^3\chi^{(1)}(\omega)\sqrt{\epsilon(\omega)}E_0\pi\delta(\omega - \omega_0)\sum_\ell\kappa_\ell\left[a_{1\ell1}^<(\omega)\bm{\mathcal{M}}_{1\ell1}(\mathbf{r},k)-\mathrm{i}b_{0\ell1}^<(\omega)\bm{\mathcal{N}}_{0\ell1}(\mathbf{r},k)\right] + \mathrm{c.c.r.}\\
\mathbf{E}^{(1)}_{\mathrm{res},2}(\mathbf{r},\omega) &= \mathrm{i}\pi k^3\chi^{(1)}(\omega)\sqrt{\epsilon(\omega)}E_0\pi\delta(\omega - \omega_0)\sum_\ell\kappa_\ell\left[c_{1\ell1}^<(\omega)\mathbf{M}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k) + k_0^{-3}\widebar{\mathbf{M}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\right.\\
&\left.\quad-\mathrm{i}d_{0\ell1}^<(\omega)\mathbf{N}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega)}k) - \mathrm{i}k_0^{-3}\widebar{\mathbf{N}}_{0\ell 1}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\right] + \mathrm{c.c.r.}
\end{split}
\end{equation}





\subsubsection{Boundary Condition Satisfaction}

To see that these first-order solutions are correct, we can test whether they satisfy the Maxwell boundary conditions. Importantly, however, we must note that $\mathbf{E}_0$ and $\mathbf{E}^{(1)}_\mathrm{res}$ satisfy different boundary conditions by construction---since we've defined $\mathbf{E}_0(\mathbf{r},\omega)$ as the component of the total field that is not affected by any media, it only needs to satisfy the boundary conditions of free space. That is, $\mathbf{E}_0(\mathbf{r},\omega)\to0$ for $r\to\infty$, which is guaranteed by the nullification of $\mathbf{M}_{p\ell m}(\mathbf{r},k)$ and $\mathbf{N}_{p\ell m}(\mathbf{r},k)$ at large $r$.

The response fields, however, must also satisfy Maxwell boundary conditions at $r = a$, as they modify and are modified by rearrangement of the bound charges and currents of the sphere. To begin our boundary condition analysis, we note that, conveniently,
\begin{equation}
\begin{split}
\widebar{\mathbf{M}}_{p\ell m}(r = a,\theta,\phi;k) &= k_0^3\bm{\mathcal{M}}_{p\ell m}(r=a,\theta,\phi;k)R_\ell^<(k,k_0;0,a),\\
\widebar{\mathbf{N}}_{p\ell m}(r = a,\theta,\phi;k) &= k_0^3\bm{\mathcal{N}}_{p\ell m}(r=a,\theta,\phi;k)\left[\frac{\ell + 1}{2\ell + 1}R_{\ell-1}^<(k,k_0;0,a) + \frac{\ell}{2\ell + 1}R_{\ell+1}^<(k,k_0;0,a)\right].
\end{split}
\end{equation}
Together with
\begin{equation}\label{eq:parallelIdentity1}
\begin{split}
j_\ell(\sqrt{\epsilon(\omega)}ka)C_{p\ell m}^<(\omega) + h_\ell^{(1)}(\sqrt{\epsilon(\omega)}ka) &= h_\ell^{(1)}(ka)A_{p\ell m}^<(\omega),\\
\psi_\ell(\sqrt{\epsilon(\omega)}ka)D_{p\ell m}^<(\omega) + \xi_\ell(\sqrt{\epsilon(\omega)}ka) &= \sqrt{\epsilon(\omega)}\xi_\ell(ka)B_{p\ell m}^<(\omega),
\end{split}
\end{equation}
these identities can be used to show that
\begin{equation}\label{eq:parallelIdentity2}
\begin{split}
\left[c_{1\ell1}^<(\omega)\mathbf{M}_{1\ell 1}(r=a,\theta,\phi;\sqrt{\epsilon(\omega)}k) + k_0^{-3}\widebar{\mathbf{M}}_{1\ell1}(r=a,\theta,\phi;\sqrt{\epsilon(\omega)}k)\right]\cdot\hat{\mathbf{e}}_\parallel &= \\
a_{1\ell1}^<(\omega)\bm{\mathcal{M}}&_{1\ell1}(r=a,\theta,\phi;k)\cdot\hat{\mathbf{e}}_\parallel,\\[1.0em]
\left[d_{0\ell1}^<(\omega)\mathbf{N}_{0\ell 1}(r=a,\theta,\phi;\sqrt{\epsilon(\omega)}k) + k_0^{-3}\widebar{\mathbf{N}}_{0\ell1}(r=a,\theta,\phi;\sqrt{\epsilon(\omega)}k)\right]\cdot\hat{\mathbf{e}}_\parallel &= \\
b_{0\ell1}^<(\omega)\bm{\mathcal{N}}&_{0\ell1}(r=a,\theta,\phi;k)\cdot\hat{\mathbf{e}}_\parallel,
\end{split}
\end{equation}
wherein $\hat{\mathbf{e}}_\parallel \in \{\hat{\bm{\theta}},\hat{\bm{\phi}}\}$ is either of the spherical unit vectors parallel to the substrate. To see this, one should note that $\mathbf{M}_{p\ell m}(\mathbf{r},k)\cdot\hat{\mathbf{e}}_\parallel\sim j_\ell(rk)$, $\bm{\mathcal{M}}_{p\ell m}(r,k)\cdot\hat{\mathbf{e}}_\parallel\sim h_\ell^{(1)}(kr)$, $\mathbf{N}_{p\ell m}(r,k)\cdot\hat{\mathbf{e}}_\parallel\sim\psi_\ell(kr)/kr$, and $\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)\cdot\hat{\mathbf{e}}_\parallel\sim \xi_\ell(kr)/kr$. Further, the angular factors of the surface-parallel components of vector spherical harmonics of the same type are equal, such that all angular factors cancel in either equation of Eq. \eqref{eq:parallelIdentity2}. Finally, the radial integrals present in the modified expansion coefficients and the associated intermediate harmonics are also equal at $r = a$. Thus, all terms in Eq. \eqref{eq:parallelIdentity2} not present in Eq. \eqref{eq:parallelIdentity1} cancel and the equality holds.

Multiplication of Eq. \eqref{eq:parallelIdentity2} by the appropriate prefactors from Eq. \eqref{eq:firstOrderSolution} demonstrates immediately that the Maxwell boundary condition
\begin{equation}
\hat{\mathbf{r}}\times[\mathbf{E}^{(1)}_{\mathrm{res},1}(\mathbf{r},\omega) - \mathbf{E}^{(1)}_{\mathrm{res},2}(\mathbf{r},\omega)]_{r = a} = \bm{0}
\end{equation}
is satisfied. The boundary condition on the surface-perpendicular part of the electric displacement fields,
\begin{equation}
\hat{\mathbf{r}}\cdot[\mathbf{E}^{(1)}_{\mathrm{res},1}(\mathbf{r},\omega) - \epsilon(\omega)\mathbf{E}^{(1)}_{\mathrm{res},2}(\mathbf{r},\omega)]_{r = a} = 0,
\end{equation} requires another identity
\begin{equation}\label{eq:perpIdentity1}
j_\ell(\sqrt{\epsilon(\omega)}ka)D_{p\ell m}^<(\omega) + h_\ell^{(1)}(\sqrt{\epsilon(\omega)}ka) = \frac{1}{\sqrt{\epsilon(\omega)}}h_\ell^{(1)}(ka)B_{p\ell m}^<(\omega)
\end{equation}
to prove, but is otherwise simpler to deal with since only the electric harmonics have radial components. Explicitly, this new identity provides
\begin{equation}\label{eq:perpIdentity2}
\begin{split}
\epsilon(\omega)\left[d_{0\ell1}^<(\omega)\mathbf{N}_{0\ell 1}(r=a,\theta,\phi;\sqrt{\epsilon(\omega)}k) + k_0^{-3}\widebar{\mathbf{N}}_{0\ell1}(r=a,\theta,\phi;\sqrt{\epsilon(\omega)}k)\right]\cdot\hat{\mathbf{r}} &= \\
b_{0\ell1}^<(\omega)\bm{\mathcal{N}}&_{0\ell1}(r=a,\theta,\phi;k)\cdot\hat{\mathbf{r}},
\end{split}
\end{equation}
which, via multiplication of the appropriate prefactors, guarantees the satisfaction of the perpendicular boundary condition of $\mathbf{E}^{(1)}_\mathrm{res}$.








\subsection{Second-order Solution}

The solution to the second-order wave equation of Eq. \eqref{eq:nonLinWaveEq1} can be constructed straightforwardly, if not simply, from the results of Section \ref{sec:firstOrderSolution}. Explicitly, the term on the right hand side of the equation can be rewritten as a current as was alluded to in Eq. \eqref{eq:waveEqFreeOrderN}, such that
\begin{equation}
\nabla\times\nabla\times\mathbf{E}^{(2)}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(2)}(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^{(2)}(\mathbf{r},\omega),
\end{equation}
wherein
\begin{equation}
\mathbf{J}^{(2)}(\mathbf{r},\omega) = -\mathrm{i}\omega\int_{-\infty}^\infty\mathbf{E}^{(1)}(\mathbf{r},\omega')\cdot\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega')\cdot\mathbf{E}^{(1)}(\mathbf{r},\omega - \omega')\;\frac{\mathrm{d}\omega'}{2\pi}.
\end{equation}
Simple substitution of the fields of Section \ref{sec:firstOrderSolution} into the integral above provides the analytical description of the second-order driving current. 

We are now in a strong position to derive a tractable form for $\mathbf{J}^{(2)}$. First, we can solidify our assumption that the sphere has an isotropic second-order susceptibility by letting $\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega') = \bm{1}_3\Theta(a - r)\chi^{(2)}(\omega',\omega - \omega')$, where $\bm{1}_3$ is a rank-3 identity matrix. Therefore,
\begin{equation}\label{eq:J2_1}
\begin{split}
\mathbf{J}^{(2)}(\mathbf{r},\omega) &= -\mathrm{i}\omega\int_{-\infty}^\infty \left[\left(E_0\pi\delta(\omega' - \omega_0)\mathrm{i}\pi k'^3\chi^{(1)}(\omega')\sqrt{\epsilon(\omega')}\sum_\ell\kappa_\ell\left[c_{1\ell1}^<(\omega')\mathbf{M}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega')}k')\right.\right.\right.\\
&\quad+\left.\left.k_0^{-3}\widebar{\mathbf{M}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega')}k') - \mathrm{i}d_{0\ell1}^<(\omega')\mathbf{N}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega')}k') - \mathrm{i}k_0^{-3}\widebar{\mathbf{N}}_{0\ell 1}(\mathbf{r},\sqrt{\epsilon(\omega')}k')\right] + \mathrm{c.c.r.} \vphantom{\sum_\ell} \right)\\
&\quad+\left.\left(E_0\pi\delta(\omega' - \omega_0)\sum_\ell\kappa_\ell\left[\mathbf{M}_{1\ell1}(\mathbf{r},k') - \mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},k')\right] + \mathrm{c.c.r.}\right)\right]\\
&\quad\cdot\bm{1}_3\chi^{(2)}(\omega',\omega - \omega')\cdot\left[\left(E_0\pi\delta([\omega - \omega'] - \omega_0)\mathrm{i}\pi(k - k')^3\chi^{(1)}(\omega - \omega')\sqrt{\epsilon(\omega - \omega')}\vphantom{\sum_\ell\kappa_\ell}\right.\right.\\
&\quad\times\sum_\ell\kappa_\ell\left[c_{1\ell1}^<(\omega - \omega')\mathbf{M}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega - \omega')}[k - k']) + k_0^{-3}\widebar{\mathbf{M}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega - \omega')}[k - k'])\right.\\
&\quad-\left.\left.\mathrm{i}d_{0\ell1}^<(\omega - \omega')\mathbf{N}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega - \omega')}[k - k']) - \mathrm{i}k_0^{-3}\widebar{\mathbf{N}}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega - \omega')}[k - k'])\right] + \mathrm{c.c.r.} \vphantom{\sum_\ell} \right)\\
&\quad+\left.\left(E_0\pi\delta([\omega - \omega']-\omega_0)\sum_\ell\kappa_\ell\left[\mathbf{M}_{1\ell1}(\mathbf{r},k - k')-\mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},k - k')\right] + \mathrm{c.c.r.}\right)\right]\;\frac{\mathrm{d}\omega'}{2\pi}.
\end{split}
\end{equation}
While deciphering this expression is difficult, it is useful to note that the Dirac deltas in the unwritten conjugate terms can be written as $\delta(\omega' + \omega_0)$ and $\delta([\omega - \omega'] + \omega_0)$ due to the symmetry properties of the Dirac delta. Given this, one can see that any terms inside the integral of Eq. \eqref{eq:J2_1} proportional to $\delta(\omega' - \omega_0)\delta([\omega - \omega'] + \omega_0)$ or the same with $\omega_0\to-\omega_0$ will restrict $\omega$ to be zero. The current in these cases also goes to zero due to the leading factor of $-\mathrm{i}\omega$.

Thus, the only terms in the sum that contribute to a nonzero current are those proportional to the products $\delta(\omega' \mp \omega_0)\delta([\omega - \omega'] \mp \omega_0)$ that, after integration, become $\delta(\omega \mp 2\omega_0)$. Straightforwardly, then, Eq. \eqref{eq:J2_1} becomes
\begin{equation}\label{eq:J2_2}
\begin{split}
\mathbf{J}^{(2)}(\mathbf{r},\omega) &= -\frac{\mathrm{i}\omega}{2\pi}E_0^2\pi^2\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega - \omega_0)\\
&\quad\times\sum_{\ell\ell'}\kappa_\ell\kappa_{\ell'}\left[\mathrm{i}\pi k_0^3\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}\left(c_{1\ell1}^<(\omega_0)\mathbf{M}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0)\right.\right.\\
&\quad+\left.k_0^{-3}\widebar{\mathbf{M}}_{1\ell1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) - \mathrm{i}d_{0\ell 1}^<(\omega_0)\mathbf{N}_{0\ell 1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) - \mathrm{i}k_0^{-3}\widebar{\mathbf{N}}_{0\ell1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0)\right)\\
&\quad+\left.\left(\mathbf{M}_{1\ell1}(\mathbf{r},k_0) - \mathrm{i}\mathbf{N}_{0\ell1}(\mathbf{r},k_0) \vphantom{\chi^{(1)}} \right)\right] \cdot\bm{1}_3\cdot \left[\mathrm{i}\pi k_0^3\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}\left(c_{1\ell'1}^<(\omega_0)\mathbf{M}_{1\ell'1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0)\right.\right.\\
&\quad+\left.k_0^{-3}\widebar{\mathbf{M}}_{1\ell'1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) - \mathrm{i}d_{0\ell'1}^<(\omega_0)\mathbf{N}_{0\ell'1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) - \mathrm{i}k_0^{-3}\widebar{\mathbf{N}}_{0\ell'1}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0)\right)\\
&\quad+\left.\left(\mathbf{M}_{1\ell'1}(\mathbf{r},k_0) - \mathrm{i}\mathbf{N}_{0\ell'1}(\mathbf{r},k_0) \vphantom{\chi^{(1)}} \right)\right] + \mathrm{c.c.r.}
\end{split}
\end{equation}
Even as it splits nicely into positive- and negative-frequency second-harmonic terms, Eq. \eqref{eq:J2_2} is so cumbersome that it is only really useful as a quantity that helps us when calculating final observables. However, defining shorthand notation to make life easier is possible.

Separating the wave equation for $\mathbf{E}^{(2)}(\mathbf{r},\omega)$ into free-space and response components, we have
\begin{equation}
\begin{split}
\nabla\times\nabla\times\mathbf{E}^{(2)}_\infty(\mathbf{r},\omega)-\frac{\omega^2}{c^2}\mathbf{E}^{(2)}_\infty(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^{(2)}(\mathbf{r},\omega),\\
\nabla\times\nabla\times\mathbf{E}^{(2)}_\mathrm{res}(\mathbf{r},\omega)-\epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}^{(2)}_\mathrm{res}(\mathbf{r},\omega) &= 4\pi\frac{\omega^2}{c^2}\chi^{(1)}(\omega)\mathbf{E}^{(2)}_\infty(\mathbf{r},\omega).
\end{split}
\end{equation}
Therefore,
\begin{equation}
\begin{split}
\mathbf{E}^{(2)}_\infty(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}',
\end{split}
\end{equation}
which, due to the extended form of Eq. \eqref{eq:J2_2}, is extremely unwieldy to write in its full form. However, we can use several notation modifications to produce sensible results. First, we can define a unitless function to standardize and simplify the notation of our radial integrals and intermediate harmonics,
\begin{equation}\label{eq:U}
U_{T\ell}^i(k_1,k_2;r_1,r_2) = 
\begin{cases}
k_2^3R_\ell^i(k_1,k_2;r_1,r_2), & T = M,\\[0.25em]
k_2^3\left(\dfrac{\ell + 1}{2\ell + 1}R_{\ell - 1}^i(k_1,k_2;r_1,r_2) + \dfrac{\ell}{2\ell + 1}R_{\ell + 1}^i(k_1,k_2;r_1,r_2)\right), & T = E,
\end{cases}
\end{equation}
with $i \in\{<,<>\}$ such that
\begin{equation}
\widebar{\mathbf{X}}_{Tp\ell m}(\mathbf{r},k) = \mathbf{X}_{Tp\ell m}(\mathbf{r},k)U_{T\ell}^{<>}(k,k_0;r,a) + \bm{\mathcal{X}}_{Tp\ell m}(\mathbf{r},k)U_{T\ell}^<(k,k_0;0,r).
\end{equation}
% \begin{equation}
% \widebar{\mathbf{N}}_{p\ell m}(\mathbf{r},k) = \mathbf{N}_{p\ell m}(\mathbf{r},k)k_0^3U_\ell^{<>}(k,k_0;r,a) + \bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)k_0^3U_\ell^<(k,k_0;0,r),
% \end{equation}
Next, we can see that the integration of the second-order current against the free-space Green's function will simplify into a sum of integrals each taken over three vector harmonics and, possibly, a number of $r$-dependent factors. To define these integrals, we will first simplify our notation by using the collective indices $\bm{\alpha}_i = (T_i,p_i,\ell_i,m_i)$ to label the modes of the first-order solution that contribute to $\mathbf{J}^{(2)}$ and the modes of the second-order fields. We will then also define values $t_i\in\{0,1\}$ that designate the presence of factors $U_{T\ell}^i$ that depend on $r$. In total, we have a set of four integrals
\begin{equation}
\begin{split}
I^{<<<}_{\bm{\alpha}_1\bm{\alpha}_2\bm{\alpha}_3}&(k_1,k_2,k_3;t_1,t_2,t_3;r_1,r_2) = \int_0^{2\pi}\int_0^\pi\int_{r_1}^{r_2}\left[U_{\bm{\alpha}_1}^{<>}(k_1,k_0;r,r_2)\right]^{t_1}\left[U_{\bm{\alpha}_2}^{<>}(k_2,k_0;r,r_2)\right]^{t_2}\\
&\times\left[U_{\bm{\alpha}_3}^{<>}(k_3,k_0;r,r_2)\right]^{t_3}\mathbf{X}_{\bm{\alpha}_1}(\mathbf{r},k_1)\cdot\left[\mathbf{X}_{\bm{\alpha}_2}(\mathbf{r},k_2)\cdot\bm{1}_3\cdot\mathbf{X}_{\bm{\alpha}_3}(\mathbf{r},k_3)\right]r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi,\\[0.5em]
I^{><<}_{\bm{\alpha}_1\bm{\alpha}_2\bm{\alpha}_3}&(k_1,k_2,k_3;t_1,t_2,t_3;r_1,r_2) = \int_0^{2\pi}\int_0^\pi\int_{r_1}^{r_2}\left[U_{\bm{\alpha}_1}^{<}(k_1,k_0;r_1,r)\right]^{t_1}\left[U_{\bm{\alpha}_2}^{<>}(k_2,k_0;r,r_2)\right]^{t_2}\\
&\times\left[U_{\bm{\alpha}_3}^{<>}(k_3,k_0;r,r_2)\right]^{t_3}\bm{\mathcal{X}}_{\bm{\alpha}_1}(\mathbf{r},k_1)\cdot\left[\mathbf{X}_{\bm{\alpha}_2}(\mathbf{r},k_2)\cdot\bm{1}_3\cdot\mathbf{X}_{\bm{\alpha}_3}(\mathbf{r},k_3)\right]r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi,\\[0.5em]
I^{>><}_{\bm{\alpha}_1\bm{\alpha}_2\bm{\alpha}_3}&(k_1,k_2,k_3;t_1,t_2,t_3;r_1,r_2) = \int_0^{2\pi}\int_0^\pi\int_{r_1}^{r_2}\left[U_{\bm{\alpha}_1}^{<}(k_1,k_0;r_1,r)\right]^{t_1}\left[U_{\bm{\alpha}_2}^{<}(k_2,k_0;r_1,r)\right]^{t_2}\\
&\times\left[U_{\bm{\alpha}_3}^{<>}(k_3,k_0;r,r_2)\right]^{t_3}\bm{\mathcal{X}}_{\bm{\alpha}_1}(\mathbf{r},k_1)\cdot\left[\bm{\mathcal{X}}_{\bm{\alpha}_2}(\mathbf{r},k_2)\cdot\bm{1}_3\cdot\mathbf{X}_{\bm{\alpha}_3}(\mathbf{r},k_3)\right]r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi,\\[0.5em]
I^{>>>}_{\bm{\alpha}_1\bm{\alpha}_2\bm{\alpha}_3}&(k_1,k_2,k_3;t_1,t_2,t_3;r_1,r_2) = \int_0^{2\pi}\int_0^\pi\int_{r_1}^{r_2}\left[U_{\bm{\alpha}_1}^{<}(k_1,k_0;r_1,r)\right]^{t_1}\left[U_{\bm{\alpha}_2}^{<}(k_2,k_0;r_1,r)\right]^{t_2}\\
&\times\left[U_{\bm{\alpha}_3}^{<}(k_3,k_0;r_1,r)\right]^{t_3}\bm{\mathcal{X}}_{\bm{\alpha}_1}(\mathbf{r},k_1)\cdot\left[\bm{\mathcal{X}}_{\bm{\alpha}_2}(\mathbf{r},k_2)\cdot\bm{1}_3\cdot\bm{\mathcal{X}}_{\bm{\alpha}_3}(\mathbf{r},k_3)\right]r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi
\end{split}
\end{equation} 
that can be used to calculate our fields in each region. Permutations of the region indices $<$, $>$ and their associated $\bm{\alpha}_i$, $t_i$, and $k_i$ values are possible, and do not require separate definitions.

Using this simplified notation, we can define the expansion coefficient
\begin{equation}
w_{\bm{\alpha}}(\omega) = 
\begin{cases}
c_{1\ell1}^<(\omega), & T = M,\\
d_{0\ell1}^<(\omega), & T = E,
\end{cases}
\end{equation}
wherein we have assumed that $\bm{\alpha} \in \{(M,1,\ell,1),(E,0,\ell,1)\}$. This, in turn, allows for the shortening of the expression for the second-order bound current
\begin{equation}
\begin{split}
\mathbf{J}^{(2)}(\mathbf{r},\omega) &= -\frac{\mathrm{i}\omega}{2}E_0^2\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega - \omega_0)\\
&\times\sum_{\bm{\alpha},\bm{\alpha}'}\kappa_\ell\kappa_{\ell'}(-\mathrm{i})^{\delta_{TE}+\delta_{T'E}}\left[\mathrm{i}\pi k_0^3\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}w_{\bm{\alpha}}(\omega_0)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0)\right.\\
&+ \left.\mathrm{i}\pi\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}\widebar{\mathbf{X}}_{\bm{\alpha}}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) + \mathbf{X}_{\bm{\alpha}}(\mathbf{r},k_0)\right]\cdot\bm{1}_3\cdot\left[\mathrm{i}\pi k_0^3\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}w_{\bm{\alpha}'}(\omega_0)\right.\\
&\times\left.\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) + \mathrm{i}\pi\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}\widebar{\mathbf{X}}_{\bm{\alpha}'}(\mathbf{r},\sqrt{\epsilon(\omega_0)}k_0) + \mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k_0)\right] + \mathrm{c.c.r.},
\end{split}
\end{equation}
wherein the sums on $\bm{\alpha}$ and $\bm{\alpha}'$ are shorthand for sums over $T$, $\ell$, $T'$, and $\ell'$. Moving forward, we can see that, outside the sphere,
\begin{equation}\label{eq:Efree2_1}
\begin{split}
\mathbf{E}_{\infty,1}^{(2)}(\mathbf{r},\omega) &= \Theta(r - a)\frac{4\pi\mathrm{i}\omega}{c}\int\frac{\mathrm{i}\omega}{4\pi c}\sum_{\bm{\beta}}\left[\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k)\right]\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'\\
&= \Theta(r - a)\frac{\mathrm{i}\omega^3}{2c^3}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega - \omega_0)\\
&\quad\times\sum_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}\kappa_\ell\kappa_{\ell'}(-\mathrm{i})^{\delta_{TE} + \delta_{T'E}}I^{<}_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}(k;0,a)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.}\\
&=\Theta(r - a)E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\sum_{\bm{\beta}}u_{\bm{\beta}}^<(k)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.}
\end{split}
\end{equation}
Here, the overlap integrals $I^{<}_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}(k;0,a)$ are defined such that
\begin{equation}
\begin{split}
I^{<}_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}(k;r_1,r_2) &= \left(-\pi^2k_0^6\left[\chi^{(1)}(\omega_0)\right]^2\epsilon(\omega_0)w_{\bm{\alpha}}(\omega_0)w_{\bm{\alpha}'}(\omega_0)I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,0,0;r_1,r_2)\right.\\
&\quad - \pi^2k_0^3\left[\chi^{(1)}(\omega_0)\right]^2\epsilon(\omega_0)w_{\bm{\alpha}}(\omega_0)\left[I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,0,1;r_1,r_2)\right.\\
&\quad\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<>}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,0,1;r_1,r_2)\right]\\
&\quad + \mathrm{i}\pi k_0^3\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}w_{\bm{\alpha}}(\omega_0)I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,\sqrt{\epsilon(\omega_0)}k_0,k_0;0,0,0;r_1,r_2)\\
&\quad - \pi^2k_0^3\left[\chi^{(1)}(\omega_0)\right]^2\epsilon(\omega_0)w_{\bm{\alpha}'}(\omega_0)\left[I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,1,0;r_1,r_2)\right.\\
&\quad\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<><}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,1,0;r_1,r_2)\right]\\
&\quad - \pi^2\left[\chi^{(1)}(\omega_0)\right]^2\epsilon(\omega_0)\left[I_{\bm{\beta}\bm{\alpha}\bm{\alpha}}^{<<<}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,1,1;r_1,r_2)\right.\\
&\quad\quad + I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<>}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,1,1;r_1,r_2)\\
&\quad\quad + I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<><}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,1,1;r_1,r_2)\\
&\quad\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<>>}(k,\sqrt{\epsilon(\omega_0)}k_0,\sqrt{\epsilon(\omega_0)}k_0;0,1,1;r_1,r_2)\right]\\
&\quad + \mathrm{i}\pi\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}\left[I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,\sqrt{\epsilon(\omega_0)}k_0,k_0;0,1,0;r_1,r_2)\right.\\
&\quad\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<><}(k,\sqrt{\epsilon(\omega_0)}k_0,k_0;0,1,0;r_1,r_2)\right]\\
&\quad + \mathrm{i}\pi k_0^3\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}w_{\bm{\alpha}'}(\omega_0)I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,k_0,\sqrt{\epsilon(\omega_0)}k_0;0,0,0;r_1,r_2)\\
&\quad + \mathrm{i}\pi\chi^{(1)}(\omega_0)\sqrt{\epsilon(\omega_0)}\left[I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,k_0,\sqrt{\epsilon(\omega_0)}k_0;0,0,1;r_1,r_2)\right.\\
&\quad\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<>}(k,k_0,\sqrt{\epsilon(\omega_0)}k_0;0,0,1;r_1,r_2)\right]\\
&\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<<<}(k,k_0,k_0;0,0,0;r_1,r_2) \vphantom{\left[\chi^{(1)}(\omega_0)\right]^2} \right),
\end{split}
\end{equation}
and
\begin{equation}
u_{\bm{\beta}}^<(k;r_1,r_2) = \sum_{\bm{\alpha}\bm{\alpha}'}\kappa_{\ell}\kappa_{\ell'}(-\mathrm{i})^{\delta_{TE} + \delta_{T'E}}\frac{\mathrm{i}\omega^3}{2 c^3}I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^<(k;r_1,r_2),
\end{equation}
with the shorthand
\begin{equation}
u_{\bm{\beta}}^<(k) = u_{\bm{\beta}}^<(k;0,a)
\end{equation}
defined for brevity. We wish to similarly define the free fields inside the sphere, but we would like to do so without repeating the horrible accounting of terms that we just did above. Fortuitously, the symmetry of the Green's function allows us to avoid undue effort. Noting that
\begin{equation}
\begin{split}
\mathbf{E}_{\infty,2}^{(2)}(\mathbf{r},\omega) &= \Theta(a - r)\frac{4\pi\mathrm{i}\omega}{c}\int\frac{\mathrm{i}\omega}{4\pi c}\sum_{\bm{\beta}}\left[\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k)\Theta(r - r')\right.\\
& + \left.\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r}',k)\Theta(r' - r)\right]\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'
\end{split}
\end{equation}
involves nearly the same integration as above except that it is broken into two segments below and above $r$, we can define
\begin{equation}
\begin{split}
I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{>}(k;r_1,r_2) &= \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<}(k;r_1,r_2)\right|_{\mathbf{X}_{\bm{\beta}}\to\bm{\mathcal{X}}_{\bm{\beta}}},\\
u_{\bm{\beta}}^>(k;r_1,r_2) &= \left.u_{\bm{\beta}}^<(k;r_1,r_2)\right|_{\mathbf{X}_{\bm{\beta}}\to\bm{\mathcal{X}}_{\bm{\beta}}},
\end{split}
\end{equation} 
which lead directly to
\begin{equation}\label{eq:Efree2_2}
\begin{split}
\mathbf{E}_{\infty,2}^{(2)}(\mathbf{r},\omega) &= \Theta(a - r)\frac{\mathrm{i}\omega^3}{2c^3}E_0^2\pi\delta(\omega - 2\omega_0)\chi(\omega_0,\omega - \omega_0)\sum_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}\kappa_\ell\kappa_{\ell'}(-\mathrm{i})^{\delta_{TE} + \delta_{T'E}}\\
&\times\left(I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{<}(k;0,r)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^{>}(k;r,a)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k) \right) + \mathrm{c.c.r.}\\
&= \Theta(a - r)E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\sum_{\bm{\beta}}\left(u_{\bm{\beta}}^<(k;0,r)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + u_{\bm{\beta}}^>(k;r,a)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)\right) + \mathrm{c.c.r.}
\end{split}
\end{equation}

The expression for the response fields follows in a similar vein. We can make life easier by defining
\begin{equation}
\begin{split}
V_{Tp\ell m}(\omega) &= 
\begin{cases}
A_{p\ell m}^<(\omega), & T = M,\\
B_{p\ell m}^<(\omega), & T = E,
\end{cases}\\
W_{Tp\ell m}(\omega) &=
\begin{cases}
C_{p\ell m}^<(\omega), & T = M,\\
D_{p\ell m}^<(\omega), & T = E,
\end{cases}
\end{split}
\end{equation}
such that
\begin{equation}
\begin{split}
\mathbf{E}_{\mathrm{res},1}^{(2)}(\mathbf{r},\omega) &= \Theta(r - a)\frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}_{12}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'\\
&= \frac{4\pi\mathrm{i}\omega}{c}\int_{\mathbb{V}_2}\frac{\mathrm{i}\omega\sqrt{\epsilon(\omega)}}{4\pi c}\sum_{\bm{\beta}}V_{\bm{\beta}}(\omega)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r}',\sqrt{\epsilon(\omega)}k\right)\cdot\mathbf{J}^{(2)}(\mathbf{r}',\omega)\;\mathrm{d}^3\mathbf{r}'\\
&= \Theta(r - a)\frac{\mathrm{i}\omega^3}{2c^3}\sqrt{\epsilon(\omega)}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega - \omega_0)\\
&\quad\times\sum_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}V_{\bm{\beta}}(\omega)\kappa_\ell\kappa_{\ell'}(-\mathrm{i})^{\delta_{TE} + \delta_{T'E}}I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^<\!\left(\sqrt{\epsilon(\omega)}k;0,a\right)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.}\\[1.0em]
&= \Theta(r - a)\sqrt{\epsilon(\omega)}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\\
&\quad\times\sum_{\bm{\beta}}V_{\bm{\beta}}(\omega)u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k\right)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.}
\end{split}
\end{equation}
Further, 
\begin{equation}
\begin{split}
\mathbf{E}_{\mathrm{res},2}^{(2)}(\mathbf{r},\omega) &= \Theta(a - r)\frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}_{22}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'\\
&=\Theta(a-r)\frac{4\pi\mathrm{i}\omega}{c}\int\frac{\mathrm{i}\omega\sqrt{\epsilon(\omega)}}{4\pi c}\sum_{\bm{\beta}}\left[W_{\bm{\beta}}(\omega)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r}',\sqrt{\epsilon(\omega)}k\right)\right.\\
&\quad+\bm{\mathcal{X}}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r}',\sqrt{\epsilon(\omega)}k\right)\Theta(r - r')\\
&\quad + \left.\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\bm{\mathcal{X}}_{\bm{\beta}}\!\left(\mathbf{r}',\sqrt{\epsilon(\omega)}k\right)\Theta(r' - r)\right]\cdot\frac{\mathbf{J}^{(2)}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'\\
&=\Theta(a - r)\frac{\mathrm{i}\omega^3}{2c^3}\sqrt{\epsilon(\omega)}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega - \omega_0)\\
&\quad\times\sum_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}\kappa_\ell\kappa_{\ell'}(-\mathrm{i})^{\delta_{TE} + \delta_{T'E}}\left[W_{\bm{\beta}}(\omega)I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^<\!\left(\sqrt{\epsilon(\omega)}k;0,a\right)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right.\\
&\quad + \left.I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^<\!\left(\sqrt{\epsilon(\omega)}k;0,r\right)\bm{\mathcal{X}}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right) + I_{\bm{\beta}\bm{\alpha}\bm{\alpha}'}^>\!\left(\sqrt{\epsilon(\omega)}k;r,a\right)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right]\\
&\quad + \mathrm{c.c.r.},
\end{split}
\end{equation}
such that
\begin{equation}
\begin{split}
\mathbf{E}_{\mathrm{res},2}^{(2)}(\mathbf{r},\omega) &=\Theta(a - r)\sqrt{\epsilon(\omega)}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\\
&\times\sum_{\bm{\beta}}\left[W_{\bm{\beta}}(\omega)u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k\right)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right) + u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k;0,r\right)\bm{\mathcal{X}}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right.\\
&+ \left.u_{\bm{\beta}}^>\!\left(\sqrt{\epsilon(\omega)}k;r,a\right)\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right] + \mathrm{c.c.r.}
\end{split}
\end{equation}







\subsubsection{Boundary Condition Satisfaction}

The solution for the free fields can be seen to straightforwardly satisfy the Maxwell boundary conditions at $r = a$. Because they satisfy the wave equation with $\epsilon(\mathbf{r},\omega)\to1$, both the surface parallel and perpendicular terms of the field must be continuous, a condition which is immediately satisfied by letting $r\to a$ in Eq. \eqref{eq:Efree2_2} and noting that 1) the second term under the sum proportional to $u_{\bm{\beta}}^{>}(k;r,a)$ goes to zero and 2) the first becomes precisely equal to the expression of Eq. \eqref{eq:Efree2_1}.

The response fields' boundary conditions can be seen to be satisfied using Eqs. \eqref{eq:parallelIdentity1} and \eqref{eq:perpIdentity1}, which, alongside the identity $u_{\bm{\beta}}^>(\sqrt{\epsilon(\omega)}k;a,a) = 0$, provides
\begin{equation}
\begin{split}
\left[W_{\bm{\beta}}(\omega)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\sqrt{\epsilon(\omega)}k) + \bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\right]_{r= a}\cdot\hat{\mathbf{e}}_\parallel = \left.V_{\bm{\beta}}(\omega)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\right|_{r = a}\cdot\hat{\mathbf{e}}_\parallel,\\
\epsilon(\omega)\left[W_{\bm{\beta}}(\omega)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\sqrt{\epsilon(\omega)}k) + \bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\right]_{r= a}\cdot\hat{\mathbf{r}} = \left.V_{\bm{\beta}}(\omega)\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\right|_{r = a}\cdot\hat{\mathbf{r}}.
\end{split}
\end{equation}
The boundary conditions
\begin{equation}
\begin{split}
\hat{\mathbf{r}}\times\left[\mathbf{E}_{\mathrm{res},1}^{(2)}(\mathbf{r},\omega) - \mathbf{E}_{\mathrm{res},2}^{(2)}(\mathbf{r},\omega)\right]_{r = a} &= \bm{0},\\
\hat{\mathbf{r}}\cdot\left[\mathbf{E}_{\mathrm{res},1}^{(2)}(\mathbf{r},\omega) - \epsilon(\omega)\mathbf{E}_{\mathrm{res},2}^{(2)}(\mathbf{r},\omega)\right]_{r = a} &= 0
\end{split}
\end{equation}
are thus satisfied by inspection.












\subsubsection{Scattered Power}

To calculate the power scattered by the SHG fields, one must first calculate the magnetic fields associated with $\mathbf{E}^{(2)}(\mathbf{r},\omega)$. These fields can be quickly determined from Faraday's law,
\begin{equation}
\mathbf{B}^{(2)}(\mathbf{r},\omega) = \frac{1}{\mathrm{i}k}\nabla\times\mathbf{E}^{(2)}(\mathbf{r},\omega).
\end{equation}
First looking at the free fields, we find
\begin{equation}
\begin{split}
\mathbf{B}_{\infty,1}^{(2)}(\mathbf{r},\omega) &= -\mathrm{i}\Theta(r - a)E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\sum_{\bm{\beta}}u_{\bm{\beta}}^<(k)\bm{\mathcal{Y}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.},\\
\mathbf{B}_{\infty,2}^{(2)}(\mathbf{r},\omega) &= -\mathrm{i}\Theta(a - r)E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\sum_{\bm{\beta}}\left[u_{\bm{\beta}}^<(k;0,r)\bm{\mathcal{Y}}_{\bm{\beta}}(\mathbf{r},k)\right.\\
&\left. + \frac{1}{k}\nabla u_{\bm{\beta}}^<(k;r,a)\times\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) +  u_{\bm{\beta}}^>(k;r,a)\mathbf{Y}_{\bm{\beta}}(\mathbf{r},k) + \frac{1}{k}\nabla u_{\bm{\beta}}^>(k;r,a)\times\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)\right] + \mathrm{c.c.r.},
\end{split}
\end{equation}
where we have defined new vector spherical harmonic functions
\begin{equation}
\begin{split}
\mathbf{Y}_{\bm{\beta}}(\mathbf{r},k) &= \frac{1}{k}\nabla\times\mathbf{X}_{\bm{\beta}}(\mathbf{r},k),\\
\bm{\mathcal{Y}}_{\bm{\beta}}(\mathbf{r},k) &= \frac{1}{k}\nabla\times\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)
\end{split}
\end{equation}
that, due to the relations
\begin{equation}
\begin{split}
\nabla\times\mathbf{M}_{\bm{\beta}}(\mathbf{r},k) &= k\mathbf{N}_{\bm{\beta}}(\mathbf{r},k),\\
\nabla\times\mathbf{N}_{\bm{\beta}}(\mathbf{r},k) &= k\mathbf{M}_{\bm{\beta}}(\mathbf{r},k),
\end{split}
\end{equation}
and similar for $\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)\to\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)$ above, define our new spherical harmonics as simply the old ones but with the ``wrong'' type index, i.e. with the transformation $M\to E$ or vice-versa. Further, we can see that neither field $\mathbf{B}_{\infty,i}^{(2)}(\mathbf{r},\omega)$ contains a term with a derivative acting on the Heaviside functions. It is straightforward to see why---taking the curl of the total free electric field, one can see that any terms proportional to $\nabla\Theta(\pm [r - a]) = \pm\delta(r - a)\hat{\mathbf{r}}$ exactly cancel such that the region-separated free fields need not carry these eventually-nullified terms in their definitions.

The definitions of the response field in each region follows from above, such that
\begin{equation}
\begin{split}
\mathbf{B}_{\mathrm{res},1}^{(2)}&(\mathbf{r},\omega) = -\mathrm{i}\Theta(r - a)\sqrt{\epsilon(\omega)}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\\
&\times\sum_{\bm{\beta}}V_{\bm{\beta}}(\omega)u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k\right)\bm{\mathcal{Y}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.},\\[0.5em]
\mathbf{B}_{\mathrm{res},2}^{(2)}&(\mathbf{r},\omega) = -\mathrm{i}\Theta(a - r)\sqrt{\epsilon(\omega)}E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\\
&\times\sum_{\bm{\beta}}\left[W_{\bm{\beta}}(\omega)\sqrt{\epsilon(\omega)}u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k\right)\mathbf{Y}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right) + \sqrt{\epsilon(\omega)}u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k;0,r\right)\bm{\mathcal{Y}}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right.\\
&\hspace{0.05\textwidth}\left. + \frac{1}{k}\nabla u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k;0,r\right)\times\bm{\mathcal{X}}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right) + \sqrt{\epsilon(\omega)}u_{\bm{\beta}}^>\!\left(\sqrt{\epsilon(\omega)}k;r,a\right)\mathbf{Y}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right.\\
&\hspace{0.05\textwidth}\left. + \frac{1}{k}\nabla u_{\bm{\beta}}^>\!\left(\sqrt{\epsilon(\omega)}k;r,a\right)\times\mathbf{X}_{\bm{\beta}}\!\left(\mathbf{r},\sqrt{\epsilon(\omega)}k\right)\right] + \mathrm{c.c.r.}
\end{split}
\end{equation}
We are now ready to calculate the scattered second-harmonic power. In general, we will do this by calculating the time-averaged energy flux carried away to infinity by the second-harmonic fields, i.e.
\begin{equation}
\bar{P}(2\omega_0) = \frac{2\omega_0}{2\pi}\int_{-\pi/2\omega_0}^{\pi/2\omega_0} \oint\mathbf{S}^{(2)}(\mathbf{r},t)\cdot\mathrm{d}\mathbf{a}\,\mathrm{d}t,
\end{equation}
wherein
\begin{equation}
\mathbf{S}^{(2)}(\mathbf{r},t) = \frac{c}{4\pi}\mathbf{E}^{(2)}(\mathbf{r},t)\times\mathbf{B}^{(2)}(\mathbf{r},t)
\end{equation}
is the Poynting vector of the second-harmonic fields and the surface integral is taken over a sphere centered at the origin with a radius that is taken to infinity. Using the convolution theorem, we can see that
\begin{equation}
\int_{-\tau}^\tau\mathbf{S}^{(2)}(\mathbf{r},t)\;\mathrm{d}t = \frac{c}{2\pi}\iint\frac{\sin([\omega - \omega']\tau)}{\omega - \omega'}\mathbf{E}^{(2)}(\mathbf{r},\omega)\times\mathbf{B}^{(2)*}(\mathbf{r},\omega')\;\frac{\mathrm{d}\omega\mathrm{d}\omega'}{4\pi^2},
\end{equation}
such that with $\mathrm{d}\mathbf{a} = \hat{\mathbf{r}}r^2\sin\theta\,\mathrm{d}\theta\mathrm{d}\phi$ we have
\begin{equation}
\bar{P}(2\omega_0) = \lim_{r\to\infty}\frac{c\omega_0}{2\pi^2}\int_0^{2\pi}\int_0^\pi\iint\frac{\sin([\omega - \omega']\frac{\pi}{2\omega_0})}{\omega - \omega'}\mathbf{E}^{(2)}(\mathbf{r},\omega)\times\mathbf{B}^{(2)*}(\mathbf{r},\omega')\;\frac{\mathrm{d}\omega\mathrm{d}\omega'}{4\pi^2}\cdot\hat{\mathbf{r}}r^2\sin\theta\;\mathrm{d}\theta\mathrm{d}\phi.
\end{equation}
Thus, including only the fields outside the sphere, we have
\begin{equation}
\begin{split}
\bar{P}(2\omega_0) &= \lim_{r\to\infty}\frac{c\omega_0}{2\pi^2}\int_0^{2\pi}\int_0^\pi\iint\frac{\sin([\omega - \omega']\frac{\pi}{2\omega_0})}{\omega - \omega'}\left( \vphantom{\sum_{\bm{\beta}}} E_0^2\pi\delta(\omega - 2\omega_0)\chi^{(2)}(\omega_0,\omega_0)\right.\\
&\left.\times\sum_{\bm{\beta}}\left[\sqrt{\epsilon(\omega)}V_{\bm{\beta}}(\omega)u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(\omega)}k\right) + u_{\bm{\beta}}^<(k)\right]\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k) + \mathrm{c.c.r.}\right)\\
&\times\left(\mathrm{i}E_0^2\pi\delta(\omega' - 2\omega_0)\chi^{(2)*}(\omega_0,\omega_0)\sum_{\bm{\beta}'}\left[\sqrt{\epsilon^*(\omega')}V_{\bm{\beta}'}^*(\omega')u_{\bm{\beta}'}^{<*}\!\left(\sqrt{\epsilon(\omega')}k'\right)\right.\right.\\
&+ \left.\left.u_{\bm{\beta}'}^{<*}(k')\right]\bm{\mathcal{Y}}_{\bm{\beta}'}^*(\mathbf{r},k') + \mathrm{c.c.r.} \vphantom{\sum_{\bm{\beta}'}} \right)\;\frac{\mathrm{d}\omega\mathrm{d}\omega'}{4\pi^2}\cdot\hat{\mathbf{r}}r^2\sin\theta\,\mathrm{d}\theta\mathrm{d}\phi.
\end{split}
\end{equation}

Because
\begin{equation}
\begin{split}
\lim_{[\omega - \omega']\to\pm2\pi}\frac{\sin([\omega - \omega']\frac{\pi}{2\omega_0})}{\omega - \omega'} &= 0,\\
\lim_{[\omega - \omega']\to0}\frac{\sin([\omega - \omega']\frac{\pi}{2\omega_0})}{\omega - \omega'} &= \frac{\pi}{2\omega_0},
\end{split}
\end{equation}
we can see that only terms above that are proportional to $\delta(\omega\mp2\omega_0)\delta(\omega'\mp2\omega_0)$ are nonzero. Thus, the expression for the scattered power becomes
\begin{equation}
\begin{split}
\bar{P}(2\omega_0) &= \frac{\mathrm{i}c}{16\pi}E_0^4\left|\chi^{(2)}(\omega_0,\omega_0)\right|^2\sum_{\bm{\beta}\bm{\beta}'}\left[\sqrt{\epsilon(2\omega_0)}V_{\bm{\beta}}(2\omega_0)u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(2\omega_0)}2k_0\right) + u_{\bm{\beta}}^<(2k_0)\right]\\ 
&\hspace{0.1\textwidth}\times\left[\sqrt{\epsilon^*(2\omega_0)}V_{\bm{\beta}'}^*(2\omega_0)u_{\bm{\beta}'}^{<*}\!\left(\sqrt{\epsilon(2\omega_0)}2k_0\right) + u_{\bm{\beta}'}^{<*}(2k_0)\right]\\
&\hspace{0.1\textwidth}\times\lim_{r\to\infty}\int_0^{2\pi}\int_0^\pi\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},2k_0)\times\bm{\mathcal{Y}}_{\bm{\beta}'}^*(\mathbf{r},2k_0)\cdot\hat{\mathbf{r}}r^2\sin\theta\;\mathrm{d}\theta\mathrm{d}\phi + \mathrm{c.c.}
\end{split}
\end{equation}
To simplify this expression, we can use the identities
\begin{equation}
\begin{split}
\lim_{r\to\infty}\int_0^{2\pi}\int_0^\pi\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\times\bm{\mathcal{Y}}_{\bm{\beta}'}^*(\mathbf{r},k)\cdot\hat{\mathbf{r}}r^2\sin\theta\;\mathrm{d}\theta\mathrm{d}\phi &= 4\pi(1 - \delta_{p1}\delta_{m0})\frac{(-1)^{\ell + 1}\mathrm{i}^{2\ell + 1}}{k^2}\delta_{\bm{\beta}\bm{\beta}'},\\
\lim_{r\to\infty}\int_0^{2\pi}\int_0^\pi\bm{\mathcal{X}}_{\bm{\beta}}(\mathbf{r},k)\times\bm{\mathcal{X}}_{\bm{\beta}'}^*(\mathbf{r},k)\cdot\hat{\mathbf{r}}r^2\sin\theta\;\mathrm{d}\theta\mathrm{d}\phi &= 0,
\end{split}
\end{equation}
along with $\mathrm{i}^{2\ell + 2}(-1)^{\ell + 1} = 1$, to provide us with
\begin{equation}
\begin{split}
\bar{P}(2\omega_0) = \sum_{\bm{\beta}}(1 - \delta_{p1}\delta_{m0})\frac{c}{16k_0^2}E_0^4\left|\chi^{(2)}(\omega_0,\omega_0)\right|^2\left|\sqrt{\epsilon(2\omega_0)}V_{\bm{\beta}}(2\omega_0)u_{\bm{\beta}}^<\!\left(\sqrt{\epsilon(2\omega_0)}2k_0\right) + u_{\bm{\beta}}^<(2k_0)\right|^2.
\end{split}
\end{equation}
























\newpage
\section{Spontaneous Parametric Downconversion with a Monochromatic Plane Wave Source (Quantum)}\label{sec:SPDCquantum}





\subsection{Expansion of the First-Principles Lagrangian}\label{sec:LagrangianExpansion}

To describe the quantum electrodynamical generation of downconverted photons from a single input beam, we need to rebuild our first principles in terms of quantum-mechanical operators and organize these operators inside of a Hamiltonian formalism. To do so, we will begin with the classical Lagrangian density of the electromangetic field,
\begin{equation}\label{eq:lagrangianDensity1}
\begin{split}
\mathcal{L}&\left[\mathbf{x}_1,\ldots,\mathbf{x}_N,\dot{\mathbf{x}}_1,\ldots,\dot{\mathbf{x}}_N;\mathbf{A},\dot{\mathbf{A}},\Phi,\dot{\Phi};\mathbf{r},t\right] = \sum_{i = 1}^N\frac{1}{2}\mu_i\dot{\mathbf{x}}_i^2(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] + \frac{1}{8\pi}\left[\mathbf{E}^2(\mathbf{r},t) - \mathbf{B}^2(\mathbf{r},t)\right]\\
&+ \sum_{i = 1}^N\frac{e_i}{c}\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)]\cdot\mathbf{A}(\mathbf{r},t) - \sum_{i = 1}^Ne_i\delta[\mathbf{r} - \mathbf{x}_i(t)]\Phi(\mathbf{r},t).
\end{split}
\end{equation}





\subsubsection{Scalar potential term}

We will begin by analyzing the last term of the above expression. It is clear from the Euler-Lagrange equations for the scalar potential $\Phi(\mathbf{r},t)$ that, in the Coulomb gauge defined by $\nabla\cdot\mathbf{A}(\mathbf{r},t) = 0$, the scalar potential's dynamics are straightforwardly determined by the dynamics of the charges $e_i$. Explicitly, as shown in Section \ref{sec:PZWderivation}, one can see from
\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}t}\left\{\frac{\partial \mathcal{L}}{\partial \dot{\Phi}(\mathbf{r},t)}\right\} = \frac{\partial \mathcal{L}}{\partial \Phi(\mathbf{r},t)} - \sum_{\nu = 1}^3\frac{\partial}{\partial r_\nu}\frac{\partial \mathcal{L}}{\partial\!\left(\frac{\partial \Phi(\mathbf{r},t)}{\partial r_\nu}\right)}
\end{equation}
that
\begin{equation}
\nabla\cdot\mathbf{E}_\parallel(\mathbf{r},t) = 4\pi\rho(\mathbf{r},t).
\end{equation}
Here, $\mathbf{E}_\parallel(\mathbf{r},t) = -\nabla\Phi(\mathbf{r},t)$ is the longitudinal (i.e., irrotational or curl-free) part of the electric field and $\rho(\mathbf{r},t) = \sum_ie_i\delta[\mathbf{r} - \mathbf{x}_i(t)]$ is the charge density of the system. Therefore, 
\begin{equation}
\Phi(\mathbf{r},t) = \int\frac{\rho(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'
\end{equation}
such that the scalar potential at each point $(\mathbf{r},t)$ depends only on the positions of the charges at $t$ and experiences no retardation effects.

To see why this is a useful starting point for analyzing the Lagrangian, we can see that the charges are each acted upon by a potential energy density
\begin{equation}
\begin{split}
u_\Phi(\mathbf{r},t) &= \sum_ie_i\delta[\mathbf{r} - \mathbf{x}_i(t)]\Phi(\mathbf{r},t)\\
&= \int\frac{\rho(\mathbf{r},t)\rho(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'.
\end{split}
\end{equation}
This potential can then be simplified via phenomenologically-driven approximations. First, we can assume the $N$ charges of the model are made of $N_m$ charges $e_{mi}$ responsible for the interesting behavior of the material, $N_b = N_m$ background charges $e_{bi} = -e_{mi}$ that counterbalance the material charges in an unperturbed system, $N_r$ secondary reservoir charges $e_{ri}$ that interact with the material and background charges only weakly and are globally neutral, and $N_f$ free charges $e_{fi}$ that are well-separated from the material and serve only to drive the system. In total, $\sum_ie_i\delta[\mathbf{r} - \mathbf{x}_i(t)] = \sum_{\alpha = \{m,b,r,f\}}\sum_{i = 1}^{N_\alpha}e_{\alpha i}\delta[\mathbf{r} - \mathbf{x}_{\alpha i}(t)]$ or $\rho(\mathbf{r},t) = \rho_m(\mathbf{r},t) + \rho_b(\mathbf{r},t) + \rho_r(\mathbf{r},t) + \rho_f(\mathbf{r},t)$.

We will assume that the free charges do not interact significantly with the reservoir such that $u_{\Phi,fr} \approx u_{\Phi,rf} \approx 0$ where $u_{\Phi,\alpha\beta}(\mathbf{r},t) = \int\mathrm{d}^3\mathbf{r}'\;\rho_\alpha(\mathbf{r},t)\rho_\beta(\mathbf{r}',t)/|\mathbf{r} - \mathbf{r}'|$. Further, we can assume that
\begin{equation}\label{eq:uPhiBM}
\begin{split}
u_{\Phi,mb}(\mathbf{r},t) &+ u_{\Phi,bm}(\mathbf{r},t) = \sum_{i = 1}^{N_m}\left(\frac{1}{2}\mu_{mi}\omega_0^2\left[\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)\right]^2\delta[\mathbf{r} - \mathbf{x}_{bi}(t)]\right.\\
&\left.+ \frac{\sigma_0}{3}\mu_{mi}[\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)]\cdot\left([\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)]\cdot\bm{1}_3\cdot[\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)]\right)\delta[\mathbf{r} - \mathbf{x}_{bi}(t)] \vphantom{\frac{1}{2}} \right)\Theta(a - r)\\
&+ \sum_{i = 1}^{N_m}\sum_{j\in\partial i}\left(\frac{e_{mi}e_{bj}}{|\mathbf{x}_{mi}(t) - \mathbf{x}_{bj}(t)|}\delta[\mathbf{r} - \mathbf{x}_{mi}(t)] + \frac{e_{mj}e_{bi}}{|\mathbf{x}_{mj}(t) - \mathbf{x}_{bi}(t)|}\delta[\mathbf{r} - \mathbf{x}_{bi}(t)]\right)\Theta(a - r)\\
&+ u_{\Phi,bm}^\infty(\mathbf{r})\Theta(r - a) + u_{\Phi,mb}^\infty(\mathbf{r})\Theta(r - a) .
\end{split}
\end{equation}
In other words, we can assume that the material charges each exist in a spherically-symmetric anharmonic potential well centered at the location of each corresponding background charge $i$ with a natural frequency $\omega_0$ and anharmonic coefficient $\sigma_0$. We will assume the material charges exist inside a spherical surface at $r = a$, such that these potential wells exist only inside the sphere's surface. Outside the sphere, the charges experience very large potentials $u_{\Phi,bm}^\infty(\mathbf{r})$ and $u_{\Phi,mb}^\infty(\mathbf{r})$, ostensibly generated by chemical bonds, such that the sphere of charges remains stable. Finally, we assume that each charge moves independently of its neighbors due to screening effects, but is forced by imperfectly screened charges lying at the sphere's surface. The set of labels of these surface charges is named $\partial i$.

We have ignored the potential wells that the background charges live in. These can be introduced here, however we will assume that the motion of the background charges is negligible. We can then survive with the assumption that the potential energy generated by the displacement of the background charges is roughly zero. We can also assume that the displacements of the material charges are very small compared to the scale of the sphere radius $a$. Thus, in addition to the simplification $\mathbf{x}_{bi}(t)\approx\mathbf{x}_{bi}$, we can say that each material coordinate can be rewritten as $\mathbf{x}_{mi}(t) = \mathbf{r}_i + \mathbf{q}_{mi}(t)$ and each background coordinate as $\mathbf{x}_{bi} = \mathbf{r}_i$ such that $\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t) = \mathbf{q}_{mi}(t)$. 

To make the leap between a discrete set of point charges and a continuous material or ``jellium'' model, we can replace the notion that a particle lives at a single point $\mathbf{x}_{\alpha i}(t)$ with the idea that it is smeared with constant density over a small set of points $\mathbb{V}[\mathbf{x}_{\alpha i}(t)]$ centered at $\mathbf{x}_{\alpha i}(t)$ with a volume $\Delta[\mathbf{x}_{\alpha i}(t)]$. We can then let the particle number densities $\delta[\mathbf{r} - \mathbf{x}_{bi}(t)] = \delta(\mathbf{r} - \mathbf{r}_i)\to\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]/\Delta(\mathbf{r}_i)$ that are nonzero within $\mathbb{V}(\mathbf{r}_i)$ and zero otherwise. Implicit in this replacement is the assumption that only one particle of a given class $\alpha$ can exist within a volume element $\Delta(\mathbf{r}_i)$, as one can see via $\int_{\mathbb{V}(\mathbf{r}_i)}\mathrm{d}^3\mathbf{r}\,\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]/\Delta(\mathbf{r}_i) = 1$. 

Moving forward, we can then define particle mass densities $\eta_\alpha(\mathbf{r},t) = \sum_i\Theta(\mathbf{r}\in\mathbb{V}[\mathbf{x}_{\alpha i}(t)])\mu_{\alpha i}/\Delta[\mathbf{x}_{\alpha i}(t)]$. In the limit where the displacements $\mathbf{x}_i(t)$ of the particles of the system are never displaced far from their equilibrium positions $\mathbf{r}_i$, we can let $\mathbb{V}[\mathbf{x}_i(t)]\approx\mathbb{V}(\mathbf{r}_i)$ and $\Delta[\mathbf{x}_i(t)]\approx\Delta(\mathbf{r}_i)$. Further, we can give each of the volume elements of our system an equal (and equally tiny) volume $\Delta(\mathbf{r}_i)\approx\Delta$ to produce the time-independent mass densities
\begin{equation}
\eta_{\alpha}(\mathbf{r}) \approx \Theta(a - r)\sum_{i = 1}^{N_\alpha}\frac{\mu_{\alpha i}}{\Delta}\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)].
\end{equation}
Further, we can define the displacement fields
\begin{equation}
\mathbf{Q}_m(\mathbf{r},t) = \Theta(a - r)\sum_{i = 1}^{N_m}\mathbf{q}_{mi}(t)\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]
\end{equation}
such that the first two terms of Eq. \eqref{eq:uPhiBM} can be rewritten as
\begin{equation}
\begin{split}
\sum_{i = 1}^{N_m}&\left(\frac{1}{2}\mu_{mi}\omega_0^2\left[\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)\right]^2\delta[\mathbf{r} - \mathbf{x}_{bi}(t)]\right.\\
&\left.+ \sigma_0\mu_{mi}[\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)]\cdot\left([\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)]\cdot\bm{1}_3\cdot[\mathbf{x}_{mi}(t) - \mathbf{x}_{bi}(t)]\right)\delta[\mathbf{r} - \mathbf{x}_{bi}(t)] \vphantom{\frac{1}{2}} \right)\Theta(a - r)\\
&\approx \frac{\eta_m(\mathbf{r})\omega_0^2}{2}\mathbf{Q}_m^2(\mathbf{r},t) + \frac{\sigma_0}{3}\eta_m(\mathbf{r})\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right].
\end{split}
\end{equation}

The third and fourth terms of Eq. \eqref{eq:uPhiBM} are most usefully rewritten in terms of charge densities, such that
\begin{equation}
\begin{split}
\sum_{i = 1}^{N_m}\sum_{j\in\partial i}&\left(\frac{e_{mi}e_{bj}}{|\mathbf{x}_{mi}(t) - \mathbf{x}_{bj}(t)|}\delta[\mathbf{r} - \mathbf{x}_{mi}(t)] + \frac{e_{mj}e_{bi}}{|\mathbf{x}_{mj}(t) - \mathbf{x}_{bi}(t)|}\delta[\mathbf{r} - \mathbf{x}_{bi}(t)]\right)\Theta(a - r)\\
&= \rho_m(\mathbf{r},t)\oint\frac{\sigma_b(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^2\mathbf{s}' + \rho_b(\mathbf{r},t)\oint\frac{\sigma_m(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^2\mathbf{s}'.
% &= \sum_{i = 1}^{N_m}e_{mi}\delta[(\mathbf{r} - \mathbf{r}_i) - \mathbf{q}_{mi}(t)]\oint\frac{\sigma_b(\mathbf{r}',t)}{|\mathbf{r}_i - \mathbf{r}'|}\;\mathrm{d}^2\mathbf{s}' + \sum_{i = 1}^{N_m}e_{bi}\delta(\mathbf{r} - \mathbf{r}_i)\oint\frac{\sigma_m(\mathbf{r}',t)}{|\mathbf{r}_i - \mathbf{r}'|}\;\mathrm{d}^2\mathbf{s}'.
\end{split}
\end{equation}
We have implicitly defined the surface charge densities as $\sigma_\alpha(\mathbf{r},t)\delta(r - a) = \rho_\alpha(\mathbf{r},t)$ such that the surface integrals $\oint\cdots\mathrm{d}^2\mathbf{s}'$ describe the potentials at each point $\mathbf{r}_i$ set up by the imperfectly-screened charges located at the sphere's boundary. With the surface potentials labeled as $\Phi_\alpha^\mathrm{surf}(\mathbf{r},t) = \oint\mathrm{d}^2\mathbf{s}'\,\sigma_\alpha(\mathbf{r}',t)/|\mathbf{r} - \mathbf{r}'|$, we can rewrite the third and fourth terms of Eq. \eqref{eq:uPhiBM} as
\begin{equation}
\rho_m(\mathbf{r},t)\Phi_b^\mathrm{surf}(\mathbf{r},t) + \rho_b(\mathbf{r},t)\Phi_m^\mathrm{surf}(\mathbf{r},t)
\end{equation}
such that
\begin{equation}
\begin{split}
u_{\Phi,mb}(\mathbf{r},t) + u_{\Phi,bm}(\mathbf{r},t) &\approx \frac{\eta_m(\mathbf{r})\omega_0^2}{2}\mathbf{Q}_m^2(\mathbf{r},t) + \frac{\sigma_0}{3}\eta_m(\mathbf{r})\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]\\
&+ \rho_m(\mathbf{r},t)\Phi_b^\mathrm{surf}(\mathbf{r},t) + \rho_b(\mathbf{r},t)\Phi_m^\mathrm{surf}(\mathbf{r},t)\\
&+ u_{\Phi,bm}^\infty(\mathbf{r})\Theta(r - a) + u_{\Phi,mb}^\infty(\mathbf{r})\Theta(r - a).
\end{split}
\end{equation}

From here, it is straightforward to see that the mutual interactions between the material charges and the mutual interactions between the background charges can be expanded in a similar manner. Assuming the material and background charges are screened from interacting with other charges of the same kind except for the charges at the boundary, one finds
\begin{equation}
\begin{split}
u_{\Phi,mm}(\mathbf{r},t) &= \rho_m(\mathbf{r},t)\Phi_m^\mathrm{surf}(\mathbf{r},t) + u_m^\mathrm{self} + u_{mm}^\infty(\mathbf{r})\Theta(r - a),\\
u_{\Phi,bb}(\mathbf{r},t) &= \rho_b(\mathbf{r},t)\Phi_b^\mathrm{surf}(\mathbf{r},t) + u_b^\mathrm{self} + u_{bb}^\infty(\mathbf{r})\Theta(r - a).
\end{split}
\end{equation}
Here, $u_{\alpha\alpha}^\infty(\mathbf{r})$ are the contributions to the binding potentials of the material or background charges by their interactions with other charges of the same type, and $u_\alpha^\mathrm{self}$ are the Coulombic self-interactions are, in general, infinite, but can be ignored in the following analysis. In total, our potential energy densities are
\begin{equation}
\begin{split}
u_{\Phi,mb}(\mathbf{r},t) &+ u_{\Phi,bm}(\mathbf{r},t) + u_{\Phi,mm}(\mathbf{r},t) + u_{\Phi,bb}(\mathbf{r},t) = \frac{\eta_m(\mathbf{r})\omega_0^2}{2}\mathbf{Q}_m^2(\mathbf{r},t)\\
&+ \frac{\sigma_0}{3}\eta_m(\mathbf{r})\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right] + \rho_m(\mathbf{r},t)\Phi^\mathrm{surf}(\mathbf{r},t) + \rho_b(\mathbf{r},t)\Phi^\mathrm{surf}(\mathbf{r},t)\\
&+ u_m^\mathrm{self} + u_b^\mathrm{self} + \sum_{\alpha = m,b}\left[u_{m\alpha}^\infty(\mathbf{r}) + u_{b\alpha}^\infty(\mathbf{r})\right]\Theta(r - a).
\end{split}
\end{equation}
Here, $\Phi^\mathrm{surf}(\mathbf{r},t) = \Phi_m^\mathrm{surf}(\mathbf{r},t) + \Phi_b^\mathrm{surf}(\mathbf{r},t)$ is the total surface potential generated by imperfectly-screened material and background charges.

It is useful at this point to note that, in line with \citet{huttner1992quantization}, the divergence of the material displacement field is given by
\begin{equation}
\nabla\cdot\mathbf{Q}_m(\mathbf{r},t) = -\hat{\mathbf{r}}\delta(r - a)\cdot\sum_{i = 1}^{N_m}\mathbf{q}_{mi}(t)\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)].
\end{equation}
We have implicitly stated that the field within the sphere's boundary is smooth, as we have assumed the free charges exist outside the sphere. A smooth displacement field can have no divergence (i.e., no sources or sinks) such that $\nabla\cdot\sum_i\mathbf{q}_{mi}(t)\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)] = 0$ by definition for sufficiently small volumes $\Delta$. Further, as we have assumed the background charges are negligibly displaced during excitation, we can let $\mathbf{Q}_b(\mathbf{r},t) = \bm{0}$. Thus, trivially, $\mathbf{Q}_m(\mathbf{r},t) = \mathbf{Q}_m(\mathbf{r},t) + \mathbf{Q}_b(\mathbf{r},t)$.

Without loss of generality, we can also assume that $e_{mi} = e$ such that $e_{bi} = -e$. Therefore, we can define the polarization field
\begin{equation}
\begin{split}
\mathbf{P}(\mathbf{r},t) &= \frac{e}{\Delta}\left[\mathbf{Q}_m(\mathbf{r},t) + \mathbf{Q}_b(\mathbf{r},t)\right]\\
&= \Theta(a - r)\sum_{i = 1}^{N_m}\frac{e}{\Delta}\left[\mathbf{q}_{mi}(t) - \mathbf{q}_{bi}(t)\right]\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]
\end{split}
\end{equation}
(it is implied here that $\mathbf{q}_{bi}(t) = 0$). We demand that our system satisfies the usual macroscopic E\&M condition $\nabla\cdot\mathbf{P}(\mathbf{r},t) = -\rho_d(\mathbf{r},t)$, with $\rho_d(\mathbf{r},t) = \rho_m(\mathbf{r},t) + \rho_b(\mathbf{r},t)$ the total bound charge. Thus, we can conclude that $\rho_m(\mathbf{r},t) + \rho_b(\mathbf{r},t) = -e\nabla\cdot\left[\mathbf{Q}_m(\mathbf{r},t) + \mathbf{Q}_b(\mathbf{r},t)\right]/\Delta = -e\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)/\Delta$. This allows us to say
\begin{equation}
\begin{split}
u_{\Phi,mb}(\mathbf{r},t) &+ u_{\Phi,bm}(\mathbf{r},t) + u_{\Phi,mm}(\mathbf{r},t) + u_{\Phi,bb}(\mathbf{r},t) = \frac{\eta_m(\mathbf{r})\omega_0^2}{2}\mathbf{Q}_m^2(\mathbf{r},t)\\
&+ \frac{\sigma_0}{3}\eta_m(\mathbf{r})\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right] -\frac{e}{\Delta}\Phi^\mathrm{surf}(\mathbf{r},t)\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\\
&+ u_m^\mathrm{self} + u_b^\mathrm{self} +\sum_{\alpha = m,b}\left[u_{m\alpha}^\infty(\mathbf{r}) + u_{b\alpha}^\infty(\mathbf{r})\right]\Theta(r - a).
\end{split}
\end{equation}

The final potential energy densities to analyze are those of the reservoir-material interaction and the free charge-material interaction. Beginning with the reservoir energies, we can assume that the reservoir charges are trapped in harmonic potential wells by the static background charges such that 
\begin{equation}
u_{\Phi,br}(\mathbf{r},t) + u_{\Phi,rb}(\mathbf{r},t) \approx \sum_\nu\sum_{i = 1}^{N_\nu}\frac{1}{2}\mu_{\nu i}\nu^2[\mathbf{x}_{\nu i}(t) - \mathbf{x}_{bi}(t)]^2\delta[\mathbf{r} - \mathbf{x}_{bi}(t)] + u_{rb}^\infty(\mathbf{r})\Theta(r - a) + u_{br}^\infty(\mathbf{r})\Theta(r - a).
\end{equation}
Here we assume that the reservoir charges generally undergo chaotic motion and do not contribute significantly to the surface charges of the system. We have labeled them according to their characteristic natural frequencies $\nu$ such that, with the previous approximation $\mathbf{x}_{bi}(t) = \mathbf{r}_i$, we can define displacement coordinates $\mathbf{q}_{\nu i}(t) = \mathbf{x}_{\nu i}(t) - \mathbf{r}_i$ and a corresponding field
\begin{equation}
\mathbf{Q}_\nu(\mathbf{r},t) = \Theta(a - r)\sum_{i = 1}^{N_\nu}\mathbf{q}_{\nu i}(t)\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]
\end{equation}
such that
\begin{equation}
u_{\Phi,br}(\mathbf{r},t) + u_{\Phi,rb}(\mathbf{r},t) \approx \sum_\nu\frac{\eta_\nu(\mathbf{r})\nu^2}{2}\mathbf{Q}_\nu^2(\mathbf{r},t) + u_{rb}^\infty(\mathbf{r})\Theta(r - a) + u_{br}^\infty(\mathbf{r})\Theta(r - a).
\end{equation}
Here, we have implicitly defined the mass densities $\eta_\nu(\mathbf{r}) \approx \Theta(a - r)\sum_i\mu_{\nu i}\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]/\Delta$.

The material-reservoir interaction would at first glance seem to be easiest written with terms like $\mathbf{Q}_m(\mathbf{r},t)\cdot\mathbf{Q}_\nu(\mathbf{r},t)$. However, to keep our solution in line with \citet{huttner1992quantization}, we will phenomenologically replace this bilinear coupling with one that goes like the time-derivative of $\mathbf{Q}_\nu(\mathbf{r},t)$:
\begin{equation}
u_{\Phi,mr}(\mathbf{r},t) + u_{\Phi,rm}(\mathbf{r},t) \approx \sum_\nu v(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\mathbf{Q}}_\nu(\mathbf{r},t) + u_{mr}^\infty(\mathbf{r})\Theta(r - a) + u_{rm}^\infty(\mathbf{r})\Theta(r - a).
\end{equation}
Here, $v(\nu)$ is a to-be-determined coupling constant. Finally, to keep in line with previous publications, we will replace the discrete sums over $\nu$ with integrals by introducing the reservoir charge displacement field \textit{density} $\tilde{\mathbf{Q}}_\nu(\mathbf{r},t)$, such that
\begin{equation}
\begin{split}
&u_{\Phi,br}(\mathbf{r},t) + u_{\Phi,rb}(\mathbf{r},t) + u_{\Phi,mr}(\mathbf{r},t) + u_{\Phi,rm}(\mathbf{r},t) + u_{\Phi,rr}(\mathbf{r},t) \approx \int_0^\infty\frac{\eta_\nu(\mathbf{r})\nu^2}{2}\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\;\mathrm{d}\nu\\
&+ \int_0^\infty\tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;\mathrm{d}\nu + u_{r}^\mathrm{self}(\mathbf{r}) + u_{rr}^\infty(\mathbf{r})\Theta(r - a) + \sum_{\alpha = m,b}\left[u_{r\alpha}^\infty(\mathbf{r}) + u_{\alpha r}^\infty(\mathbf{r})\right]\Theta(r - a).
\end{split}
\end{equation}
Here we have also introduced the material-reservoir coupling density $\tilde{v}(\nu)$. As $\tilde{\mathbf{Q}}_\nu(\mathbf{r},t)$ has dimensions of $[T]^{1/2}[L]$, $\tilde{v}(\nu)$ has dimensions of $[M]/[L]^3[T]^{1/2}$. We have also introduced the interaction energy between reservoir charges, $u_{\Phi,rr}(\mathbf{r},t) = u_{r}^\mathrm{self} + u_{rr}^\infty(\mathbf{r})\Theta(r - a)$, which describes the potential well of a set of charges that are perfectly screened from one another except when they try to leave the sphere, at which point they experience a large binding potential generated by their mutual interactions.

Finally, we can analyze the interactions between the free charges and the material and background charges. Explicitly,
\begin{equation}
\begin{split}
u_{\Phi,mf}(\mathbf{r},t) + u_{\Phi,fm}(\mathbf{r},t) &+ u_{\Phi,bf}(\mathbf{r},t) + u_{\Phi,fb}(\mathbf{r},t) = \left[\rho_m(\mathbf{r},t) + \rho_b(\mathbf{r},t)\right]\int\frac{\rho_f(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'\\
&+ \rho_f(\mathbf{r},t)\int\frac{\rho_m(\mathbf{r}',t) + \rho_b(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'.
\end{split}
\end{equation}
The last term, which characterizes the back-forces of the polarized sphere on the free charges, can be rewritten as $\rho_f(\mathbf{r},t)\Phi^\mathrm{surf}(\mathbf{r},t)$. This is simple to see using our earlier approximation that the material and background charge distributions cancel at all points except for those along the sphere's surface. The second-to-last term can be rewritten similarly using $\Phi_f(\mathbf{r},t) = \int\mathrm{d}^3\mathbf{r}'\,\rho_f(\mathbf{r}',t)/|\mathbf{r} - \mathbf{r}'|$ such that
\begin{equation}
\sum_{\alpha = m,b}\left[u_{\alpha f}(\mathbf{r},t) + u_{f\alpha}(\mathbf{r},t)\right] \approx -\frac{e}{\Delta}\Phi_f(\mathbf{r},t)\nabla\cdot\mathbf{Q}_m(\mathbf{r},t) + \rho_f(\mathbf{r},t)\Phi^\mathrm{surf}(\mathbf{r},t).
\end{equation}
The Coulomb interactions between the free charges are described by
\begin{equation}
u_{ff}(\mathbf{r},t) = u_f^\mathrm{self} + \rho_f(\mathbf{r},t)\Phi_f(\mathbf{r},t).
\end{equation}
As these are, in general, complicated, we will leave their description abstracted for the moment.

In total, then, we have seen that
\begin{equation}\label{eq:LphiSimp}
\begin{split}
\sum_{i = 1}^Ne_i\delta[\mathbf{r} - \mathbf{x}_i(t)]\Phi(\mathbf{r},t) &\approx \frac{\eta_m(\mathbf{r})\omega_0^2}{2}\mathbf{Q}_m^2(\mathbf{r},t) + \frac{\sigma_0}{3}\eta_m(\mathbf{r})\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]\\
&+ \int_0^\infty\frac{\eta_\nu(\mathbf{r})\nu^2}{2}\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\;\mathrm{d}\nu + \int_0^\infty \tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;\mathrm{d}\nu\\
&-\frac{e}{\Delta}\left[\Phi_f(\mathbf{r},t) + \Phi^\mathrm{surf}(\mathbf{r},t)\right]\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)+ \rho_f(\mathbf{r},t)\left[\Phi_f(\mathbf{r},t) + \Phi^\mathrm{surf}(\mathbf{r},t)\right]\\
&+ \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right] + \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self}.
\end{split}
\end{equation}
This description lends itself to the macroscopic approximation $\Phi(\mathbf{r},t)\approx\Phi_f(\mathbf{r},t) + \Phi^\mathrm{surf}(\mathbf{r},t)$. With this condition in hand, we can enforce the Maxwellian boundary condition for the continuity of $\Phi(\mathbf{r},t)$ at each boundary. These approximations guarantee that Eq. \eqref{eq:LphiSimp} can be combined with the Euler-Legendre equation for $\Phi(\mathbf{r},t)$ to produce a Poisson equation that obeys all of the usual conditions of a classical scattering theory. More explicitly, using our newly simplified potential, one finds
\begin{equation}
\begin{split}
\frac{\partial\mathcal{L}}{\partial\dot{\Phi}(\mathbf{r},t)} &= 0,\\
\frac{\partial \mathcal{L}}{\partial \Phi(\mathbf{r},t)} &= \frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t) - \rho_f(\mathbf{r},t) = -\rho_d(\mathbf{r},t) - \rho_f(\mathbf{r},t),\\
\sum_{k = 1}^3\frac{\partial}{\partial r_k}\frac{\partial \mathcal{L}}{\partial\left(\frac{\partial\Phi(\mathbf{r},t)}{\partial r_k}\right)} &= \frac{1}{4\pi}\nabla\cdot\nabla\Phi(\mathbf{r},t),\\
\end{split}
\end{equation}
such that
\begin{equation}\label{eq:poisson1}
-\nabla\cdot\nabla\Phi(\mathbf{r},t) = 4\pi\left[\rho_d(\mathbf{r},t) + \rho_f(\mathbf{r},t)\right].
\end{equation}

This description also lends itself to the use of another macroscopic simplification, in which the motion degrees of freedom of the polarization density $\mathbf{P}(\mathbf{r},t) = e\mathbf{Q}_m(\mathbf{r},t)/\Delta$ is assumed to be related analytically to the motion of the electric field. In other words, we can let
\begin{equation}\label{eq:suscDef}
\begin{split}
\mathbf{P}(\mathbf{r},t) &= \int_{-\infty}^t\chi^{(1)}(\mathbf{r},t-t')\mathbf{E}(\mathbf{r},t')\;\mathrm{d}t' + \int_{-\infty}^t\int_{-\infty}^t\mathbf{E}(\mathbf{r},t_1)\cdot\bm{\chi}^{(2)}(\mathbf{r};t - t_1,t - t_2)\cdot\mathbf{E}(\mathbf{r},t_2)\;\mathrm{d}t_1\mathrm{d}t_2.
\end{split}
\end{equation}
Since we have assumed that $\mathbf{P}(\mathbf{r},t)$ is smooth inside the sphere, so too must be $\mathbf{E}(\mathbf{r},t)$. Further, we'll assume that $\chi^{(1)}(\mathbf{r},t - t') = \chi^{(1)}(t - t')\Theta(a - r)$ and $\bm{\chi}^{(2)}(\mathbf{r};t - t_1,t - t_2) = \bm{1}_3\chi^{(2)}(t - t_1,t - t_2)\Theta(a - r)$ to match our assumption that the charge densities inside the particle are uniform at equilibrium. Therefore,
\begin{equation}
\begin{split}
\nabla\cdot\mathbf{P}(\mathbf{r},t) &= \int_{-\infty}^t\delta(r - a)\chi^{(1)}(t - t')(-\hat{\mathbf{r}})\cdot\mathbf{E}(\mathbf{r},t')\;\mathrm{d}t'\\
&+ \int_{-\infty}^t\int_{-\infty}^t\delta(r - a)\chi^{(2)}(t - t_1,t - t_2)(-\hat{\mathbf{r}})\cdot\left[\mathbf{E}(\mathbf{r},t_1)\cdot\bm{1}_3\cdot\mathbf{E}(\mathbf{r},t_2)\right]\;\mathrm{d}t_1\mathrm{d}t_2,
\end{split}
\end{equation}
gives the linear and nonlinear contributions to $\rho_d(\mathbf{r},t)$ in the first and second terms on the right-hand side, respectively. 

In the linear limit, i.e. when $\chi^{(2)}(t- t_1,t - t_2)\to0$, we can see that the Poisson equation of Eq. \eqref{eq:poisson1} can be rearranged to give $-\nabla\cdot\{\nabla\Phi(\mathbf{r},t) + 4\pi\mathbf{P}(\mathbf{r},t)\} = 4\pi\rho_f(\mathbf{r},t)$. Therefore, it is convenient to define a dielectric function
\begin{equation}
\epsilon(\mathbf{r},t - t') = \Theta(a - r)\left[\delta(t - t') + 4\pi\chi^{(1)}(t - t')\right]
\end{equation}
such that Eq. \eqref{eq:poisson1} becomes
\begin{equation}
-\nabla\cdot\left\{\int_{-\infty}^t\epsilon(\mathbf{r},t - t')\nabla\Phi(\mathbf{r},t')\;\mathrm{d}t'\right\} = 4\pi\rho_f(\mathbf{r},t).
\end{equation}
Note that, in the Coulomb gauge, $\nabla\cdot\mathbf{E}(\mathbf{r},t) = \nabla\cdot\left\{\nabla\Phi(\mathbf{r},t)\right\}$.




\subsubsection{Vector potential term}

The second-to-last term in Eq. \eqref{eq:lagrangianDensity1} is much simpler to analyze than the last. Specifically, we can define the current density $\mathbf{J}(\mathbf{r},t) = \sum_ie_i\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)]$ such that $\mathbf{J}(\mathbf{r},t) = \mathbf{J}_m(\mathbf{r},t) + \mathbf{J}_b(\mathbf{r},t) + \mathbf{J}_r(\mathbf{r},t) + \mathbf{J}_f(\mathbf{r},t)$. Recalling that the charge density of the system is $\rho(\mathbf{r},t) = \sum_ie_i\delta[\mathbf{r} - \mathbf{x}_i(t)]$, it is straightforward to prove that, with the Dirac delta ``softened'' to be a very sharply-peaked but finite even function,
\begin{equation}
\frac{\partial}{\partial t}\left\{\delta[\mathbf{r} - \mathbf{x}_i(t)]\right\} = -\dot{\mathbf{x}}_i(t)\cdot\nabla\left\{\delta[\mathbf{r} - \mathbf{x}_i(t)]\right\}
\end{equation}
such that the continuity equation $(\partial/\partial t)\rho(\mathbf{r},t) + \nabla\cdot\mathbf{J}(\mathbf{r},t) = 0$ is satisfied for all $(\mathbf{r},t)$.

Much the same as we did for the scalar potential, we can assume here that the vector potential can be broken into two parts, one set up by the surface charges and one set up as if only the free charges of the system were present. In other words, we'll let $\mathbf{A}(\mathbf{r},t) = \mathbf{A}_f(\mathbf{r},t) + \mathbf{A}^\mathrm{surf}(\mathbf{r},t)$. To justify this approximation, we can see from the Euler-Lagrange equations for the vector potential components $A_j(\mathbf{r},t)$,
\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}t}\left\{\frac{\partial \mathcal{L}}{\partial \dot{A}_j(\mathbf{r},t)}\right\} = \frac{\partial \mathcal{L}}{\partial A_j(\mathbf{r},t)} - \sum_{k = 1}^3\frac{\partial}{\partial r_k}\frac{\partial \mathcal{L}}{\partial\!\left(\frac{\partial A_j(\mathbf{r},t)}{\partial r_k}\right)},
\end{equation}
that the vector potential satisfies the wave equation
\begin{equation}
\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) + \frac{1}{c^2}\ddot{\mathbf{A}}(\mathbf{r},t) = \frac{4\pi}{c}\mathbf{J}(\mathbf{r},t) - \frac{\nabla\dot{\Phi}(\mathbf{r},t)}{c}
\end{equation}
(see Appendix \ref{sec:PZWderivation} for details). We'll make the approximation here that the interactions between the vector potential and the reservoir current $\mathbf{J}_r(\mathbf{r},t)$ is negligible, such that we can replace the current on the right-hand side of the wave equation with $\sum_{\alpha = m,b,f}\mathbf{J}_\alpha(\mathbf{r},t)$. Further, from our analysis of the scalar potential we know that $-\nabla\cdot\nabla\dot{\Phi}(\mathbf{r},t) = 4\pi\sum_{\alpha = m,b,f}\dot{\rho}_\alpha(\mathbf{r},t) = -4\pi\sum_{\alpha = m,b,f}\nabla\cdot\mathbf{J}_\alpha(\mathbf{r},t)$. Therefore, noting that the divergence of the transverse part of any vector field is zero, we can conclude that $-\nabla\dot{\Phi}(\mathbf{r},t)/c = -(4\pi/c)\sum_{\alpha = m,b,f}\mathbf{J}^\parallel_\alpha(\mathbf{r},t)$ and
\begin{equation}
\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) + \frac{1}{c^2}\ddot{\mathbf{A}}(\mathbf{r},t) \approx \frac{4\pi}{c}\sum_{\alpha = m,b,f}\mathbf{J}^\perp_{\alpha}(\mathbf{r},t).
\end{equation}
From here, all we need to do is define the bound current $\mathbf{J}_d(\mathbf{r},t) = \mathbf{J}_m(\mathbf{r},t) + \mathbf{J}_b(\mathbf{r},t)$ to see that the wave equation can be split into two parts:
\begin{equation}\label{eq:vectorPotentialSplit}
\begin{split}
\nabla\times\nabla\times\mathbf{A}_f(\mathbf{r},t) + \frac{1}{c^2}\ddot{\mathbf{A}}_f(\mathbf{r},t) &= \frac{4\pi}{c}\mathbf{J}^\perp_f(\mathbf{r},t),\\
\nabla\times\nabla\times\mathbf{A}^\mathrm{surf}(\mathbf{r},t) + \frac{1}{c^2}\ddot{\mathbf{A}}^\mathrm{surf}(\mathbf{r},t) &= \frac{4\pi}{c}\mathbf{J}^\perp_d(\mathbf{r},t).
\end{split}
\end{equation}

In contrast to the Poisson equation that the scalar potential $\Phi(\mathbf{r},t)$ obeys, the vector potential terms of Eq. \eqref{eq:vectorPotentialSplit} obey a wave equation with a term $\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t)$ that resembles a restoring force. This suggests that the vector potential ought to act as a set of independent degrees of freedom from the particle motion. This suggestion is confirmed by the fact that the derivatives $\partial\mathcal{L}/\partial \dot{A}_j(\mathbf{r},t)$ are nonzero such that there exists a conjugate momentum field $\Pi_j(\mathbf{r},t) = \partial\mathcal{L}/\partial \dot{A}_j(\mathbf{r},t)$ to the vector potential guaranteeing that the vector potential will display inertial motion and therefore need to be treated as a set of generalized coordinates separate form those of the particles. Moreover, we can see from our microscopic model that $\mathbf{J}_d(\mathbf{r},t) = \dot{\mathbf{P}}(\mathbf{r},t) = e\dot{\mathbf{Q}}_m(\mathbf{r},t)/\Delta$, such that 
\begin{equation}
\sum_{i = 1}^N\frac{e_i}{c}\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)]\cdot\mathbf{A}(\mathbf{r},t) \approx \frac{1}{c}\left[\frac{e}{\Delta}\dot{\mathbf{Q}}_m(\mathbf{r},t) + \mathbf{J}_f(\mathbf{r},t)\right]\cdot\mathbf{A}(\mathbf{r},t).
\end{equation}
Therefore, this term represents both the coupling of the vector potential to the free charges and to the displacement field of the particle.

Finally, we can also use our displacement-field expansion of the bound current to see that
\begin{equation}
\begin{split}
&\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) + \frac{1}{c^2}\ddot{\mathbf{A}}(\mathbf{r},t) - \frac{4\pi}{c}\dot{\mathbf{P}}^\perp(\mathbf{r},t) = \frac{4\pi}{c}\mathbf{J}^\perp_f(\mathbf{r},t)\\
= &\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) - \frac{1}{c}\frac{\partial}{\partial t}\left\{-\frac{\dot{\mathbf{A}}(\mathbf{r},t)}{c} + 4\pi\mathbf{P}^\perp(\mathbf{r},t)\right\}.
\end{split}
\end{equation}
We can use Eq. \eqref{eq:suscDef} to say that
\begin{equation}
\begin{split}
\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) &- \frac{1}{c}\frac{\partial}{\partial t}\left\{-\frac{\dot{\mathbf{A}}(\mathbf{r},t)}{c} + 4\pi\left[\int_{-\infty}^t\chi^{(1)}(\mathbf{r},t - t')\mathbf{E}(\mathbf{r},t')\;\mathrm{d}t'\right]^\perp\right\}\\
& - \frac{1}{c}\frac{\partial}{\partial t}\left\{\left[\int_{-\infty}^t\int_{-\infty}^t\mathbf{E}(\mathbf{r},t_1)\cdot\bm{\chi}^{(2)}(\mathbf{r};t - t_1,t - t_2)\cdot\mathbf{E}(\mathbf{r},t_2)\;\mathrm{d}t_1\mathrm{d}t_2\right]^\perp\right\} = \frac{4\pi}{c}\mathbf{J}^\perp_f(\mathbf{r},t).
\end{split}
\end{equation}
In the linear limit, we can use the the identity $\mathbf{E}^\perp(\mathbf{r},t) = -\dot{\mathbf{A}}(\mathbf{r},t)/c$ to see that
\begin{equation}
\begin{split}
&\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) - \frac{1}{c}\frac{\partial}{\partial t}\left\{\left[\mathbf{E}(\mathbf{r},t) + 4\pi\int_{-\infty}^t\chi^{(1)}(\mathbf{r},t - t')\mathbf{E}(\mathbf{r},t')\;\mathrm{d}t'\right]^\perp\right\} = \frac{4\pi}{c}\mathbf{J}^\perp_f(\mathbf{r},t)\\
&= \nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) - \left[\frac{1}{c}\frac{\partial}{\partial t}\int_{-\infty}^t\epsilon(\mathbf{r},t - t')\mathbf{E}(\mathbf{r},t')\;\mathrm{d}t'\right]^\perp.
\end{split}
\end{equation}
Application of a time-derivative and multiplication by $1/c$ then produces the transverse component of the wave equation for the electric field. In contrast, expansion of the current form of the wave equation in terms of the vector potential demonstrates the coupling between the vector and scalar potentials caused by the existence of a surface. In particular,
\begin{equation}
\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) - \left(\frac{1}{c}\frac{\partial}{\partial t}\int_{-\infty}^t\epsilon(\mathbf{r},t - t')\left[-\nabla\Phi(\mathbf{r},t') - \frac{1}{c}\dot{\mathbf{A}}(\mathbf{r},t')\right]\;\mathrm{d}t'\right)^\perp = \frac{4\pi}{c}\mathbf{J}^\perp_f(\mathbf{r},t),
\end{equation}
where we must note that the transverse part of $\epsilon(\mathbf{r},t - t')\nabla\Phi(\mathbf{r},t')$ is not zero in general. 











\subsubsection{The rest of it}

The second term in Eq. \eqref{eq:lagrangianDensity1}, in line with the analyses of the latter two terms, can be expanded straightforwardly. 
\begin{equation}
\begin{split}
\frac{1}{8\pi}\left[\mathbf{E}^2(\mathbf{r},t) - \mathbf{B}^2(\mathbf{r},t)\right] &= \frac{1}{8\pi}\left[\left(-\nabla\Phi(\mathbf{r},t) - \frac{1}{c}\dot{\mathbf{A}}(\mathbf{r},t)\right)^2 - \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right]\\
&= \frac{1}{8\pi}\left[\left[\nabla\Phi(\mathbf{r},t)\right]^2 + \frac{1}{c^2}\dot{\mathbf{A}}^2(\mathbf{r},t) - \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2 + \frac{2}{c}\nabla\Phi(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)\right].
\end{split}
\end{equation}

The first term in Eq. \eqref{eq:lagrangianDensity1} is also quite easily expanded using the notion of the material displacement fields. More specifically, using the approximation $\delta(\mathbf{r} - \mathbf{r}_i)\to\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]/\Delta$, one can see that
\begin{equation}
\begin{split}
\sum_{i = 1}^N\frac{1}{2}\mu_i\dot{\mathbf{x}}_i^2(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] &= \sum_{i = 1}^{N_f}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t)\delta[\mathbf{r} - \mathbf{x}_{fi}(t)] + \sum_{\alpha = m,b,r}\sum_{i = 1}^{N_\alpha}\frac{1}{2}\mu_{\alpha i}\dot{\mathbf{x}}_{\alpha i}^2(t)\delta[\mathbf{r} - \mathbf{x}_{\alpha i}(t)]\\
&\approx \sum_{i = 1}^{N_f}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t)\delta[\mathbf{r} - \mathbf{x}_{fi}(t)] + \sum_{\alpha = m,b,r}\sum_{i = 1}^{N_\alpha}\frac{\mu_{\alpha i}\dot{\mathbf{x}}_{\alpha i}^2(t)}{2\Delta}\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]\\
&= \sum_{i = 1}^{N_f}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t)\delta[\mathbf{r} - \mathbf{x}_{fi}(t)] + \sum_{\alpha = m,b,r}\frac{\eta_{\alpha}(\mathbf{r})}{2}\dot{\mathbf{Q}}^2_\alpha(\mathbf{r},t).
\end{split}
\end{equation}
Further, noting that $\mathbf{Q}_b(\mathbf{r},t) = \bm{0}$ and expanding the reservoir displacement field such that
\begin{equation}
\eta_r(\mathbf{r})\dot{\mathbf{Q}}_r^2(\mathbf{r},t) \equiv \int_0^\infty\eta_\nu(\mathbf{r})\dot{\tilde{\mathbf{Q}}}_\nu^2(\mathbf{r},t)\;\mathrm{d}\nu,
\end{equation}
we can see that
\begin{equation}
\sum_{i = 1}^N\frac{1}{2}\mu_i\dot{\mathbf{x}}_i^2(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] = \sum_{i = 1}^{N_f}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t)\delta[\mathbf{r} - \mathbf{x}_{fi}(t)] + \frac{\eta_m(\mathbf{r})}{2}\dot{\mathbf{Q}}_m^2(\mathbf{r},t) + \int_0^\infty\frac{\eta_\nu(\mathbf{r})}{2}\dot{\tilde{\mathbf{Q}}}_\nu^2(\mathbf{r},t)\;\mathrm{d}\nu.
\end{equation}

Finally, then, we come to a straightforward description of the Lagrangian density,
\begin{equation}
\mathcal{L} = \mathcal{L}_f + \mathcal{L}_m + \mathcal{L}_r + \mathcal{L}_\mathrm{int} + \mathcal{L}_\mathrm{bind} + \mathcal{L}_\mathrm{EM} + \mathcal{L}_\mathrm{NL}
\end{equation}
where
\begin{equation}
\mathcal{L}_f = \sum_{i = 1}^{N_f}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t)\delta[\mathbf{r} - \mathbf{x}_{fi}(t)]
\end{equation}
describes the kinetic energy of the free charges,
\begin{equation}
\mathcal{L}_m = \frac{\eta_m(\mathbf{r})}{2}\left[\dot{\mathbf{Q}}_m^2(\mathbf{r},t) - \omega_0^2\mathbf{Q}_m^2(\mathbf{r},t)\right]
%- \frac{\eta_m(\mathbf{r})\omega_0^2}{2}\mathbf{Q}_m^2(\mathbf{r},t)
\end{equation}
describes the kinetic and harmonic potential energies experienced by the material charges,
\begin{equation}
\mathcal{L}_r = \int_0^\infty\frac{\eta_\nu(\mathbf{r})}{2}\left[\dot{\tilde{\mathbf{Q}}}_\nu^2(\mathbf{r},t) - \nu^2\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\right]\;\mathrm{d}\nu
% - \int_0^\infty\frac{\eta_\nu(\mathbf{r})\nu^2}{2}\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\;\mathrm{d}\nu
\end{equation}
describes the kinetic and potential energies of the reservoir charges,
\begin{equation}
\begin{split}
\mathcal{L}_\mathrm{int} &= -\left[-\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t) + \rho_f(\mathbf{r},t)\right]\Phi(\mathbf{r},t) + \frac{1}{c}\left[\frac{e}{\Delta}\dot{\mathbf{Q}}_m(\mathbf{r},t) + \mathbf{J}_f(\mathbf{r},t)\right]\cdot\mathbf{A}(\mathbf{r},t)\\
&- \int_0^\infty \tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;\mathrm{d}\nu
\end{split}
\end{equation}
describes the interactions between the electromagnetic field, material, and reservoir, and free charges,
\begin{equation}
\mathcal{L}_\mathrm{bind} = -\sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right] - \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self}
\end{equation}
describes the binding potentials and self-energies experienced by each charge, and
\begin{equation}
\mathcal{L}_\mathrm{EM} = \frac{1}{8\pi}\left[\left[\nabla\Phi(\mathbf{r},t)\right]^2 + \frac{1}{c^2}\dot{\mathbf{A}}^2(\mathbf{r},t) - \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2 + \frac{2}{c}\nabla\Phi(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)\right]
\end{equation}
describes the energy bound in the electromagnetic fields. Finally, 
\begin{equation}
\mathcal{L}_\mathrm{NL} = - \frac{\sigma_0}{3}\eta_m(\mathbf{r})\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]
\end{equation}
describes the anharmonic portion of the potential energy experienced by the material charges.









\subsection{Three Points of View on the Matter Degrees of Freedom}

From this point, we have a choice to make. We can either choose to let the material, background, and reservoir charges have their own degrees of freedom independent of those of the electromagnetic field, or we can supplant their degrees of freedom with dielectric theory such that only the field and free charges exhibit dynamical motion with the rest of the matter locked to the time-dependent variations of the fields. We will expand on these two pictures below.

First, however, it is useful to see how a system with only free charges can be mapped onto an oscillator picture in preparation for quantization. This will provide a foundation from which the other two pictures can be constructed.






\subsubsection{No matter: the free-charge picture}\label{sec:noMatter}

Allowing the charges is a system to all be free charges is the simplest version of charge-inclusive QED that exists. Rather than deal with the various expansions and specifications of the previous section, we can simply start with Eq. \eqref{eq:lagrangianDensity1} and define current and charge densities $\sum_ie_i\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] = \mathbf{J}(\mathbf{r},t)$ and $\sum_ie_i\delta[\mathbf{r} - \mathbf{x}_i(t)] = \rho(\mathbf{r},t)$, respectively. Further, we can assume the vector potential is transverse (the Coulomb gauge) and drop terms that go like $\mathbf{A}(\mathbf{r},t)\cdot\nabla\Phi(\mathbf{r},t)$ or $\mathbf{J}^\parallel(\mathbf{r},t)\cdot\mathbf{A}(\mathbf{r},t) = [\mathbf{J}(\mathbf{r},t) - \mathbf{J}^\perp(\mathbf{r},t)]\cdot\mathbf{A}(\mathbf{r},t)$ such that
\begin{equation}
\begin{split}
\mathcal{L}' &= \sum_{i = 1}^N\frac{1}{2}\mu_i\dot{\mathbf{x}}_i^2(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] + \frac{1}{8\pi}\left(\left[-\nabla\Phi(\mathbf{r},t)\right]^2 + \frac{1}{c}\dot{\mathbf{A}}^2(\mathbf{r},t) - \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right)\\
&+ \mathbf{J}^\perp(\mathbf{r},t)\cdot\mathbf{A}(\mathbf{r},t) - \rho(\mathbf{r},t)\Phi(\mathbf{r},t).
\end{split}
\end{equation}
The Euler-Lagrange equations associated with this Lagrangian density (see Section \ref{sec:dependentMatter}) give us
\begin{equation}
\begin{split}
&\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) + \frac{1}{c^2}\ddot{\mathbf{A}}(\mathbf{r},t) = \frac{4\pi}{c}\mathbf{J}^\perp(\mathbf{r},t),\\
\implies &\mathbf{A}(\mathbf{r},t) = 4\pi\int_{-\infty}^{\infty}\int\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^\perp(\mathbf{r}',\omega)}{c}\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}^3\mathbf{r}'\,\frac{\mathrm{d}\omega}{2\pi}
\end{split}
\end{equation}
where the dyadic Green's function $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$ is given in Eq. \eqref{eq:G0} as
\begin{equation}
\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega) = \frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left[\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\Theta(r - r') + \mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)\Theta(r' - r)\right] - \frac{\hat{\mathbf{r}}\hat{\mathbf{r}}}{k^2}\delta(\mathbf{r} - \mathbf{r}').
\end{equation}

The Green's function definition of $\mathbf{A}(\mathbf{r},t)$ tells us that the transverse vector potential is generated by the projection integral of the transverse current $\mathbf{J}^\perp(\mathbf{r},t)$ with the dyadic Green's function. In its usual form, however, the Green's function is not obviously transverse or longitudinal in $\mathbf{r}$, due to the presence of the functions $\Theta(\pm r \mp r')$ and $\hat{\mathbf{r}}\hat{\mathbf{r}}\delta(\mathbf{r} - \mathbf{r}')$ that are not separated into products of functions of $\mathbf{r}$ and $\mathbf{r}'$. We can produce this separation and clarify the role of $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$, however, through use the analyses of Appendices \ref{sec:truncatedHarmonicExpansion} and \ref{sec:diracDyadExpansion}. First focusing on the terms of $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$ that appear under the sum in $\bm{\alpha}$, we can let
\begin{equation}
\begin{split}
\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r') &= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^{><}(k,\kappa;r',\infty)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&\qquad- (1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{h_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r'),\\[1.0em]
\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r' - r) &= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^\ll(k,\kappa;0,r')\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&\qquad + (1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r'),
\end{split}
\end{equation}
where in both equations the first term on the right-hand side is transverse in $\mathbf{r}$ and the second is longitudinal. Although the longitudinal terms involve the non-separable longitudinal harmonics $\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r') = \nabla\left\{r'^{-\ell + 1} f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2} f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}$ and are more unwieldy to work with, one can see that any integration in $\mathbf{r}'$ involving these harmonics can be carried out under the gradient in $\mathbf{r}$, thus guaranteeing that the resulting contributions to the vector potential will be curl-free.

The ``self-field'' term of $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$, i.e. the Driac-delta dyad $\hat{\mathbf{r}}\hat{\mathbf{r}}\delta(\mathbf{r} - \mathbf{r}')/k^2$, can be expanded similarly, providing
\begin{equation}
\begin{split}
-\frac{\hat{\mathbf{r}}\hat{\mathbf{r}}}{k^2}\delta(\mathbf{r} - \mathbf{r}') &= -\frac{1}{2\pi^2k^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\kappa^2\;\mathrm{d}\kappa\\
&\qquad-\frac{1}{4\pi k^2}\sum_{\bm{\alpha}}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}'.
\end{split}
\end{equation}
As expected, only the radially-oriented components of the current contribute to the vector potential through the self-field term, and both longitudinal and transverse self-fields exist, in general. We can see now that the Green's function is decomposable as $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega) + \mathbf{G}_0^\parallel(\mathbf{r},\mathbf{r}';\omega)$, wherein the transverse ($\perp$) and longitudinal ($\parallel$) components of the Green's function are
\begin{equation}\label{eq:helmholtzDecompositionFreeSpaceGreenFunction}
\begin{split}
\mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}k}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\left( \vphantom{\frac{1}{4\pi k^2}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty)\right.\\
&\left.+ \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r') - \frac{1}{\mathrm{i} k^3}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right)\kappa^2\mathrm{d}\kappa,\\[1.0em]
\mathbf{G}_0^\parallel(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left(\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')\left[-\frac{h_\ell(kr')}{kr'}\mathbf{N}_{\bm{\alpha}}(\mathbf{r}',k) + \frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{\bm{\alpha}}(\mathbf{r}',k)\right]\right.\\
&\left.\qquad-\frac{1}{\mathrm{i} k^3}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}' \vphantom{\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}} \right).
\end{split}
\end{equation}
We have dropped factors of $1 - \delta_{p1}\delta_{m0}$ as they are redundant when multiplied by vector harmonics that are already zero at $(p,m) = (1,0)$. The $\mathbf{r}$-transverse and -longitudinal nature of these functions is explicit from the properties of $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)$, $\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')$, and $\nabla f_{\bm{\alpha}}^{>,<}(\mathbf{r})$. It is less obvious but, nonetheless, true that these components are also transverse and longitudinal, respectively, in the source coordinate $\mathbf{r}'$ as long as $\mathbf{r}'\neq\mathbf{r}$ and $r' > 0$. The proofs of these latter conditions are given in Appendix \ref{sec:helmholtzDecompositionFreeSpaceGreenFunction}.

It is now clear that we can rewrite the integral definition of the vector potential as
\begin{equation}
\begin{split}
\mathbf{A}(\mathbf{r},t) &= 4\pi\int_{-\infty}^{\infty}\int\mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^\perp(\mathbf{r}',\omega)}{c}\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}^3\mathbf{r}'\,\frac{\mathrm{d}\omega}{2\pi}\\
&= 4\pi\int_{-\infty}^\infty\int\left[\frac{\mathrm{i}k}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left( \vphantom{\frac{1}{4\pi k^2}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty) + \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r')\right.\right.\\
&\quad\left.\left.- \frac{1}{\mathrm{i} k^3}\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right)\kappa^2\mathrm{d}\kappa \vphantom{\int_0^\infty} \right]\cdot\frac{\mathbf{J}^\perp(\mathbf{r}',\omega)}{c}\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}^3\mathbf{r}'\,\frac{\mathrm{d}\omega}{2\pi}\\
&= \sum_{\bm{\alpha}}\int_{-\infty}^\infty\int_0^\infty\mathcal{A}_{\bm{\alpha}}(\kappa,k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}\kappa\,\frac{\mathrm{d}\omega}{2\pi},
\end{split}
\end{equation}
where
\begin{equation}\label{eq:AconnectionFunction}
\begin{split}
\mathcal{A}_{\bm{\alpha}}(\kappa,k) &= \frac{2\mathrm{i}k\kappa^2}{\pi c}\int\left( \vphantom{\frac{1}{k^3}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty) + \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R^\ll_{T\ell}(k,\kappa;0,r')\right.\\
&\qquad\left.- \frac{1}{\mathrm{i}k^3}\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right)\cdot\mathbf{J}^\perp(\mathbf{r}',\omega)\;\mathrm{d}^3\mathbf{r}'
\end{split}
\end{equation}
are the amplitudes of the modes of the field that have angular indices $\bm{\alpha}$, a radial index $\kappa$, and oscillate at $\omega$. In contrast to waves moving in free space, the excited modes here do not display a fixed dispersion relation between $\kappa$ and $k = \omega/c$: modes of radial index (spatial wavenumber?) $\kappa$ can oscillate in time at any frequency $\omega$ (temporal wavenumber $k$?). However, both $R_{T\ell}^><(k,\kappa;r',\infty)$ and $R_{T\ell}^\ll(k,\kappa;0,r')$ vary as $1/(k^2 - \kappa^2)$ (see Appendix \ref{app:greenFuncDetails}) such that modes in which $|k|\approx\kappa$ are more readily excited than those in which $|k|$ and $\kappa$ are dissimilar. Finally, these amplitudes have dimensions of $[\mathrm{charge}][\mathrm{length}][\mathrm{time}]/[\mathrm{length}] = [\mathrm{charge}][\mathrm{time}]$.

The transverse and longitudinal electric fields are also straightforward to calculate from the Helmholtz components of $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$. Specifically, 
\begin{equation}
\mathbf{E}^{\perp,\parallel}(\mathbf{r},t) = \int_{-\infty}^\infty\int\mathbf{G}_0^{\perp,\parallel}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^{\perp,\parallel}(\mathbf{r}',\omega)\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}^3\mathbf{r}'\,\frac{\mathrm{d}\omega}{2\pi},
\end{equation}
such that
\begin{equation}
\mathbf{E}^\perp(\mathbf{r},t) = \sum_{\bm{\alpha}}\int_{-\infty}^\infty\int_0^\infty\mathrm{i}k\mathcal{A}(\kappa,k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}\kappa\,\frac{\mathrm{d}\omega}{2\pi}
\end{equation}
in agreement with the condition $\mathbf{E}^\perp(\mathbf{r},t) = -\dot{\mathbf{A}}(\mathbf{r},t)/c$ and
\begin{equation}\label{eq:Elongitudinal1}
\begin{split}
\mathbf{E}&^\parallel(\mathbf{r},t) = \int_{-\infty}^\infty\int\frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left(\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')\left[-\frac{h_\ell(kr')}{kr'}\mathbf{N}_{\bm{\alpha}}(\mathbf{r}',k) + \frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{\bm{\alpha}}(\mathbf{r}',k)\right]\right.\\
&\left.-\frac{1}{\mathrm{i} k^3}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}' \vphantom{\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}} \right) \cdot\frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^\parallel(\mathbf{r}',\omega)\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}^3\mathbf{r}'\,\frac{\mathrm{d}\omega}{2\pi}.
\end{split}
\end{equation}
The longitudinal electric field can be simplified through the expansion of the harmonics $\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')$ and the application of the gradient in the second line above. In more detail, use of the closure relation
\begin{equation}
\sum_{p\ell m}(2 - \delta_{m0})(2\ell + 1)\frac{(\ell - m)!}{(\ell + m)!}P_{\ell m}(\cos\theta)P_{\ell m}(\cos\theta')S_p(m\phi)S_p(m\phi') = \frac{4\pi}{\sin\theta}\delta(\theta - \theta')\delta(\phi - \phi')
\end{equation}
in addition to the product rule and the Dirac delta definitions $\nabla\Theta(\pm r \mp a) = \pm\hat{\mathbf{r}}\delta(r - a)$ and $\delta(\mathbf{r} - \mathbf{r}') = \delta(r - r')\delta(\theta - \theta')\delta(\phi - \phi')/r^2\sin\theta$ provides
\begin{equation}
\begin{split}
&\sum_{\bm{\alpha}}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}'\\
=&\sum_{\bm{\alpha}}\left[\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'} \nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\hat{\mathbf{r}}' + 4\pi\delta(\mathbf{r} - \mathbf{r}')\hat{\mathbf{r}}\hat{\mathbf{r}}'.
\end{split}
\end{equation}
Therefore,
\begin{equation}\label{eq:Elongitudinal2}
\mathbf{E}^\parallel(\mathbf{r},t) = \sum_{\bm{\alpha}}\int_{-\infty}^\infty\left[\mathcal{E}_{\bm{\alpha}}^<(k;r)\nabla f_{\bm{\alpha}}^<(\mathbf{r}) + \mathcal{E}_{\bm{\alpha}}^>(k;r)\nabla f_{\bm{\alpha}}^>(\mathbf{r})\right]\mathrm{e}^{-\mathrm{i}\omega t}\;\frac{\mathrm{d}\omega}{2\pi} - \int_{-\infty}^\infty\frac{4\pi\mathrm{i}}{\omega}\left[\mathbf{J}^\parallel(\mathbf{r},\omega)\cdot\hat{\mathbf{r}}\right]\hat{\mathbf{r}}\mathrm{e}^{-\mathrm{i}\omega t}\;\frac{\mathrm{d}\omega}{2\pi},
\end{equation}
wherein
\begin{equation}
\begin{split}
\mathcal{E}_{\bm{\alpha}}^<(k;r) &= -\frac{k^2}{c}\int\left[\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}r'^{-\ell + 1}\left(\frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k) - \frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right)\right.\\
&\qquad+\left.\frac{\mathrm{i}}{k^3}\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}\hat{\mathbf{r}}' 
\vphantom{\sqrt{\frac{\ell}{\ell}}} \right]\cdot\mathbf{J}^\parallel(\mathbf{r}',\omega)\Theta(r' - r)\;\mathrm{d}^3\mathbf{r}',\\
\mathcal{E}_{\bm{\alpha}}^>(k;r) &= -\frac{k^2}{c}\int\left[\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}r'^{\ell + 2}\left(\frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k) - \frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right)\right.\\
&\qquad+\left.\frac{\mathrm{i}}{k^3}\frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}\hat{\mathbf{r}}' 
\vphantom{\sqrt{\frac{\ell}{\ell}}} \right]\cdot\mathbf{J}^\parallel(\mathbf{r}',\omega)\Theta(r - r')\;\mathrm{d}^3\mathbf{r}'.
\end{split}
\end{equation}
The scalar potential defined by $-\nabla \Phi(\mathbf{r},t) = \mathbf{E}^\parallel(\mathbf{r},t)$ can be found straightforwardly from Eq. \eqref{eq:Elongitudinal1} by removing, rather than applying, the gradient operators in $\mathbf{r}$. Explicitly,
\begin{equation}
\begin{split}
\Phi(\mathbf{r},t) &= -\int_{-\infty}^\infty\int\frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left(\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\left[r'^{-\ell + 1}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\right.\\
&\qquad\times\left[-\frac{h_\ell(kr')}{kr'}\mathbf{N}_{\bm{\alpha}}(\mathbf{r}',k) + \frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{\bm{\alpha}}(\mathbf{r}',k)\right] - \frac{1}{\mathrm{i} k^3}\left[\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r)\right.\\
&\qquad\left.\left. + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\hat{\mathbf{r}}' \vphantom{\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}} \right)\cdot\frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}^\parallel(\mathbf{r}',\omega)\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}^3\mathbf{r'}\,\frac{\mathrm{d}\omega}{2\pi}.
\end{split}
\end{equation}
Finally, the magnetic fields can be calculated from $\mathbf{B}(\mathbf{r},t) = \nabla\times\mathbf{A}(\mathbf{r},t)$ and give
\begin{equation}
\mathbf{B}(\mathbf{r},t) = \sum_{\bm{\alpha}}\int_{-\infty}^\infty\int_0^\infty\kappa\mathcal{A}_{\bm{\alpha}}(\kappa,k)\mathbf{Y}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathrm{e}^{-\mathrm{i}\omega t}\;\mathrm{d}\kappa\,\frac{\mathrm{d}\omega}{2\pi}.
\end{equation}











\subsubsection{Dependent matter: the dielectric picture}\label{sec:dependentMatter}

We have touched on this picture already in the preceding sections, but it is useful to reiterate that the Euler-Lorentz equations derivable from the system Lagrangian $L$ state clearly that the degrees of freedom of the matter and electromagnetic field are coupled. More explicitly, there are four Euler-Lorentz equations of the form
\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}t}\left\{\frac{\partial\mathcal{L}'}{\partial\dot{F}(\mathbf{r},t)}\right\} = \frac{\partial\mathcal{L}'}{\partial F(\mathbf{r},t)} - \sum_{i = 1}^3\frac{\partial}{\partial r_i}\frac{\partial\mathcal{L}'}{\partial\left(\frac{\partial F(\mathbf{r},t)}{\partial r_i}\right)},
\end{equation}
where $F(\mathbf{r},t)$ takes the place of the scalar potential or a component of the vector potential, matter displacement field, or reservoir displacement field. The modified Lagrangian density $\mathcal{L}' = \mathcal{L} - (1/4\pi c)\nabla\Phi(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)$ provides the same Lagrangian, i.e. $\int\mathcal{L}\;\mathrm{d}^3\mathbf{r} = \int\mathcal{L}'\;\mathrm{d}^3\mathbf{r} = L$, due to the orthogonality under integration (see Eq. [\ref{eq:helmholtzOrthogonality}]) of the longitudinal gradient of the scalar potential and transverse (Coulomb gauge) vector potential. Here, the use of $\mathcal{L}'$ provides mathematical simplicity.

The equations of motion the four Euler-Lagrange equations lead to are
\begin{equation}\label{eq:fourEOMs}
\begin{split}
\eta_m(\mathbf{r})\ddot{\mathbf{Q}}_m(\mathbf{r},t) + \int_0^\infty\tilde{v}(\nu)\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;&\mathrm{d}\nu + \eta_m(\mathbf{r})\omega_0^2\mathbf{Q}_m(\mathbf{r},t)\\
+ \eta_m(\mathbf{r})\sigma_0\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3&\cdot\mathbf{Q}_m(\mathbf{r},t) = \frac{e}{\Delta}\left(-\nabla\Phi(\mathbf{r},t) - \frac{1}{c}\dot{\mathbf{A}}(\mathbf{r})\right),\\[1.0em]
\eta_\nu(\mathbf{r})\ddot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t) + \eta_\nu(\mathbf{r})\nu^2\tilde{\mathbf{Q}}_\nu(\mathbf{r},t) &= \tilde{v}(\nu)\dot{\mathbf{Q}}_m(\mathbf{r},t),\\[0.5em]
-\nabla\cdot\nabla\Phi(\mathbf{r},t) &= 4\pi\rho_f(\mathbf{r},t) - \frac{4\pi e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t),\\
\nabla\times\nabla\times\mathbf{A}(\mathbf{r},t) - \frac{1}{c^2}\ddot{\mathbf{A}}(\mathbf{r},t) &= \frac{4\pi}{c}\left[\frac{e}{\Delta}\dot{\mathbf{Q}}_m(\mathbf{r},t) + \mathbf{J}_f(\mathbf{r},t)\right] - \frac{\nabla\dot{\Phi}(\mathbf{r},t)}{c}\\
&= \frac{4\pi}{c}\left[\frac{e}{\Delta}\dot{\mathbf{Q}}_m^\perp(\mathbf{r},t) + \mathbf{J}_f^\perp(\mathbf{r},t)\right].
\end{split}
\end{equation}
The most pertient equation to analyze here is the second. Using the Green's function (valid for $r < a$)
\begin{equation}
G(t - t') = \frac{\Theta(t - t')}{\eta_\nu(\mathbf{r})\nu}\sin(\nu[t - t'])
\end{equation}
of the oscillator differential equation
\begin{equation}
\eta_\nu(\mathbf{r})\ddot{G}(t - t') + \eta_\nu(\mathbf{r})\nu^2G(t - t') = 
\begin{cases}
\delta(t - t'), & t > t';\\
0, & t < t';
\end{cases}
\end{equation}
we can see that
\begin{equation}
\begin{split}
\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t) &= \dot{\tilde{\mathbf{Q}}}_\nu^{(0)}(\mathbf{r},t) + \frac{\mathrm{d}}{\mathrm{d}t}\int_{-\infty}^\infty G(t - t')\tilde{v}(\nu)\dot{\mathbf{Q}}_m(\mathbf{r},t')\;\mathrm{d}t'\\
&= \dot{\tilde{\mathbf{Q}}}_\nu^{(0)}(\mathbf{r},t) + \int_{-\infty}^\infty\frac{\Theta(t - t')}{\eta_\nu(\mathbf{r})}\cos(\nu[t - t'])\tilde{v}(\nu)\dot{\mathbf{Q}}_m(\mathbf{r},t')\;\mathrm{d}t'.
\end{split}
\end{equation}
where $\dot{\tilde{\mathbf{Q}}}^{(0)}_\nu(\mathbf{r},t)$ is the $\nu^\mathrm{th}$ velocity field at $t$ generated by stimuli far in the past (formally, at the initial time $-\infty$). The inverse of the reservoir mass-density, $1/\eta_\nu(\mathbf{r}) = \eta_\nu^{-1}(\mathbf{r})$, is taken to imply use of the function $\eta_\nu^{-1}(\mathbf{r}) = \Theta(a - r)\Delta/\sum_{i = 1}^{N_r}\mu_{ri}\Theta[\mathbf{r}\in\mathbb{V}(\mathbf{r}_i)]$, i.e. is assumed to be equal to $\Delta/\mu_{ri}$ within each small region $\mathbb{V}(\mathbf{r}_i)$ inside the sphere and zero for all $r > a$. We can then define a loss function
\begin{equation}
\gamma_0(t - t') = \frac{1}{\eta_m(\mathbf{r})}\int_0^\infty\frac{\tilde{v}^2(\nu)}{\eta_\nu(\mathbf{r})}\cos(\nu[t - t'])\;\mathrm{d}\nu
\end{equation}
and a thermal noise field (dimensions of force per unit volume)
\begin{equation}
\mathbf{N}_\mathrm{therm}(\mathbf{r},t) = -\int_0^\infty\tilde{v}(\nu)\dot{\tilde{\mathbf{Q}}}^{(0)}_\nu(\mathbf{r},t)\;\mathrm{d}\nu
\end{equation}
using an identical assumption for the inverse of the mass-density of the matter field (simply let $\mu_{ri}\to\mu_{mi}$, etc.) such that the first equation of Eq. \eqref{eq:fourEOMs} becomes
\begin{equation}\label{eq:matterEOM}
\begin{split}
\eta_m(\mathbf{r})\ddot{\mathbf{Q}}_m(\mathbf{r},t) &+ \eta_m(\mathbf{r})\int_{-\infty}^t\gamma_0(t - t')\dot{\mathbf{Q}}_m(\mathbf{r},t')\;\mathrm{d}t' + \eta_m(\mathbf{r})\omega_0^2\mathbf{Q}_m(\mathbf{r},t)\\
&+ \eta_m(\mathbf{r})\sigma_0\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t) = \frac{e}{\Delta}\left(-\nabla\Phi(\mathbf{r},t) - \frac{1}{c}\dot{\mathbf{A}}(\mathbf{r})\right) + \mathbf{N}_\mathrm{therm}(\mathbf{r},t).
\end{split}
\end{equation}

Solutions to Eq. \eqref{eq:matterEOM} are simplest in the case where $\sigma_0$ is a ``small'' quantity. We will not belabor the exact definition of ``small'' here, other than to say that we will assume $\sigma_0$ to be linearly proportional to a characteristically small number $\lambda$ that can be used to expand the matter displacement field as a perturbation series:
\begin{equation}
\begin{split}
\mathbf{Q}_m(\mathbf{r},t) &= \mathbf{Q}_m^{(1)}(\mathbf{r},t) + \mathbf{Q}_m^{(2)}(\mathbf{r},t) + \ldots\\
&= \sum_{n = 1}^\infty\lambda^{n-1}\bm{\mathcal{Q}}_m^{(n)}(\mathbf{r},t).
\end{split}
\end{equation}
Here, the functions $\bm{\mathcal{Q}}_m^{(n)}(\mathbf{r},t)$ are of roughly the same order of magnitude at each order $n$ such that it is the different powers of $\lambda$ that separate the terms in the series. Using this expansion, we find that
\begin{equation}\label{eq:matterEOM2}
\begin{split}
\eta_m(\mathbf{r})\ddot{\mathbf{Q}}_m^{(1)}(\mathbf{r},t) + \eta_m(\mathbf{r})\int_{-\infty}^t\gamma_0(t - t')\dot{\mathbf{Q}}_m^{(1)}(\mathbf{r},t')\;\mathrm{d}t' &+ \eta_m(\mathbf{r})\omega_0^2\mathbf{Q}_m^{(1)}(\mathbf{r},t) = \frac{e}{\Delta}\mathbf{E}(\mathbf{r},t) + \mathbf{N}_\mathrm{therm}(\mathbf{r},t),\\
\eta_m(\mathbf{r})\ddot{\mathbf{Q}}_m^{(2)}(\mathbf{r},t) + \eta_m(\mathbf{r})\int_{-\infty}^t\gamma_0(t - t')\dot{\mathbf{Q}}_m^{(2)}(\mathbf{r},t')\;\mathrm{d}t'
&+ \eta_m(\mathbf{r})\omega_0^2\mathbf{Q}_m^{(2)}(\mathbf{r},t)\\
&= -\eta_m(\mathbf{r})\sigma_0\mathbf{Q}_m^{(1)}(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m^{(1)}(\mathbf{r},t)
\end{split}
\end{equation}
where we have let $\mathbf{E}(\mathbf{r},t) = -\nabla\Phi(\mathbf{r},t) - \dot{\mathbf{A}}(\mathbf{r},t)/c$.

Further, we can simplify our analysis by choosing the simple loss function $\gamma_0(t - t') = \gamma_0\delta(t - t')$. We can see that this is achievable with the choice of coupling function
\begin{equation}
\tilde{v}(\nu) = \sqrt{\frac{\gamma_0}{\pi}\eta_m(\mathbf{r})\eta_\nu(\mathbf{r})},
\end{equation}
as can be seen through the application of the identity $\delta(t - t') = \int_0^\infty 2\cos(\nu[t - t'])\;\mathrm{d}\nu/2\pi$. Using this simplification, we can take the Fourier transform of both lines of Eq. \eqref{eq:matterEOM2} to see
\begin{equation}\label{eq:matterEOM3}
\begin{split}
\mathbf{Q}_m^{(1)}(\mathbf{r},\omega)\eta_m(\mathbf{r})\left[-\omega^2 - \mathrm{i}\omega\gamma_0 + \omega_0^2\right] &= \frac{e}{\Delta}\mathbf{E}(\mathbf{r},\omega) + \mathbf{N}_\mathrm{therm}(\omega),\\
\mathbf{Q}_m^{(2)}(\mathbf{r},\omega)\eta_m(\mathbf{r})\left[-\omega^2 - \mathrm{i}\omega\gamma_0 + \omega_0^2\right] &= -\eta_m(\mathbf{r})\sigma_0\int_{-\infty}^\infty\mathbf{Q}_m^{(1)}(\mathbf{r},\omega')\cdot\bm{1}_3\cdot\mathbf{Q}_m^{(1)}(\mathbf{r},\omega - \omega')\;\mathrm{d}\omega'.
\end{split}
\end{equation}
This form of the equations of motion of the matter displacement fields is simple to connect back to a dielectric picture through the definition of the polarization field $\mathbf{P}(\mathbf{r},\omega) = (e/\Delta)\mathbf{Q}_m(\mathbf{r},\omega)$. Generally, this is done without thermal fluctuations, so we'll let $\mathbf{N}_\mathrm{therm}(\mathbf{r},\omega)\to0$ for now. The polarization field can be expanded as a perturbation series analogous to that of the displacement field, such that $\mathbf{P}(\mathbf{r},\omega) = \sum_n\mathbf{P}^{(n)}(\mathbf{r},\omega)$. This expansion can further be connected to a dielectric model through the definitions $\mathbf{P}^{(1)}(\mathbf{r},\omega) = \chi^{(1)}(\mathbf{r},\omega)\mathbf{E}(\mathbf{r},\omega)$ and $\mathbf{P}^{(2)}(\mathbf{r},\omega) = \int_{-\infty}^\infty\mathbf{E}(\mathbf{r},\omega')\cdot\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega')\cdot\mathbf{E}(\mathbf{r},\omega - \omega')\;\mathrm{d}\omega'$. Explicitly, we can use these definitions along with a substitution within Eq. \eqref{eq:matterEOM3} to see that
\begin{equation}
\begin{split}
\chi^{(1)}(\mathbf{r},\omega) &= \frac{e^2}{\Delta^2\eta_m(\mathbf{r})}\frac{1}{\omega_0^2 - \omega^2 - \mathrm{i}\omega\gamma_0},\\
\bm{\chi}^{(2)}(\mathbf{r};\omega',\omega - \omega') &= -\frac{3e^3\sigma_0}{\Delta^3\eta_m^2(\mathbf{r})}\frac{\bm{1}_3}{(\omega_0^2 - \omega^2 - \mathrm{i}\omega\gamma_0)(\omega_0^2 - \omega'^2 - \mathrm{i}\omega'\gamma_0)(\omega_0^2 - [\omega - \omega']^2 - \mathrm{i}[\omega - \omega']\gamma_0)}.
\end{split}
\end{equation}

We are now in a position to connect our microscopic model back to a Green's-function solution to the system. Explicitly, all we need to do is redefine the last two lines of Eq. \eqref{eq:fourEOMs} in Fourier space,
\begin{equation}
\begin{split}
-\nabla\cdot\nabla\Phi(\mathbf{r},\omega) &= 4\pi\rho_f(\mathbf{r},\omega) - 4\pi\nabla\cdot\mathbf{P}(\mathbf{r},\omega),\\
\nabla\times\nabla\times\mathbf{A}(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{A}(\mathbf{r},\omega) &= -\frac{4\pi\omega^2}{c}\mathbf{P}^\perp(\mathbf{r},t) - \frac{4\pi\mathrm{i}\omega}{c}\mathbf{J}_f^\perp(\mathbf{r},\omega),
\end{split}
\end{equation}
then use our definitions for the susceptibilities to build the canonical wave Helmholtz equations for inhomogeneous dielectrics. 













\subsubsection{Independent matter: the polariton picture}

The dynamics of the coupled light-matter system can equivalently be described by letting the moving charges have their own degrees of freedom distinct from those of the fields. Generally, it is easiest to construct this picture in a Hamiltonian formalism, especially if we are to quantize it later. We must therefore begin by identifying the momenta and momentum densities associated with our particle coordinates and fields, respectively. Following the usual procedure, we find
\begin{equation}
\begin{split}
\mathbf{p}_{fi}(t) &= \sum_k\frac{\partial L}{\partial\left(\dot{\mathbf{x}}_{fi}(t)\cdot\hat{\mathbf{e}}_k\right)}\hat{\mathbf{e}}_k = \mu_{fi}\dot{\mathbf{x}}_{fi}(t) + \frac{e_i}{c}\mathbf{A}[\mathbf{x}_{fi}(t),t],\\
\mathbf{P}_m(\mathbf{r},t) &= \sum_k\frac{\partial\mathcal{L}}{\partial\left(\dot{\mathbf{Q}}_m(\mathbf{r},t)\cdot\hat{\mathbf{e}}_k\right)}\hat{\mathbf{e}}_k = \eta_m(\mathbf{r})\dot{\mathbf{Q}}_m(\mathbf{r},t) + \frac{e}{c\Delta}\mathbf{A}(\mathbf{r},t),\\
\tilde{\mathbf{P}}_\nu(\mathbf{r},t) &= \sum_k\frac{\partial\mathcal{L}}{\partial\left(\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\cdot\hat{\mathbf{e}}_k\right)}\hat{\mathbf{e}}_k = \eta_\nu(\mathbf{r})\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t) - \tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t),\\
\mathbf{\Pi}(\mathbf{r},t) &= \sum_k\frac{\partial\mathcal{L}}{\partial\left(\dot{\mathbf{A}}(\mathbf{r},t)\cdot\hat{\mathbf{e}}_k\right)}\hat{\mathbf{e}}_k = \frac{1}{4\pi c}\left[\frac{1}{c}\dot{\mathbf{A}}(\mathbf{r},t) + \nabla\Phi(\mathbf{r},t)\right],
\end{split}
\end{equation}
such that
\begin{equation}
\begin{split}
H &= \sum_i\mathbf{p}_{fi}(t)\cdot\dot{\mathbf{x}}_{fi}(t) + \int\left[\mathbf{P}_m(\mathbf{r},t)\cdot\dot{\mathbf{Q}}_m(\mathbf{r},t) + \int_0^\infty\tilde{\mathbf{P}}_\nu(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;\mathrm{d}\nu + \bm{\Pi}(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} - L\\
&= \sum_i\left(\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \frac{e_i}{c}\dot{\mathbf{x}}_{fi}(t)\cdot\mathbf{A}\left[\mathbf{x}_{fi}(t),t\right]\right) + \int\left[\eta_m(\mathbf{r})\dot{\mathbf{Q}}_m^2(\mathbf{r},t) + \frac{e}{c\Delta}\dot{\mathbf{Q}}_m(\mathbf{r},t)\cdot\mathbf{A}(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
&+ \int\int_0^\infty\left[\eta_\nu(\mathbf{r})\dot{\tilde{\mathbf{Q}}}^2_\nu(\mathbf{r},t) - \tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\right]\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r} + \frac{1}{4\pi c}\int\left[\frac{1}{c}\dot{\mathbf{A}}^2(\mathbf{r},t) + \nabla\Phi(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)\right]\;\mathrm{d}^3\mathbf{r}\\
&- \sum_i\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \int\frac{1}{2}\eta_m(\mathbf{r})\left(-\dot{\mathbf{Q}}_m^2(\mathbf{r},t) + \omega_0^2\mathbf{Q}_m^2(\mathbf{r},t) + \frac{2}{3}\sigma_0\mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]\right)\mathrm{d}^3\mathbf{r}\\
&+ \int\int_0^\infty\left(-\frac{1}{2}\eta_\nu(\mathbf{r})\dot{\tilde{\mathbf{Q}}}_\nu^2(\mathbf{r},t) + \frac{1}{2}\eta_\nu(\mathbf{r})\nu^2\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\right)\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r} + \int\int_0^\infty\tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
&+ \int\left(-\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t) + \sum_ie_i\delta[\mathbf{x}_{fi}(t) - \mathbf{r}]\right)\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
&- \int\left(\frac{e}{c\Delta}\dot{\mathbf{Q}}_m(\mathbf{r},t) + \sum_i\frac{e_i}{c}\dot{\mathbf{x}}_{fi}(t)\delta[\mathbf{x}_{fi}(t) - \mathbf{r}]\right)\cdot\mathbf{A}(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right]\\
&+ \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self} - \frac{1}{8\pi}\int\left(\left[\nabla\Phi(\mathbf{r},t)\right]^2 + \frac{1}{c^2}\dot{\mathbf{A}}^2(\mathbf{r},t) - \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2 + \frac{2}{c}\nabla\Phi(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)\right)\mathrm{d}^3\mathbf{r}.
\end{split}
\end{equation}
After eliminating any terms that include integration of Helmholtz-orthogonal fields and cancelling any reverse duplicates, the Hamiltonian simplifies to
\begin{equation}
\begin{split}
H &= \sum_i\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \int\frac{1}{2}\eta_m(\mathbf{r})\left[\dot{\mathbf{Q}}_m^2(\mathbf{r},t) + \omega_0^2\mathbf{Q}_m^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
&+ \int\frac{1}{3}\eta_m(\mathbf{r})\sigma_0 \mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} + \int\int_0^\infty\frac{1}{2}\eta_\nu(\mathbf{r})\left[\dot{\tilde{\mathbf{Q}}}_\nu^2(\mathbf{r},t) + \nu^2\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\right]\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
&+ \frac{1}{8\pi}\int\left(\frac{1}{c^2}\dot{\mathbf{A}}^2(\mathbf{r},t) + \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r} - \frac{1}{8\pi}\int\left[\nabla\Phi(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r} - \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
&+ \sum_ie_i\Phi[\mathbf{x}_{fi}(t),t] + \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right] + \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self}.
\end{split}
\end{equation}
Eliminating the velocities and velocity densities in favor of momenta and momentum densities, one finds
\begin{equation}
\begin{split}
H &= \sum_i\frac{1}{2}\mu_{fi}\left(\frac{\mathbf{p}_{fi}(t)}{\mu_{fi}} - \frac{e_i}{\mu_{fi}c}\mathbf{A}\left[\mathbf{x}_{fi}(t),t\right]\right)^2\\
&+ \int\frac{1}{2}\eta_m(\mathbf{r})\left[\left(\frac{\mathbf{P}_m(\mathbf{r},t)}{\eta_m(\mathbf{r})} - \frac{e\mathbf{A}(\mathbf{r},t)}{\eta_m(\mathbf{r})c\Delta}\right)^2 + \omega_0^2\mathbf{Q}_m^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
&+ \int\frac{1}{3}\eta_m(\mathbf{r})\sigma_0 \mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
&+ \int\int_0^\infty\frac{1}{2}\eta_\nu(\mathbf{r})\left[\left(\frac{\tilde{\mathbf{P}}_\nu(\mathbf{r},t)}{\eta_\nu(\mathbf{r})} + \frac{\tilde{v}(\nu)}{\eta_\nu(\mathbf{r})}\mathbf{Q}_m(\mathbf{r},t)\right)^2 + \nu^2\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\right]\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
&+ \frac{1}{8\pi}\int\left(\frac{1}{c^2}\left[4\pi c^2\bm{\Pi}(\mathbf{r},t) - c\nabla\Phi(\mathbf{r},t)\right]^2 + \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r} - \frac{1}{8\pi}\int\left[\nabla\Phi(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
&- \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \sum_ie_i\Phi[\mathbf{x}_{fi}(t),t] + \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right] + \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self}.
\end{split}
\end{equation}
From here, we can simplify by separating the scalar potentials of the free and bound charges. Since $\partial\mathcal{L}/\partial\dot{\Phi}(\mathbf{r},t) = 0$, the scalar potentials are not dynamical variables and do not carry their own degrees of freedom. Therefore, the scalar potentials can be considered to instantaneously track the motion of the free and bound charges such that
\begin{equation}
\Phi(\mathbf{r},t) = \Phi_f(\mathbf{r},t) + \Phi_m(\mathbf{r},t)
\end{equation}
where $\Phi_\alpha(\mathbf{r},t) = \int\rho_\alpha(\mathbf{r}',t)/|\mathbf{r} - \mathbf{r}'|\;\mathrm{d}^3\mathbf{r}'$. The 
% first two terms in the last line of $H$ above can then be expanded as
% \begin{equation}
% \begin{split}
% - \int\frac{e}{\Delta}&\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \sum_ie_i\Phi[\mathbf{x}_{fi}(t),t] = - \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
% &+ \sum_ie_i\Phi_m[\mathbf{x}_{fi}(t),t] - \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \sum_ie_i\Phi_f[\mathbf{x}_{fi}(t),t]
% \end{split}
% \end{equation}
% and the 
total Hamiltonian can then be expanded as
\begin{equation}
H = H_f + H_m + H_r + H_\mathrm{EM} + H_\mathrm{int} + H_\mathrm{drive} + H_\mathrm{bind} + H_\mathrm{self} + H_\mathrm{NL}.
\end{equation}
The first term is the Hamiltonian of the free particles,
\begin{equation}
H_f = \sum_i\frac{\mathbf{p}_{fi}^2(t)}{2\mu_{fi}} + \sum_ie_i\Phi_f[\mathbf{x}_{fi}(t),t].
\end{equation}
The second is the Hamiltonian of the matter resonance,
\begin{equation}
\begin{split}
H_m &= \int\left[\frac{\mathbf{P}_m^2(\mathbf{r},t)}{2\eta_m(\mathbf{r})} + \frac{1}{2}\eta_m(\mathbf{r})\omega_0^2\mathbf{Q}_m^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} + \int\int_0^\infty\frac{\tilde{v}^2(\nu)}{2\eta_\nu(\mathbf{r})}\mathbf{Q}_m^2(\mathbf{r},t)\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
&- \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r},
\end{split}
\end{equation}
the third is the Hamiltonian of the bath,
\begin{equation}
H_r = \int\int_0^\infty\left[\frac{\tilde{\mathbf{P}}_\nu^2(\mathbf{r},t)}{2\eta_\nu(\mathbf{r})} + \frac{1}{2}\eta_\nu(\mathbf{r})\nu^2\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\right]\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r},
\end{equation}
and the fourth is the Hamiltonian of the transverse electromagnetic field,
\begin{equation}
\begin{split}
H_\mathrm{EM} &= \int\left(2\pi c^2\bm{\Pi}^2(\mathbf{r},t) + \frac{1}{8\pi}\left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r} + \int\frac{e^2}{2\eta_m(\mathbf{r})c^2\Delta^2}\mathbf{A}^2(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\&+ \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t].
\end{split}
\end{equation}
The fifth is the interaction Hamiltonian that couples the matter, bath, and EM field together,
\begin{equation}
\begin{split}
H_\mathrm{int} &= -\int\frac{e}{\eta_m(\mathbf{r})c\Delta}\mathbf{P}_m(\mathbf{r},t)\cdot\mathbf{A}(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \int\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu(\mathbf{r})}\tilde{\mathbf{P}}_\nu(\mathbf{r},t)\cdot\mathbf{Q}_m(\mathbf{r},t)\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
& - c\int\bm{\Pi}(\mathbf{r},t)\cdot\nabla\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r},
\end{split}
\end{equation}
and the sixth is the driving Hamiltonian that details the interactions of the free charges with the other resonances of the system,
\begin{equation}
\begin{split}
H_\mathrm{drive} &= -\sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] - c\int\bm{\Pi}(\mathbf{r},t)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\&- \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t)\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \sum_ie_i\Phi_m[\mathbf{x}_{fi}(t),t].
\end{split}
\end{equation}
The seventh and eighth terms are the binding and self-energy Hamiltonians
\begin{equation}
\begin{split}
H_\mathrm{bind} &= \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right],\\
H_\mathrm{self} &= \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self},
\end{split}
\end{equation}
while the ninth is the nonlinear term in the potential energy of the matter resonance,
\begin{equation}
H_\mathrm{NL} = \int\frac{1}{3}\eta_m(\mathbf{r})\sigma_0 \mathbf{Q}_m(\mathbf{r},t)\cdot\left[\mathbf{Q}_m(\mathbf{r},t)\cdot\bm{1}_3\cdot\mathbf{Q}_m(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}.
\end{equation}

The matter displacement field, bath displacement field, and vector potential can now be expanded as
\begin{equation}\label{eq:fieldExpansions}
\begin{split}
\mathbf{A}(\mathbf{r},t) &= \sum_{\bm{\alpha}}\int_{-\infty}^\infty \mathcal{A}_{\bm{\alpha}}(k,t)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\;\mathrm{d}k,\\
\mathbf{Q}_m(\mathbf{r},t) &= \Theta(a - r)\sum_{\bm{\beta}}\sum_n\left[\mathcal{B}_{\bm{\beta}}^\perp(k_{\ell n},t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n}) + \mathcal{B}_{\bm{\beta}}^\parallel(k_{\ell n},t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\right],\\
\tilde{\mathbf{Q}}_\nu(\mathbf{r},t) &= \Theta(a - r)\sum_{\bm{\gamma}}\sum_n\left[\tilde{\mathcal{C}}_{\bm{\gamma}}^\perp(k_{\ell n},\nu;t)\mathbf{X}_{\bm{\gamma}}(\mathbf{r},k_{\ell n}) + \tilde{\mathcal{C}}_{\bm{\gamma}}^\parallel(k_{\ell n},\nu;t)\mathbf{L}_{\bm{\gamma}}(\mathbf{r},k_{\ell n})\right].
\end{split}
\end{equation}
The mode functions $\mathbf{X}_{\bm{\beta}}$ and $\mathbf{L}_{\bm{\beta}}$ are chosen to match the symmetry of our problem (details in Appendix \ref{app:greenFuncDetails}) such that the definition of the vector potential can be extrapolated from any introductory quantum optics text (also: Section \ref{sec:noMatter}). Specifically, the photon modes of the system have angular indices $\bm{\alpha}$ and radial indices $k$ that determine their wave pattern in space. In free space, the radial index is linked to the time evolution through the relation $k = \omega/c$ with $\omega$ the Fourier conjugate to $t$. However, with both free and bound charges present, this relationship will not hold in general such that each mode's time-variations will need to be accounted for separately.

The expansions for the matter and bath fields are not so obvious. However, it is useful to remember that the displacement field is simply related to the electric polarization field via $\mathbf{Q}_m(\mathbf{r},t) = \Delta\mathbf{P}(\mathbf{r},t)/e$. Thus, since the polarization field is always a solution to the wave equation in any region containing a homogeneous medium (or vacuum) with sharp boundaries, we can conclude that a spherical particle with sharp boundaries will contain a polarization field $\mathbf{P}(\mathbf{r},t)$ and a corresponding displacement field $\mathbf{Q}_m(\mathbf{r},t)$ that are solutions to the wave equation. A proof is given in Appendix \ref{app:polarizationWaveEquation}.

The displacement field can therefore be completely described by a linear combination of the basis functions of the wave equation in spherical coordinates. However, the behavior of $\mathbf{Q}_m(\mathbf{r},t)$ at the boundary must be considered carefully. In particular, because the surface charges of the sphere are $\sigma_b(\theta,\phi) = \hat{\mathbf{r}}\cdot\mathbf{P}(r=a,\theta,\phi;t) = (e/\Delta)\hat{\mathbf{r}}\cdot\mathbf{Q}_m(r=a,\theta,\phi;t)$, we know that the radial components of the vector harmonics that comprise $\mathbf{Q}_m(\mathbf{r},t)$ must be nonzero at the boundary. The surface-parallel components of $\mathbf{Q}_m(\mathbf{r},t)$ have no such restriction, however, such that we can let them go to zero at $r = a$.

The vector harmonics that showcase these boundary behaviors are $\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n})$ and $\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n})$, in which the set of possible wavenumbers $k$ has been truncated to a discrete set $\{k_{\ell n}\}$, with $k_{\ell n}a$ the $n^\mathrm{th}$ nonzero root of the $\ell^\mathrm{th}$ spherical Bessel function. As discussed in Appendix \ref{app:helmholtzDelta}, these vector spherical harmonics provide a complete set of functions within the boundary such that any form of $\mathbf{Q}_m(\mathbf{r},t)$ can be constructed within the boundary by tuning the expansion coefficients $\mathcal{B}_{\bm{\beta}}^{\perp,\parallel}$, which represent the excitation magnitudes of the transverse and longitudinal matter mode displacements. Finally, we let the bath displacement field be expanded similarly to that of the matter field with excitation magnitudes $\tilde{\mathcal{C}}_{\bm{\gamma}}^{\perp,\parallel}(k,\nu;t)$.

% Due to the bilinear nature of most of the terms of $H$, the most convenient way to simplify the calculations further is by exploiting Helmholtz orthogonality. The vector potential is transverse by the definition of the Coulomb gauge, and is sensibly expanded only in terms of the transverse harmonics $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)$. The 

% To do this, we need to break each of our fields into transverse (divergence-free) and longitudinal (curl-free) components. This can be done via the decomposition of the dyadic Dirac delta into components as is shown in Appendix \ref{sec:diracDyadExpansion}, and gives
% \begin{equation}
% \mathbf{Q}^{\perp,\parallel}(\mathbf{r}) = \int\mathbf{Q}(\mathbf{r}')\cdot\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_{\perp,\parallel}\;\mathrm{d}^3\mathbf{r}',
% \end{equation}
% where
% \begin{equation}
% \begin{split}
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp &= \frac{1}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k,\\
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\parallel &= \frac{1}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty k^2\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{L}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k,
% \end{split}
% \end{equation}
% as is shown in Eq. \eqref{eq:dyadicDiracDeltaSeparated}. By construction, and as can be seen from the transverse nature of the harmonics $\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)$, the vector potential $\mathbf{A}(\mathbf{r},t)$ is purely transverse, i.e. $\mathbf{A}(\mathbf{r},t) = \mathbf{A}^\perp(\mathbf{r},t)$. Therefore, we can begin the difficult calculations by starting with the matter field $\mathbf{Q}_m(\mathbf{r},t)$. Using the finite integral identities of Eq. \eqref{eq:vectorSphericalHarmonicOrthogonalityConditionFinite}, we find that the matter field's transverse part is
% \begin{equation}
% \begin{split}
% \mathbf{Q}_m^\perp(\mathbf{r},t) &= \int\mathbf{Q}_m(\mathbf{r}',t)\cdot\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp\mathrm{d}^3\mathbf{r}'\\
% % &= \int\Theta(a - r')\left(\sum_{\bm{\beta}}\int_{0}^\infty\left[\mathcal{B}_{\bm{\beta}}^\perp(k,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k) + \mathcal{B}_{\bm{\beta}}^\parallel(k,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r}',k)\right]\mathrm{d}k\right)\\
% % &\qquad\cdot\left(\frac{1}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\kappa^2\;\mathrm{d}\kappa\right)\mathrm{d}^3\mathbf{r}'\\
% % &=  \sum_{\bm{\alpha}\bm{\beta}}\int_{0}^\infty\int_0^\infty \mathcal{B}_{\bm{\beta}}^\perp(k,t)\frac{\kappa^2}{2\pi^2}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\int\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k)\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\Theta(a - r')\;\mathrm{d}^3\mathbf{r}'\,\mathrm{d}\kappa\,\mathrm{d}k\\
% % &\qquad+ \sum_{\bm{\alpha}\bm{\beta}}\int_{0}^\infty\int_0^\infty \mathcal{B}_{\bm{\beta}}^\parallel(k,t)\frac{\kappa^2}{2\pi^2}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\int\mathbf{L}_{\bm{\alpha}}(\mathbf{r}',\kappa)\cdot\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k)\Theta(a - r')\;\mathrm{d}^3\mathbf{r}'\,\mathrm{d}\kappa\,\mathrm{d}k\\
% % &= \sum_{\bm{\beta}}\int_{0}^\infty\int_0^\infty \frac{\kappa^2}{2\pi^2}4\pi R_{T\ell}^{\ll}(k,\kappa;0,a)\mathcal{B}_{\bm{\beta}}^\perp(k,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k\\
% % &\qquad+ \sum_{\bm{\beta}}\int_0^\infty\int_{0}^\infty \frac{\kappa^2}{2\pi^2}4\pi\sqrt{\ell(\ell + 1)}\delta_{TE}\frac{1}{k\kappa}aj_\ell(ka)j_\ell(\kappa a)\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k\\
% &= \sum_{\bm{\beta}}\int_{0}^\infty\int_0^\infty \frac{2\kappa^2}{\pi} R_{T\ell}^{\ll}(k,\kappa;0,a)\mathcal{B}_{\bm{\beta}}^\perp(k,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k\\
% &\qquad+ \sum_{\bm{\beta}}\int_0^\infty\int_{0}^\infty\frac{2\kappa^2}{\pi}\frac{a}{k\kappa}\sqrt{\ell(\ell + 1)}j_\ell(ka)j_\ell(\kappa a)\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k.
% \end{split}
% \end{equation}
% Similarly, the longitudinal part is
% \begin{equation}
% \begin{split}
% \mathbf{Q}_m^\parallel(\mathbf{r},t) &= \int\mathbf{Q}_m(\mathbf{r}',t)\cdot\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\parallel\mathrm{d}^3\mathbf{r}'\\
% % &= \int\Theta(a - r')\left(\sum_{\bm{\beta}}\int_{0}^\infty\left[\mathcal{B}_{\bm{\beta}}^\perp(k,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k) + \mathcal{B}_{\bm{\beta}}^\parallel(k,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r}',k)\right]\mathrm{d}k\right)\\
% % &\qquad\cdot\left(\frac{1}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{L}_{\bm{\alpha}}(\mathbf{r}',\kappa)\mathbf{L}_{\bm{\alpha}}(\mathbf{r},\kappa)\kappa^2\;\mathrm{d}\kappa\right)\mathrm{d}^3\mathbf{r}'\\
% % &= \sum_{\bm{\alpha}\bm{\beta}}\int_{0}^\infty\int_0^\infty\mathcal{B}_{\bm{\beta}}^\perp(k,t)\frac{\kappa^2}{2\pi^2}\mathbf{L}_{\bm{\alpha}}(\mathbf{r},\kappa)\int\mathbf{X}_{\bm{\beta}}(\mathbf{r}',k)\cdot\mathbf{L}_{\bm{\alpha}}(\mathbf{r}',\kappa)\Theta(a - r')\;\mathrm{d}^3\mathbf{r}'\,\mathrm{d}\kappa\,\mathrm{d}k\\
% % &\qquad + \sum_{\bm{\alpha}\bm{\beta}}\int_{0}^\infty\int_0^\infty\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\frac{\kappa^2}{2\pi^2}\mathbf{L}_{\bm{\alpha}}(\mathbf{r},\kappa)\int\mathbf{L}_{\bm{\alpha}}(\mathbf{r}',\kappa)\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r}',k)\Theta(a - r')\;\mathrm{d}^3\mathbf{r}'\,\mathrm{d}\kappa\,\mathrm{d}k\\
% % &= \sum_{\bm{\beta}}\int_{0}^\infty\int_0^\infty\frac{\kappa^2}{2\pi^2}4\pi\sqrt{\ell(\ell + 1)}\delta_{TE}\frac{1}{k\kappa}aj_\ell(ka)j_\ell(\kappa a)\mathcal{B}_{\bm{\beta}}^\perp(k,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k\\
% % &\qquad + \sum_{\bm{\beta}}\int_{0}^\infty\int_0^\infty\frac{\kappa^2}{2\pi^2}4\pi R_{L\ell}^\ll(k,\kappa;0,a)\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k\\
% &= \sum_{\bm{\beta}}\int_{0}^\infty\int_0^\infty\frac{2\kappa^2}{\pi}\frac{a}{k\kappa}\sqrt{\ell(\ell + 1)}j_\ell(ka)j_\ell(\kappa a)\mathcal{B}_{\bm{\beta}}^\perp(k,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k\\
% &\qquad + \sum_{\bm{\beta}}\int_{0}^\infty\int_0^\infty\frac{2\kappa^2}{\pi}R_{L\ell}^\ll(k,\kappa;0,a)\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}k.
% \end{split}
% \end{equation}

% With these results, we can define the Helmholtz components of the displacement field as
% \begin{equation}\label{eq:matterFieldHelmholtzExpansion}
% \begin{split}
% \mathbf{Q}_m^\perp(\mathbf{r},t) &= \sum_{\bm{\beta}}\int_0^\infty \mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,\\
% \mathbf{Q}_m^\parallel(\mathbf{r},t) &= \sum_{\bm{\beta}}\int_0^\infty \mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,
% \end{split}
% \end{equation}
% where the expansion coefficients
% \begin{equation}
% \begin{split}
% \mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t) &= \frac{2\kappa^2}{\pi}\int_{0}^\infty\left[ R_{T\ell}^\ll(k,\kappa;0,a)\mathcal{B}_{\bm{\beta}}^\perp(k,t) + \frac{a}{k\kappa}\sqrt{\ell(\ell + 1)}j_\ell(ka)j_\ell(\kappa a)\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\right]\mathrm{d}k,\\
% \mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t) &= \frac{2\kappa^2}{\pi}\int_{0}^\infty\left[\frac{a}{k\kappa}\sqrt{\ell(\ell + 1)}j_\ell(ka)j_\ell(\kappa a)\mathcal{B}_{\bm{\beta}}^\perp(k,t) + R_{L\ell}^\ll(k,\kappa;0,a)\mathcal{B}_{\bm{\beta}}^\parallel(k,t)\right]\mathrm{d}k
% \end{split}
% \end{equation}
% describe the relative excitations of the constituent parts of the two independent Helmholtz field components at each index set $(\bm{\beta},k)$. Moreover, the expansion of the bath field follows immediately using the same expansion techniques, such that
% \begin{equation}\label{eq:bathFieldHelmholtzExpansion}
% \begin{split}
% \tilde{\mathbf{Q}}_\nu^\perp(\mathbf{r},t) &= \sum_{\bm{\gamma}}\int_0^\infty \tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\mathbf{X}_{\bm{\gamma}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,\\
% \tilde{\mathbf{Q}}_\nu^\parallel(\mathbf{r},t) &= \sum_{\bm{\gamma}}\int_0^\infty\tilde{\mathcal{Q}}_{\bm{\gamma}}^\parallel(\kappa,\nu; t)\mathbf{L}_{\bm{\gamma}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,
% \end{split}
% \end{equation}
% with
% \begin{equation}
% \begin{split}
% \tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t) &= \frac{2\kappa^2}{\pi}\int_{0}^\infty\left[ R_{T\ell}^\ll(k,\kappa;0,a)\tilde{\mathcal{C}}_{\bm{\gamma}}^\perp(k,\nu;t) + \frac{a}{k\kappa}\sqrt{\ell(\ell + 1)}j_\ell(ka)j_\ell(\kappa a)\tilde{\mathcal{C}}_{\bm{\gamma}}^\parallel(k,\nu;t)\right]\mathrm{d}k,\\
% \tilde{\mathcal{Q}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t) &= \frac{2\kappa^2}{\pi}\int_{0}^\infty\left[\frac{a}{k\kappa}\sqrt{\ell(\ell + 1)}j_\ell(ka)j_\ell(\kappa a)\tilde{\mathcal{C}}_{\bm{\gamma}}^\perp(k,\nu;t) + R_{L\ell}^\ll(k,\kappa;0,a)\tilde{\mathcal{C}}_{\bm{\gamma}}^\parallel(k,\nu;t)\right]\mathrm{d}k.
% \end{split}
% \end{equation}

Before inserting these new definitions of our photon and matter field into the Hamiltonian, it is convenient to rewrite any terms of our system Lagrangian/Hamiltonian involving the photon coordinates or velocities as integrals only over nonnegative wavenumbers. We can use the symmetry properties $\mathcal{A}_{\bm{\alpha}}(-k,t) = (-1)^{\ell + \delta_{TE}}\mathcal{A}_{\bm{\alpha}}(k,t)$ and $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},-k) = (-1)^{\ell + \delta_{TE}}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)$ to do so, such that
\begin{equation}
\begin{split}
\mathbf{A}(\mathbf{r},t) &= \sum_{\bm{\alpha}}\int_{-\infty}^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\;\mathrm{d}k\\
&= \sum_{\bm{\alpha}}\int_{0}^\infty2\mathcal{A}_{\bm{\alpha}}(k,t)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\;\mathrm{d}k.
\end{split}
\end{equation}
Further, it will be convenient to define the matter field Helmholtz components
\begin{equation}
\begin{split}
\mathbf{Q}_m^\perp(\mathbf{r},t) &= \Theta(a - r)\sum_{\bm{\beta}}\sum_n\mathcal{B}_{\bm{\beta}}^\perp(k_{\ell n},t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n}),\\
\mathbf{Q}_m^\parallel(\mathbf{r},t) &= \Theta(a - r)\sum_{\bm{\beta}}\sum_n\mathcal{B}_{\bm{\beta}}^\parallel(k_{\ell n},t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n}),\\
\tilde{\mathbf{Q}}_\nu^\perp(\mathbf{r},t) &= \Theta(a - r)\sum_{\bm{\beta}}\sum_n\tilde{\mathcal{C}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n}),\\
\tilde{\mathbf{Q}}_\nu^\parallel(\mathbf{r},t) &= \Theta(a - r)\sum_{\bm{\beta}}\sum_n\tilde{\mathcal{C}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n}).\\
\end{split}
\end{equation}
These components are not quite the transverse and longitudinal components of each field in the traditional sense, as they aren't smooth over the entire universe. However, any terms in the Hamiltonian proportional to $\mathbf{Q}_m^2(\mathbf{r},t)$ or similar will only involve integrals over the inside of the sphere, such that the above component definitions provide a notion of Helmholtz orthogonality between the matter and bath fields that will provide some useful simplifications.

To see this, we can repeat the process of deriving the system Hamiltonian from the Lagrangian using our new matter and photon field expansions. The expansion coefficients both for the matter field and for the reservoir field can be treated as their own degrees of freedom with corresponding conjugate momenta. Taking care to note that our coordinates, as our harmonics, are zero in the case $p=1$, $m=0$, we can see that
\begin{equation}
\begin{split}
L_m &= \frac{\eta_m}{2}\int\left(\dot{\mathbf{Q}}_m^2(\mathbf{r},t) - \omega_0^2\mathbf{Q}_m^2(\mathbf{r},t)\right)\mathrm{d}^3\mathbf{r}\\
% &= \frac{\eta_m}{2}\left(\;\int_{r<a}\sum_{\bm{\beta}n}\dot{\mathcal{B}}_{\bm{\beta}}^\perp(k_{\ell n},t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\dot{\mathcal{B}}_{\bm{\beta}'}^\perp(k_{\ell'n'},t)\mathbf{X}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}^3\mathbf{r}\right.\\
% &\qquad + \int_{r<a}\sum_{\bm{\beta}n}\dot{\mathcal{B}}_{\bm{\beta}}^\parallel(k_{\ell n},t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\dot{\mathcal{B}}_{\bm{\beta}'}^\parallel(k_{\ell'n'},t)\mathbf{L}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}^3\mathbf{r}\\
% &\qquad - \omega_0^2\int_{r<a}\sum_{\bm{\beta}n}\mathcal{B}_{\bm{\beta}}^\perp(k_{\ell n},t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\mathcal{B}_{\bm{\beta}'}^\perp(k_{\ell'n'},t)\mathbf{X}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}^3\mathbf{r}\\
% &\qquad\left. - \omega_0^2\int_{r<a}\sum_{\bm{\beta}n}\mathcal{B}_{\bm{\beta}}^\parallel(k_{\ell n},t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\mathcal{B}_{\bm{\beta}'}^\parallel(k_{\ell'n'},t)\mathbf{L}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}^3\mathbf{r}\right)\\
% &= \frac{\eta_m}{2}\sum_{\bm{\beta}\bm{\beta}'}\sum_{nn'}2\pi a^3(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\beta}'}\delta_{nn'}j_{\ell + 1}^2(k_{\ell n}a)\left[\dot{\mathcal{B}}_{\bm{\beta}}^\perp(k_{\ell n},t)\dot{\mathcal{B}}_{\bm{\beta}'}^\perp(k_{\ell' n'},t)\right.\\
% &\qquad\left. + \dot{\mathcal{B}}_{\bm{\beta}}^\parallel(k_{\ell n},t)\dot{\mathcal{B}}_{\bm{\beta}'}^\parallel(k_{\ell' n'},t) - \omega_0^2\mathcal{B}_{\bm{\beta}}^\perp(k_{\ell n},t)\mathcal{B}_{\bm{\beta}'}^\perp(k_{\ell' n'},t) - \omega_0^2\mathcal{B}_{\bm{\beta}}^\parallel(k_{\ell n},t)\mathcal{B}_{\bm{\beta}'}^\parallel(k_{\ell' n'},t)\right]\\
&= \sum_{\bm{\beta}n}\eta_m\pi a^3j_{\ell + 1}^2(k_{\ell n}a)\left[\left(\left[\dot{\mathcal{B}}_{\bm{\beta}}^\perp(k_{\ell n},t)\right]^2 - \omega_0^2\left[\mathcal{B}_{\bm{\beta}}^\perp(k_{\ell n},t)\right]^2\right) + \left(\left[\dot{\mathcal{B}}_{\bm{\beta}}^\parallel(k_{\ell n},t)\right]^2 - \omega_0^2\left[\mathcal{B}_{\bm{\beta}}^\parallel(k_{\ell n},t)\right]^2\right)\right]
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
L_r &= \int_{r<a}\int_0^\infty\frac{\eta_\nu}{2}\left(\dot{\tilde{\mathbf{Q}}}_\nu^2(\mathbf{r},t) - \nu^2\tilde{\mathbf{Q}}_\nu^2(\mathbf{r},t)\right)\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
% &= \frac{\eta_m}{2}\left(\;\int_{r<a}\int_0^\infty\sum_{\bm{\beta}n}\dot{\tilde{\mathcal{C}}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\dot{\tilde{\mathcal{C}}}_{\bm{\beta}'}^\perp(k_{\ell'n'},\nu;t)\mathbf{X}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\right.\\
% &\qquad + \int_{r<a}\int_0^\infty\sum_{\bm{\beta}n}\dot{\tilde{\mathcal{C}}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\dot{\tilde{\mathcal{C}}}_{\bm{\beta}'}^\parallel(k_{\ell'n'},\nu;t)\mathbf{L}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
% &\qquad - \nu^2\int_{r<a}\int_0^\infty\sum_{\bm{\beta}n}\tilde{\mathcal{C}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\tilde{\mathcal{C}}_{\bm{\beta}'}^\perp(k_{\ell'n'},\nu;t)\mathbf{X}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
% &\qquad\left. - \nu^2\int_{r<a}\int_0^\infty\sum_{\bm{\beta}n}\tilde{\mathcal{C}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},k_{\ell n})\cdot\sum_{\bm{\beta}'n'}\tilde{\mathcal{C}}_{\bm{\beta}'}^\parallel(k_{\ell'n'},\nu;t)\mathbf{L}_{\bm{\beta}'}(\mathbf{r},k_{\ell'n'})\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\right)\\
% &= \sum_{\bm{\beta}\bm{\beta}'}\sum_{nn'}\int_0^\infty \frac{\eta_m}{2}2\pi a^3(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\beta}'}\delta_{nn'}j_{\ell + 1}^2(k_{\ell n}a)\left[\dot{\tilde{\mathcal{C}}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\dot{\tilde{\mathcal{C}}}_{\bm{\beta}'}^\perp(k_{\ell' n'},\nu;t)\right.\\
% &\qquad\left. + \dot{\tilde{\mathcal{C}}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\dot{\tilde{\mathcal{C}}}_{\bm{\beta}'}^\parallel(k_{\ell' n'},\nu;t) - \nu^2\tilde{\mathcal{C}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\tilde{\mathcal{C}}_{\bm{\beta}'}^\perp(k_{\ell' n'},\nu;t) - \nu^2\tilde{\mathcal{C}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\tilde{\mathcal{C}}_{\bm{\beta}'}^\parallel(k_{\ell' n'},\nu;t)\right]\mathrm{d}\nu\\
&= \sum_{\bm{\beta}n}\int_0^\infty\eta_\nu\pi a^3j_{\ell + 1}^2(k_{\ell n}a)\left[\left(\left[\dot{\tilde{\mathcal{C}}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\right]^2 - \nu^2\left[\tilde{\mathcal{C}}_{\bm{\beta}}^\perp(k_{\ell n},\nu;t)\right]^2\right)\right.\\
&\qquad\left. + \left(\left[\dot{\tilde{\mathcal{C}}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\right]^2 - \nu^2\left[\tilde{\mathcal{C}}_{\bm{\beta}}^\parallel(k_{\ell n},\nu;t)\right]^2\right)\right]\mathrm{d}\nu.
\end{split}
\end{equation}
Further, noting that $\Phi(\mathbf{r},t) = \Phi_f(\mathbf{r},t) + \Phi_m(\mathbf{r},t)$ where
\begin{equation}
\begin{split}
\Phi_m(\mathbf{r},t) &= \int\frac{\rho_m(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'\\
&= -\frac{e}{\Delta}\int\frac{\nabla'\cdot\mathbf{Q}_m^\parallel(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'\\
&= -\frac{e}{\Delta}\int\left(\int_0^\infty\sum_{\bm{\beta}}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\nabla'\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r}',\kappa)\right)\sum_{\bm{\alpha}}\left[f_{\bm{\alpha}}^>(\mathbf{r})f_{\bm{\alpha}}^<(\mathbf{r}')\Theta(r - r') + f_{\bm{\alpha}}^<(\mathbf{r})f_{\bm{\alpha}}^>(\mathbf{r}')\Theta(r' - r)\right]\mathrm{d}^3\mathbf{r}'\\
&= \frac{e}{\Delta}\int_0^\infty\sum_{\bm{\alpha}\bm{\beta}}\delta_{TE}\kappa\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}\left[f_{\bm{\alpha}}^>(\mathbf{r})\int f_{\bm{\alpha}}^<(\mathbf{r}')j_\ell(\kappa r')P_{\ell m}(\cos\theta')S_p(m\phi')\;\mathrm{d}^3\mathbf{r}'\right.\\
&\qquad + \left.f_{\bm{\alpha}}^<(\mathbf{r})\int f_{\bm{\alpha}}^>(\mathbf{r}')j_\ell(\kappa r')P_{\ell m}(\cos\theta')S_p(m\phi')\;\mathrm{d}^3\mathbf{r}'\right]\mathrm{d}\kappa\\
&= \frac{e}{\Delta}\int_0^\infty\sum_{\bm{\alpha}\bm{\beta}}\delta_{TE}\kappa\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{4\pi}{\kappa}(1 - \delta_{p1}\delta_{m0})\delta_{T'E}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}\frac{1}{\sqrt{2\ell + 1}}\\
&\qquad\times\left[f_{\bm{\alpha}}^>(\mathbf{r})r^{\ell + 2}j_{\ell + 1}(\kappa t) + f_{\bm{\alpha}}^<(\mathbf{r})r^{-\ell + 1}j_{\ell - 1}(\kappa r)\right]\mathrm{d}\kappa\\
&= \frac{4\pi e}{\Delta}\int_0^\infty\sum_{\bm{\beta}}\delta_{TE}(1 - \delta_{p1}\delta_{m0})\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{1}{\sqrt{2\ell + 1}}\\
&\qquad\times \sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}P_{\ell m}(\cos\theta)S_p(m\phi)\left[\frac{r^{\ell + 2}}{r^{\ell + 1}}j_{\ell + 1}(\kappa r) + \frac{r^\ell}{r^{\ell - 1}}j_{\ell - 1}(\kappa r)\right]\mathrm{d}\kappa\\
&= \frac{4\pi e}{\Delta}\int_0^\infty\sum_{\bm{\beta}}\delta_{TE}(1 - \delta_{p1}\delta_{m0})\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{1}{\sqrt{2\ell + 1}}\\
&\qquad\times \sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}P_{\ell m}(\cos\theta)S_p(m\phi)(2\ell + 1)j_\ell(\kappa r)\;\mathrm{d}\kappa\\
&= \frac{4\pi e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\delta_{TE}(1 - \delta_{p1}\delta_{m0})\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}j_\ell(\kappa r)P_{\ell m}(\cos\theta)S_p(m\phi)\;\mathrm{d}\kappa
\end{split}
\end{equation}
is the electrostatic potential set up by the matter field,


\begin{equation}
\begin{split}
L_\mathrm{EM} &= \frac{1}{8\pi}\int\left(\left[\nabla\Phi(\mathbf{r},t)\right]^2 + \frac{1}{c^2}\dot{\mathbf{A}}^2(\mathbf{r},t) - \left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r}\\
% &= \frac{1}{8\pi}\int\left[\nabla\Phi(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r} + \frac{1}{8\pi}\int\left(\frac{1}{c^2}\sum_{\bm{\alpha}}\int_0^\infty2\dot{\mathcal{A}}_{\bm{\alpha}}(k,t)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\;\mathrm{d}k\cdot\sum_{\bm{\alpha}'}\int_0^\infty2\dot{\mathcal{A}}_{\bm{\alpha}'}(k',t)\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}k'\right.\\
% &\qquad\left. - \sum_{\bm{\alpha}}\int_0^\infty 2k\mathcal{A}_{\bm{\alpha}}(k,t)\mathbf{Y}_{\bm{\alpha}}(\mathbf{r},k)\;\mathrm{d}k\cdot\sum_{\bm{\alpha}'}\int_0^\infty 2k'\mathcal{A}_{\bm{\alpha}'}(k',t)\mathbf{Y}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}k'\right)\mathrm{d}^3\mathbf{r}\\
% &= \frac{1}{8\pi}\int\left[\nabla\Phi(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r} + \frac{1}{8\pi}\sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty\frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}\delta(k - k')\\
% &\qquad\times\left(\frac{4}{c^2}\dot{\mathcal{A}}_{\bm{\alpha}}(k,t)\dot{\mathcal{A}}_{\bm{\alpha}'}(k',t) - 4kk'\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\right)\mathrm{d}k\,\mathrm{d}k'\\
&= \frac{1}{8\pi}\int\left[\nabla\Phi(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r} + \sum_{\bm{\alpha}}\int_0^\infty\left(\frac{\pi}{k^2c^2}\dot{\mathcal{A}}^2_{\bm{\alpha}}(k,t) - \pi\mathcal{A}_{\bm{\alpha}}^2(k,t)\right)\mathrm{d}k,
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
L_\mathrm{int} &= \int\left(\left[\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m(\mathbf{r},t) - \rho_f(\mathbf{r},t)\right]\Phi(\mathbf{r},t) + \frac{1}{c}\left[\frac{e}{\Delta}\dot{\mathbf{Q}}_m(\mathbf{r},t) + \mathbf{J}_f(\mathbf{r},t)\right]\cdot\mathbf{A}(\mathbf{r},t)\right.\\
&\qquad\left. - \int_0^\infty\tilde{v}(\nu)\mathbf{Q}_m(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)\;\mathrm{d}\nu\right)\mathrm{d}^3\mathbf{r}\\
&= 
\end{split}
\end{equation}

\noindent\rule{\textwidth}{0.5pt}

\begin{equation}
\begin{split}
L &= \frac{\eta_m}{2}\int\left(\left[\dot{\mathbf{Q}}_m^\perp(\mathbf{r},t)\right]^2 + \left[\dot{\mathbf{Q}}_m^\parallel(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r} + \int_0^\infty\frac{\eta_\nu}{2}\int\left(\left[\dot{\tilde{\mathbf{Q}}}_\nu^\perp(\mathbf{r},t)\right]^2 + \left[\dot{\tilde{\mathbf{Q}}}_\nu^\parallel(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r}\,\mathrm{d}\nu\\
&\qquad + \frac{1}{8\pi}\int_0^\infty\frac{1}{c^2}\dot{\mathbf{A}}^2(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} - \int_0^\infty\tilde{v}(\nu)\int\left[\mathbf{Q}_m^\perp(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu^\perp(\mathbf{r},t) + \mathbf{Q}_m^\parallel(\mathbf{r},t)\cdot\dot{\tilde{\mathbf{Q}}}_\nu^\parallel(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\,\mathrm{d}\nu\\
&\qquad + \frac{e}{c\Delta}\int\dot{\mathbf{Q}}_m^\perp(\mathbf{r},t)\cdot\mathbf{A}(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \ldots\\
&= \frac{\eta_m}{2}\sum_{\bm{\beta}}\int_0^\infty\frac{2\pi^2}{\kappa^2}\left(\left[\dot{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t)\right]^2 + \delta_{TE}\left[\dot{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
&+ \int_0^\infty\frac{\eta_\nu}{2}\sum_{\bm{\gamma}}\int_0^\infty\frac{2\pi^2}{\kappa^2}\left(\left[\dot{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right]^2 + \delta_{TE}\left[\dot{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right]^2\right)\mathrm{d}\kappa\,\mathrm{d}\nu + \sum_{\bm{\alpha}}\int_{0}^\infty\frac{\pi}{k^2c^2}\dot{\mathcal{A}}_{\bm{\alpha}}^2(k,t)\;\mathrm{d}k\\
&- \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{2\pi^2}{\kappa^2}\tilde{v}(\nu)\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\dot{\tilde{\mathcal{Q}}}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \delta_{TE}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\dot{\tilde{\mathcal{Q}}}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&+ \frac{e}{c\Delta}\sum_{\bm{\beta}}\int_0^\infty\frac{4\pi^2}{\kappa^2}\dot{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{A}_{\bm{\beta}}(\kappa,t)\;\mathrm{d}\kappa + \ldots,
\end{split}
\end{equation}
where the terms in the ellipsis do not contain factors of any of the system's velocities. We have let $\eta_m(\mathbf{r})\to\eta_m$ and $\eta_\nu(\mathbf{r})\to\eta_\nu$, as either of the mass densities' spatial profiles is simply a Heaviside function $\Theta(a - r)$ and therefore redundant when multiplied by the Heaviside functions within the matter and reservoir field coordinates $\mathbf{Q}_m(\mathbf{r},t)$ and $\tilde{\mathbf{Q}}_\nu(\mathbf{r},t)$ or the corresponding velocities $\dot{\mathbf{Q}}_m(\mathbf{r},t)$ and $\dot{\tilde{\mathbf{Q}}}_\nu(\mathbf{r},t)$.

The conjugate momenta then become
\begin{equation}
\begin{split}
\mathit{\Pi}_{\bm{\alpha}}(k,t) &= \frac{\partial L}{\partial \dot{\mathcal{A}}_{\bm{\alpha}}(k,t)} = \frac{2\pi}{k^2c^2}\dot{\mathcal{A}}_{\bm{\alpha}}(k,t),\\
\mathcal{P}_{\bm{\beta}}^\perp(k,t) &= \frac{\partial L}{\partial \dot{\mathcal{Q}}_{\bm{\beta}}^\perp(k,t)} = \eta_m\frac{2\pi^2}{k^2}\dot{\mathcal{Q}}_{\bm{\beta}}^\perp(k,t) + \frac{e}{c\Delta}\frac{4\pi^2}{k^2}\mathcal{A}_{\bm{\beta}}(k,t),\\
\mathcal{P}_{\bm{\beta}}^\parallel(k,t) &= \frac{\partial L}{\partial \dot{\mathcal{Q}}_{\bm{\beta}}^\parallel(t)} = \eta_m\frac{2\pi^2}{k^2}\dot{\mathcal{Q}}_{\bm{\beta}}^\parallel(k,t),\\
\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(k,\nu;t) &= \frac{\partial L}{\partial \dot{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\perp(k,\nu;t)} = \eta_\nu\frac{2\pi^2}{k^2}\dot{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\perp(k,\nu;t) - \frac{2\pi^2}{k^2}\tilde{v}(\nu)\mathcal{Q}_{\bm{\gamma}}^\perp(k,t),\\
\tilde{\mathcal{P}}_{\bm{\gamma}}^\parallel(k,\nu;t) &= \frac{\partial L}{\partial \dot{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\parallel(k,\nu;t)} = \eta_\nu \frac{2\pi^2}{k^2}\dot{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\parallel(k,\nu;t) - \frac{2\pi^2}{k^2}\tilde{v}(\nu)\mathcal{Q}_{\bm{\gamma}}^\parallel(t),
\end{split}
\end{equation}
such that
\begin{equation}
\begin{split}
\bm{\Pi}(\mathbf{r},t) &= \sum_{\bm{\alpha}}\int_0^\infty \frac{k^2}{4\pi^2}\mathit{\Pi}_{\bm{\alpha}}(k,t)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\;\mathrm{d}k + \frac{1}{4\pi c}\nabla\Phi(\mathbf{r},t),\\
\mathbf{P}_m^\perp(\mathbf{r},t) &= \sum_{\bm{\beta}}\int_0^\infty\frac{\kappa^2}{2\pi^2}\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,\\
\mathbf{P}_m^\parallel(\mathbf{r},t) &= \sum_{\bm{\beta}}\int_0^\infty\frac{\kappa^2}{2\pi^2}\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,\\
\tilde{\mathbf{P}}_\nu^\perp(\mathbf{r},t) &= \sum_{\bm{\gamma}}\int_0^\infty\frac{\kappa^2}{2\pi^2}\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\mathbf{X}_{\bm{\gamma}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa,\\
\tilde{\mathbf{P}}_\nu^\parallel(\mathbf{r},t) &= \sum_{\bm{\gamma}}\int_0^\infty\frac{\kappa^2}{2\pi^2}\tilde{\mathcal{P}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\mathbf{L}_{\bm{\gamma}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa.
\end{split}
\end{equation}
These definitions, along with Eqs. \eqref{eq:fieldExpansions}, \eqref{eq:matterFieldHelmholtzExpansion}, and \eqref{eq:bathFieldHelmholtzExpansion} allow us to rewrite $H$ in terms of the scalar coordinates and momenta. We first note that, with 
\begin{equation}
1/|\mathbf{r} - \mathbf{r}'| = \sum_{\bm{\alpha}}[f_{\bm{\alpha}}^>(\mathbf{r})f_{\bm{\alpha}}^<(\mathbf{r}')\Theta(r - r') + f_{\bm{\alpha}}^<(\mathbf{r})f_{\bm{\alpha}}^>(\mathbf{r}')\Theta(r' - r)]
\end{equation}
and
\begin{equation}
\nabla\cdot\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k) = -k\delta_{TE}\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}j_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi),
\end{equation}
the scalar potential set up by the matter field is
\begin{equation}
\begin{split}
\Phi_m(\mathbf{r},t) &= \int\frac{\rho_m(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'\\
&= -\frac{e}{\Delta}\int\frac{\nabla'\cdot\mathbf{Q}_m^\parallel(\mathbf{r}',t)}{|\mathbf{r} - \mathbf{r}'|}\;\mathrm{d}^3\mathbf{r}'\\
% &= -\frac{e}{\Delta}\int\left(\int_0^\infty\sum_{\bm{\beta}}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\nabla'\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r}',\kappa)\right)\sum_{\bm{\alpha}}\left[f_{\bm{\alpha}}^>(\mathbf{r})f_{\bm{\alpha}}^<(\mathbf{r}')\Theta(r - r') + f_{\bm{\alpha}}^<(\mathbf{r})f_{\bm{\alpha}}^>(\mathbf{r}')\Theta(r' - r)\right]\mathrm{d}^3\mathbf{r}'\\
% &= \frac{e}{\Delta}\int_0^\infty\sum_{\bm{\alpha}\bm{\beta}}\delta_{TE}\kappa\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}\left[f_{\bm{\alpha}}^>(\mathbf{r})\int f_{\bm{\alpha}}^<(\mathbf{r}')j_\ell(\kappa r')P_{\ell m}(\cos\theta')S_p(m\phi')\;\mathrm{d}^3\mathbf{r}'\right.\\
% &\qquad + \left.f_{\bm{\alpha}}^<(\mathbf{r})\int f_{\bm{\alpha}}^>(\mathbf{r}')j_\ell(\kappa r')P_{\ell m}(\cos\theta')S_p(m\phi')\;\mathrm{d}^3\mathbf{r}'\right]\mathrm{d}\kappa\\
% &= \frac{e}{\Delta}\int_0^\infty\sum_{\bm{\alpha}\bm{\beta}}\delta_{TE}\kappa\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{4\pi}{\kappa}(1 - \delta_{p1}\delta_{m0})\delta_{T'E}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}\frac{1}{\sqrt{2\ell + 1}}\\
% &\qquad\times\left[f_{\bm{\alpha}}^>(\mathbf{r})r^{\ell + 2}j_{\ell + 1}(\kappa t) + f_{\bm{\alpha}}^<(\mathbf{r})r^{-\ell + 1}j_{\ell - 1}(\kappa r)\right]\mathrm{d}\kappa\\
% &= \frac{4\pi e}{\Delta}\int_0^\infty\sum_{\bm{\beta}}\delta_{TE}(1 - \delta_{p1}\delta_{m0})\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{1}{\sqrt{2\ell + 1}}\\
% &\qquad\times \sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}P_{\ell m}(\cos\theta)S_p(m\phi)\left[\frac{r^{\ell + 2}}{r^{\ell + 1}}j_{\ell + 1}(\kappa r) + \frac{r^\ell}{r^{\ell - 1}}j_{\ell - 1}(\kappa r)\right]\mathrm{d}\kappa\\
% &= \frac{4\pi e}{\Delta}\int_0^\infty\sum_{\bm{\beta}}\delta_{TE}(1 - \delta_{p1}\delta_{m0})\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{1}{\sqrt{2\ell + 1}}\\
% &\qquad\times \sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}P_{\ell m}(\cos\theta)S_p(m\phi)(2\ell + 1)j_\ell(\kappa r)\;\mathrm{d}\kappa\\
&= \frac{4\pi e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\delta_{TE}(1 - \delta_{p1}\delta_{m0})\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}j_\ell(\kappa r)P_{\ell m}(\cos\theta)S_p(m\phi)\;\mathrm{d}\kappa
\end{split}
\end{equation}
such that
\begin{equation}
\nabla\Phi_m(\mathbf{r},t) = \frac{4\pi e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa.
\end{equation}
This allows us to say
\begin{equation}\label{eq:Hm2}
\begin{split}
H_m &= \sum_{s = \perp,\parallel}\int\left(\frac{\left[\mathbf{P}_m^s(\mathbf{r},t)\right]^2}{2\eta_m} + \frac{1}{2}\eta_m\omega_0^2\left[\mathbf{Q}_m^s(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r} + \sum_{s = \perp,\parallel}\int\int_0^\infty\frac{\tilde{v}^2(\nu)}{2\eta_\nu}\left[\mathbf{Q}_m^s(\mathbf{r},t)\right]^2\;\mathrm{d}\nu\,\mathrm{d}^3\mathbf{r}\\
&\qquad+ \frac{e}{\Delta}\int\mathbf{Q}_m^\parallel(\mathbf{r},t)\cdot\nabla\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
% &= \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{P}_{\bm{\beta}'}^\perp(\kappa',t)}{2\eta_m} + \frac{\eta_m}{2}\omega_0^2\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\right)\int\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{X}_{\bm{\beta}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{P}_{\bm{\beta}'}^\parallel(\kappa',t)}{2\eta_m} + \frac{\eta_m}{2}\omega_0^2\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\right)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\frac{\tilde{v}^2(\nu)}{2\eta_\nu}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\int\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{X}_{\bm{\beta}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\frac{\tilde{v}^2(\nu)}{2\eta_\nu}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{4\pi e}{\Delta}\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &= \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{P}_{\bm{\beta}'}^\perp(\kappa',t)}{2\eta_m} + \frac{\eta_m}{2}\omega_0^2\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\right)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{P}_{\bm{\beta}'}^\parallel(\kappa',t)}{2\eta_m} + \frac{\eta_m}{2}\omega_0^2\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\right)\\
% &\qquad\qquad \times \frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\frac{\tilde{v}^2(\nu)}{2\eta_\nu}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\frac{\tilde{v}^2(\nu)}{2\eta_\nu}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{4\pi e}{\Delta}\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &= \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \int_0^\infty\frac{\tilde{v}^2(\nu)}{\eta_\nu\eta_m}\;\mathrm{d}\nu\right]\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \int_0^\infty\frac{\tilde{v}^2(\nu)}{\eta_\nu\eta_m}\;\mathrm{d}\nu + \frac{8\pi e^2}{\eta_m\Delta^2}\right]\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
&= \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2\right]\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2 + \frac{8\pi e^2}{\eta_m\Delta^2}\right]\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\right)\mathrm{d}\kappa
\end{split}
\end{equation}
where
\begin{equation}
\Gamma^2 = \int_0^\infty\frac{\tilde{v}^2(\nu)}{\eta_\nu\eta_m}\;\mathrm{d}\nu
\end{equation}
and we have assumed that $\mathcal{Q}_{\bm{\beta}}^s(\kappa,t)$ and $\mathcal{P}_{\bm{\beta}}^s(\kappa,t)$ are zero for $(p,m) = (1,0)$ and that the longitudinal matter coordinates and momenta are zero when $T = M$. Additionally,
\begin{equation}
\begin{split}
H_r &= \sum_{s = \perp,\parallel}\int_0^\infty\int\left(\frac{\left[\tilde{\mathbf{P}}_\nu^s(\mathbf{r},t)\right]^2}{2\eta_\nu} + \frac{1}{2}\eta_\nu\nu^2\left[\tilde{\mathbf{Q}}_\nu^s(\mathbf{r},t)\right]^2\right)\mathrm{d}^3\mathbf{r}\,\mathrm{d}\nu\\
% &= \sum_{\bm{\gamma}\bm{\gamma}'}\int_0^\infty\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\tilde{\mathcal{P}}^\perp_{\bm{\gamma}}(\kappa,\nu;t)\tilde{\mathcal{P}}^\perp_{\nu\bm{\gamma}'}(\kappa',t)}{2\eta_\nu} + \frac{\eta_\nu}{2}\nu^2\tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\tilde{\mathcal{Q}}_{\nu\bm{\gamma}'}^\perp(\kappa',t)\right)\\
% &\qquad\qquad \times \int\mathbf{X}_{\bm{\gamma}}(\mathbf{r},\kappa)\cdot\mathbf{X}_{\bm{\gamma}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\gamma}\bm{\gamma}'}\int_0^\infty\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\tilde{\mathcal{P}}_{\nu\bm{\gamma}'}^\perp(\kappa',t)}{2\eta_\nu} + \frac{\eta_\nu}{2}\nu^2\tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\tilde{\mathcal{Q}}_{\nu\bm{\gamma}'}^\perp(\kappa',t)\right)\\
% &\qquad\qquad \times \int\mathbf{L}_{\bm{\gamma}}(\mathbf{r},\kappa)\cdot\mathbf{L}_{\bm{\gamma}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &= \sum_{\bm{\gamma}\bm{\gamma}'}\int_0^\infty\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\tilde{\mathcal{P}}^\perp_{\bm{\gamma}}(\kappa,\nu;t)\tilde{\mathcal{P}}^\perp_{\nu\bm{\gamma}'}(\kappa',t)}{2\eta_\nu} + \frac{\eta_\nu}{2}\nu^2\tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\tilde{\mathcal{Q}}_{\nu\bm{\gamma}'}^\perp(\kappa',t)\right)\\
% &\qquad\qquad \times \frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\gamma}\bm{\gamma}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\gamma}\bm{\gamma}'}\int_0^\infty\int_0^\infty\int_0^\infty\left(\frac{\kappa^4}{4\pi^4}\frac{\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\tilde{\mathcal{P}}_{\nu\bm{\gamma}'}^\perp(\kappa',t)}{2\eta_\nu} + \frac{\eta_\nu}{2}\nu^2\tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\tilde{\mathcal{Q}}_{\nu\bm{\gamma}'}^\perp(\kappa',t)\right)\\
% &\qquad\qquad \times \frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\gamma}\bm{\gamma}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
&= \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right]^2}{2\eta_\nu} + \frac{2\pi^2}{\kappa^2}\frac{\eta_\nu}{2}\nu^2\left[\tilde{\mathcal{Q}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right]^2\right)\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\tilde{\mathcal{P}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right]^2}{2\eta_\nu} + \frac{2\pi^2}{\kappa^2}\frac{\eta_\nu}{2}\nu^2\left[\tilde{\mathcal{Q}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right]^2\right)\mathrm{d}\kappa\,\mathrm{d}\nu
\end{split}
\end{equation}
and, letting $\nabla\Phi(\mathbf{r},t) = \nabla\Phi_f(\mathbf{r},t) + (4\pi e/\Delta)\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa$,
\begin{equation}
\begin{split}
H_\mathrm{EM} &= \int\left(2\pi c^2\left[\bm{\Pi}^\perp(\mathbf{r},t)\right]^2 + 2\pi c^2\left[\bm{\Pi}^\parallel(\mathbf{r},t)\right]^2 +  \frac{1}{8\pi}\left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2 + \frac{e^2}{2\eta_m c^2\Delta^2}\mathbf{A}^2(\mathbf{r},t)\right)\mathrm{d}^3\mathbf{r}\\
&\qquad+ \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t]\\
% &= \sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty2\pi c^2\frac{k^2k'^2}{16\pi^4}\mathit{\Pi}_{\bm{\alpha}}(k,t)\mathit{\Pi}_{\bm{\alpha}'}(k',t)\int\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty2\pi c^2\frac{1}{16\pi^2c^2}\frac{e^2}{\Delta^2}16\pi^2\mathcal{Q}_{\bm{\beta}}^\parallel(t)\mathcal{Q}_{\bm{\beta}'}^\parallel(t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\cdot\mathbf{L}_{\bm{\beta}'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + 2\pi c^2\frac{2}{16\pi^2c^2}\frac{e}{\Delta}4\pi\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\int\nabla\Phi_f(\mathbf{r},t)\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k + \frac{2\pi c^2}{16\pi^2c^2}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
% &\qquad + \frac{1}{8\pi}\sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty4kk'\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\int\mathbf{Y}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{Y}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + \frac{e^2}{2\eta_mc^2\Delta^2}\sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty4\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\int\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + \sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty4\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{X}_{\bm{\alpha}}[\mathbf{x}_{fi}(t),k]\cdot\mathbf{X}_{\bm{\alpha}'}[\mathbf{x}_{fi}(t),k']\;\mathrm{d}k\,\mathrm{d}k'\\
% &= \sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty\frac{c^2k^2k'^2}{8\pi^3}\mathit{\Pi}_{\bm{\alpha}}(k,t)\mathit{\Pi}_{\bm{\alpha}'}(k',t)\frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}\;\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + \sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\frac{2\pi e^2}{\Delta^2}\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(k',t)\frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\int\nabla\Phi_f(\mathbf{r},t)\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k + \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r}\\
% &\qquad + \frac{1}{2\pi}\sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty kk'\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}\;\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad +  \frac{2e^2}{\eta_m c^2\Delta^2}\sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}\;\mathrm{d}k\,\mathrm{d}k'\\
% &\qquad + \sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\sum_i\frac{2e_i^2}{\mu_{fi}c^2}\mathbf{X}_{\bm{\alpha}}[\mathbf{x}_{fi}(t),k]\cdot\mathbf{X}_{\bm{\alpha}'}[\mathbf{x}_{fi}(t),k']\;\mathrm{d}k\,\mathrm{d}k'\\
% &= \sum_{\bm{\alpha}}\int_0^\infty\frac{c^2k^2}{4\pi}\mathit{\Pi}_{\bm{\alpha}}^2(k,t)\;\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\frac{4\pi^3e^2}{k^2\Delta^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\right]^2\;\mathrm{d}k + \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r}\\
% &\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\int\nabla\Phi_f(\mathbf{r},t)\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k + \sum_{\bm{\alpha}}\int_0^\infty\pi\mathcal{A}_{\bm{\alpha}}^2(k,t)\;\mathrm{d}k\\
% &\qquad + \sum_{\bm{\alpha}}\int_0^\infty\frac{4\pi^2e^2}{\eta_mc^2k^2\Delta^2}\mathcal{A}_{\bm{\alpha}}^2(k,t)\;\mathrm{d}k\\
% &\qquad + \sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\sum_i\frac{2e_i^2}{\mu_{fi}c^2}\mathbf{X}_{\bm{\alpha}}[\mathbf{x}_{fi}(t),k]\cdot\mathbf{X}_{\bm{\alpha}'}[\mathbf{x}_{fi}(t),k']\;\mathrm{d}k\,\mathrm{d}k'\\
&= \sum_{\bm{\alpha}}\int_0^\infty\left(\frac{c^2k^2}{4\pi}\mathit{\Pi}_{\bm{\alpha}}^2(k,t) + \left[\pi + \frac{4\pi^2e^2}{\eta_mc^2k^2\Delta^2}\right]\mathcal{A}_{\bm{\alpha}}^2(k,t)\right)\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\frac{4\pi^3e^2}{k^2\Delta^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\right]^2\;\mathrm{d}k\\
&\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\int\nabla\Phi_f(\mathbf{r},t)\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k + \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r}\\
&\qquad + \sum_{\bm{\alpha}\bm{\alpha}'}\int_0^\infty\int_0^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{A}_{\bm{\alpha}'}(k',t)\sum_i\frac{2e_i^2}{\mu_{fi}c^2}\mathbf{X}_{\bm{\alpha}}[\mathbf{x}_{fi}(t),k]\cdot\mathbf{X}_{\bm{\alpha}'}[\mathbf{x}_{fi}(t),k']\;\mathrm{d}k\,\mathrm{d}k'.
\end{split}
\end{equation}

The interaction and driving Hamiltonian terms follow suit, such that
\begin{equation}
\begin{split}
H_\mathrm{int} &= -\int\frac{e}{\eta_mc\Delta}\mathbf{P}_m^\perp(\mathbf{r},t)\cdot\mathbf{A}(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\int\left(\tilde{\mathbf{P}}_\nu^\perp(\mathbf{r},t)\cdot\mathbf{Q}_m^\perp(\mathbf{r},t) + \tilde{\mathbf{P}}_\nu^\parallel(\mathbf{r},t)\cdot\mathbf{Q}_m^\parallel(\mathbf{r},t)\right)\mathrm{d}^3\mathbf{r}\\
&\qquad - c\int\bm{\Pi}^\parallel(\mathbf{r},t)\cdot\nabla\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
% &= -\frac{e}{\eta_m c\Delta}\sum_{\bm{\alpha}\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\kappa^2}{2\pi^2}\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)2\mathcal{A}_{\bm{\alpha}}(k,t)\int\mathbf{X}_{\bm{\alpha}}(k,t)\cdot\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\,\mathrm{d}\kappa\\
% &\qquad + \sum_{\bm{\beta}\bm{\gamma}}\int_0^\infty\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\frac{\kappa'^2}{2\pi^2}\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(\kappa',\nu;t)\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\int\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{X}_{\bm{\gamma}}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\beta}\bm{\gamma}}\int_0^\infty\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\frac{\kappa'^2}{2\pi^2}\tilde{\mathcal{P}}_{\bm{\gamma}}^\parallel(\kappa',\nu;t)\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{L}_{\bm{\gamma}}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad - c\sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\frac{1}{4\pi c}\frac{4\pi e}{\Delta}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{4\pi e}{\Delta}\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &\qquad - c\frac{1}{4\pi c}\sum_{\bm{\beta}}\int_0^\infty\frac{4\pi e}{\Delta}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\\
% &= -\frac{2e}{\eta_mc\Delta}\sum_{\bm{\alpha}\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\kappa^2}{2\pi^2}\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{A}_{\bm{\alpha}}(k,t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - k)(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\beta}}\;\mathrm{d}\kappa\,\mathrm{d}k\\
% &\qquad + \sum_{\bm{\beta}\bm{\gamma}}\int_0^\infty\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\frac{\kappa'^2}{2\pi^2}\tilde{\mathcal{P}}_{\bm{\gamma}}^\perp(\kappa',\nu;t)\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\gamma}}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\beta}\bm{\gamma}}\int_0^\infty\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\frac{\kappa'^2}{2\pi^2}\tilde{\mathcal{P}}_{\bm{\gamma}}^\parallel(\kappa',\nu;t)\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')\delta_{TE}(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\gamma}}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\nu\\
% &\qquad - \frac{4\pi e^2}{\Delta^2}\sum_{\bm{\beta}\bm{\beta}'}\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\frac{2\pi^2}{\kappa^2}\delta(\kappa - \kappa')\delta_{TE}(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\\
% &\qquad - \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\\
&= -\frac{2e}{\eta_mc\Delta}\sum_{\bm{\alpha}}\int_0^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{P}_{\bm{\alpha}}(k,t)\;\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\tilde{\mathcal{P}}_{\bm{\beta}}^\perp(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\tilde{\mathcal{P}}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu - \frac{4\pi e^2}{\Delta^2}\sum_{\bm{\beta}}\int_0^\infty\frac{2\pi^2}{\kappa^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\mathrm{d}\kappa\\
&\qquad - \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa
\end{split}
\end{equation}
and, letting $\sum_ie_i\Phi_m[\mathbf{x}_{fi},t] = \int\rho_f(\mathbf{r},t)\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}$ and $\rho_f(\mathbf{r},t) = -\nabla\cdot\nabla\Phi_f(\mathbf{r},t)/4\pi$ and using integration by parts, one finds
\begin{equation}
\begin{split}
H_\mathrm{drive} &= -\sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] - c\int\bm{\Pi}^\parallel(\mathbf{r},t)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
&\qquad - \int\frac{e}{\Delta}\nabla\cdot\mathbf{Q}_m^\parallel(\mathbf{r},t)\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \int\rho_f(\mathbf{r},t)\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
&= -\sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] - c\int\frac{1}{4\pi c}\left[\nabla\Phi_f(\mathbf{r},t) + \nabla\Phi_m(\mathbf{r},t)\right]\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
&\qquad + \int\frac{e}{\Delta}\mathbf{Q}_m^\parallel(\mathbf{r},t)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \frac{1}{4\pi}\int\nabla\Phi_f(\mathbf{r},t)\cdot\nabla\Phi_m(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
&= -\sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\sum_{\bm{\alpha}}\int_0^\infty 2\mathcal{A}_{\bm{\alpha}}(k,t)\mathbf{X}_{\bm{\alpha}}[\mathbf{x}_{fi}(t),k]\;\mathrm{d}k - \frac{1}{4\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
&\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa
\end{split}
\end{equation}
Finally, the nonlinear Hamiltonian is
\begin{equation}\label{eq:HNL2}
\begin{split}
H_\mathrm{NL} &= \frac{1}{3}\sigma_0\eta_m\int\sum_{\bm{\beta}}\int_0^\infty\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa) + \mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\right]\mathrm{d}\kappa\\
&\qquad\cdot\left(\sum_{\bm{\beta}'}\int_0^\infty\left[\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\mathbf{X}_{\bm{\beta}'}(\mathbf{r},\kappa') + \mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\right]\mathrm{d}\kappa'\cdot\bm{1}_3\right.\\
&\qquad\cdot\left.\sum_{\bm{\beta}''}\int_0^\infty\left[\mathcal{Q}_{\bm{\beta}''}^\perp(\kappa'',t)\mathbf{X}_{\bm{\beta}''}(\mathbf{r},\kappa'') + \mathcal{Q}_{\bm{\beta}''}^\parallel(\kappa'',t)\mathbf{L}_{\bm{\beta}''}(\mathbf{r},\kappa'')\right]\mathrm{d}\kappa''\right)\mathrm{d}^3\mathbf{r}\\
&= \frac{1}{3}\sigma_0\eta_m\sum_{\bm{\beta}\bm{\beta}'\bm{\beta}'''}\left[\int_0^\infty\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\mathcal{Q}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\right.\\
&\qquad + 3\int_0^\infty\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\perp(\kappa',t)\mathcal{Q}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(2)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&\qquad + 3\int_0^\infty\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\mathcal{Q}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(3)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&\qquad\left. + \int_0^\infty\int_0^\infty\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\mathcal{Q}_{\bm{\beta}'}^\parallel(\kappa',t)\mathcal{Q}_{\bm{\beta}''}^\parallel(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(4)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa'' \vphantom{\int_0^\infty} \right]
\end{split}
\end{equation}
where
\begin{equation}
\begin{split}
I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\kappa,\kappa',\kappa'') &= \int\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\left[\mathbf{X}_{\bm{\beta}'}(\mathbf{r},\kappa')\cdot\bm{1}_3\cdot\mathbf{X}_{\bm{\beta}''}(\mathbf{r},\kappa'')\right]\mathrm{d}^3\mathbf{r},\\
I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(2)}(\kappa,\kappa',\kappa'') &= \int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\left[\mathbf{X}_{\bm{\beta}'}(\mathbf{r},\kappa')\cdot\bm{1}_3\cdot\mathbf{X}_{\bm{\beta}''}(\mathbf{r},\kappa'')\right]\mathrm{d}^3\mathbf{r},\\
I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(3)}(\kappa,\kappa',\kappa'') &= \int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\left[\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\cdot\bm{1}_3\cdot\mathbf{X}_{\bm{\beta}''}(\mathbf{r},\kappa'')\right]\mathrm{d}^3\mathbf{r},\\
I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(4)}(\kappa,\kappa',\kappa'') &= \int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\left[\mathbf{L}_{\bm{\beta}'}(\mathbf{r},\kappa')\cdot\bm{1}_3\cdot\mathbf{L}_{\bm{\beta}''}(\mathbf{r},\kappa'')\right]\mathrm{d}^3\mathbf{r},
\end{split}
\end{equation}
and the last three terms of our Hamiltonian are unchanged:
\begin{equation}
\begin{split}
H_f &= \sum_i\frac{\mathbf{p}_{fi}^2(t)}{2\mu_{fi}} + \sum_ie_i\Phi_f[\mathbf{x}_{fi}(t),t],\\
H_\mathrm{bind} &= \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right],\\
H_\mathrm{self} &= \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self}.
\end{split}
\end{equation}






















\newpage
\subsection{Quantization with Classical Free Charges}\label{sec:quantization}

To make the process of quantization easier, we can begin by demoting the free charges from dynamical objects with trajectories dependent on the system motion to ``pump'' sources with predestined positions and velocities. In doing so, we can remove dependence on the free charge momenta $\mathbf{p}_{fi}(t)$ from the Hamiltonian $H$ and, in doing so, produce some dramatic simplification of the mathematics. Explicitly, one can see that, before $\mathbf{A}[\mathbf{x}_{fi}(t),t]$ is expanded in terms of its mode amplitudes and mode functions, three terms of the Hamiltonian depend on either or both of $\mathbf{p}_{fi}(t)$ or $\mathbf{A}[\mathbf{x}_{fi}(t),t]$:
\begin{equation}
\begin{split}
H_f &= \sum_i\frac{\mathbf{p}_{fi}^2(t)}{2\mu_{fi}} + \ldots\\
&= \sum_{i}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \sum_i\frac{e_i}{c}\dot{\mathbf{x}}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] + \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] + \ldots\\[0.5em]
H_\mathrm{drive} &= -\sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] + \ldots\\
&= -\sum_i\frac{e_i}{c}\dot{\mathbf{x}}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] - \sum_i\frac{e_i^2}{\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] + \ldots\\[0.5em]
H_\mathrm{EM} &= \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] + \ldots.
\end{split}
\end{equation}
Here, the ellipses contain all of the terms within the three Hamiltonian terms that don't depend on $\mathbf{p}_{fi}(t)$ or $\mathbf{A}[\mathbf{x}_{fi}(t),t]$. Conveniently, $H_f + H_\mathrm{drive} + H_\mathrm{EM} = \sum_i\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t)/2 + \ldots$, such that we can ignore all of the complicated free-charge-related terms of $H$ in the case where $\mathbf{p}_{fi}(t)$ does not need to be explicitly represented within the formalism.

In addition, it turns out that the most convenient way to rearrange the terms within $H$ is to define $H = H_f' + H_m' + H_r + H_\mathrm{EM}' + H_\mathrm{int}' + H_\mathrm{drive}' + H_\mathrm{NL} + H_\mathrm{bind} + H_\mathrm{self}$ due to some convenient cancellations between the terms of Eqs. \eqref{eq:Hm2}--\eqref{eq:HNL2}. The new Hamiltonian terms are given by
\begin{equation}
\begin{split}
H_f' &= H_f - \sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] + \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] + \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
&\qquad - \frac{1}{4\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r}\\
% &= \sum_i\frac{\mathbf{p}_{fi}^2(t)}{2\mu_{fi}} - \sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] + \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] + \sum_ie_i\Phi_f[\mathbf{x}_{fi}(t),t]\\
% &\qquad - \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
% &= \sum_{i}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \sum_i\frac{e_i}{c}\dot{\mathbf{x}}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] + \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t]\\
% &\qquad - \sum_i\frac{e_i}{c}\dot{\mathbf{x}}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] - \sum_i\frac{e_i^2}{\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] + \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t]\\
% &\qquad + \int\rho_f(\mathbf{r},t)\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} - \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
% &= \sum_{i}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) - \frac{1}{4\pi}\int\nabla\cdot\nabla\Phi_f(\mathbf{r},t)\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} - \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
% &= \sum_{i}\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \frac{1}{4\pi}\int\nabla\Phi_f(\mathbf{r},t)\cdot \nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} - \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\ 
&= \sum_i\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}^2_{fi}(t) + \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
H_m' &= H_m + \sum_{\bm{\beta}}\int_0^\infty\frac{4\pi^3e^2}{k^2\Delta^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\right]^2\mathrm{d}k - \frac{4\pi e^2}{\Delta^2}\sum_{\bm{\beta}}\int_0^\infty\frac{2\pi^2}{\kappa^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\mathrm{d}\kappa\\
% &= \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2\right]\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2 + \frac{8\pi e^2}{\eta_m\Delta^2}\right]\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
% &\qquad - \sum_{\bm{\beta}}\int_0^\infty\frac{4\pi e^2}{\Delta^2}\frac{\pi^2}{\kappa^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\mathrm{d}\kappa\\
% &= \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2\right]\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2 + \frac{8\pi e^2}{\eta_m\Delta^2} - \frac{4\pi e^2}{\eta_m\Delta^2}\right]\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
&= \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\perp(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2\right]\left[\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\right]^2\right)\mathrm{d}\kappa\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\left(\frac{\kappa^2}{2\pi^2}\frac{\left[\mathcal{P}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2}{2\eta_m} + \frac{2\pi^2}{\kappa^2}\frac{\eta_m}{2}\left[\omega_0^2 + \Gamma^2 + \frac{4\pi e^2}{\eta_m\Delta^2}\right]\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\right)\mathrm{d}\kappa
\end{split}
\end{equation}
and 
\begin{equation}
\begin{split}\label{eq:HEM2}
H_\mathrm{EM}' &= H_\mathrm{EM} - \sum_i\frac{e_i^2}{2\mu_{fi}c^2}\mathbf{A}^2[\mathbf{x}_{fi}(t),t] - \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
&\qquad - \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\int\nabla\Phi_f(\mathbf{r},t)\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k - \sum_{\bm{\beta}}\int_0^\infty\frac{4\pi^3e^2}{k^2\Delta^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\right]^2\mathrm{d}k\\
&= \sum_{\bm{\alpha}}\int_0^\infty\left(\frac{c^2k^2}{4\pi}\mathit{\Pi}_{\bm{\alpha}}^2(k,t) + \left[\pi + \frac{4\pi^2e^2}{\eta_mc^2k^2\Delta^2}\right]\mathcal{A}_{\bm{\alpha}}^2(k,t)\right)\mathrm{d}k
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
H_\mathrm{int}' &= H_\mathrm{int} + \frac{4\pi e^2}{\Delta^2}\sum_{\bm{\beta}}\int_0^\infty\frac{2\pi^2}{\kappa^2}\left[\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\right]^2\mathrm{d}\kappa + \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\\
&= -\frac{2e}{\eta_mc\Delta}\sum_{\bm{\alpha}}\int_0^\infty\mathcal{A}_{\bm{\alpha}}(k,t)\mathcal{P}_{\bm{\alpha}}^\perp(k,t)\;\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\mathcal{Q}_{\bm{\beta}}^\perp(\kappa,t)\tilde{\mathcal{P}}_{\bm{\beta}}^\perp(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\tilde{\mathcal{P}}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
H_\mathrm{drive}' &= H_\mathrm{drive} + \sum_i\frac{e_i}{\mu_{fi}c}\mathbf{p}_{fi}(t)\cdot\mathbf{A}[\mathbf{x}_{fi}(t),t] + \frac{1}{4\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\mathrm{d}^3\mathbf{r}\\
&\qquad + \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\\
&\qquad - \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(k,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\\
&= \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\mathcal{Q}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa.
\end{split}
\end{equation}

We are now ready to begin the quantization process. This can be formally conducted with the transformation
\begin{equation}
H\to\hat{H}
\end{equation}
alongside
\begin{equation}
\begin{split}
\mathcal{Q}_{\bm{\beta}}^{\perp,\parallel}&\to\hat{\mathcal{Q}}_{\bm{\beta}}^{\perp,\parallel},\\
\mathcal{P}_{\bm{\beta}}^{\perp,\parallel}&\to\hat{\mathcal{P}}_{\bm{\beta}}^{\perp,\parallel},\\
\tilde{\mathcal{Q}}_{\bm{\gamma}}^{\perp,\parallel}&\to\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^{\perp,\parallel},\\
\tilde{\mathcal{P}}_{\bm{\gamma}}^{\perp,\parallel}&\to\hat{\tilde{\mathcal{P}}}_{\bm{\gamma}}^{\perp,\parallel},\\
\mathcal{A}_{\bm{\alpha}}&\to\hat{\mathcal{A}}_{\bm{\alpha}},\\
\mathit{\Pi}_{\bm{\alpha}}&\to\hat{\mathit{\Pi}}_{\bm{\alpha}}.
\end{split}
\end{equation}
Each of our new coordinate and momentum operators obeys an equal-time commutation relation with its conjugate operator, such that
\begin{equation}
\begin{split}
\left[\hat{\mathcal{A}}_{\bm{\alpha}}(k,t),\hat{\mathit{\Pi}}_{\bm{\alpha}'}(k',t)\right] &= \mathrm{i}\hbar\delta_{\bm{\alpha}\bm{\alpha}'}\delta(k - k'),\\
\left[\hat{\mathcal{Q}}_{\bm{\beta}}^{\perp,\parallel}(\kappa,t),\hat{\mathcal{P}}_{\bm{\beta}'}^{\perp,\parallel}(\kappa',t)\right] &= \mathrm{i}\hbar\delta_{\bm{\beta}\bm{\beta}'}\delta(\kappa - \kappa'),\\
\left[\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^{\perp,\parallel}(\kappa,\nu;t),\hat{\tilde{\mathcal{P}}}_{\nu'\bm{\gamma}'}^{\perp,\parallel}(\kappa',\nu';t)\right] &= \mathrm{i}\hbar\delta_{\bm{\gamma}\bm{\gamma}'}\delta(\kappa - \kappa')\delta(\nu - \nu').
\end{split}
\end{equation}
Further, we can define boson ladder operators for each of the coordinate-momentum pairs. Beginning with the operators corresponding to the field variables, we can define
\begin{equation}
\hat{a}_{\bm{\alpha}}(k,t) = P(k)\left[u(k)\hat{\mathcal{A}}_{\bm{\alpha}}(k,t) + \mathrm{i}v(k)\hat{\mathcal{P}}_{\bm{\alpha}}(k,t)\right],
\end{equation}
where the prefactors $P(k)$, $u(k)$, and $v(k)$ must be determined from the constraints of the system. In particular, we want the ladder operators to provide an EM Hamiltonian
\begin{equation}\label{eq:HEM3}
\hat{H}_{\mathrm{EM}}' = \sum_{\bm{\alpha}}\int_0^\infty\frac{1}{2}\hbar\tilde{k}c\left[\hat{a}_{\bm{\alpha}}(k,t)\hat{a}_{\bm{\alpha}}^\dagger(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\hat{a}_{\bm{\alpha}}(k,t)\right]\mathrm{d}k
\end{equation}
and to have commutators
\begin{equation}\label{eq:aComm}
\begin{split}
[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)], &= \delta_{\bm{\alpha}\bm{\alpha}'}\delta(k - k')\\
[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}(k',t)] &= [\hat{a}_{\bm{\alpha}}^\dagger(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)] = 0,
\end{split}
\end{equation}
wherein $\hbar\tilde{k}c$ is a characteristic eigenenergy of the photon mode of wavenumber $k$. The form of $\tilde{k}$ can be found by plugging the explicit form of $\hat{a}_{\bm{\alpha}}(k,t)$ into Eqs. \eqref{eq:HEM3} and \eqref{eq:aComm} such that
\begin{equation}\label{eq:HEMunknownCoeff}
\hat{H}_\mathrm{EM}' = \sum_{\bm{\alpha}}\int_0^\infty\hbar\tilde{k}c\left[P^2(k)u^2(k)\hat{\mathcal{A}}^2_{\bm{\alpha}}(k,t) + P^2(k)v^2(k)\hat{\mathit{\Pi}}_{\bm{\alpha}}^2(k,t)\right]\mathrm{d}k
\end{equation}
and
\begin{equation}\label{eq:aComm2}
[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)] = 2\hbar P^2(k)u(k)v(k)\delta_{\bm{\alpha}\bm{\alpha}'}\delta(k - k').
\end{equation}
Comparing Eq. \eqref{eq:HEMunknownCoeff} with Eq. \eqref{eq:HEM2} and Eq. \eqref{eq:aComm2} with Eq. \eqref{eq:aComm}, we can see that the definitions $A(k) = \pi + 4\pi^2e^2/\eta_mc^2k^2\Delta^2$ and $B(k) = c^2k^2/4\pi$ result in the system of equations
\begin{equation}\label{eq:prefactorSystem}
\begin{split}
\hbar\tilde{k}cP^2(k)u^2(k) &= A(k),\\
\hbar\tilde{k}cP^2(k)v^2(k) &= B(k),\\
2\hbar P^2(k)u(k)v(k) &= 1.
\end{split}
\end{equation}
This system of equations contains three equalities and four unknowns [$u(k)$, $v(k)$, $P(k)$, and $\tilde{k}$], such that we have some freedom in defining each quantity. However, we can pin down $\tilde{k}$ immediately. We find from the first and second lines above that $u(k) = [1/P(k)]\sqrt{A(k)/\hbar\tilde{k}c}$ and $v(k) = [1/P(k)]\sqrt{B(k)/\hbar\tilde{k}c}$. Plugging these results into the third line we find that $2\sqrt{A(k)B(k)}/\tilde{k}c = 1$. Therefore, substituting the full forms of $A(k)$ and $B(k)$, we find
\begin{equation}
\tilde{k} = k\sqrt{1 + \frac{4\pi e^2}{\eta_mc^2k^2\Delta^2}}.
\end{equation}
Finally, we can see that Eq. \eqref{eq:prefactorSystem} has no solutions except in the case $P(k) = \sqrt{1/2\hbar u(k)v(k)}$, which quickly leads us to the final constraint
\begin{equation}
\frac{u(k)}{v(k)} = 2\pi\frac{\tilde{k}c}{k^2c^2}.
\end{equation}
We are free to choose $u(k) = \tilde{k}c$ such that $v(k) = k^2c^2/2\pi$ and $P(k) = \sqrt{\pi/\hbar\tilde{k}ck^2c^2}$, giving us
\begin{equation}
\hat{a}_{\bm{\alpha}}(k,t) = \sqrt{\frac{\pi}{\hbar\tilde{k}ck^2c^2}}\left[\tilde{k}c\hat{\mathcal{A}}_{\bm{\alpha}}(k,t) + \mathrm{i}\frac{k^2c^2}{2\pi}\hat{\mathit{\Pi}}_{\bm{\alpha}}(k,t)\right].
\end{equation}

We can repeat this process for $H_m'$ and $H_r$, the ladder-operator forms of which we take to be
\begin{equation}
\begin{split}
\hat{H}_m' &= \sum_{\bm{\beta}}\int_0^\infty\frac{1}{2}\hbar\Omega_\perp\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t)\hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\hat{b}_{\bm{\beta}}^\perp(\kappa,t)\right]\mathrm{d}\kappa\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\frac{1}{2}\hbar\Omega_\parallel\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\right]\mathrm{d}\kappa,\\[0.5em]
\hat{H}_r &= \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu
\end{split}
\end{equation}
with
\begin{equation}
\begin{split}
\Omega_\perp^2 &= \omega_0^2 + \Gamma^2,\\
\Omega_\parallel^2 &= \omega_0^2 + \Gamma^2 + \frac{4\pi e^2}{\Delta^2\eta_m}.\\
\end{split}    
\end{equation}
The resulting definitions of the ladder operators are
\begin{equation}
\begin{split}
\hat{b}_{\bm{\beta}}^\perp(\kappa,t) &= \sqrt{\frac{\pi^2\eta_m}{\kappa^2\hbar\Omega_\perp}}\left[\Omega_\perp\hat{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t) + \mathrm{i}\frac{\kappa^2}{2\pi^2\eta_m}\hat{\mathcal{P}}_{\bm{\beta}}^\perp(\kappa,t)\right],\\
\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) &= \sqrt{\frac{\pi^2 \eta_m}{\kappa^2\hbar\Omega_\parallel}}\left[\Omega_\parallel\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t) + \mathrm{i}\frac{\kappa^2}{2\pi^2\eta_m}\hat{\mathcal{P}}_{\bm{\beta}}^\parallel(\kappa,t)\right],\\
\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t) &= \sqrt{\frac{\pi^2\eta_\nu}{\kappa^2\hbar\nu}}\left[-\mathrm{i}\nu\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\perp(\kappa,\nu;t) + \frac{\kappa^2}{2\pi^2\eta_\nu}\hat{\tilde{\mathcal{P}}}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right],\\
\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t) &= \sqrt{\frac{\pi^2\eta_\nu}{\kappa^2\hbar\nu}}\left[-\mathrm{i}\nu\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t) + \frac{\kappa^2}{2\pi^2 \eta_\nu}\hat{\tilde{\mathcal{P}}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right],
\end{split}
\end{equation}
which can be straightforwardly be seen through the last line of Eq. \eqref{eq:prefactorSystem} to obey the commutation relations
\begin{equation}
\begin{split}
\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t),\hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right] &= \delta_{\bm{\beta}\bm{\beta}'}\delta(\kappa - \kappa'),\\
\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t),\hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right] &= \delta_{\bm{\beta}\bm{\beta}'}\delta(\kappa - \kappa'),\\
\left[\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t),\hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t)\right] &= \delta_{\bm{\gamma}\bm{\gamma}'}\delta(\kappa - \kappa')\delta(\nu - \nu'),\\
\left[\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t),\hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t)\right] &= \delta_{\bm{\gamma}\bm{\gamma}'}\delta(\kappa - \kappa')\delta(\nu - \nu').
\end{split}
\end{equation}
In total, the alternate forms of our generalized coordinates and momenta are
\begin{equation}
\begin{split}
\hat{\mathcal{A}}_{\bm{\alpha}}(k,t) &= \sqrt{\frac{\hbar k^2c^2}{4\pi\tilde{k}c}}\left[\hat{a}_{\bm{\alpha}}(k,t) + \hat{a}^\dagger_{\bm{\alpha}}(k,t)\right],\\
\hat{\mathit{\Pi}}_{\bm{\alpha}}(k,t) &= -\mathrm{i}\sqrt{\frac{\pi\hbar\tilde{k}c}{k^2c^2}}\left[\hat{a}_{\bm{\alpha}}(k,t) - \hat{a}_{\bm{\alpha}}^\dagger(k,t)\right],
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t) &= \sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\perp}}\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right],\\
\hat{\mathcal{P}}_{\bm{\beta}}^\perp(\kappa,t) &= -\mathrm{i}\sqrt{\frac{\pi^2\eta_m\hbar\Omega_\perp}{\kappa^2}}\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) - \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right],\\[0.5em]
\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t) &= \sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\parallel}}\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right],\\
\hat{\mathcal{P}}_{\bm{\beta}}^\parallel(\kappa,t) &= -\mathrm{i}\sqrt{\frac{\pi^2\eta_m\hbar\Omega_\parallel}{\kappa^2}}\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) - \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right],
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\perp(\kappa,\nu;t) &= \mathrm{i}\sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_\nu\nu}}\left[\hat{c}_{\bm{\gamma}}^{\perp}(\kappa,\nu;t) - \hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t)\right],\\
\hat{\tilde{\mathcal{P}}}_{\bm{\gamma}}^\perp(\kappa,\nu;t) &= \sqrt{\frac{\pi^2\eta_\nu\hbar\nu}{\kappa^2}}\left[\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t)\right],\\[0.5em]
\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t) &= \mathrm{i}\sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_\nu\nu}}\left[\hat{c}_{\bm{\gamma}}^{\parallel}(\kappa,\nu;t) - \hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t)\right],\\
\hat{\tilde{\mathcal{P}}}_{\bm{\gamma}}^\parallel(\kappa,\nu;t) &= \sqrt{\frac{\pi^2\eta_\nu\hbar\nu}{\kappa^2}}\left[\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t)\right].
\end{split}
\end{equation}

The last interesting linear parts of our Hamiltonian to be quantized are the interaction and driving Hamiltonians $H_\mathrm{int}'$ and $H_\mathrm{drive}'$. The former is given by
\begin{equation}
\begin{split}
\hat{H}_\mathrm{int}' &= -\frac{2e}{\eta_mc\Delta}\sum_{\bm{\alpha}}\int_0^\infty\hat{\mathcal{A}}_{\bm{\alpha}}(k,t)\hat{\mathcal{P}}_{\bm{\alpha}}^\perp(k,t)\;\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\hat{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t)\hat{\tilde{\mathcal{P}}}_{\bm{\beta}}^\perp(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\tilde{\mathcal{P}}}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu\\
% &= -\frac{2e}{\eta_mc\Delta}\sum_{\bm{\alpha}}\int_0^\infty\sqrt{\frac{\hbar k^2c^2}{4\pi\tilde{k}c}}\left[\hat{a}_{\bm{\alpha}}(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\right](-\mathrm{i})\sqrt{\frac{\pi^2\eta_m\hbar\Omega_\perp}{k^2}}\left[\hat{b}_{\bm{\alpha}}^\perp(k,t) - \hat{b}_{\bm{\alpha}}^{\perp\dagger}(k,t)\right]\mathrm{d}k\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\sqrt{\frac{\hbar \kappa^2}{4\pi^2\eta_m\Omega_\perp}}\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp,\dagger}(\kappa,t)\right]\sqrt{\frac{\pi^2\eta_\nu\hbar\nu}{\kappa^2}}\left[\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\tilde{v}(\nu)}{\eta_\nu}\sqrt{\frac{\hbar \kappa^2}{4\pi^2\eta_m\Omega_\parallel}}\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\sqrt{\frac{\pi^2\eta_\nu\hbar\nu}{\kappa^2}}\left[\hat{c}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
% &= \sum_{\bm{\alpha}}\int_0^\infty\mathrm{i}\frac{\hbar e}{\Delta}\sqrt{\frac{\pi\Omega_\perp}{\eta_m \tilde{k}c}}\left[\hat{a}_{\bm{\alpha}}(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\right]\left[\hat{b}_{\bm{\alpha}}^\perp(k,t) - \hat{b}_{\bm{\alpha}}^{\perp\dagger}(k,t)\right]\mathrm{d}k\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar\tilde{v}(\nu)}{2}\sqrt{\frac{\nu}{\eta_\nu\eta_m\Omega_\perp}}\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp,\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar\tilde{v}(\nu)}{2}\sqrt{\frac{\nu}{\eta_\nu\eta_m\Omega_\parallel}}\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&= \mathrm{i}\frac{\hbar}{2}\sum_{\bm{\alpha}}\int_0^\infty\Lambda(k)\left[\hat{a}_{\bm{\alpha}}(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\right]\left[\hat{b}_{\bm{\alpha}}^\perp(k,t) - \hat{b}_{\bm{\alpha}}^{\perp\dagger}(k,t)\right]\mathrm{d}k\\
&\qquad + \frac{\hbar}{2}\sum_{\bm{\beta}}\int_0^\infty V_\perp(\nu)\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp,\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \frac{\hbar}{2}\sum_{\bm{\beta}}\int_0^\infty V_\parallel(\nu)\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu
\end{split}
\end{equation}
wherein the coupling functions are
\begin{equation}\label{eq:couplingFunctions}
\begin{split}
\Lambda(\kappa) &= \frac{2e}{\Delta}\sqrt{\frac{\pi\Omega_\perp}{\eta_m\tilde{\kappa}c}},\\
V_\perp(\nu) &= \tilde{v}(\nu)\sqrt{\frac{\nu}{\eta_m\eta_\nu\Omega_\perp}},\\
V_\parallel(\nu) &= \tilde{v}(\nu)\sqrt{\frac{\nu}{\eta_m\eta_\nu\Omega_\parallel}},
\end{split}
\end{equation}
and $\tilde{\kappa} = \kappa\sqrt{1 + 4\pi e^2/\eta_mc^2\kappa^2\Delta^2}$. The latter is 
\begin{equation}
\begin{split}
\hat{H}_\mathrm{drive}' &= \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\\
&= \frac{e}{\Delta}\sum_{\bm{\beta}}\int_0^\infty\sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\parallel}}\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\right]\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}\kappa\\
&= \sum_{\bm{\beta}}\int_0^\infty F_{\bm{\beta}}(\kappa,t)\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\right]\mathrm{d}\kappa
\end{split}
\end{equation}
where
\begin{equation}
F_{\bm{\beta}}(\kappa,t) = \sqrt{\frac{e^2}{\Delta^2}\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\parallel}}\int\mathbf{L}_{\bm{\beta}}(\mathbf{r},\kappa)\cdot\nabla\Phi_f(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}
\end{equation}












\subsubsection{Diagonalization of the Linear Hamiltonian}

We will ignore the exact forms of $\hat{H}_\mathrm{bind}$ and $\hat{H}_\mathrm{self}$, as they will not contribute meaningfully to the dynamics of our system. Further, to describe the nonlinear dynamics stemming from $\hat{H}_\mathrm{NL}$ in a useful and convenient fashion, it is best to first focus on the linear Hamiltonian,
\begin{equation}
\hat{H}_0 = \hat{H}_\mathrm{EM}' + \hat{H}_m' + \hat{H}_r + \hat{H}_\mathrm{int}' + \hat{H}_\mathrm{drive}',
\end{equation}
where we have implicitly defined $\hat{H} = \hat{H}_0 + \hat{H}_\mathrm{NL} + \hat{H}_\mathrm{bind} + \hat{H}_\mathrm{self}$. This linear Hamiltonian can be diagonalized using the Fano diagonalization method as shown in \citet{huttner1992quantization}. This diagonalization is most simply done by breaking the linear Hamiltonian into its transverse and longitudinal pieces, which are uncoupled. In other words,
\begin{equation}
\hat{H}_0 = \hat{H}_0^\perp + \hat{H}_0^\parallel,
\end{equation}
wherein
\begin{equation}
\hat{H}_0^i = \hat{H}_\mathrm{EM}'^i + \hat{H}_m'^i + \hat{H}_r^i + \hat{H}_\mathrm{int}'^i + \hat{H}_\mathrm{drive}'^i
\end{equation}
with $i\in\{\perp,\parallel\}$. In detail, we find that
\begin{equation}
\begin{split}
\hat{H}_\mathrm{EM}'^\perp &= \hat{H}_{\mathrm{EM}}' = \sum_{\bm{\alpha}}\int_0^\infty\frac{1}{2}\hbar\tilde{k}c\left[\hat{a}_{\bm{\alpha}}(k,t)\hat{a}_{\bm{\alpha}}^\dagger(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\hat{a}_{\bm{\alpha}}(k,t)\right]\mathrm{d}k\\
\hat{H}_\mathrm{EM}'^\parallel &= 0,
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{H}_m'^\perp &= \sum_{\bm{\beta}}\int_0^\infty\frac{1}{2}\hbar\Omega_\perp\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t)\hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\hat{b}_{\bm{\beta}}^\perp(\kappa,t)\right]\mathrm{d}\kappa\\
\hat{H}_m'^\parallel &= \sum_{\bm{\beta}}\int_0^\infty\frac{1}{2}\hbar\Omega_\parallel\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\right]\mathrm{d}\kappa,
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{H}_r'^\perp &= \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
\hat{H}_r'^\parallel &= \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu,
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{H}_\mathrm{int}'^\perp &=  \sum_{\bm{\beta}}\int_0^\infty\mathrm{i}\frac{\hbar}{2}\Lambda(\kappa)\left[\hat{a}_{\bm{\beta}}(\kappa,t) + \hat{a}_{\bm{\beta}}^\dagger(\kappa,t)\right]\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) - \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right]\mathrm{d}\kappa\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar}{2}V_\perp(\nu)\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu,\\[1.0em]
\hat{H}_\mathrm{int}'^\parallel &=  \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar}{2}V_\parallel(\nu)\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu,\\
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{H}_\mathrm{drive}'^\perp &= 0,\\
\hat{H}_\mathrm{drive}'^\parallel &= \sum_{\bm{\beta}}\int_0^\infty F_{\bm{\beta}}(\kappa,t)\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\mathrm{d}\kappa.
\end{split}
\end{equation}

We can further separate the transverse interaction Hamiltonian as $\hat{H}_\mathrm{int}'^\perp = \hat{H}_{mr}^\perp + \hat{H}_{mp}$, where
\begin{equation}
\begin{split}
\hat{H}_{mr}^\perp &= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar}{2}V_\perp(\nu)\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu,\\
\hat{H}_{mp} &= \sum_{\bm{\beta}}\int_0^\infty\mathrm{i}\frac{\hbar}{2}\Lambda(\kappa)\left[\hat{a}_{\bm{\beta}}(\kappa,t) + \hat{a}_{\bm{\beta}}^\dagger(\kappa,t)\right]\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) - \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right]\mathrm{d}\kappa.
\end{split}
\end{equation}
This allows us to diagonalize the matter-reservoir part of the linear Hamiltonian such that
\begin{equation}
\begin{split}
\hat{H}_\mathrm{mat}^\perp &= \hat{H}_m'^\perp + \hat{H}_r'^\perp + \hat{H}_{mr}^\perp\\
&= \sum_{\bm{\beta}}\int_0^\infty\frac{1}{2}\hbar\Omega_\perp\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t)\hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\hat{b}_{\bm{\beta}}^\perp(\kappa,t)\right]\mathrm{d}\kappa\\
&\qquad + \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\perp\dagger}(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^\perp(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar}{2}V_\perp(\nu)\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^{\perp}(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{H}_\mathrm{mat}^\parallel &= \hat{H}_m'^\parallel + \hat{H}_r'^\parallel + \hat{H}_{mr}^\parallel\\
&= \sum_{\bm{\beta}}\int_0^\infty\frac{1}{2}\hbar\Omega_\parallel\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\hat{b}_{\bm{\beta}}^\parallel(\kappa,t)\right]\mathrm{d}\kappa\\
&\qquad + \sum_{\bm{\gamma}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t) + \hat{c}_{\bm{\gamma}}^{\parallel\dagger}(\kappa,\nu;t)\hat{c}_{\bm{\gamma}}^\parallel(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{\hbar}{2}V_\parallel(\nu)\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\left[\hat{c}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{c}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^{\parallel}(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu,
\end{split}
\end{equation}
where we have let $\hat{H}_{mr}^\parallel = \hat{H}_\mathrm{int}'^\parallel$ for consistency. The explicit forms of the hybrid operators $\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t)$ and $\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t)$ are
\begin{equation}\label{eq:hybridOperatorsGeneralForm}
\begin{split}
\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t) &= q_\perp(\nu)\hat{b}_{\bm{\beta}}^\perp(\kappa,t) + s_\perp(\nu)\hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t) + \int_0^\infty\left[u_\perp(\nu,\nu')\hat{c}_{\bm{\beta}}^\perp(\kappa,\nu';t) + v_\perp(\nu,\nu')\hat{c}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu';t)\right]\mathrm{d}\nu',\\
\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) &= q_\parallel(\nu)\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + s_\parallel(\nu)\hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t) + \int_0^\infty\left[u_\parallel(\nu,\nu')\hat{c}_{\bm{\beta}}^\parallel(\kappa,\nu';t) + v_\parallel(\nu,\nu')\hat{c}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu';t)\right]\mathrm{d}\nu',
\end{split}
\end{equation}
where the coefficients $q_{\perp,\parallel}(\nu)$, $s_{\perp,\parallel}(\nu)$, $u_{\perp,\parallel}(\nu,\nu')$, and $v_{\perp,\parallel}(\nu,\nu')$ can be found via the Fano diagonalization process shown in Appendix \ref{app:fanoDiagonalization} by making the substitutions $g(\nu)\to V_{\perp,\parallel}(\nu)/2$, $\Omega\to\{\Omega_\perp,\Omega_\parallel\}$, $\hat{a}_{\bm{\beta}}(k,t)\to\hat{b}_{\bm{\beta}}^{\perp,\parallel}(\kappa,t)$, $\hat{b}_{\bm{\beta}}(k,\nu;t)\to\hat{c}_{\bm{\beta}}^{\perp,\parallel}(\kappa,\nu;t)$, and $\hat{B}_{\bm{\beta}}(k,\nu;t)\to\hat{B}_{\bm{\beta}}^{\perp,\parallel}(\kappa,\nu;t)$, respectively. The coefficients are too cumbersome to write here, but guarantee the inverse transformations
\begin{equation}
\begin{split}
\hat{b}_{\bm{\beta}}^{\perp,\parallel}(\kappa,t) &= \int_0^\infty\left[q_{\perp,\parallel}^*(\nu)\hat{B}_{\bm{\beta}}^{\perp,\parallel}(\kappa,\nu;t) - s_{\perp,\parallel}(\nu)\hat{B}_{\bm{\beta}}^{\{\perp,\parallel\}\dagger}(\kappa,\nu;t)\right]\mathrm{d}\nu,\\
\hat{c}_{\bm{\beta}}^{\perp,\parallel}(\kappa,\nu;t) &= \int_0^\infty\left[u_{\perp,\parallel}^*(\omega,\nu)\hat{B}_{\bm{\beta}}^{\perp,\parallel}(\kappa,\omega;t) - v_{\perp,\parallel}(\omega,\nu)\hat{B}_{\bm{\beta}}^{\{\perp,\parallel\}\dagger}(\kappa,\omega;t)\right]\mathrm{d}\omega.
\end{split}
\end{equation}

We can then rewrite our linear Hamiltonians as
\begin{equation}
\begin{split}
\hat{H}_0^\perp &= \hat{H}_\mathrm{EM}'^\perp + \hat{H}_\mathrm{mat}^\perp + \hat{H}_{mp}^\perp\\
&= \sum_{\bm{\alpha}}\int_0^\infty\frac{\hbar\tilde{k}c}{2}\left[\hat{a}_{\bm{\alpha}}(k,t)\hat{a}_{\bm{\alpha}}^\dagger(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\hat{a}_{\bm{\alpha}}(k,t)\right]\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\mathrm{i}\frac{\hbar}{2}\Lambda(\kappa)\left[\hat{a}_{\bm{\beta}}(\kappa,t) + \hat{a}_{\bm{\beta}}^\dagger(\kappa,t)\right]\left[\hat{b}_{\bm{\beta}}^\perp(\kappa,t) - \hat{b}_{\bm{\beta}}^{\perp\dagger}(\kappa,t)\right]\mathrm{d}\kappa,\\
&= \sum_{\bm{\alpha}}\int_0^\infty\frac{\hbar\tilde{k}c}{2}\left[\hat{a}_{\bm{\alpha}}(k,t)\hat{a}_{\bm{\alpha}}^\dagger(k,t) + \hat{a}_{\bm{\alpha}}^\dagger(k,t)\hat{a}_{\bm{\alpha}}(k,t)\right]\mathrm{d}k + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t)\;\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\mathrm{i}\frac{\hbar}{2}\Lambda(\kappa)\left[q_\perp(\nu) + s_\perp(\nu)\right]\left[\hat{a}_{\bm{\beta}}(\kappa,t) + \hat{a}_{\bm{\beta}}^\dagger(\kappa,t)\right]\left[\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t) - \hat{B}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\hat{H}_0^\parallel &= \hat{H}_\mathrm{mat}^\parallel + \hat{H}_\mathrm{drive}^\parallel\\
&= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\;\mathrm{d}\nu + \sum_{\bm{\beta}}\int_0^\infty F_{\bm{\beta}}(\kappa,t)\left[\hat{b}_{\bm{\beta}}^\parallel(\kappa,t) + \hat{b}_{\bm{\beta}}^{\parallel\dagger}(\kappa,t)\right]\mathrm{d}\kappa\\
&= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\;\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty F_{\bm{\beta}}(\kappa,t)\left[q_\parallel(\nu) - s_\parallel(\nu)\right]\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu.
\end{split}
\end{equation}
The longitudinal Hamiltonian is, at this point, fully hybridized, but not yet diagonal. An exact diagonalization procedure exists\cite{husimi1953miscellanea}, but is only useful in the case where the driving amplitude $F_{\bm{\beta}}(\kappa,t)[q_\parallel(\nu) - s_\parallel(\nu)]$ is large with respect to $\hbar\nu$ at any time $t$. For weaker driving, the nondiagonal term in $\hat{H}_0^\parallel$ can be sufficiently handled via perturbation theory such that it does not need to be addressed at the moment.

The transverse Hamiltonian, however, requires one more hybridization step. Its structure is entirely parallel to that of the transverse matter Hamiltonian, such that the same hybridization scheme can be devised. First defining polariton operators $\hat{C}_{\bm{\beta}}(\kappa,\omega;t)$ as
\begin{equation}
\hat{C}_{\bm{\beta}}(\kappa,\omega;t) = \tilde{q}(\kappa,\omega)\hat{a}_{\bm{\beta}}(\kappa,t) + \tilde{s}(\kappa,\omega)\hat{a}_{\bm{\beta}}^\dagger(\kappa,t) + \int_0^\infty\left[\tilde{u}(\kappa;\omega,\nu)\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t) + \tilde{v}(\kappa;\omega,\nu)\hat{B}_{\bm{\beta}}^{\perp\dagger}(\kappa,\nu;t)\right]\mathrm{d}\nu,
\end{equation}
we can use the procedure of Appendix \ref{app:fanoDiagonalization} with the substitutions $g(\nu)\to\mathrm{i}\Lambda(\kappa)[q_\perp(\nu) + s_\perp(\nu)]/2$, $\Omega\to\tilde{k}c$, $\hat{b}_{\bm{\beta}}(k,\nu;t)\to\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t)$, and $\hat{B}_{\bm{\beta}}(k,\nu;t)\to\hat{C}_{\bm{\beta}}(\kappa,\nu;t)$ to show that
\begin{equation}
\begin{split}
\hat{a}_{\bm{\beta}}(\kappa,t) &= \int_0^\infty\left[\tilde{q}^*(\kappa,\omega)\hat{C}_{\bm{\beta}}(\kappa,\omega;t) - \tilde{s}(\kappa,\omega)\hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\right]\mathrm{d}\omega,\\
\hat{B}_{\bm{\beta}}^\perp(\kappa,\nu;t) &= \int_0^\infty\left[\tilde{u}^*(\kappa;\omega,\nu)\hat{C}_{\bm{\beta}}(\kappa,\omega;t) - \tilde{v}(\kappa;\omega,\nu)\hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\right]\mathrm{d}\omega,
\end{split}
\end{equation}
and
\begin{equation}
\hat{H}_0^\perp = \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\omega\hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\hat{C}_{\bm{\beta}}(\kappa,\omega;t)\;\mathrm{d}\kappa\,\mathrm{d}\omega.
\end{equation}
Therefore, we can write a fully hybridized linear Hamiltonian as
\begin{equation}
\begin{split}
\hat{H}_0 &= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\omega\hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\hat{C}_{\bm{\beta}}(\kappa,\omega;t)\;\mathrm{d}\kappa\,\mathrm{d}\omega + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\;\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty F_{\bm{\beta}}(\kappa,t)\left[q_\parallel(\nu) - s_\parallel(\nu)\right]\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu.
\end{split}
\end{equation}













\subsubsection{Finishing the Rest of it}

We also have the tools to expand the nonlinear Hamiltonian in the basis of polaritons we have just defined. Quantizing in the usual way, we have
\begin{equation}
\begin{split}
\hat{H}_\mathrm{NL} &= \frac{1}{3}\sigma_0\eta_m\sum_{\bm{\beta}\bm{\beta}'\bm{\beta}'''}\left[\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\perp(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\right.\\
&\qquad + 3\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\perp(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(2)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&\qquad + 3\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\parallel(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(3)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&\qquad\left. + \int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\parallel(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\parallel(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(4)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa'' \vphantom{\int_0^\infty} \right]
\end{split}
\end{equation}
From here, we can rewrite the coordinate operators in terms of the dressed raising and lowering operators such that
\begin{equation}
\begin{split}
\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t) &= \int_0^\infty\sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\parallel}}[q_\parallel(\nu) - s_\parallel(\nu)]\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\nu,\\
\hat{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t) &= \int_0^\infty\int_0^\infty\sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\perp}}[q_\perp(\nu) - s_\perp(\nu)][\tilde{u}(\kappa;\omega,\nu) - \tilde{v}(\kappa;\omega,\nu)]\left[\hat{C}_{\bm{\beta}}(\kappa,\omega;t) + \hat{C}_{\bm{\beta}}^{\dagger}(\kappa,\omega;t)\right]\mathrm{d}\nu\,\mathrm{d}\omega\\
&= \int_0^\infty\sqrt{\frac{\hbar\kappa^2}{4\pi^2\eta_m\Omega_\perp}}K(\kappa,\omega)\left[\hat{C}_{\bm{\beta}}(\kappa,\omega;t) + \hat{C}_{\bm{\beta}}^{\dagger}(\kappa,\omega;t)\right]\mathrm{d}\omega,
\end{split}
\end{equation}
where
\begin{equation}
\begin{split}
K(\kappa,\omega) &= \int_0^\infty[q_\perp(\nu) - s_\perp(\nu)][\tilde{u}(\kappa;\omega,\nu) - \tilde{v}(\kappa;\omega,\nu)]\mathrm{d}\nu\\
&= -\frac{2\mathrm{i}}{\pi V_\perp(\omega)} - \frac{2V_\perp(\omega)}{\pi^2\omega}\int_0^\infty\frac{\nu}{V_\perp^2(\nu)}\left(PV\left\{\frac{1}{\omega - \nu}\right\} - PV\left\{\frac{1}{\omega + \nu}\right\}\right)\mathrm{d}\nu.
\end{split}
\end{equation}
With these definitions, we can see that
\begin{equation}
\begin{split}
&\sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\perp(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\perp(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\perp(\kappa'',t)I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&= \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\kappa,\kappa',\kappa'')\frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\perp^3}}\int_0^\infty\int_0^\infty\int_0^\infty K(\omega)K(\omega')K(\omega'')\\
&\qquad\times\left[\hat{C}_{\bm{\beta}}(\kappa,\omega;t) + \hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\right]\left[\hat{C}_{\bm{\beta}'}(\kappa',\omega';t) + \hat{C}_{\bm{\beta}'}^\dagger(\kappa',\omega';t)\right]\left[\hat{C}_{\bm{\beta}''}(\kappa'',\omega'';t) + \hat{C}_{\bm{\beta}''}^\dagger(\kappa'',\omega'';t)\right]\\
&\qquad\times\mathrm{d}\omega\,\mathrm{d}\omega'\,\mathrm{d}\omega''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''.
\end{split}
\end{equation}
Distribution of the binomials produces a cumbersome expression, so we'll leave this here for now. We can now immediately see that
\begin{equation}
\begin{split}
&\sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\parallel(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\parallel(\kappa'',t)I^{(4)}_{\bm{\beta}\bm{\beta}'\bm{\beta}''}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&= \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty I^{(4)}_{\bm{\beta}\bm{\beta}'\bm{\beta}''}(\kappa,\kappa',\kappa'')\frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\parallel^3}}\int_0^\infty\int_0^\infty\int_0^\infty\left[q_\parallel(\nu) - s_\parallel(\nu)\right]\left[q_\parallel(\nu') - s_\parallel(\nu')\right]\\
&\qquad\times\left[q_\parallel(\nu'') - s_\parallel(\nu'')\right]\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\left[\hat{B}_{\bm{\beta}'}^\parallel(\kappa',\nu';t) + \hat{B}_{\bm{\beta}'}^{\parallel\dagger}(\kappa',\nu';t)\right]\\
&\qquad\times\left[\hat{B}_{\bm{\beta}''}^\parallel(\kappa'',\nu'';t) + \hat{B}_{\bm{\beta}''}^{\parallel\dagger}(\kappa'',\nu'';t)\right]\mathrm{d}\nu\,\mathrm{d}\nu'\,\mathrm{d}\nu''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa'',
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
&\sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\perp(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\perp(\kappa'',t)I^{(2)}_{\bm{\beta}\bm{\beta}'\bm{\beta}''}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&= \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\parallel\Omega_\perp^2}}\left[q_\parallel(\nu) - s_\parallel(\nu)\right]K(\omega')K(\omega'')I^{(2)}_{\bm{\beta}\bm{\beta}'\bm{\beta}''}(\kappa,\kappa',\kappa'')\\
&\qquad\times\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\left[\hat{C}_{\bm{\beta}'}(\kappa',\omega';t) + \hat{C}_{\bm{\beta}'}^\dagger(\kappa',\omega';t)\right]\left[\hat{C}_{\bm{\beta}''}(\kappa'',\omega'';t) + \hat{C}_{\bm{\beta}''}^\dagger(\kappa'',\omega'';t)\right]\\
&\qquad\times\mathrm{d}\nu\,\mathrm{d}\omega'\,\mathrm{d}\omega''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa'',
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
&\sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\hat{\mathcal{Q}}_{\bm{\beta}}^\parallel(\kappa,t)\hat{\mathcal{Q}}_{\bm{\beta}'}^\parallel(\kappa',t)\hat{\mathcal{Q}}_{\bm{\beta}''}^\perp(\kappa'',t)I^{(3)}_{\bm{\beta}\bm{\beta}'\bm{\beta}''}(\kappa,\kappa',\kappa'')\;\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&= \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\parallel^2\Omega_\perp}}\left[q_\parallel(\nu) - s_\parallel(\nu)\right]\left[q_\parallel(\nu') - s_\parallel(\nu')\right]K(\omega'')I^{(3)}_{\bm{\beta}\bm{\beta}'\bm{\beta}''}(\kappa,\kappa',\kappa'')\\
&\qquad\times\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\left[\hat{B}_{\bm{\beta}'}^\parallel(\kappa',\nu';t) + \hat{B}_{\bm{\beta}'}^{\parallel\dagger}(\kappa',\nu';t)\right]\left[\hat{C}_{\bm{\beta}''}(\kappa'',\omega'';t) + \hat{C}_{\bm{\beta}''}^\dagger(\kappa'',\omega'';t)\right]\\
&\qquad\times\mathrm{d}\nu\,\mathrm{d}\nu'\,\mathrm{d}\omega''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''.
\end{split}
\end{equation}

Finally, since the free-charge, binding, and self-energy terms of the Hamiltonian do not contain any canonical coordinates or momenta, we can say
\begin{equation}
\begin{split}
\hat{H}_f' &= H_f',\\
\hat{H}_\mathrm{bind} &= H_\mathrm{bind},\\
\hat{H}_\mathrm{self} &= H_\mathrm{self}.\\
\end{split}
\end{equation}
Therefore, if we introduce for brevity the coupling functions
\begin{equation}
\begin{split}
J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa'') &= \frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\perp^3}}K(\omega)K(\omega')K(\omega'')I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa''),\\[0.5em]
J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(2)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa'') &= \frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\perp^2\Omega_\parallel}}\left[q_\parallel(\omega) - s_\parallel(\omega)\right]K(\omega')K(\omega'')\\
&\qquad\times I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(2)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa''),\\[0.5em]
J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(3)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa'') &= \frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\perp\Omega_\parallel^2}}\left[q_\parallel(\omega) - s_\parallel(\omega)\right]\left[q_\parallel(\omega') - s_\parallel(\omega')\right]K(\omega'')\\
&\qquad\times I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(3)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa''),\\[0.5em]
J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(4)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa'') &= \frac{\kappa\kappa'\kappa''}{8\pi^3}\sqrt{\frac{\hbar^3}{\eta_m^3\Omega_\parallel^3}}\left[q_\parallel(\omega) - s_\parallel(\omega)\right]\left[q_\parallel(\omega') - s_\parallel(\omega')\right]\left[q_\parallel(\omega'') - s_\parallel(\omega'')\right]\\
&\qquad\times I_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(4)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa''),
\end{split}
\end{equation}
we can write the complete Hamiltonian as
\begin{equation}
\begin{split}
\hat{H} &= \hat{H}_0 + \hat{H}_\mathrm{NL} + \hat{H}_f' + \hat{H}_\mathrm{bind} + \hat{H}_\mathrm{self}\\
&= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\omega\hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\hat{C}_{\bm{\beta}}(\kappa,\omega;t)\;\mathrm{d}\kappa\,\mathrm{d}\omega + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t)\;\mathrm{d}\kappa\;\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty F_{\bm{\beta}}(\kappa,t)\left[q_\parallel(\nu) - s_\parallel(\nu)\right]\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\mathrm{d}\kappa\,\mathrm{d}\nu\\
&\qquad + \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(1)}(\omega,\omega',\omega'';\kappa,\kappa',\kappa'')\left[\hat{C}_{\bm{\beta}}(\kappa,\omega;t) + \hat{C}_{\bm{\beta}}^\dagger(\kappa,\omega;t)\right]\\
&\qquad\qquad\times\left[\hat{C}_{\bm{\beta}'}(\kappa',\omega';t) + \hat{C}_{\bm{\beta}'}^\dagger(\kappa',\omega';t)\right]\left[\hat{C}_{\bm{\beta}''}(\kappa'',\omega'';t) + \hat{C}_{\bm{\beta}''}^\dagger(\kappa'',\omega'';t)\right]\mathrm{d}\omega\,\mathrm{d}\omega'\,\mathrm{d}\omega''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\[0.5em]
&\qquad + \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(2)}(\nu,\omega',\omega'';\kappa,\kappa',\kappa'')\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\\
&\qquad\qquad\times\left[\hat{C}_{\bm{\beta}'}(\kappa',\omega';t) + \hat{C}_{\bm{\beta}'}^\dagger(\kappa',\omega';t)\right]\left[\hat{C}_{\bm{\beta}''}(\kappa'',\omega'';t) + \hat{C}_{\bm{\beta}''}^\dagger(\kappa'',\omega'';t)\right]\mathrm{d}\nu\,\mathrm{d}\omega'\,\mathrm{d}\omega''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\[0.5em]
&\qquad + \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(3)}(\nu,\nu',\omega'';\kappa,\kappa',\kappa'')\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\\
&\qquad\qquad\times\left[\hat{B}_{\bm{\beta}'}^\parallel(\kappa',\nu';t) + \hat{B}_{\bm{\beta}'}^{\parallel\dagger}(\kappa',\nu';t)\right]\left[\hat{C}_{\bm{\beta}''}(\kappa'',\omega'';t) + \hat{C}_{\bm{\beta}''}^\dagger(\kappa'',\omega'';t)\right]\mathrm{d}\nu\,\mathrm{d}\nu'\,\mathrm{d}\omega''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\
&\qquad + \sum_{\bm{\beta}\bm{\beta}'\bm{\beta}''}\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty\int_0^\infty J_{\bm{\beta}\bm{\beta}'\bm{\beta}''}^{(4)}(\nu,\nu',\nu'';\kappa,\kappa',\kappa'')\left[\hat{B}_{\bm{\beta}}^\parallel(\kappa,\nu;t) + \hat{B}_{\bm{\beta}}^{\parallel\dagger}(\kappa,\nu;t)\right]\\
&\qquad\qquad\times\left[\hat{B}_{\bm{\beta}'}^\parallel(\kappa',\nu';t) + \hat{B}_{\bm{\beta}'}^{\parallel\dagger}(\kappa',\nu';t)\right]\left[\hat{B}_{\bm{\beta}''}^\parallel(\kappa'',\nu'';t) + \hat{B}_{\bm{\beta}''}^{\parallel\dagger}(\kappa'',\nu'';t)\right]\mathrm{d}\nu\,\mathrm{d}\nu'\,\mathrm{d}\nu''\,\mathrm{d}\kappa\,\mathrm{d}\kappa'\,\mathrm{d}\kappa''\\[0.5em]
&\qquad + \sum_i\frac{1}{2}\mu_{fi}\dot{\mathbf{x}}_{fi}^2(t) + \frac{1}{8\pi}\int\left[\nabla\Phi_f(\mathbf{r},t)\right]^2\;\mathrm{d}^3\mathbf{r} + \sum_{\alpha,\beta = m,b,r}\left[u_{\alpha\beta}^\infty(\mathbf{r}) + u_{\beta\alpha}^\infty(\mathbf{r})\right] + \sum_{\alpha = m,b,r,f}u_\alpha^\mathrm{self}.
\end{split}
\end{equation}



























%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Appendix %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\appendix
\numberwithin{equation}{section}

\section{Unit Conventions}\label{app:unitConventions}

The chosen dimensions and units for each important quantity in each chapter are shown below.

\subsection{Chapter \ref{sec:nonlinearFirstPrinciplesClassical}}

\subsection{Chapter \ref{sec:SHGclassical}}

\subsection{Chapter \ref{sec:SPDCquantum}}

\begin{center}
\def\arraystretch{1.5}
\begin{longtable}{c|c|c}
    Symbol Name & Dimensions & Units (cgs Gaussian) \\
    \hline
    $\mathcal{L}$ & $\frac{[U]}{[L]^3} = \frac{[M]}{[L][T^2]}$ & $\frac{\mathrm{erg}}{\mathrm{cm}^3}$\\
    $L$, $H$ & $[U]$ & erg\\
    $\Delta$ & $[L]^3$ & cm$^3$\\
    $\mu_{fi}$, $\mu_{mi}$, $\mu_{ri}$ & $[M]$ & g\\
    $\eta_m$, $\eta_\nu$ & $\frac{[M]}{[L]^3}$ & $\frac{\mathrm{g}}{\mathrm{cm}^3}$\\
    $\mathbf{Q}_m(\mathbf{r},t)$ & $[L]$ & cm\\
    $\tilde{\mathbf{Q}}_\nu(\mathbf{r},t)$ & $[L][T]^\frac{1}{2}$ & $\mathrm{cm}\cdot \mathrm{s}^\frac{1}{2}$\\
    $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)$, $\mathbf{Y}_{\bm{\alpha}}(\mathbf{r},k)$, $\mathbf{L}_{\bm{\alpha}}(\mathbf{r};s)$ & 1 & no units\\
    $f_{\bm{\alpha}}^{>,<}(\mathbf{r})$ & $[L]^{-\ell-1}$ (for $>$) or $[L]^{\ell}$ (for $<$) & $\mathrm{cm}^{-\ell-1}$ or $\mathrm{cm}^\ell$\\
    $\mathbf{G}_0(\mathbf{r},t)$ & $[L]^{-1}$ & cm$^{-1}$\\
    $\tilde{v}(\nu)$ & $\frac{[M]}{[L]^3[T]^\frac{1}{2}}$ & $\frac{\mathrm{g}}{\mathrm{cm}^3\mathrm{s}^\frac{1}{2}}$\\
    $\sigma_0$ & $\frac{1}{[T]^2[L]}$ & $\mathrm{s}^{-2}$$\mathrm{cm}^{-1}$\\
    $\chi^{(1)}(\mathbf{r},\omega)$ & 1 & no units\\
    $\chi^{(2)}(\mathbf{r};\omega',\omega - \omega')$ & $\frac{[L]^2}{[C]}$ & $\frac{\mathrm{cm}}{\mathrm{statV}} = \frac{\mathrm{cm}^2}{\mathrm{statC}}$\\
    $k$, $\kappa$ & $[L]^{-1}$ & cm$^{-1}$\\
    $\mathbf{A}(\mathbf{r},t)$, $\Phi(\mathbf{r},t)$ & $\frac{[C]}{[L]}$ & $\frac{\mathrm{statC}}{\mathrm{cm}}$\\
    $\mathbf{p}_{fi}(t)$ & $\frac{[M][L]}{[T]}$ & $\frac{\mathrm{g}\cdot\mathrm{cm}}{\mathrm{s}}$\\
    $\mathbf{P}_m(\mathbf{r},t)$ & $\frac{[M]}{[L]^2[T]}$ & $\frac{\mathrm{g}}{\mathrm{cm}^2\mathrm{s}}$\\
    $\tilde{\mathbf{P}}_\nu(\mathbf{r},t)$ & $\frac{[M]}{[L]^2[T]^\frac{1}{2}}$ & $\frac{\mathrm{g}}{\mathrm{cm}^2\cdot\mathrm{s}^\frac{1}{2}}$\\
    $\bm{\Pi}(\mathbf{r},t)$ & $\frac{[C][T]}{[L]^3}$ & $\frac{\mathrm{statC}\cdot\mathrm{s}}{\mathrm{cm}^3}$\\
    $\mathcal{A}_{\bm{\alpha}}(k,t)$, $\hat{\mathcal{A}}_{\bm{\alpha}}(k,t)$ & $[C]$ & statC\\
    $\mathcal{Q}_{\bm{\beta}}^{\perp,\parallel}(\kappa,t)$, $\hat{\mathcal{Q}}_{\bm{\beta}}^{\perp,\parallel}(\kappa,t)$ & $[L]^2$ & cm$^{2}$\\
    $\tilde{\mathcal{Q}}_{\bm{\gamma}}^{\perp,\parallel}(\kappa,t)$, $\hat{\tilde{\mathcal{Q}}}_{\bm{\gamma}}^{\perp,\parallel}(\kappa,t)$ & $[L]^2[T]^\frac{1}{2}$ & $\mathrm{cm}^2\cdot\mathrm{s}^\frac{1}{2}$\\
    $\mathit{\Pi}_{\bm{\alpha}}(k,t)$, $\hat{\mathit{\Pi}}_{\bm{\alpha}}(k,t)$ & $[C][T]$ & $\mathrm{statC}\cdot\mathrm{s}$\\
    $\mathcal{P}_{\bm{\beta}}^{\perp,\parallel}(k,t)$, $\hat{\mathcal{P}}_{\bm{\beta}}^{\perp,\parallel}(k,t)$ & $\frac{[M][L]}{[T]}$ & $\frac{\mathrm{g}\cdot\mathrm{cm}}{\mathrm{s}}$\\
    $\tilde{\mathcal{P}}_{\bm{\gamma}}^{\perp,\parallel}(k,\nu;t)$, $\hat{\tilde{\mathcal{P}}}_{\bm{\gamma}}^{\perp,\parallel}(k,\nu;t)$ & $\frac{[M][L]}{[T]^\frac{1}{2}}$ & $\frac{\mathrm{g}\cdot\mathrm{cm}}{\mathrm{s}^\frac{1}{2}}$\\
    $\omega_0$, $\Gamma$, $\Omega_\perp$, $\Omega_\parallel$ & $\frac{1}{[T]}$ & s$^{-1}$\\
    $\hat{a}_{\bm{\alpha}}(k,t)$ & $[L]^\frac{1}{2}$ & cm$^\frac{1}{2}$ \\
    $\hat{b}_{\bm{\beta}}^{\perp,\parallel}(\kappa,t)$ & $[L]^\frac{1}{2}$ & cm$^\frac{1}{2}$\\
    $\hat{c}_{\bm{\gamma}}^{\perp,\parallel}(\kappa,\nu;t)$ & $[L]^\frac{1}{2}[T]^\frac{1}{2}$ & cm$^\frac{1}{2}$s$^\frac{1}{2}$\\
\end{longtable}
\end{center}





















\section{Dyadic Green's Function of a Sphere}

Beginning with a general wave equation of a nonmagnetic, isotropic spherical dielectric material
\begin{equation}
\nabla\times\nabla\times\mathbf{E}(\mathbf{r},\omega) - \epsilon(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\mathbf{J}(\mathbf{r},\omega),
\end{equation}
one can employ dyadic generalizations to Green's identities to define a Green's function $\mathbf{G}(\mathbf{r},\mathbf{r}';\omega)$ that obeys the electric-type Maxwell boundary conditions as well as the Lippmann-Schwinger equation
\begin{equation}
\mathbf{E}(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c}\int\mathbf{G}(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'.
\end{equation}
The dielectric function here is assumed to obey the relations
\begin{equation}
\begin{split}
\epsilon(\mathbf{r},\omega) &= \epsilon(\omega)\Theta(r < a) + \Theta(r > a),\\
\epsilon(t - t') &= \epsilon(t - t')\Theta(t' \leq t)
\end{split}
\end{equation}
in the frequency- and time-domains, respectively, wherein
\begin{equation}
\epsilon(\omega) = \int_{-\infty}^t \epsilon(t - t')\mathrm{e}^{\mathrm{i}\omega(t - t')}\;\mathrm{d}(t-t')
\end{equation}
with $t$ taken to be a real constant parameter. 

Under these assumptions, the Green's function takes different forms depending on the locations of the observer ($\mathbf{r}$) and source current ($\mathbf{r}'$). This discontinuity is analogous to that found in the Green's function of free space ($\epsilon(\mathbf{r},\omega)\to1$), which is given by
\begin{equation}\label{eq:G0}
\begin{split}
\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega) &= \frac{1}{4\pi}\left(\bm{1}_2 - \frac{c^2}{\omega^2}\nabla'\nabla\right)\left\{\frac{\mathrm{e}^{\mathrm{i}\omega|\mathbf{r} - \mathbf{r}'|/c}}{|\mathbf{r} - \mathbf{r}'|}\right\}\\
&= \frac{\mathrm{i}\omega}{4\pi c}\sum_{p\ell m}\left[\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)\mathbf{M}_{p\ell m}(\mathbf{r}',k) + \bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right]\Theta(r - r')\\
&+ \frac{\mathrm{i}\omega}{4\pi c}\sum_{p\ell m}\left[\mathbf{M}_{p\ell m}(\mathbf{r},k)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',k) + \mathbf{N}_{p\ell m}(\mathbf{r},k)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\Theta(r' - r) - \frac{c^2}{\omega^2}\hat{\mathbf{r}}\hat{\mathbf{r}}\delta(\mathbf{r} - \mathbf{r}').
\end{split}
\end{equation}
The notation here includes $k= \omega/c$ as well as the vector spherical harmonics $\mathbf{M}_{p\ell m}(\mathbf{r},k)$, etc., which take different forms depending on whether the observer coordinate is closer to the origin than the source coordinate. The formal definitions of the vector harmonics are given in Appendix \ref{app:greenFuncDetails}.

Notably, $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$ is defined using Heaviside functions which arise due to the irregularity of one of the solutions to the wave equation at the origin. Geometrically, the source coordinate's radial component sets the radius of a Gaussian surface that serves as a boundary between two regions with different boundary conditions and different viable solutions. The Dirac delta term serves simply to eliminate from consideration the divergent fields arising in the unphysical case $\mathbf{r} = \mathbf{r}'$, and will be largely ignored in the following discussion.

The boundary of a dielectric sphere forms another natural boundary across which the form of the Green's function can be discontinuous. Explicitly, we will let the region outside the sphere be labeled as a set of points $\mathbb{V}_1$ and the region inside be similarly labeled $\mathbb{V}_2$. First defining the Green's function that is valid for an observer outside the sphere as
\begin{equation}
\mathbf{G}_1(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_{11}(\mathbf{r},\mathbf{r}';\omega) + \mathbf{G}_{12}(\mathbf{r},\mathbf{r}';\omega)
\end{equation}
where we have used the convention $\mathbf{G}_{\mathrm{obs},\mathrm{src}}$ to label each term, we can see that the function's components each display Heaviside behavior:
\begin{equation}
\begin{split}
&\mathbf{G}_{11}(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)\Theta(\mathbf{r}\in\mathbb{V}_1)\Theta(\mathbf{r}'\in\mathbb{V}_1)\\[0.5em]
&+\frac{\mathrm{i}\omega}{4\pi c}\sum_{p\ell m}\left[A^>_{p\ell m}(\omega)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',k) + B_{p\ell m}^>(\omega)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\Theta(\mathbf{r}\in\mathbb{V}_1)\Theta(\mathbf{r}' \in \mathbb{V}_1)\\
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\mathbf{G}_{12}(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}\omega\sqrt{\epsilon(\omega)}}{4\pi c}\sum_{p\ell m}\left[A_{p\ell m}^<(\omega)\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)\mathbf{M}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k) + \right.\\
&+\left.B_{p\ell m}^<(\omega)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)\mathbf{N}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right]\Theta(\mathbf{r}\in\mathbb{V}_1)\Theta(\mathbf{r}'\in\mathbb{V}_2).
\end{split}
\end{equation}
The expansion coefficients $A_{p\ell m}^{\cdot}(\omega),\ldots$ are given in Appendix \ref{app:greenFuncDetails} for brevity.

The sum is taken over three indices, $p$, $\ell$, and $m$, that detail each harmonic's reflection symmetry about the $x$-axis, its Legendre polynomial order, and its Legendre polynomial degree, respectively. Further, in the case of $\mathbf{G}_{12}(\mathbf{r},\mathbf{r}';\omega)$, the frequency argument of the source harmonics has been multiplied by the refractive index $\sqrt{\epsilon(\omega)}$, detailing the effects of wave retardation and attenuation within a medium such that the complete angular and radial dependence of the fields set up outside the sphere by a given source current are captured simply by the series representation of $\mathbf{G}_1$.

The Green's function valid for an observer inside the sphere,
\begin{equation}
\mathbf{G}_2(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_{21}(\mathbf{r},\mathbf{r}';\omega) + \mathbf{G}_{22}(\mathbf{r},\mathbf{r}';\omega),
\end{equation}
takes a similar form. Explicitly,
\begin{equation}
\begin{split}
\mathbf{G}_{21}(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}\omega}{4\pi c}\sum_{p\ell m}\left[C_{p\ell m}^>(\omega)\mathbf{M}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\bm{\mathcal{M}}(\mathbf{r}',k)\right.\\
&\left.+ D_{p\ell m}^>(\omega)\mathbf{N}_{p\ell m}(\mathbf{r},k)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\Theta(\mathbf{r}\in\mathbb{V}_2)\Theta(\mathbf{r}'\in\mathbb{V}_1)
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\mathbf{G}_{22}(\mathbf{r},\mathbf{r}';\omega) &= \mathbf{G}_0(\mathbf{r},\mathbf{r}';\sqrt{\epsilon(\omega)}\omega)\Theta(\mathbf{r}\in\mathbb{V}_2)\Theta(\mathbf{r}'\in\mathbb{V}_2)\\[0.5em]
&+ \frac{\mathrm{i}\omega\sqrt{\epsilon(\omega)}}{4\pi c}\sum_{p\ell m}\left[C_{p\ell m}^<(\omega)\mathbf{M}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\mathbf{M}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right.\\
&\left.+ D_{p\ell m}^<(\omega)\mathbf{N}_{p\ell m}(\mathbf{r},\sqrt{\epsilon(\omega)}k)\mathbf{N}_{p\ell m}(\mathbf{r}',\sqrt{\epsilon(\omega)}k)\right]\Theta(\mathbf{r}\in\mathbb{V}_2)\Theta(\mathbf{r}'\in\mathbb{V}_2).
\end{split}
\end{equation}








\section{Green's Function Details}\label{app:greenFuncDetails}



\subsection{Harmonic Definitions}

The dyadic Green's function of a sphere is composed of transverse vector spherical harmonics
\begin{equation}
\begin{split}
\mathbf{M}_{p\ell m}(\mathbf{r},k) &= \sqrt{K_{\ell m}}\left[\frac{(-1)^{p + 1}m}{\sin\theta}j_\ell(kr)P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\theta}} - j_\ell(kr)\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\phi}}\right],\\[0.5em]
\mathbf{N}_{p\ell m}(\mathbf{r},k) &= \sqrt{K_{\ell m}}\left[\frac{\ell(\ell + 1)}{kr}j_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}}\right.\\
&+ \left.\frac{1}{kr}\frac{\partial\{rj_\ell(kr)\}}{\partial r}\left(\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\theta}} + \frac{(-1)^{p+1}m}{\sin\theta}P_{\ell m}(\cos\theta)S_{p + 1}(m\phi)\hat{\bm{\phi}}\right)\right],
\end{split}
\end{equation}
which each have zero divergence, i.e. $\nabla\cdot\mathbf{M}_{p\ell m}(\mathbf{r},k) = \nabla\cdot\mathbf{N}_{p\ell m}(\mathbf{r},k) = 0$, and longitudinal vector spherical harmonics
\begin{equation}
\begin{split}
\mathbf{L}_{p\ell m}(\mathbf{r},k) &= \frac{1}{k}\nabla\left\{\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}j_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi)\right\}\\
&= \sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}\left[\frac{1}{k}\frac{\partial\{j_\ell(kr)\}}{\partial r}P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}} + \frac{1}{kr}j_\ell(kr)\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\theta}}\right.\\
&\left. + \frac{(-1)^{p+1}m}{kr\sin\theta}j_\ell(kr)P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\phi}}\right]
\end{split}
\end{equation}
which obey $\nabla\times\mathbf{L}_{p\ell m}(\mathbf{r},k) = 0$. Here $j_\ell(x)$ are spherical Bessel functions with $\ell = 1,2,3,\ldots,\infty$; $P_{\ell m}(x)$ are associated Legendre polynomials with the same range in $\ell$; $m = 0,1,2,\ldots,\ell$; and 
\begin{equation}
S_p(mx) = 
\begin{cases}
\cos(mx), & p\;\;\mathrm{even},\\
\sin(mx), & p \;\;\mathrm{odd}
\end{cases}
\end{equation}
and the same range in $m$. Due to the binary nature of $p$, we will in general need to use special notation to assert that $S_p(x) = S_{p + 2}(x) = S_{p+4}(x) = \cdots$. However, to save space, we will use the convention that any nonzero even value of $p$ is automatically replaced by 0 and any non-one odd value of $p$ is automatically replaced by 1 in what follows. Further, the prefactors $K_{\ell m}$, which are set to $1$ in most texts, are set to
\begin{equation}
K_{\ell m} = (2 - \delta_{m0})\frac{2\ell + 1}{\ell(\ell + 1)}\frac{(\ell - m)!}{(\ell + m)!}
\end{equation}
in an effort to regularize the transverse harmonics, i.e. ensure that their maximum magnitudes in $\mathbf{r}$ for fixed $k$ are similar for all index combinations $T,p,\ell,m$. The prefactors of the Laplacian harmonics are defined similarly, but with an added factor of $\delta_{TE}$. Here, $T$ is a fourth ``type'' index, similar to the parity ($p$), order ($\ell$), and degree ($m$) indices, that takes values of $M$ (magnetic type) or $E$ (electric type) to describe whether the characteristic field profiles of each mode resemble those of magnetic or electric multipoles. Only the electric longitudinal modes $\mathbf{L}_{p\ell m}(\mathbf{r})$ are nonzero such that we won't bother to invent a second symbol for magnetic longitudinal modes, but the transverse harmonics clearly come in two different types: magnetic modes $\mathbf{M}_{p\ell m}(\mathbf{r},k)$ ($T = M$) and electric modes $\mathbf{N}_{p\ell m}(\mathbf{r},k)$ ($T = E$).

Both the transverse and Laplacian modes also come with a fifth modifier, the ``region'' index, taking values of $<$ for \textit{interior} harmonics and $>$ for \textit{exterior} harmonics, although we have neglected append our definitions with yet another symbol. The interior harmonics, listed above as $\mathbf{L}$, $\mathbf{M}$, and $\mathbf{N}$, are generally used for $\mathbf{r}$ confined within some closed spherical surface such that $r<\infty$ always and $r = 0$ somwhere within the region. To describe fields in regions that do not include the origin, one can find the second set of solutions to the second-order wave equation PDE, which are the so-called \textit{exterior} vector spherical harmonics $\bm{\mathcal{L}}_{p\ell m}(\mathbf{r})$, $\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k)$, and $\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k)$. These harmonics are defined with the simple substitutions $j_\ell(kr)\to h_\ell(kr)$ and are explicitly given by
\begin{equation}
\begin{split}
\bm{\mathcal{L}}_{p\ell m}(\mathbf{r},k) &= \frac{1}{k}\nabla\left\{\sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}h_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi)\right\},\\
&= \sqrt{K_{\ell m}}\sqrt{\ell(\ell + 1)}\left[\frac{1}{k}\frac{\partial\{h_\ell(kr)\}}{\partial r}P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}} + \frac{1}{kr}h_\ell(kr)\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\theta}}\right.\\
&\left. + \frac{(-1)^{p+1}m}{kr\sin\theta}h_\ell(kr)P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\phi}}\right],\\[1.0em]
\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k) &= \sqrt{K_{\ell m}}\left[\frac{(-1)^{p + 1}m}{\sin\theta}h_\ell(kr)P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\theta}} - h_\ell(kr)\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\phi}}\right],\\[0.5em]
\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k) &= \sqrt{K_{\ell m}}\left[\frac{\ell(\ell + 1)}{kr}h_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}}\right.\\
&+ \left.\frac{1}{kr}\frac{\partial\{rh_\ell(kr)\}}{\partial r}\left(\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\theta}} + \frac{(-1)^{p+1}m}{\sin\theta}P_{\ell m}(\cos\theta)S_{p + 1}(m\phi)\hat{\bm{\phi}}\right)\right].
\end{split}
\end{equation}
The functions $h_\ell(kr) = j_\ell(kr) + \mathrm{i}y_\ell(kr)$ are the spherical Hankel functions of the first kind and involve the spherical Bessel functions of both the first kind ($j_\ell[kr]$) and the second kind, $y_\ell(kr)$, the latter of which are irregular at $r\to0$, justifying their exclusion from use in all regions that include the point $r = 0$.

We would like the notation for the transverse harmonics to be as succinct as that of the longitudinal harmonics. Therefore, for shorthand, we can define the transverse vector harmonics more compactly as
\begin{equation}
\begin{split}
\mathbf{X}_{Tp\ell m}(\mathbf{r},k) &= 
\begin{cases}
\mathbf{M}_{p\ell m}(\mathbf{r},k), & T=M,\\
\mathbf{N}_{p\ell m}(\mathbf{r},k), & T=E;
\end{cases}\\[1.0em]
\bm{\mathcal{X}}_{Tp\ell m}(\mathbf{r},k) &=
\begin{cases}
\bm{\mathcal{M}}_{p\ell m}(\mathbf{r},k), & T=M,\\
\bm{\mathcal{N}}_{p\ell m}(\mathbf{r},k), & T=E.
\end{cases}
\end{split}
\end{equation}
Here, we have finally introduced the fourth ``type'' index to the transverse harmonic notation. We can condense the notation further by writing the string of four indices as $\bm{\alpha} = (T,p,\ell,m)$, such that our harmonics can now be written as $\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k)$, $\bm{\mathcal{L}}_{\bm{\alpha}}(\mathbf{r},k)$, $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)$, and $\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)$. By convention, we'll let $\mathbf{L}_{Mp\ell m}(\mathbf{r},k) = 0$ and $\bm{\mathcal{L}}_{Mp\ell m}(\mathbf{r},k) = 0$ as well as $\mathbf{L}_{Ep\ell m}(\mathbf{r},k) = \mathbf{L}_{p\ell m}(\mathbf{r},k)$ and $\bm{\mathcal{L}}_{Ep\ell m}(\mathbf{r},k) = \bm{\mathcal{L}}_{p\ell m}(\mathbf{r},k)$.

The symmetries of the transverse vector spherical harmonics are such that
\begin{equation}
\begin{split}
\mathbf{M}_{p\ell m}^*(\mathbf{r},k) &= (-1)^\ell\mathbf{M}_{p\ell m}(\mathbf{r},-k),\\
\mathbf{N}_{p\ell m}^*(\mathbf{r},k) &= (-1)^{\ell + 1}\mathbf{N}_{p\ell m}(\mathbf{r},-k),
\end{split}
\end{equation}
with identical relations for the respective exterior transverse harmonics. Further, they obey the duality
\begin{equation}
\begin{split}
\nabla\times\mathbf{M}_{p\ell m}(\mathbf{r},k) &= k\mathbf{N}_{p\ell m}(\mathbf{r},k),\\
\nabla\times\mathbf{N}_{p\ell m}(\mathbf{r},k) &= k\mathbf{M}_{p\ell m}(\mathbf{r},k),
\end{split}
\end{equation}
and similar for the exterior transverse harmonics, such that a second set of transverse harmonics can be defined as 
\begin{equation}
\begin{split}
\mathbf{Y}_{\bm{\alpha}}(\mathbf{r},k) &= \frac{1}{k}\nabla\times\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k),\\
\bm{\mathcal{Y}}_{\bm{\alpha}}(\mathbf{r},k) &= \frac{1}{k}\nabla\times\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k).
\end{split}
\end{equation}
These obey the same conjugation symmetry as $\mathbf{X}_{\bm{\alpha}}$ and $\bm{\mathcal{X}}_{\bm{\alpha}}$ but with an extra factor of $-1$ such that
\begin{equation}
\begin{split}
\bm{\mathcal{X}}_{\bm{\alpha}}^*(\mathbf{r},k) &= 
\begin{cases}
(-1)^{\ell}\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},-k), & T = M,\\
(-1)^{\ell + 1}\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},-k), & T = E;\\
\end{cases}\\
\bm{\mathcal{Y}}_{\bm{\alpha}}^*(\mathbf{r},k) &= 
\begin{cases}
(-1)^{\ell + 1}\bm{\mathcal{Y}}_{\bm{\alpha}}(\mathbf{r},-k), & T = M,\\
(-1)^{\ell}\bm{\mathcal{Y}}_{\bm{\alpha}}(\mathbf{r},-k), & T = E;\\
\end{cases}
\end{split}
\end{equation}
and similar for the interior transverse harmonics. The longitudinal vector spherical harmonics obey the symmetries
\begin{equation}
\begin{split}
\mathbf{L}_{p\ell m}(\mathbf{r},k) &= (-1)^{\ell+1}\mathbf{L}_{p\ell m}(\mathbf{r},-k),\\
\bm{\mathcal{L}}_{p\ell m}^*(\mathbf{r},k) &= (-1)^{\ell+1}\bm{\mathcal{L}}_{p\ell m}(\mathbf{r},-k).
\end{split}
\end{equation}

Due to their regularity at all points $\mathbf{r}$, the transverse interior harmonics obey the orthogonality condition
\begin{equation}\label{eq:vectorSphericalHarmonicOrthogonality}
\int \mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r} = \frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{TT'}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}\\
\end{equation}
for $k,k' > 0$ and integration across the entire universe. The simpler orthogonality relations that contribute to this simple result are given in Appendix \ref{sec:simpleOrthogonality}. The longitudinal interior harmonics obey the orthogonality condition
\begin{equation}\label{eq:longitudinalHarmonicOrthogonality}
\int\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{L}_{\bm{\alpha}'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r} = \frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{TT'}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}.
\end{equation}
Accordingly, the transverse and longitudinal harmonics also satisfy convenient orthogonality relations when integrated over finite regions in $r$. Explicitly,
\begin{equation}\label{eq:vectorSphericalHarmonicOrthogonalityConditionFinite}
\begin{split}
\int_0^{2\pi}\int_0^\pi\int_a^b\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k')r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi &= 4\pi(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}R_{T\ell}^{\ll}(k,k';a,b),\\
\int_0^{2\pi}\int_0^\pi\int_a^b\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{L}_{\bm{\alpha}'}(\mathbf{r},k')r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi &= 4\pi(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}R_{L\ell}^{\ll}(k,k';a,b)
\end{split}
\end{equation}
where $R_{T\ell}^\ll(k,k';a,b)$ and $R_{L\ell}^\ll(k,k';a,b)$ are radial integral functions defined by
\begin{equation}\label{eq:finiteRadialIntegrals}
\begin{split}
R_{M\ell}^\ll(k,k';a,b) &= \int_a^bj_\ell(kr)j_\ell(k'r)r^2\;\mathrm{d}r\\
&= \left.\frac{r^2}{k^2 - k'^2}\left[k'j_{\ell - 1}(k'r)j_\ell(kr) - kj_{\ell - 1}(kr)j_\ell(k'r)\right]\right|_a^b,\\[0.5em]
R_{E\ell}^\ll(k,k';a,b) &= \frac{\ell + 1}{2\ell + 1}R_{M,\ell - 1}^\ll(k,k';a,b) + \frac{\ell}{2\ell + 1}R_{M,\ell + 1}^\ll(k,k';a,b),\\
R_{L\ell}^\ll(k,k';a,b) &= \frac{\ell + 1}{2\ell + 1}R_{M,\ell + 1}^\ll(k,k';a,b) + \frac{\ell}{2\ell + 1}R_{M,\ell - 1}^\ll(k,k';a,b).
\end{split}
\end{equation}
The superscript $\ll$ indicates that the integral involves two spherical Bessel functions of the first kind and thus arises from the integration of two interior harmonics. 

From their opposing Helmholtz symmetries, we can conclude that integrals of the inner product of $\mathbf{M}$ or $\mathbf{N}$ and $\mathbf{L}$ over all space are null. However, the same is not true when integrating over finite regions of space. Again choosing the region of integration to be finite in $r$, we can see that
\begin{equation}\label{eq:vectorSphericalHarmonicOrthogonalityConditionFiniteMixed}
\begin{split}
\int_0^{2\pi}\int_0^{\pi}\int_a^b\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k)\cdot\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k')r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi &= 4\pi(1 - \delta_{p1}\delta_{m0})\sqrt{\ell(\ell + 1)}\delta_{TE}\delta_{T'E}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}\\[-0.5em]
&\qquad\times\frac{1}{kk'}\left[bj_\ell(kb)j_\ell(k'b) - aj_\ell(ka)j_\ell(k'a)\right].
\end{split}
\end{equation}
Note that integration of the longitudinal and transverse magnetic harmonics always produces zero, even when carried out over finite regions in $r$. Integration of the longitudinal and transverse electric harmonics can be seen to produce zero in the limit where the integration region is allowed to become infinite. Explicitly, with $a\to0$ and $b\to\infty$, one can see that $\lim_{r\to0}rj_\ell(kr)j_\ell(k'r) = \lim_{r\to\infty}rj_\ell(kr)j_\ell(k'r) = 0$ for all real, positive $k$ and $k'$ if $\ell$ is an integer greater than 0.

An important case of this integral occurs when $b\to a$ and $a\to0$, i.e. during integration over a finite sphere. In this case, the characteristic wavenumbers are often defined such that $k = z_{\ell n}/a$ and $k' = z_{\ell n'}/a$, where $z_{\ell n}$ is the $n^\mathrm{th}$ unitless root of $j_\ell(x)$ with $n = 1,2,\ldots$. With these values of $k$ and $k'$ fixed, we can easily see that $R_{M\ell}^\ll(z_{\ell n}/a,z_{\ell n'}/a;0,a) = 0$ for $n\neq n'$. Further, with
\begin{equation}
\lim_{k'\to k}R_{M\ell}^\ll(k,k';0,a) = \frac{a^3}{2}\left[j_\ell^2(ka) - j_{\ell - 1}(ka)j_{\ell + 1}(ka)\right]
\end{equation}
by L'Hopital's rule, we can see that
\begin{equation}
R_{M\ell}^\ll\left(\frac{z_{\ell n}}{a},\frac{z_{\ell n'}}{a};0,a\right) = -\delta_{nn'}\frac{a^3}{2}j_{\ell - 1}(z_{\ell n})j_{\ell + 1}(z_{\ell n}).
\end{equation}
Finally, using the recursion identity $j_\ell(x) = [x/(2\ell + 1)][j_{\ell - 1}(x) + j_{\ell 1}(x)]$, we can see that $j_{\ell - 1}(z_{n\ell}) = -j_{\ell + 1}(z_{n\ell})$. Therefore, letting $k_{\bm{\alpha}n} = z_{\ell n}/a$ and $k_{\bm{\alpha}'n'} = z_{\ell'n'}/a$, we have
\begin{equation}
\begin{split}
\int_0^{2\pi}\int_0^\pi\int_0^a\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k_{\bm{\alpha}n})\cdot\mathbf{X}_{\bm{\alpha}'}(\mathbf{r},k_{\bm{\alpha}'n'})r^2\sin\theta\;\mathrm{d}r\;\mathrm{d}\theta\;\mathrm{d}\phi &= 2\pi a^3(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}\delta_{nn'}j_{\ell + 1}^2(z_{\ell n}),\\
\int_0^{2\pi}\int_0^\pi\int_0^a\mathbf{L}_{\bm{\alpha}}(\mathbf{r},k_{\bm{\alpha}n})\cdot\mathbf{L}_{\bm{\alpha}'}(\mathbf{r},k_{\bm{\alpha}'n'})r^2\sin\theta\;\mathrm{d}r\;\mathrm{d}\theta\;\mathrm{d}\phi &= 2\pi a^3(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\alpha}'}\delta_{nn'}j_{\ell + 1}^2(z_{\ell n}).
\end{split}
\end{equation}

\noindent\rule{\textwidth}{0.5pt}\\

For calculations involving one or more \textit{exterior} harmonics, one simply replaces one or both of the spherical Bessel functions with spherical Hankel functions. More explicitly, if we define 
\begin{equation}
z_\ell^i(x) = 
\begin{cases}
j_\ell(x), & i = \,<,\\
h_\ell(x), & i = \,>,
\end{cases}
\end{equation}
then we can generalize Eq. \eqref{eq:finiteRadialIntegrals} with
\begin{equation}
\begin{split}
R_{M\ell}^{ij}(k,k';a,b) &= \int_a^bz_\ell^i(kr)z_\ell^j(k'r)r^2\;\mathrm{d}r\\
&= \lim_{\kappa\to k'}\frac{r^2}{k^2 - \kappa^2}\left[\kappa z_{\ell-1}^j(\kappa r)z_{\ell}^i(kr) - kz_{\ell-1}^i(kr)z_{\ell}^j(\kappa r)\right]_a^b
\end{split}
\end{equation}
and $R_{E\ell}^{ij}(k,k';a,b) = (\ell+1)R_{M,\ell - 1}^{ij}(k,k';a,b)/(2\ell + 1) + \ell R_{M,\ell + 1}^{ij}(k,k';a,b)/(2\ell + 1)$. For $k'\neq k$, the limits within both the magnetic and electric radial integrals can be evaluated with simple substitution, but for $k'=k$ it is necessary to evaluate the limit carefully.




and Laplacian vector spherical harmonics
\begin{equation}
\begin{split}
\mathbf{F}_{Tp\ell m}(\mathbf{r}) &= \nabla\left\{\delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}r^\ell P_{\ell m}(\cos\theta)S_p(m\phi)\right\},\\
% \nabla f_{Tp\ell m}^{>}(\mathbf{r}) &= \nabla\left\{\delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\frac{1}{r^{\ell + 1}}P_{\ell m}(\cos\theta)S_p(m\phi)\right\},
&= \delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\left[ \vphantom{\frac{(-1)^{p+1}}{\sin\theta}} \ell r^{\ell - 1}P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}}\right.\\
&\qquad+ \left. r^{\ell - 1}\frac{\partial P_{\ell m}(\cos\theta)}{\partial \theta}S_p(m\phi)\hat{\bm{\theta}} + \frac{(-1)^{p+1}m}{\sin\theta}r^{\ell - 1}P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\phi}} \right]
\end{split}
\end{equation}
which have neither curl ($\nabla\times\mathbf{F}_{Tp\ell m}(\mathbf{r}) = 0$) or divergence ($\nabla\cdot\mathbf{F}_{Tp\ell m}(\mathbf{r}) = 0$). 

\begin{equation}
\begin{split}
\mathbf{M}_{p\ell m}(\mathbf{r},k) &= \sqrt{K_{\ell m}}\left[\frac{(-1)^{p + 1}m}{\sin\theta}j_\ell(kr)P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\theta}} - j_\ell(kr)\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\phi}}\right],\\[0.5em]
\mathbf{N}_{p\ell m}(\mathbf{r},k) &= \sqrt{K_{\ell m}}\left[\frac{\ell(\ell + 1)}{kr}j_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}}\right.\\
&+ \left.\frac{1}{kr}\frac{\partial\{rj_\ell(kr)\}}{\partial r}\left(\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}S_p(m\phi)\hat{\bm{\theta}} + \frac{(-1)^{p+1}m}{\sin\theta}P_{\ell m}(\cos\theta)S_{p + 1}(m\phi)\hat{\bm{\phi}}\right)\right],
\end{split}
\end{equation}


\begin{equation}
\begin{split}
\bm{\mathcal{F}}_{Tp\ell m}(\mathbf{r},k) &= \nabla\left\{\delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\frac{1}{r^{\ell + 1}} P_{\ell m}(\cos\theta)S_p(m\phi)\right\},\\
&= \delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\left[(-\ell - 1)\frac{1}{r^{\ell + 2}}P_{\ell m}(\cos\theta)S_p(m\phi)\hat{\mathbf{r}}\right.\\
&\qquad+ \left.\frac{1}{r^{\ell + 2}}\frac{\partial P_{\ell m}(\cos\theta)}{\partial \theta}S_p(m\phi)\hat{\bm{\theta}} + \frac{(-1)^{p+1}m}{\sin\theta}\frac{1}{r^{\ell + 2}}P_{\ell m}(\cos\theta)S_{p+1}(m\phi)\hat{\bm{\phi}} \right]
\end{split}
\end{equation}
 





 The Laplacian harmonics are either irregular at infinity ($r^\ell$) or at the origin ($1/r^{\ell + 1}$) for $\ell > 0$, such that their orthogonality relations can only be defined across finite regions in $r$:
\begin{equation}\label{eq:laplacianHarmonicOrthogonality}
\begin{split}
\int_0^{2\pi}\int_0^\pi\int_a^b\mathbf{F}_{\bm{\alpha}}(\mathbf{r})\cdot\mathbf{F}_{\bm{\alpha}'}(\mathbf{r})r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi &= 4\pi\frac{\ell}{2\ell + 1}\left(b^{2\ell + 1} - a^{2\ell + 1}\right)\delta_{T\!E}\delta_{TT'}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'},\\
\int_0^{2\pi}\int_0^\pi\int_a^b\bm{\mathcal{F}}_{\bm{\alpha}}(\mathbf{r})\cdot\bm{\mathcal{F}}_{\bm{\alpha}'}(\mathbf{r})r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi &= -4\pi\frac{\ell + 1}{2\ell + 1}\left(b^{-2\ell - 1} - a^{-2\ell - 1}\right)\delta_{TE}\delta_{TT'}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'},\\
\int_0^{2\pi}\int_0^\pi\int_a^b\mathbf{F}_{\bm{\alpha}}(\mathbf{r})\cdot\bm{\mathcal{F}}_{\bm{\alpha}'}(\mathbf{r})r^2\sin\theta\;\mathrm{d}r\,\mathrm{d}\theta\,\mathrm{d}\phi &= 0.
\end{split}
\end{equation}

A useful mixed Laplacian-transverse orthogonality conditions also exists:
\begin{equation}\label{eq:angularMixedOrthogonalityNf}
\begin{split}
\int_0^{2\pi}\int_0^\pi&\left[\hat{\mathbf{r}}\cdot\mathbf{N}_{p\ell m}(r,\theta,\phi;k)\right]f_{p'\ell'm'}^i(r,\theta,\phi)\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi\\
&= 4\pi\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}(1 - \delta_{p1}\delta_{m0})\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr)}{kr}\left[r^\ell\delta_{i,<} + \frac{\delta_{i,>}}{r^{\ell + 1}}\right],
\end{split}
\end{equation}
as does the mixed Laplacian-longitudinal orthogonality condition
\begin{equation}\label{eq:angularMixedOrthogonalityLf}
\begin{split}
\int_0^{2\pi}\int_0^\pi&\left[\hat{\mathbf{r}}\cdot\mathbf{L}_{p\ell m}(r,\theta,\phi;k)\right]f_{p'\ell'm'}^i(r,\theta,\phi)\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi\\
&= 4\pi\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}(1 - \delta_{p1}\delta_{m0})\frac{1}{\sqrt{2\ell + 1}}\frac{1}{k}\frac{\partial j_\ell(kr)}{\partial r}\left[r^\ell\delta_{i,<} + \frac{\delta_{i,>}}{r^{\ell + 1}}\right].
\end{split}
\end{equation}

\begin{equation}
\begin{split}
\int_{r<a}\mathbf{F}_{\bm{\alpha}}(\mathbf{r})\cdot\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r} &= \int_{r < a}\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)\cdot\nabla f_{\bm{\alpha}}^<(\mathbf{r})\;\mathrm{d}^3\mathbf{r}\\
&= \int_{r < a}\nabla\cdot\left\{\mathbf{X}_{\bm{\beta}}(\mathbf{r},k) f_{\bm{\alpha}}^<(\mathbf{r})\right\}\;\mathrm{d}^3\mathbf{r} - \int_{r < a}\nabla\cdot\mathbf{X}_{\bm{\beta}}(\mathbf{r},k)f_{\bm{\alpha}}^<(\mathbf{r})\;\mathrm{d}^3\mathbf{r}\\
&= \int_0^{2\pi}\int_0^\pi\mathbf{X}_{\bm{\beta}}(a,\theta,\phi;k)f_{\bm{\alpha}}^<(a,\theta,\phi)\cdot \hat{\mathbf{r}}a^2\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi - 0\\
&= \delta_{TE}\delta_{T'E}\int_0^{2\pi}\int_0^\pi\left[\mathbf{N}_{p\ell m}(a,\theta,\phi;k)\cdot\hat{\mathbf{r}}\right]f_{p'\ell' m'}^<(a,\theta,\phi)a^2\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi\\
&= 4\pi\delta_{TE}\delta_{T'E}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}(1 - \delta_{p1}\delta_{m0})\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(ka)}{ka}a^{\ell+2}
\end{split}
\end{equation}

\begin{equation}
\begin{split}
\int_{a<r<b}\mathbf{F}_{\bm{\alpha}}(\mathbf{r})\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r} &= 4\pi\delta_{TE}\delta_{T'E}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}(1 - \delta_{p1}\delta_{m0})\frac{\ell}{\sqrt{2\ell+1}}\left(\frac{j_\ell(kb)}{kb}b^{\ell+2} - \frac{j_\ell(ka)}{ka}a^{\ell+2}\right),\\
\int_{a<r<b}\bm{\mathcal{F}}_{\bm{\alpha}}(\mathbf{r})\cdot\mathbf{L}_{\bm{\beta}}(\mathbf{r},k)\;\mathrm{d}^3\mathbf{r} &= 4\pi\delta_{TE}\delta_{T'E}\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}(1 - \delta_{p1}\delta_{m0})\frac{\ell+1}{\sqrt{2\ell+1}}\frac{1}{k}\left(\frac{1}{a^\ell}j_\ell(ka) - \frac{1}{b^\ell}j_\ell(kb)\right).
\end{split}
\end{equation}

The associated completeness relations to these orthogonality conditions can be derived from the Helmholtz expansion of $\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')$, which states that 
\begin{equation}\label{eq:vectorSphericalHarmonicCompleteness}
\begin{split}
\bm{1}_2\delta(\mathbf{r} - \mathbf{r}') &= \frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\\
&+ \frac{1}{4\pi}\sum_{\bm{\alpha}}\nabla\nabla'\left\{ f_{\bm{\alpha}}^>(\mathbf{r})f_{\bm{\alpha}}^<(\mathbf{r}')\Theta(r - r') +  f_{\bm{\alpha}}^<(\mathbf{r})f_{\bm{\alpha}}^>(\mathbf{r}')\Theta(r' - r)\right\}.
\end{split}
\end{equation}
Here, the scalar harmonics 
\begin{equation}\label{eq:scalarHarmonics}
f_{\bm{\alpha}}^i(\mathbf{r}) = \delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}P_{\ell m}(\cos\theta)S_p(m\phi)\times
\begin{cases}
r^\ell, & i = \, <,\\
\dfrac{1}{r^{\ell + 1}}, & i = \,>
\end{cases}
\end{equation}
are defined such that $\mathbf{F}_{\bm{\alpha}}(\mathbf{r}) = \nabla f_{\bm{\alpha}}^<(\mathbf{r})$ and $\bm{\mathcal{F}}_{\bm{\alpha}}(\mathbf{r}) = \nabla f_{\bm{\alpha}}^>(\mathbf{r})$.
Note that, as is clear form the derivation of Section \ref{app:helmholtzDelta}, the second term is curl-free in both the $\mathbf{r}$ and $\mathbf{r}'$ and the first term is likewise transverse in both coordinate systems.

The transverse exterior harmonics also satisfy the convenient relation at large radii
\begin{equation}
\begin{split}
\lim_{r\to\infty}\int_0^{2\pi}\int_0^\pi \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)&\times\bm{\mathcal{Y}}_{\bm{\alpha}'}(\mathbf{r},k)\cdot\hat{\mathbf{r}}r^2\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi = \\
&(1 + \delta_{p0}\delta_{m0} - \delta_{p1}\delta_{m0})2\pi\frac{(-1)^{\ell + 1}\mathrm{i}^{2\ell + 1}}{k^2}\frac{\ell(\ell + 1)}{2\ell + 1}\frac{(\ell + m)!}{(\ell - m)!}\delta_{\bm{\alpha}\bm{\alpha}'}.
\end{split}
\end{equation}

It is also useful from time to time to use the unitless regularized longitudinal harmonics
\begin{equation}
\begin{split}
\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};s) &= s^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(s - r) + s^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - s)\\
&= \nabla\left\{s^{-\ell + 1} f_{\bm{\alpha}}^<(\mathbf{r})\Theta(s - r) + s^{\ell + 2} f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - s)\right\}\\
&= s^{-\ell + 1}\mathbf{F}_{\bm{\alpha}}(\mathbf{r})\Theta(s - r) + s^{\ell + 2}\bm{\mathcal{F}}_{\bm{\alpha}}(\mathbf{r})\Theta(r - s)
\end{split}
\end{equation}
which obey the orthogonality conditions
\begin{equation}
\begin{split}
\int\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};a)\cdot\mathbf{Z}_{\bm{\beta}}(\mathbf{r};b)\;\mathrm{d}^3\mathbf{r} &= 4\pi\delta_{TE}\delta_{\bm{\alpha}\bm{\beta}}(1 - \delta_{p1}\delta_{m0})\left[\Theta(a - b)\frac{b^{\ell + 2}}{a^{\ell - 1}} + \Theta(b - a)\frac{a^{\ell + 2}}{b^{\ell - 1}}\right],\\
\int\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};s)\cdot\mathbf{Z}_{\bm{\beta}}(\mathbf{r};s)\;\mathrm{d}^3\mathbf{r} &= 4\pi s^3\delta_{TE}\delta_{\bm{\alpha}\bm{\beta}}(1 - \delta_{p1}\delta_{m0}).
\end{split}
\end{equation}















\section{Fano Diagonalization of an Oscillator Coupled to a Bath}\label{app:fanoDiagonalization}

Beginning with a Hamiltonian
\begin{equation}
\hat{H} = \hat{H}_0 + \hat{H}_\mathrm{int}
\end{equation}
where 
\begin{equation}
\begin{split}
\hat{H}_0 &= \sum_{\bm{\alpha}}\int_0^\infty\frac{1}{2}\hbar\Omega\left[\hat{a}_{\bm{\alpha}}^\dagger(k,t)\hat{a}_{\bm{\alpha}}(k,t) + \hat{a}_{\bm{\alpha}}(k,t)\hat{a}_{\bm{\alpha}}^\dagger(k,t)\right]\mathrm{d}k\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu\left[\hat{b}_{\bm{\beta}}^\dagger(k,\nu;t)\hat{b}_{\bm{\beta}}(k,\nu;t) + \hat{b}_{\bm{\beta}}(k,\nu;t)\hat{b}_{\bm{\beta}}^\dagger(k,\nu;t)\right]\mathrm{d}\nu\,\mathrm{d}k
\end{split}
\end{equation}
and
\begin{equation}
\hat{H}_\mathrm{int} = \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty \hbar g(\nu)\left[\hat{a}_{\bm{\beta}}(k,t) + \hat{a}_{\bm{\beta}}^\dagger(k,t)\right]\left[\hat{b}_{\bm{\beta}}(k,\nu;t) + \hat{b}_{\bm{\beta}}^\dagger(k,\nu;t)\right]\mathrm{d}\nu\,\mathrm{d}k,
\end{equation}
we can define the boson operators $\hat{a}_{\bm{\alpha}}(k,t)$ and $\hat{b}_{\bm{\beta}}(k,\nu;t)$ by their commutation relations
\begin{equation}
\begin{split}
\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)\right] &= \delta_{\bm{\alpha}\bm{\alpha}'}\delta(k - k'),\\
\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\right] &= \delta_{\bm{\beta}\bm{\beta}'}\delta(k - k')\delta(\nu - \nu')
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}(k',t)\right] &= 0,\\
\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}(k',\nu';t)\right] &= 0,\\
\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{b}_{\bm{\alpha}'}(k',\nu;t)\right] &= \left[\hat{a}_{\bm{\alpha}}(k,t),\hat{b}_{\bm{\alpha}'}^\dagger(k',\nu;t)\right] = 0.
\end{split}
\end{equation}
Note that commutation relations between the system's creation operators follow from the above via the Hermitian conjugate identity $[\hat{A},\hat{B}]^\dagger = -[\hat{A}^\dagger,\hat{B}^\dagger]$. Diagonalization of this system can be performed by defining new boson operators
\begin{equation}
\hat{B}_{\bm{\beta}}(k,\nu;t) = q(\nu)\hat{a}_{\bm{\beta}}(k,t) + s(\nu)\hat{a}_{\bm{\beta}}^\dagger(k,t) + \int_0^\infty\left[u(\nu,\nu')\hat{b}_{\bm{\beta}}(k,\nu';t) + v(\nu,\nu')\hat{b}_{\bm{\beta}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu'
\end{equation}
that obey commutation relations
\begin{equation}
\begin{split}
\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}^\dagger(k',\nu';t)\right] &= \delta_{\bm{\beta}\bm{\beta}'}\delta(k - k')\delta(\nu - \nu'),\\
\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}(k',\nu';t)\right] &= 0
\end{split}
\end{equation}
and provide a new Hamiltonian
\begin{equation}
\hat{H} = \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu\hat{B}_{\bm{\beta}}^\dagger(k,\nu;t)\hat{B}_{\bm{\beta}}(k,\nu;t)\;\mathrm{d}\nu\,\mathrm{d}k.
\end{equation}

The diagonalization process begins with the identification of the commutation relations
\begin{equation}
\begin{split}
\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{H}\right] &= \sum_{\bm{\alpha}'}\int_0^\infty\frac{1}{2}\hbar\Omega\left(\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)\hat{a}_{\bm{\alpha}'}(k',t)\right] + \left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}(k',t)\hat{a}_{\bm{\alpha}'}^\dagger(k',t)\right]\right)\mathrm{d}k'\\
&\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty \hbar g(\nu)\left(\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\beta}}(k',t)\right] + \left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\beta}}^\dagger(k',t)\right]\right)\\
&\qquad\qquad\times\left[\hat{b}_{\bm{\beta}}(k',\nu;t) + \hat{b}_{\bm{\beta}}^\dagger(k',\nu;t)\right]\mathrm{d}\nu\,\mathrm{d}k'\\[0.5em]
% &= \sum_{\bm{\alpha}'}\int_0^\infty\frac{1}{2}\hbar\Omega\left(\hat{a}_{\bm{\alpha}'}^\dagger(k',t)\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}(k',t)\right] + \hat{a}_{\bm{\alpha}'}(k',t)\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)\right]\right.\\
% &\qquad \left. + \hat{a}_{\bm{\alpha}'}(k',t)\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}^\dagger(k',t)\right] + \hat{a}_{\bm{\alpha}'}^\dagger(k',t)\left[\hat{a}_{\bm{\alpha}}(k,t),\hat{a}_{\bm{\alpha}'}(k',t)\right]\right)\mathrm{d}k'\\
% &\qquad + \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty \hbar g(\nu)\delta_{\bm{\alpha}\bm{\beta}}\delta(k - k')\left[\hat{b}_{\bm{\beta}}(k',\nu;t) + \hat{b}_{\bm{\beta}}^\dagger(k',\nu;t)\right]\mathrm{d}\nu\,\mathrm{d}k'\\
% &= \sum_{\bm{\alpha}'}\int_0^\infty\frac{1}{2}\hbar\Omega\left[2\hat{a}_{\bm{\alpha}'}(k',t)\delta_{\bm{\alpha}\bm{\alpha}'}\delta(k - k')\right] + \int_0^\infty \hbar g(\nu)\left[\hat{b}_{\bm{\alpha}}(k,\nu;t) + \hat{b}_{\bm{\alpha}}^\dagger(k,\nu;t)\right]\mathrm{d}\nu\\
&= \hbar\Omega\hat{a}_{\bm{\alpha}}(k,t) + \int_0^\infty \hbar g(\nu)\left[\hat{b}_{\bm{\alpha}}(k,\nu;t) + \hat{b}_{\bm{\alpha}}^\dagger(k,\nu;t)\right]\mathrm{d}\nu
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{H}\right] &= \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu'\left(\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\hat{b}_{\bm{\beta}'}(k',\nu';t)\right]\right.\\
&\qquad\qquad\left. + \left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}(k',\nu';t)\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\right]\right)\mathrm{d}\nu'\,\mathrm{d}k'\\
&\qquad + \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty \hbar g(\nu')\left[\hat{a}_{\bm{\beta}'}(k',t) + \hat{a}_{\bm{\beta}'}^\dagger(k',t)\right]\\
&\qquad\qquad\times\left(\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}(k',\nu';t)\right] + \left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\right]\right)\mathrm{d}\nu'\,\mathrm{d}k'\\[1.0em]
% &= \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu'\left(\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}(k',\nu';t)\right]\right.\\
% &\qquad\qquad + \hat{b}_{\bm{\beta}'}(k',\nu';t)\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\right]\\
% &\qquad\qquad + \hat{b}_{\bm{\beta}'}(k',\nu';t)\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\right]\\
% &\qquad\qquad \left. + \hat{b}_{\bm{\beta}'}^\dagger(k',\nu';t)\left[\hat{b}_{\bm{\beta}}(k,\nu;t),\hat{b}_{\bm{\beta}'}(k',\nu';t)\right]\right)\mathrm{d}\nu'\,\mathrm{d}k'\\
% &\qquad + \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty \hbar g(\nu')\left[\hat{a}_{\bm{\beta}'}(k',t) + \hat{a}_{\bm{\beta}'}^\dagger(k',t)\right]\delta_{\bm{\beta}\bm{\beta}'}\delta(k - k')\delta(\nu - \nu')\mathrm{d}\nu'\,\mathrm{d}k'\\
% &= \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty\frac{1}{2}\hbar\nu'2\hat{b}_{\bm{\beta}'}(k',\nu';t)\delta_{\bm{\beta}\bm{\beta}'}\delta(k - k')\delta(\nu - \nu')\;\mathrm{d}\nu'\,\mathrm{d}k' + \hbar g(\nu)\left[\hat{a}_{\bm{\beta}}(k,t) + \hat{a}_{\bm{\beta}}^\dagger(k,t)\right]\\
&= \hbar\nu\hat{b}_{\bm{\beta}}(k,\nu;t) + \hbar g(\nu)\left[\hat{a}_{\bm{\beta}}(k,t) + \hat{a}_{\bm{\beta}}^\dagger(k,t)\right].
\end{split}
\end{equation}
With these and the identity $[\hat{A},\hat{B}]^\dagger = -[\hat{A}^\dagger,\hat{B}^\dagger]$, we can calculate the commutator of our hybridized annihilation operators with both the hybridized and unhybridized forms of the Hamtilonian. In detail,
\begin{equation}\label{eq:BcommH1}
\begin{split}
\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{H}\right] &= \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty\hbar\nu'\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}^\dagger(k',\nu';t)\hat{B}_{\bm{\beta}'}(k',\nu';t)\right]\mathrm{d}\nu'\,\mathrm{d}k'\\
% &= \sum_{\bm{\beta}'}\int_0^\infty\int_0^\infty\hbar\nu'\left(\hat{B}_{\bm{\beta}'}^\dagger(k',\nu';t)\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}(k',\nu';t)\right]\right.\\
% &\qquad\left. + \hat{B}_{\bm{\beta}'}(k',\nu';t)\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}^\dagger(k',\nu';t)\right]\right)\mathrm{d}\nu'\,\mathrm{d}k'\\
% &= \sum_{\bm{\beta}}\int_0^\infty\int_0^\infty\hbar\nu'\hat{B}_{\bm{\beta}'}(k',\nu';t)\delta_{\bm{\beta}'\bm{\beta}}\delta(k - k')\delta(\nu - \nu')\;\mathrm{d}\nu'\,\mathrm{d}k'\\
% &= \hbar\nu\hat{B}_{\bm{\beta}}(k,\nu;t)\\
&= \hbar\nu\left(q(\nu)\hat{a}_{\bm{\beta}}(k,t) + s(\nu)\hat{a}_{\bm{\beta}}^\dagger(k,t) + \int_0^\infty\left[u(\nu,\nu')\hat{b}_{\bm{\beta}}(k,\nu';t) + v(\nu,\nu')\hat{b}_{\bm{\beta}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu'\right).
\end{split}
\end{equation}
and
\begin{equation}\label{eq:BcommH2}
\begin{split}
\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{H}\right] &= \left[q(\nu)\hat{a}_{\bm{\beta}}(k,t) + s(\nu)\hat{a}_{\bm{\beta}}^\dagger(k,t) + \int_0^\infty\left[u(\nu,\nu')\hat{b}_{\bm{\beta}}(k,\nu';t) + v(\nu,\nu')\hat{b}_{\bm{\beta}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu',\hat{H}\right]\\
&= q(\nu)\left(\hbar\Omega\hat{a}_{\bm{\alpha}}(k,t) + \int_0^\infty \hbar g(\nu')\left[\hat{b}_{\bm{\alpha}}(k,\nu';t) + \hat{b}_{\bm{\alpha}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu'\right)\\
&\qquad - s(\nu)\left(\hbar\Omega\hat{a}_{\bm{\alpha}}^\dagger(k,t) + \int_0^\infty \hbar g(\nu')\left[\hat{b}_{\bm{\alpha}}(k,\nu';t) + \hat{b}_{\bm{\alpha}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu'\right)\\
&\qquad + \int_0^\infty u(\nu,\nu')\left(\hbar\nu'\hat{b}_{\bm{\beta}}(k,\nu';t) + \hbar g(\nu')\left[\hat{a}_{\bm{\beta}}(k,t) + \hat{a}_{\bm{\beta}}^\dagger(k,t)\right]\right)\mathrm{d}\nu'\\
&\qquad - \int_0^\infty v(\nu,\nu')\left(\hbar\nu'\hat{b}_{\bm{\beta}}^\dagger(k,\nu';t) + \hbar g(\nu')\left[\hat{a}_{\bm{\beta}}(k,t) + \hat{a}_{\bm{\beta}}^\dagger(k,t)\right]\right)\mathrm{d}\nu'.
\end{split}
\end{equation}
Noting that each operator is linearly independent from the others, we can see that Eqs. \eqref{eq:BcommH1} and \eqref{eq:BcommH2} form a system of four equations,
\begin{equation}\label{eq:hybridizationCoefficientsSystem}
\begin{split}
\hbar\nu q(\nu) &= \hbar\Omega q(\nu) + \int_0^\infty\left[u(\nu,\nu') - v(\nu,\nu')\right]\hbar g(\nu')\mathrm{d}\nu',\\
\hbar\nu s(\nu) &= -\hbar\Omega s(\nu) + \int_0^\infty\left[u(\nu,\nu') - v(\nu,\nu')\right]\hbar g(\nu')\mathrm{d}\nu',\\
\hbar\nu u(\nu,\nu') &= \hbar g(\nu')[q(\nu) - s(\nu)] + \hbar\nu'u(\nu,\nu'),\\
\hbar\nu v(\nu,\nu') &= \hbar g(\nu')[q(\nu) - s(\nu)] - \hbar\nu'v(\nu,\nu').
\end{split}
\end{equation}
From the first two equations of Eq. \eqref{eq:hybridizationCoefficientsSystem}, we can see that
\begin{equation}
s(\nu) = \frac{\nu - \Omega}{\nu + \Omega}q(\nu).
\end{equation}
This result can be plugged into the latter two lines to produce
\begin{equation}
\begin{split}
(\nu - \nu')u(\nu,\nu') &= \frac{2\Omega}{\nu + \Omega} g(\nu')q(\nu),\\
(\nu + \nu')v(\nu,\nu') &= \frac{2\Omega}{\nu + \Omega} g(\nu')q(\nu).\\
\end{split}
\end{equation}
It will be useful later in our calculations to extend the definitions of our coefficients to negative bath frequencies, such that either equation above needs to be carefully handled where $\nu = \pm\nu'$, respectively. In these cases, the equations give no information about $u(\nu,\nu')$ or $v(\nu,\nu')$, such that we must use the formal solution $f(x) = PV\left\{1/x\right\} + \mathcal{C}\delta(x)$ to the equation $xf(x) = 1$ in order to proceed. With $PV$ indicating the Cauchy principal value and $\mathcal{C}$ a complex nonzero constant with respect to $x$, we can map this solution onto our current problem by letting $\nu$ be fixed such that 
\begin{equation}
\begin{split}
u(\nu,\nu') &= \left[PV\left\{\frac{1}{\nu - \nu'}\right\} + [y(\nu) + r]\delta(\nu - \nu')\right]\frac{2\Omega}{\nu + \Omega}g(\nu')q(\nu),\\
v(\nu,\nu') &= \left[PV\left\{\frac{1}{\nu + \nu'}\right\} + [x(\nu) + p]\delta(\nu + \nu')\right]\frac{2\Omega}{\nu + \Omega}g(\nu')q(\nu).
\end{split}
\end{equation}
Here, $x(\nu)$ and $y(\nu)$ are complex functions of $\nu$ and $r$ and $p$ are complex constants. Plugging these coefficients back into either of the first two lines of Eq. \eqref{eq:hybridizationCoefficientsSystem} produces the condition
\begin{equation}
y(\nu) + r = \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_0^\infty\left[PV\left\{\frac{1}{\nu - \nu'}\right\} - PV\left\{\frac{1}{\nu + \nu'}\right\}\right]g^2(\nu')\;\mathrm{d}\nu'
\end{equation}
under the assumption that $g^2(-\nu) = -g^2(\nu)$. The simplest combination of constants that satisfies this condition is
\begin{equation}
\begin{split}
p &= 0,\\
x(\nu) &= 0,\\
y(\nu) + r &= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_0^\infty\left[PV\left\{\frac{1}{\nu - \nu'}\right\} - PV\left\{\frac{1}{\nu + \nu'}\right\}\right]g^2(\nu')\;\mathrm{d}\nu'\\
% &= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_0^\infty PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')\;\mathrm{d}\nu' + \int_{-\nu' = 0}^{-\nu' = \infty}PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(-\nu')\;\mathrm{d}(-\nu')\\
% &= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_0^\infty PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')\;\mathrm{d}\nu' - \int_{\nu' = -\infty}^{\nu' = 0}PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')\;\mathrm{d}\nu'\\
&= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_{-\infty}^\infty PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')\;\mathrm{d}\nu',
\end{split}
\end{equation}
such that we can now represent $u(\nu,\nu')$ and $v(\nu,\nu')$ as products of known quantities times $q(\nu)$.

We are now left with the task of calculating $q(\nu)$. To do so, we can use the commutation relation
\begin{equation}
\begin{split}
\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}^\dagger(k',\nu';t)\right] &= \left[\left(q(\nu)\hat{a}_{\bm{\beta}}(k,t) + s(\nu)\hat{a}_{\bm{\beta}}^\dagger(k,t) + \int_0^\infty u(\nu,\omega)\hat{b}_{\bm{\beta}}(k,\omega;t)\;\mathrm{d}\omega\right.\right.\\
&\qquad + \left. \int_0^\infty v(\nu,\omega)\hat{b}_{\bm{\beta}}^\dagger(k,\omega;t)\;\mathrm{d}\omega \right),\left(q^*(\nu')\hat{a}_{\bm{\beta}'}^\dagger(k',\nu') + s^*(\nu')\hat{a}_{\bm{\beta}'}(k',\nu')  \vphantom{\int_0^\infty}\right.\\
&\qquad + \left.\left.\int_0^\infty\left[u^*(\nu',\omega')\hat{b}_{\bm{\beta}'}^\dagger(k',\omega';t) + v^*(\nu',\omega')\hat{b}_{\bm{\beta}'}(k',\omega';t)\right]\;\mathrm{d}\omega'\right)\right]\\
% &= [q(\nu)q^*(\nu') - s(\nu)s^*(\nu')]\delta(k - k')\delta_{\bm{\beta}\bm{\beta}'}\\
% &\qquad + \int_0^\infty\int_0^\infty [u(\nu,\omega)u^*(\nu',\omega') - v(\nu,\omega)v^*(\nu',\omega')]\delta(k - k')\delta(\omega - \omega')\delta_{\bm{\beta}\bm{\beta}'}\;\mathrm{d}\omega\,\mathrm{d}\omega'\\
&= [q(\nu)q^*(\nu') - s(\nu)s^*(\nu')]\delta(k - k')\delta_{\bm{\beta}\bm{\beta}'}\\
&\qquad + \delta(k - k')\delta_{\bm{\beta}\bm{\beta}'}\int_0^\infty\left[u(\nu,\omega)u^*(\nu',\omega) - v(\nu,\omega)v^*(\nu',\omega)\right]\mathrm{d}\omega
\end{split}
\end{equation}
Since we have demanded that
\begin{equation}
\left[\hat{B}_{\bm{\beta}}(k,\nu;t),\hat{B}_{\bm{\beta}'}^\dagger(k',\nu';t)\right] = \delta(k - k')\delta(\nu - \nu')\delta_{\bm{\beta}\bm{\beta}'},
\end{equation}
we can say
\begin{equation}\label{eq:prefactorAlgebra1}
\begin{split}
\delta(\nu - \nu') &= q(\nu)q^*(\nu') - s(\nu)s^*(\nu') + \int_0^\infty\left[u(\nu,\omega)u
^*(\nu',\omega) - v(\nu,\omega)v^*(\nu',\omega)\right]\mathrm{d}\omega\\
% &= q(\nu)q(\nu')\left[1 - \frac{(\nu - \Omega)(\nu' - \Omega)}{(\nu + \Omega)(\nu' + \Omega)}\right] + \int_0^\infty\left[PV\left\{\frac{1}{\nu - \omega}\right\} + [y(\nu) + r]\delta(\nu - \omega)\right]\frac{2\Omega}{\nu + \Omega}g(\omega)q(\nu)\\
% &\qquad\qquad\times \left[PV\left\{\frac{1}{\nu' - \omega}\right\} + [y(\nu') + r]^*\delta(\nu' - \omega)\right]\frac{2\Omega}{\nu' + \Omega}g(\omega)q(\nu')\;\mathrm{d}\omega\\
% &\qquad - \int_0^\infty PV\left\{\frac{1}{\nu + \omega}\right\}\frac{2\Omega}{\nu + \Omega}g(\omega)q(\nu)PV\left\{\frac{1}{\nu' + \omega}\right\}\frac{2\Omega}{\nu' + \Omega}g(\omega)q(\nu')\;\mathrm{d}\omega\\
% &= q(\nu)q^*(\nu')\left(\frac{2\Omega(\nu + \nu')}{(\nu + \Omega)(\nu' + \Omega)} + \int_0^\infty PV\left\{\frac{1}{(\nu - \omega)(\nu' - \omega)}\right\}\frac{4\Omega^2}{(\nu + \Omega)(\nu' + \Omega)}g^2(\omega)\;\mathrm{d}\omega\right.\\
% &\qquad - \int_0^\infty PV\left\{\frac{1}{(\nu + \omega)(\nu' + \omega)}\right\}\frac{4\Omega^2}{(\nu + \Omega)(\nu' + \Omega)}g^2(\omega)\;\mathrm{d}\omega\\
% &\qquad +  PV\left\{\frac{1}{\nu - \nu'}\right\}\frac{2\Omega}{\nu + \Omega}g(\nu')[y(\nu') + r]^*\frac{2\Omega}{\nu' + \Omega}g(\nu')\\
% &\qquad + PV\left\{\frac{1}{\nu' - \nu}\right\}\frac{2\Omega}{\nu' + \Omega}g(\nu)[y(\nu) + r]\frac{2\Omega}{\nu + \Omega}g(\nu)\\
% &\qquad\left. + \frac{4\Omega^2}{(\nu + \Omega)(\nu' + \Omega)}[y(\nu) + r][y(\nu') + r]^*g^2(\nu)\delta(\nu' - \nu) \vphantom{\int_0^\infty} \right)\\
% &= q(\nu)q^*(\nu')\left(\frac{2\Omega(\nu + \nu')}{(\nu + \Omega)(\nu' + \Omega)} + \frac{4\Omega^2g^2(\nu)}{(\nu + \Omega)(\nu' + \Omega)}[y(\nu) + r][y(\nu') + r]^*\delta(\nu - \nu') \vphantom{\int_0^\infty} \right.\\
% &\qquad + \int_0^\infty \left(PV\left\{\frac{1}{(\nu - \omega)(\nu' - \omega)}\right\} - PV\left\{\frac{1}{(\nu + \omega)(\nu' + \omega)}\right\}\right)\frac{4\Omega^2g^2(\omega)}{(\nu + \Omega)(\nu' + \Omega)}\;\mathrm{d}\omega\\
% &\qquad\left. + \frac{4\Omega^2}{(\nu + \Omega)(\nu' + \Omega)}\left[PV\left\{\frac{1}{\nu' - \nu}\right\}g^2(\nu)[y(\nu) + r] + PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')[y(\nu') + r]^*\right] \vphantom{\int_0^\infty} \right)\\
&= q(\nu)q^*(\nu')\frac{4\Omega^2}{(\nu + \Omega)(\nu' + \Omega)}\left(\frac{\nu + \nu'}{2\Omega} + g^2(\nu)[y(\nu) + r][y(\nu') + r]^*\delta(\nu - \nu') \vphantom{\int_0^\infty} \right.\\
&\qquad +  \int_{-\infty}^\infty PV\left\{\frac{1}{(\nu - \omega)(\nu' - \omega)}\right\}g^2(\omega)\;\mathrm{d}\omega\\
&\qquad\left. + \left[PV\left\{\frac{1}{\nu' - \nu}\right\}g^2(\nu)[y(\nu) + r] + PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')[y(\nu') + r]^*\right] \vphantom{\int_0^\infty} \right)
\end{split}
\end{equation}
To simplify, we can note that
\begin{equation}
PV\left\{\frac{1}{x}\right\} = \lim_{\epsilon\to0}\frac{x}{x^2 + \epsilon^2}
\end{equation}
such that $PV\{-1/x\} = -PV\{1/x\}$. Further, noting that
\begin{equation}
\begin{split}
\lim_{\epsilon\to0}\frac{\epsilon}{x^2 + \epsilon^2} &= \pi\delta(x),\\
\lim_{\epsilon\to0}\frac{x^2}{x^2 + \epsilon^2} &= 1,
\end{split}
\end{equation}
we can see that
\begin{equation}
\begin{split}
&\left[PV\left\{\frac{1}{\nu' - \nu}\right\}g^2(\nu)[y(\nu) + r] + PV\left\{\frac{1}{\nu - \nu'}\right\}g^2(\nu')[y(\nu') + r]^*\right]\\
% &= PV\left\{\frac{1}{\nu' - \nu}\right\}\left(\frac{\nu^2 - \Omega^2}{2\Omega} - \int_{-\infty}^\infty PV\left\{\frac{1}{\nu - \omega}\right\}g^2(\omega)\;\mathrm{d}\omega\right)\\
% &\qquad + PV\left\{\frac{1}{\nu - \nu'}\right\}\left(\frac{\nu'^2 - \Omega^2}{2\Omega} - \int_{-\infty}^\infty PV\left\{\frac{1}{\nu' - \omega}\right\}g^2(\omega)\;\mathrm{d}\omega\right)\\
% &= PV\left\{\frac{1}{\nu' - \nu}\right\}\frac{\nu^2 - \nu'^2}{2\Omega} - PV\left\{\frac{1}{\nu' - \nu}\right\}\int_{-\infty}^\infty\left(PV\left\{\frac{1}{\nu - \omega}\right\} - PV\left\{\frac{1}{\nu' - \omega}\right\}\right)g^2(\omega)\;\mathrm{d}\omega\\
% &= -\lim_{\epsilon\to0}\frac{\nu' - \nu}{(\nu' - \nu)^2 + \epsilon^2}\frac{(\nu' - \nu)(\nu' + \nu)}{2\Omega}\\
% &\qquad - \lim_{\epsilon\to0}\frac{\nu' - \nu}{(\nu' - \nu)^2 + \epsilon^2}\int_{-\infty}^\infty\lim_{\epsilon'\to0}\left(\frac{\nu - \omega}{(\nu - \omega)^2 + \epsilon'^2} - \frac{\nu' - \omega}{(\nu' - \omega)^2 + \epsilon'^2}\right)g^2(\omega)\;\mathrm{d}\omega\\
% &= -\frac{\nu + \nu'}{2\Omega} - \lim_{\epsilon\to0}\frac{\nu' - \nu}{(\nu' - \nu)^2 + \epsilon^2}\int_{-\infty}^\infty\lim_{\epsilon'\to0}\left(\frac{(\nu - \omega)[(\nu' - \omega)^2 + \epsilon'^2]}{[(\nu - \omega)^2 + \epsilon'^2][(\nu' - \omega)^2 + \epsilon'^2]}\right.\\
% &\qquad\left.- \frac{(\nu' - \omega)[(\nu - \omega)^2 + \epsilon'^2]}{[(\nu - \omega)^2 + \epsilon'^2][(\nu' - \omega)^2 + \epsilon'^2}\right)g^2(\omega)\;\mathrm{d}\omega\\
% &= -\frac{\nu + \nu'}{2\Omega} - \lim_{\epsilon\to 0}\frac{\nu' - \nu}{(\nu' - \nu)^2 + \epsilon^2}\int_{-\infty}^\infty\lim_{\epsilon'\to0}\left(\frac{(\nu - \omega)(\nu' - \omega)(\nu' - \nu) - \epsilon'^2(\nu' - \nu)}{[(\nu - \omega)^2 + \epsilon'^2][(\nu' - \omega)^2 + \epsilon'^2]}\right)g^2(\omega)\;\mathrm{d}\omega\\
% &= -\frac{\nu + \nu'}{2\Omega} - \int_{-\infty}^\infty PV\left\{\frac{1}{(\nu - \omega)(\nu' - \omega)}\right\}g^2(\omega)\;\mathrm{d}\omega + \int_{-\infty}^\infty\pi^2\delta(\nu - \omega)\delta(\nu' - \omega)g^2(\omega)\;\mathrm{d}\omega\\
&= -\frac{\nu + \nu'}{2\Omega} - \int_{-\infty}^\infty PV\left\{\frac{1}{(\nu - \omega)(\nu' - \omega)}\right\}g^2(\omega)\;\mathrm{d}\omega + \pi^2\delta(\nu - \nu')g^2(\nu).
\end{split}
\end{equation}
Plugging this result back into Eq. \eqref{eq:prefactorAlgebra1}, we find that
\begin{equation}
\delta(\nu - \nu') = q(\nu)q^*(\nu')\frac{4\Omega^2}{(\nu + \Omega)(\nu' + \Omega)}\left[g^2(\nu')[y(\nu') + r][y(\nu) + r]^*\delta(\nu - \nu') + \pi^2\delta(\nu - \nu')g^2(\nu) \vphantom{\sum} \right].
\end{equation}
This implies that
\begin{equation}
\begin{split}
1 = |q(\nu)|^2(|y(\nu) + r|^2 + \pi^2)\frac{4\Omega^2g^2(\nu)}{(\nu + \Omega)^2}.
\end{split}
\end{equation}
The most advantageous value of $r$ will turn out to be $r = 0$ such that
\begin{equation}
|y(\nu) + r|^2 + \pi^2 = |y(\nu) - \mathrm{i}\pi|^2
\end{equation}
and
\begin{equation}
q(\nu) = \frac{\nu + \Omega}{2\Omega g(\nu)[y(\nu) - \mathrm{i}\pi]}.
\end{equation}
Further, with
\begin{equation}
PV\left\{\frac{1}{x}\right\} = \lim_{\epsilon\to0}\frac{1}{x - \mathrm{i}\epsilon} - \mathrm{i}\pi\delta(x),
\end{equation}
we can see that
\begin{equation}
\begin{split}
y(\nu) - \mathrm{i}\pi &= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_{-\infty}^\infty\left[\lim_{\epsilon\to0}\frac{1}{\nu - \nu' - \mathrm{i}\epsilon} - \mathrm{i}\pi\delta(\nu - \nu')\right]g^2(\nu')\;\mathrm{d}\nu' - \mathrm{i}\pi\\
% &= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_{-\infty}^\infty\lim_{\epsilon\to0}\frac{1}{\nu - \nu' - \mathrm{i}\epsilon}g^2(\nu')\;\mathrm{d}\nu' - \mathrm{i}\pi + \mathrm{i}\pi\\
&= \frac{\nu^2 - \Omega^2}{2\Omega g^2(\nu)} - \frac{1}{g^2(\nu)}\int_{-\infty}^\infty\lim_{\epsilon\to0}\frac{1}{\nu - \nu' - \mathrm{i}\epsilon}g^2(\nu')\;\mathrm{d}\nu'.
\end{split}
\end{equation}
We can then define a new function
\begin{equation}
z(\nu) = 1 + \frac{2}{\Omega}\int_{-\infty}^\infty \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\mathrm{d}\omega
\end{equation}
such that
\begin{equation}
y(\nu) - \mathrm{i}\pi = \frac{\nu^2 - \Omega^2z(\nu)}{2\Omega g^2(\nu)},
\end{equation}
which allows us to finally define our expansions coefficients:
\begin{equation}
\begin{split}
q(\nu) &= \frac{(\nu + \Omega)g(\nu)}{\nu^2 - \Omega^2 z(\nu)},\\
s(\nu) &= \frac{(\nu - \Omega)g(\nu)}{\nu^2 - \Omega^2 z(\nu)},\\
u(\nu,\nu') &= \delta(\nu - \nu') + \frac{2\Omega g(\nu)}{\nu^2 - \Omega^2z(\nu)}\frac{g(\nu')}{\nu - \nu' - \mathrm{i}\epsilon},\\
v(\nu,\nu') &= \frac{2\Omega g(\nu)}{\nu^2 - \Omega^2z(\nu)}PV\left\{\frac{g(\nu')}{\nu + \nu'}\right\}.
\end{split}
\end{equation}

Finally, we also need to be able to represent our unhybridized coordinates in terms of our hybridized ones. To do this, we can see that
\begin{equation}
\begin{split}
\int_0^\infty&\left[q^*(\nu)\hat{B}_{\bm{\beta}}(k,\nu;t) - s(\nu)\hat{B}_{\bm{\beta}}^\dagger(k,\nu;t)\right]\mathrm{d}\nu = \hat{a}_{\bm{\beta}}(k,t)\int_0^\infty\left(|q(\nu)|^2 - |s(\nu)|^2\right)\mathrm{d}\nu\\
& + \hat{a}^\dagger_{\bm{\beta}}(k,t)\int_0^\infty\left[q^*(\nu)s(\nu) - s(\nu)q^*(\nu)\right]\mathrm{d}\nu + \int_0^\infty\int_0^\infty\left[q^*(\nu)u(\nu,\nu') - s(\nu)v^*(\nu,\nu')\right]\hat{b}_{\bm{\beta}}(k,\nu';t)\;\mathrm{d}\nu'\,\mathrm{d}\nu\\
& + \int_{0}^\infty\int_0^\infty\left[q^*(\nu)v(\nu,\nu') - s(\nu)u^*(\nu,\nu')\right]\hat{b}_{\bm{\beta}}^\dagger(k,\nu';t)\;\mathrm{d}\nu'\,\mathrm{d}\nu,
\end{split}
\end{equation}
wherein the terms under integration must go to zero independently for the linear combination of hybridized coordinates to return an expression solely dependent on the operator $\hat{a}_{\bm{\beta}}(k,t)$. We can first immediately see that $q^*(\nu)s(\nu) - s(\nu)q^*(\nu) = 0$. Second,
\begin{equation}\label{eq:consistencyCheckIntegral1}
\begin{split}
\int_0^\infty\left(|q(\nu)|^2 - |s(\nu)|^2\right)\mathrm{d}\nu &= \int_0^\infty\left[(\nu + \Omega)^2 - (\nu - \Omega)^2\right]\frac{g^2(\nu)}{[\nu^2 - \Omega^2z(\nu)]^2}\\
&= \int_0^\infty\frac{4\nu\Omega g^2(\nu)}{|\nu^2 - \Omega^2z(\nu)|^2}\;\mathrm{d}\nu.
\end{split}
\end{equation}
From here, we can note that integrals of the type in  Eq. \eqref{eq:consistencyCheckIntegral1} are often done via contour integration using a closed contour comprised of the real line and a semicircle of infinite radius that lies in the complex plane. Before we can construct such a contour, however, it is useful to first analyze the pole structure of the function $\nu^2 - \Omega^2z(\nu)$. Letting $\nu = a + \mathrm{i}b$, we can see that
\begin{equation}\label{eq:complexRootCheck}
\begin{split}
(a + \mathrm{i}b)^2 - \Omega^2z(a + \mathrm{i}b) &= a^2 + 2\mathrm{i}ab - b^2 - \Omega^2 - 2\Omega\int_{-\infty}^\infty \frac{g^2(\omega)}{a + \mathrm{i}b - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega\\
% &= a^2 - b^2 - \Omega^2 + 2\mathrm{i}ab - 2\Omega\int_{-\infty}^\infty \frac{g^2(\omega)([a - \omega] - \mathrm{i}[b-\epsilon])}{(a - \omega)^2 + (b - \epsilon)^2}\;\mathrm{d}\omega\\
&= a^2 - b^2 - \Omega^2 - 2\Omega\int_{-\infty}^\infty \frac{g^2(\omega)(a - \omega)}{(a - \omega)^2 + (b - \epsilon)^2}\;\mathrm{d}\omega\\
&\qquad + \mathrm{i}(b - \epsilon)\left(2a + 2\Omega\int_{-\infty}^\infty \frac{g^2(\omega)}{(a - \omega)^2 + (b - \epsilon)^2}\;\mathrm{d}\omega\right).
\end{split}
\end{equation}
There are two cases to consider here:
\begin{itemize}
    \item{
    First, we can see that the imaginary part of $\nu^2 - \Omega^2z(\nu)$ is zero when $b = \epsilon$. In this case, the function has a zero if there exists a value $a$ such that
    \begin{equation}
    a^2 - \Omega^2 - \epsilon^2 - 2\Omega\int_{-\infty}^\infty\frac{g^2(\omega)}{a - \omega}\;\mathrm{d}\omega = 0.
    \end{equation}
    For functions $g^2(\omega)$ and frequencies $a$ defined such that $g^2(a)\neq0$, the integral above is divergent and $\nu^2 - \Omega^2z(\nu)$ has no zeros with $b = \epsilon$. Otherwise, there can exist any number of zeros, depending on the functional form of $g^2(\omega)$. An important case considered by Huttner and Barnett\cite{huttner1992quantization} is the case in which $g^2(\omega)$ is only zero at $\omega = 0$. In this case, with $g^2(a) = 0$ only at $a = 0$, and only one zero of $\nu^2 - \Omega^2z(\nu)$ exists at $a + \mathrm{i}b = \mathrm{i}\epsilon$.
    }
    \item{
    Second, in the case that $b\neq\epsilon$, we can see that the imaginary part of the RHS of Eq. \eqref{eq:complexRootCheck} can be zero if the quantity inside the parentheses is zero. We will assume $b\neq\epsilon$ in the following logic. Because $g(\omega)\sim\omega\tilde{v}^2(\omega)$ and $\tilde{v}^2(\omega)$ is a nonnegative even function, the integrand of this term is always positive for positive $\omega$ and negative for negative $\omega$. Moreover, because the area under $1/[(a - \omega)^2 + (b - \epsilon)^2]$ is larger on the same side of the origin as the sign of $a$, the integral is always positive for positive $a$ and negative for negative $a$. The first term in the parentheses, $2a$, has the same signs in the same regions of the real line. Therefore, the imaginary part of $\nu^2 - \Omega^2z(\nu)$ can only be zero when $a = \mathrm{Re}\{\nu\} = 0$, such that $\nu^2 - \Omega^2z(\nu)$ can only have zeros along the imaginary axis. Further noting that $\int_{-\infty}^\infty g^2(\omega)/[\omega^2 + (b - \epsilon)^2]\;\mathrm{d}\omega \to 0$ as $\epsilon\to0$ due to the odd and even parities of the numerator and denominator, respectively, we can see that, in the limit $a\to0$, our function becomes
    \begin{equation}
    (\mathrm{i}b)^2 - \Omega^2z(\mathrm{i}b) = -(b^2 + \Omega^2) + 2\Omega\int_{-\infty}^\infty \frac{\omega g^2(\omega)}{\omega^2 + (b - \epsilon)^2}\;\mathrm{d}\omega.
    \end{equation}
    Because the first term on the RHS ($-[b^2 + \Omega^2]$) is strictly negative and the second is strictly positive, our function always has zeros at $b = \pm b_0$ except in the case where the two terms on the RHS never have equal magnitudes at any $b$. Because $b^2$ is strictly increasing with $|b|$ and $1/(\omega^2 + [b - \epsilon]^2)$ is strictly decreasing, the second term on the RHS can never be greater than the first for all $b$. Therefore, the only condition that guarantees the nonexistence of zeros is the condition that the sceond term on the RHS is always \textit{less} than the first, i.e.
    \begin{equation}
    2\Omega\int_{-\infty}^\infty\frac{\omega g^2(\omega)}{\omega^2 + (b - \epsilon)^2}\;\mathrm{d}\omega < b^2 + \Omega^2
    \end{equation}
    for all $b$. We can guarantee this condition by guaranteeing it is satisfied when the LHS is maximized and the RHS is minimized, which occurs at $b = 0$. Therefore, we can guarantee that $\nu^2 - \Omega^2z(\nu)$ has no zeros in the complex plane (other than $b = \epsilon$) only when 
    \begin{equation}\label{eq:consistencyCondition1}
    \begin{split}
    2\int_{-\infty}^\infty \frac{\omega g^2(\omega)}{\omega^2 + \epsilon^2}\;\mathrm{d}\omega &= 4\int_0^\infty PV\left\{\frac{g^2(\omega)}{\omega}\right\}\mathrm{d}\omega < \Omega.
    \end{split}
    \end{equation}
    }
\end{itemize}

Assuming that the second condition on $g(\nu)$ is satisfied, using contour integration to simplify Eq. \eqref{eq:consistencyCheckIntegral1} becomes much simpler. In more detail, since a contour comprised of the real line and a great semicircle in the lower complex half-plane contains no poles, the residue theorem tells us that
\begin{equation}
\int_{-\infty}^\infty\frac{4\Omega\nu g^2(\nu)}{|\nu^2 - \Omega ^2z(\nu)|^2}\;\mathrm{d}\nu = -\int_{C_R^-}\frac{4\Omega\nu g^2(\nu)}{|\nu^2 - \Omega ^2z(\nu)|^2}\;\mathrm{d}\nu
\end{equation}
with $C_R^-$ symbolizing the great circle portion of the contour. For our hybridization scheme to be consistent, we require the integral of Eq. \eqref{eq:consistencyCheckIntegral1} to be equal to one. Conveniently, we can see that the method of partial fractions gives
\begin{equation}
\frac{\mathrm{i}}{[x - (a + \mathrm{i}b)][x - (a - \mathrm{i}b)]} = -\frac{1}{2b}\frac{1}{x - (a + \mathrm{i}b)} + \frac{\mathrm{i}}{2b}\frac{1}{x - (a - \mathrm{i}b)}
\end{equation}
such that
\begin{equation}
\begin{split}
\frac{1}{|\nu^2 - \Omega^2z(\nu)|^2} &= \frac{1}{[\nu^2 - \Omega^2z(\nu)][\nu^2 - \Omega^2z^*(\nu)]}\\
% & = -\frac{\mathrm{i}}{2\Omega^2\mathrm{Im}\{z(\nu)\}}\frac{1}{\nu^2 - \Omega^2z(\nu)} + \frac{\mathrm{i}}{2\Omega^2\mathrm{Im}\{z(\nu)\}}\frac{1}{\nu^2 - \Omega^2z^*(\nu)}\\
% &= -\frac{\mathrm{i}}{2\Omega^2}\left(\frac{2\pi}{\Omega}g^2(\nu)\right)^{-1}\frac{1}{\nu^2 - \Omega^2z(\nu)} + -\frac{\mathrm{i}}{2\Omega^2}\left(\frac{2\pi}{\Omega}g^2(\nu)\right)^{-1}\frac{1}{\nu^2 - \Omega^2z^*(\nu)}\\
& = -\frac{\mathrm{i}}{4\pi\Omega g^2(\nu)}\frac{1}{\nu^2 - \Omega^2z(\nu)} + \frac{\mathrm{i}}{4\pi\Omega g^2(\nu)}\frac{1}{\nu^2 - \Omega^2z^*(\nu)}.
\end{split}
\end{equation}
Therefore, using the fact that $z(-\nu) = z^*(\nu)$, as is clear from the expansion
\begin{equation}
\begin{split}
z(\nu) &= 1 + \frac{2}{\Omega}\int_{-\infty}^\infty \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\mathrm{d}\omega\\
% &= 1 + \frac{2}{\Omega}\left[\int_0^\infty \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega + \int_{-\infty}^0 \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega\right]\\
% &= 1 + \frac{2}{\Omega}\left[\int_0^\infty \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega + \int_{-\omega = -\infty}^{-\omega = 0} \frac{g^2(-\omega)}{\nu + \omega - \mathrm{i}\epsilon}\;\mathrm{d}(-\omega)\right]\\
% &= 1 + \frac{2}{\Omega}\left[\int_0^\infty \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega - \int^{\omega = \infty}_{\omega = 0} \frac{g^2(\omega)}{\nu + \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega\right]\\
&= 1 + \frac{2}{\Omega}\left[\int_0^\infty \frac{g^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega + \int^{\infty}_{0} \frac{g^2(\omega)}{-\nu - \omega + \mathrm{i}\epsilon}\;\mathrm{d}\omega\right],
\end{split}
\end{equation}
we can say
\begin{equation}
\begin{split}
\int_{0}^\infty\frac{4\Omega\nu g^2(\nu)}{|\nu^2 - \Omega^2z(\nu)|^2}\;\mathrm{d}\nu &= -\frac{\mathrm{i}}{\pi}\int_0^\infty\left(\frac{\nu}{\nu^2 - \Omega^2z(\nu)} - \frac{\nu}{\nu^2 - \Omega^2z^*(\nu)}\right)\mathrm{d}\nu\\
% &= -\frac{\mathrm{i}}{\pi}\int_0^\infty\frac{\nu}{\nu^2 - \Omega^2z(\nu)}\;\mathrm{d}\nu + \frac{\mathrm{i}}{\pi}\int_{-\nu = 0}^{-\nu = \infty}\frac{(-\nu)}{(-\nu)^2 - \Omega^2z^*(-\nu)}\;\mathrm{d}(-\nu)\\
% &= -\frac{\mathrm{i}}{\pi}\int_0^\infty\frac{\nu}{\nu^2 - \Omega^2z(\nu)}\;\mathrm{d}\nu - \frac{\mathrm{i}}{\pi}\int_{-\infty}^0\frac{\nu}{\nu^2 - \Omega^2z(\nu)}\;\mathrm{d}\nu\\
% &= -\frac{\mathrm{i}}{\pi}\int_{-\infty}^\infty\frac{\nu}{\nu^2 - \Omega^2z(\nu)}\;\mathrm{d}\nu\\
% &= \frac{\mathrm{i}}{\pi}\int_{C_R^-}\frac{\nu}{\nu^2 - \Omega^2z(\nu)}\;\mathrm{d}\nu\\
&= \lim_{R\to\infty}\frac{\mathrm{i}}{\pi}\int_{-\pi}^0\frac{R\mathrm{e}^{\mathrm{i}\theta}}{R^2\mathrm{e}^{2\mathrm{i}\theta} - \Omega^2z(R\mathrm{e}^{\mathrm{i}\theta})}R\mathrm{i}\mathrm{e}^{\mathrm{i}\theta}\;\mathrm{d}\theta\\
% &= -\frac{1}{\pi}(-\pi)\\
&= 1,
\end{split}
\end{equation}
wherein we have noticed that $|z[R\exp(\mathrm{i}\theta)]|\ll R^2$ for large $R$. Therefore, as long as Eq. \eqref{eq:consistencyCondition1} is satisfied, we have
\begin{equation}
\int_{0}^\infty\left(|q_\perp(\nu)|^2 - |s_\perp(\nu)|^2\right)\mathrm{d}\nu = 1.
\end{equation}

Next, we can see that
\begin{equation}
\begin{split}
\int_0^\infty&\left[q^*(\nu)u(\nu,\nu') - s(\nu)v^*(\nu,\nu')\right]\mathrm{d}\nu = \int_0^\infty\left(\left[\delta(\nu - \nu') + \frac{2\Omega g(\nu)}{\nu^2 - \Omega^2z(\nu)}\frac{g(\nu')}{\nu - \nu' - \mathrm{i}\epsilon}\right]\frac{(\nu + \Omega)g(\nu)}{\nu^2 - \Omega^2z^*(\nu)}\right.\\
&\qquad\left. - \frac{(\nu - \Omega)g(\nu)}{\nu^2 - \Omega^2z(\nu)}\frac{2\Omega g(\nu)}{\nu^2 - \Omega^2z^*(\nu)}PV\left\{\frac{g(\nu')}{\nu + \nu'}\right\}\right)\mathrm{d}\nu\\[0.5em]
&= \\
&= 0
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\int_0^\infty&\left[q^*(\nu)v(\nu,\nu') - s(\nu)u^*(\nu,\nu')\right]\mathrm{d}\nu = \int_0^\infty\left(\frac{(\nu + \Omega)g(\nu)}{\nu^2 - \Omega^2z^*(\nu)}\frac{2\Omega g(\nu)}{\nu^2 - \Omega^2z(\nu)}PV\left\{\frac{g(\nu')}{\nu + \nu'}\right\}\right.\\
&\qquad\left. - \frac{(\nu - \Omega)g(\nu)}{\nu^2 - \Omega^2z(\nu)}\left[\delta(\nu - \nu') + \frac{2\Omega g(\nu)}{\nu^2 - \Omega^2z^*(\nu)}\frac{g(\nu')}{\nu - \nu' + \mathrm{i}\epsilon}\right]\right)\mathrm{d}\nu\\[0.5em]
&= \\
&= 0
\end{split}
\end{equation}
such that
\begin{equation}
\int_0^\infty\left[q^*(\nu)\hat{B}_{\bm{\beta}}(k,\nu;t) - s(\nu)\hat{B}_{\bm{\beta}}^\dagger(k,\nu;t)\right]\mathrm{d}\nu = \hat{a}_{\bm{\beta}}(k,t).
\end{equation}

We can repeat this process to find the representation of the bath operator $\hat{b}_{\bm{\beta}}(k,\nu;t)$ in terms of the hybrid operators. Beginning with
\begin{equation}
\begin{split}
\int_0^\infty&\left[u^*(\nu',\nu)\hat{B}_{\bm{\beta}}(k,\nu';t) - v(\nu',\nu)\hat{B}_{\bm{\beta}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu' = \hat{a}_{\bm{\beta}}(k,t)\int_0^\infty\left[q(\nu')u^*(\nu',\nu) - s^*(\nu')v(\nu',\nu)\right]\mathrm{d}\nu'\\
&\qquad + \hat{a}_{\bm{\beta}}^\dagger(k,t)\int_0^\infty\left[s(\nu')u^*(\nu',\nu) - q^*(\nu')v(\nu',\nu)\right]\mathrm{d}\nu'\\
&\qquad + \int_0^\infty\int_0^\infty\left[u^*(\nu',\nu)u(\nu',\omega) - v(\nu',\nu)v^*(\nu',\omega)\right]\hat{b}_{\bm{\beta}}(k,\omega;t)\;\mathrm{d}\nu'\,\mathrm{d}\omega\\
&\qquad + \int_0^\infty\int_0^\infty\left[u^*(\nu',\nu)v(\nu',\omega) - v(\nu',\nu)u^*(\nu',\omega)\right]\hat{b}_{\bm{\beta}}^\dagger(k,\omega;t)\;\mathrm{d}\nu'\,\mathrm{d}\omega,
\end{split}
\end{equation}
we can see that the integral prefactors of the first two terms on the RHS above are complex conjugates or reverses of integrals we already know to be zero and are thus themselves zero. The fourth term on the RHS is also zero, as is shown by
\begin{equation}
\begin{split}
\int_0^\infty&\left[u^*(\nu',\nu)v(\nu',\omega) - v(\nu',\nu)u^*(\nu',\omega)\right]\mathrm{d}\nu' = \\
&= \\
&= 0.
\end{split}
\end{equation}
Finally, the integral prefactor of the third term gives
\begin{equation}
\begin{split}
\int_0^\infty&\left[u^*(\nu',\omega)u(\nu',\omega) - v(\nu',\nu)v^*(\nu',\omega)\right]\mathrm{d}\nu' = \\
&= \\
&= \delta(\nu - \omega)
\end{split}
\end{equation}
such that
\begin{equation}
\begin{split}
\int_0^\infty\left[u^*(\nu',\nu)\hat{B}_{\bm{\beta}}(k,\nu';t) - v(\nu',\nu)\hat{B}_{\bm{\beta}}^\dagger(k,\nu';t)\right]\mathrm{d}\nu' &= \int_0^\infty\delta(\nu - \omega)\hat{b}_{\bm{\beta}}(k,\omega;t)\;\mathrm{d}\omega\\
&= \hat{b}_{\bm{\beta}}(k,\nu;t).
\end{split}
\end{equation}




\subsection{Hybridized Operator Expansion Coefficients}

The first hybridization step from the main text produces expansion coefficients
\begin{equation}
\begin{split}
q_{\perp,\parallel}(\nu) &= \frac{\nu + \Omega_{\perp,\parallel}}{2}\frac{V_{\perp,\parallel}(\nu)}{\nu^2 - \Omega_{\perp,\parallel}^2z_{\perp,\parallel}(\nu)},\\
s_{\perp,\parallel}(\nu) &= \frac{\nu - \Omega_{\perp,\parallel}}{2}\frac{V_{\perp,\parallel}(\nu)}{\nu^2 - \Omega_{\perp,\parallel}^2z_{\perp,\parallel}(\nu)},\\
u_{\perp,\parallel}(\nu,\nu') &= \delta(\nu - \nu') + \frac{\Omega_{\perp,\parallel}}{2}\frac{V_{\perp,\parallel}(\nu)}{\nu^2 - \Omega_{\perp,\parallel}^2z_{\perp,\parallel}(\nu)}\frac{V_{\perp,\parallel}(\nu')}{\nu - \nu' - \mathrm{i}\epsilon},\\
v_{\perp,\parallel}(\nu,\nu') &= \frac{\Omega_{\perp,\parallel}}{2}\frac{V_{\perp,\parallel}(\nu)}{\nu^2 - \Omega^2_{\perp,\parallel}z_{\perp,\parallel}(\nu)}PV\left\{\frac{V_{\perp,\parallel}(\nu)}{\nu + \nu'}\right\},
\end{split}
\end{equation}
with the substitutions $g(\nu)\to V_{\perp,\parallel}(\nu)/2$, $\Omega\to\Omega_{\perp,\parallel}$, and
\begin{equation}
z(\nu) \to z_{\perp,\parallel}(\nu) = 1 + \frac{1}{2\Omega_{\perp,\parallel}}\int_{-\infty}^\infty\frac{V_{\perp,\parallel}^2(\omega)}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega.
\end{equation}
The second step uses the substitutions $\Omega\to\tilde{k}c$,
\begin{equation}
\begin{split}
g(\nu)&\to\frac{\mathrm{i}}{2}\Lambda(k)\left[q_\perp(\nu) + s_\perp(\nu)\right]\\
&= \frac{\mathrm{i}}{2}\Lambda(k)\left(\frac{\Omega_\perp V_\perp(\nu)}{\nu^2 - \Omega_\perp^2z_\perp(\nu)}\right),
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
z(\nu)\to\tilde{z}(\nu) &= 1 + \frac{2}{\tilde{k}c}\int_{-\infty}^\infty\frac{\left(\frac{\mathrm{i}}{2}\Lambda(k)[q_\perp(\omega) + s_\perp(\omega)]\right)^2}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega\\
&= 1 - \frac{\Lambda^2(k)\Omega_\perp^2}{2\tilde{k}c}\int_{-\infty}^\infty\frac{V_\perp^2(\omega)}{[\omega^2 - \Omega_\perp^2z_\perp(\omega)]^2}\frac{1}{\nu - \omega - \mathrm{i}\epsilon}\;\mathrm{d}\omega
\end{split}
\end{equation}
to produce
\begin{equation}
\begin{split}
\tilde{q}(k,\nu) &= \mathrm{i}\frac{(\nu + \tilde{k}c)\Lambda(k)}{2}\frac{\Omega_\perp V_\perp(\nu)}{\nu^2 - \Omega_\perp^2z_\perp(\nu)}\frac{1}{\nu^2 - \tilde{k}^2c^2\tilde{z}(\nu)},\\
\tilde{s}(k,\nu) &= \mathrm{i}\frac{(\nu - \tilde{k}c)\Lambda(k)}{2}\frac{\Omega_\perp V_\perp(\nu)}{\nu^2 - \Omega_\perp^2z_\perp(\nu)}\frac{1}{\nu^2 - \tilde{k}^2c^2\tilde{z}(\nu)},\\[0.5em]
\tilde{u}(k;\nu,\nu') &= \delta(\nu - \nu') + \frac{2\tilde{k}c}{\nu^2 - \tilde{k}c\tilde{z}(\nu)}\frac{\mathrm{i}}{2}\Lambda(k)\frac{\Omega_\perp V_\perp(\nu)}{\nu^2 - \Omega_\perp^2z_\perp(\nu)}\frac{\mathrm{i}}{2}\Lambda(k)\frac{\Omega_\perp V_\perp(\nu')}{\nu'^2 - \Omega_\perp^2z_\perp(\nu')}\frac{1}{\nu - \nu' - \mathrm{i}\epsilon}\\
&= \delta(\nu - \nu') - \frac{\tilde{k}c\Lambda^2(k)\Omega_\perp^2}{2}\frac{V_\perp(\nu)}{\left[\nu^2 - \tilde{k}^2c^2\tilde{z}(\nu)\right][\nu^2 - \Omega_\perp^2z_\perp(\nu)][\nu'^2 - \Omega_\perp^2z_\perp(\nu')]}\frac{V_\perp(\nu')}{\nu - \nu' - \mathrm{i}\epsilon},\\[0.5em]
\tilde{v}(k;\nu,\nu') &= - \frac{\tilde{k}c\Lambda^2(k)\Omega_\perp^2}{2}\frac{V_\perp(\nu)}{\left[\nu^2 - \tilde{k}^2c^2\tilde{z}(\nu)\right][\nu^2 - \Omega_\perp^2z_\perp(\nu)][\nu'^2 - \Omega_\perp^2z_\perp(\nu')]}PV\left\{\frac{V_\perp(\nu')}{\nu + \nu'}\right\}.
\end{split}
\end{equation}



















\section{Miscellaneous Proofs and Derivations}

\subsection{Orthogonality of Transverse and Longitudinal Vector Fields}\label{sec:helmholtzOrthogonality}

A vector field $\mathbf{F}(\mathbf{r})$ can be broken into a transverse part $\mathbf{F}_\perp(\mathbf{r})$ and a longitudinal part $\mathbf{F}_\parallel(\mathbf{r})$ through Helmholtz decomposition. The divergence-free transverse part can be written as the curl of another vector field, such that $\mathbf{F}_\perp(\mathbf{r}) = \nabla\times\mathbf{A}(\mathbf{r})$. The curl-free longitudinal part can be written as the gradient of a scalar field, such that $\mathbf{F}_\parallel(\mathbf{r}) = \nabla\Phi(\mathbf{r})$. Therefore, using the identities $\nabla\cdot\{\mathbf{A}(\mathbf{r})\Phi(\mathbf{r})\} = \mathbf{A}(\mathbf{r})\cdot\nabla\Phi(\mathbf{r}) + \Phi(\mathbf{r})\nabla\cdot\mathbf{A}(\mathbf{r})$ and $\nabla\cdot\nabla\times\mathbf{A}(\mathbf{r}) = 0$, one can use integration by parts and Gauss' law to see that
\begin{equation}
\begin{split}
\int\mathbf{F}_\perp(\mathbf{r})\cdot\mathbf{F}_\parallel(\mathbf{r})\;\mathrm{d}^3\mathbf{r} &= \int\nabla\times\mathbf{A}(\mathbf{r})\cdot\nabla\Phi(\mathbf{r})\;\mathrm{d}^3\mathbf{r}\\
&=\int\left(\nabla\cdot\left\{\Phi(\mathbf{r})\nabla\times\mathbf{A}(\mathbf{r})\right\} - \Phi(\mathbf{r})\nabla\cdot\{\nabla\times\mathbf{A}(\mathbf{r})\}\right)\;\mathrm{d}^3\mathbf{r}\\
&= \oint\Phi(\mathbf{r})\nabla\times\mathbf{A}(\mathbf{r})\cdot\mathrm{d}^2\mathbf{s} + 0.
\end{split}
\end{equation}
Here, $\int\mathrm{d}^3\mathbf{r}$ represents integration over all space and $\oint\mathrm{d}^2\mathbf{s}$ represents integration across the surface at infinity wherein the surface elements $\mathrm{d}^2\mathbf{s}$ have outward-facing normal vectors. The surface integral vanishes for all $\mathbf{A}(\mathbf{r})$ and $\Phi(\mathbf{r})$ that go to zero at infinity, such that any physical vector field $\mathbf{F}(\mathbf{r})$ obeys
\begin{equation}\label{eq:helmholtzOrthogonality}
\int\mathbf{F}_\perp(\mathbf{r})\cdot\mathbf{F}_\parallel(\mathbf{r})\;\mathrm{d}^3\mathbf{r} = 0.
\end{equation}







\subsection{Helmholtz Decomposition of $\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')$ into Spherical Mode Functions}\label{app:helmholtzDelta}

Consider the Laplace equation
\begin{equation}
\nabla^2\psi_{p\ell m}(\mathbf{r},k) = -k^2\psi_{p\ell m}(\mathbf{r},k)
\end{equation}
with the corresponding boundary condition $\lim_{r\to\infty}\psi_{p\ell m}(\mathbf{r},k)\to0$. The solutions, which take the form
\begin{equation}
\psi_{p\ell m}(\mathbf{r},k) = \sqrt{K_{\ell m}}j_\ell(kr)P_{\ell m}(\cos\theta)S_p(m\phi),
\end{equation}
are therefore defined here as eigenfunctions of the Laplacian operator in spherical coordinates with eigenvalues $-k^2$. The individual factors of the eigenfunctions are defined in Appendix \ref{app:greenFuncDetails}. 

These eigenfunctions possess a special completeness property that is crucial to our ability to reconstruct complicated three-dimensional functions as linear combinations of simpler harmonic functions. To see how this completeness property arises, one can expand the Laplacian in spherical coordinates to find
\begin{equation}
\nabla^2\{\cdot\} = \frac{1}{r^2}\frac{\partial}{\partial r}\left\{r^2\frac{\partial}{\partial r}\left\{\cdot\right\}\right\} + \frac{1}{r^2\sin\theta}\frac{\partial}{\partial \theta}\left\{\sin\theta\frac{\partial}{\partial \theta}\{\cdot\}\right\} + \frac{1}{r^2\sin^2\theta}\frac{\partial^2}{\partial\phi^2}\{\cdot\}.
\end{equation}
Therefore, dropping the indices $(p,\ell,m)$ for a moment, the action of $\nabla^2 + k^2$ on any separable eigenfunction $\psi(\mathbf{r}) = R(r)\Theta(\theta)\Phi(\phi)$ can be seen to produce zero such that
\begin{equation}\label{eq:diffEqExpansion}
\begin{split}
&\left(\nabla^2 + k^2\right)\{\psi(\mathbf{r})\} = \frac{r^2}{\psi(\mathbf{r})}\left(\nabla^2 + k^2\right)\{\psi(\mathbf{r})\},\\
&= \frac{r}{R(r)}\left(k^2rR(r) + 2\frac{\partial R(r)}{\partial r} + r\frac{\partial^2 R(r)}{\partial r^2}\right) + \frac{1}{\tan(\theta)\Theta(\theta)}\left(\frac{\partial\Theta(\theta)}{\partial\theta} + \frac{\partial^2\Theta(\theta)}{\partial\theta^2}\right) + \frac{1}{\sin^2(\theta)\Phi(\phi)}\frac{\partial^2\Phi(\phi)}{\partial\phi^2}\\
&= 0.
\end{split}
\end{equation}
For any fixed values of $\theta$ and $\phi$, the above differential equation in $r$ is a particular form of Sturm-Liouville equation known as the spherical Bessel equation. As is discussed for the one-dimensional case in Titchmarsh,\cite{titchmarsh1946eigenfunction} solutions to Sturm-Liouville equations with specified boundary conditions form complete sets of orthogonal eigenfunctions from which any twice-differentiable function can be exactly reconstructed within the boundaries. Therefore, the set of functions $\{R(r)\}$ that are solutions to the above equation can completely describe any one-dimensional function of $r$ on the interval $(-\infty,\infty)$.

The other two terms of Eq. \eqref{eq:diffEqExpansion} also form Sturm-Liouville equations, the associated Legendre and harmonic differential equations, when only $\theta$ or $\phi$ is allowed to vary, respectively. Therefore, $\{\Theta(\theta)\}$ and $\{\Phi(\phi)\}$ are complete sets on $\theta\in[0,\pi)$ and $\phi\in[0,2\pi)$, respectively, and the eigenfunctions $\{\psi(\mathbf{r})\}$ are guaranteed to be able to reproduce any twice-differentiable scalar field in $\mathbb{R}^3$.

To extend our logic to the reconstruction of vector fields, we can note that three sets of vector eigenfunctions $\hat{\mathbf{e}}_i\psi_{p\ell m}(\mathbf{r},k)$ with $i = \{x,y,z\}$ can be defined that clearly are able to reproduce any vector field on $\mathbb{R}^3$. More precisely, these three sets of vector eigenfunctions are non-collinear\cite{stratton1941electromagnetic} and contain independent eigenfunctions of (the Sturm-Liouville operator) $\nabla^2$. The first property can be deduced from the nonzero cross-products between any two eigenfunctions from two different sets, and the second property can be deduced from the fact that $\nabla^2$ and $\hat{\mathbf{e}}_i$ commute. In other words, $\nabla^2\{\hat{\mathbf{e}}_i\psi_{p\ell m}(\mathbf{r},k)\} = \hat{\mathbf{e}}_i\nabla^2\{\psi_{p\ell m}(\mathbf{r},k)\} = -k^2\hat{\mathbf{e}}_i\psi_{p\ell m}(\mathbf{r},k)$.

Because Cartesian vector functions are inconvenient to use for problems with spherical symmetry, Hansen\cite{hansen1935new} invented, as an alternative, the three functions $\mathbf{L}_{p\ell m}(\mathbf{r},k)$, $\mathbf{M}_{p\ell m}(\mathbf{r},k)$, and $\mathbf{N}_{p\ell m}(\mathbf{r},k)$ as an alternate basis. These three functions satisfy the two criteria above, the latter of which can be directly confirmed via $\nabla^2\{\nabla\psi_{p\ell m}(\mathbf{r},k)\} = \nabla\{\nabla^2\psi_{p\ell m}(\mathbf{r},k)\}$, $\nabla^2\{\nabla\times\{\mathbf{r}\psi_{p\ell m}(\mathbf{r},k)\}\} = \nabla\times\{\mathbf{r}\nabla^2\psi_{p\ell m}(\mathbf{r},k)\}$, and $\nabla^2\{\nabla\times\nabla\times\{\mathbf{r}\psi_{p\ell m}(\mathbf{r},k)\}\} = \nabla\times\nabla\times\{\mathbf{r}\nabla^2\psi_{p\ell m}(\mathbf{r},k)\}$. The non-collinearity of the three sets of functions can be seen by taking the cross-product of any two basis functions and noting that it is nonzero. 

We are thus free to expand in terms of $\mathbf{L}_{p\ell m}(\mathbf{r},k)$, $\mathbf{M}_{p\ell m}(\mathbf{r},k)$, and/or $\mathbf{N}_{p\ell m}(\mathbf{r},k)$ any of the vector fields of our system that are smooth throughout the universe. As a matter of clarity, it is useful to show that we can expand the dyadic Dirac delta in terms of these basis functions as well. Assuming the Dirac delta to be the sharp limit of a smooth bump function, we can let 
\begin{equation}
\bm{1}_2\delta(\mathbf{r} - \mathbf{r}') = \sum_{p\ell m}\int_0^\infty\left[\mathbf{A}_{p\ell m}(\mathbf{r}',k)\mathbf{L}_{p\ell m}(\mathbf{r},k) + \mathbf{B}_{p\ell m}(\mathbf{r}',k)\mathbf{M}_{p\ell m}(\mathbf{r},k) + \mathbf{C}_{p\ell m}(\mathbf{r}',k)\mathbf{N}_{p\ell m}(\mathbf{r},k)\right]\mathrm{d}k,
\end{equation}
wherein $\mathbf{A}_{p\ell m}(\mathbf{r}',k)$, $\mathbf{B}_{p\ell m}(\mathbf{r}',k)$, and $\mathbf{C}_{p\ell m}(\mathbf{r}',k)$ are unknown vector fields. Using the orthogonality condition of Eq. \eqref{eq:longitudinalHarmonicOrthogonality}, we can see that
\begin{equation}
\begin{split}
\int\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\cdot\mathbf{L}_{p'\ell'm'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r} &= \mathbf{L}_{p'\ell'm'}(\mathbf{r}',k')\\
&= \sum_{p\ell m}\int_0^\infty\int\mathbf{A}_{p\ell m}(\mathbf{r}',k)\mathbf{L}_{p\ell m}(\mathbf{r},k)\cdot\mathbf{L}_{p'\ell'm'}(\mathbf{r},k')\;\mathrm{d}^3\mathbf{r}\,\mathrm{d}k\\
&= \sum_{p\ell m}\int_0^\infty\mathbf{A}_{p\ell m}(\mathbf{r}',k)\frac{2\pi^2}{k^2}\delta(k - k')(1 - \delta_{p0}\delta_{m0})\delta_{pp'}\delta_{\ell\ell'}\delta_{mm'}\\
&= \frac{2\pi^2}{k'^2}(1 - \delta_{p'1}\delta_{m'0})\mathbf{A}_{p'\ell'm'}(\mathbf{r}',k').
\end{split}
\end{equation}
Further, with $\mathbf{L}_{p'\ell'm'}(\mathbf{r}',k') = \mathbf{L}_{p'\ell'm'}(\mathbf{r}',k')(1 - \delta_{p'1}\delta_{m'0})$, we can see that
\begin{equation}
\mathbf{A}_{p\ell m}(\mathbf{r}',k) = \frac{k^2}{2\pi^2}\mathbf{L}_{p\ell m}(\mathbf{r}',k).
\end{equation}
Repeating this process for the transverse vector spherical harmonics using \eqref{eq:vectorSphericalHarmonicOrthogonality}, we can see that
\begin{equation}
\begin{split}
\mathbf{B}_{p\ell m}(\mathbf{r}',k) &= \frac{k^2}{2\pi^2}\mathbf{M}_{p\ell m}(\mathbf{r}',k),\\
\mathbf{C}_{p\ell m}(\mathbf{r}',k) &= \frac{k^2}{2\pi^2}\mathbf{N}_{p\ell m}(\mathbf{r}',k),
\end{split}
\end{equation}
such that
\begin{equation}\label{eq:dyadicDiracDelta}
\bm{1}_2\delta(\mathbf{r} - \mathbf{r}') = \sum_{p\ell m}\int_0^\infty\frac{k^2}{2\pi^2}\left[\mathbf{L}_{p\ell m}(\mathbf{r}',k)\mathbf{L}_{p\ell m}(\mathbf{r},k) + \mathbf{M}_{p\ell m}(\mathbf{r}',k)\mathbf{M}_{p\ell m}(\mathbf{r},k) + \mathbf{N}_{p\ell m}(\mathbf{r}',k)\mathbf{N}_{p\ell m}(\mathbf{r},k)\right]\mathrm{d}k.
\end{equation}
This in turn can be separated into its transverse and longitudinal parts as
\begin{equation}\label{eq:dyadicDiracDeltaSeparated}
\begin{split}
\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp &=  \sum_{p\ell m}\int_0^\infty\frac{k^2}{2\pi^2}\left[\mathbf{M}_{p\ell m}(\mathbf{r}',k)\mathbf{M}_{p\ell m}(\mathbf{r},k) + \mathbf{N}_{p\ell m}(\mathbf{r}',k)\mathbf{N}_{p\ell m}(\mathbf{r},k)\right]\mathrm{d}k,\\
\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\parallel &= \sum_{p\ell m}\int_0^\infty\frac{k^2}{2\pi^2}\mathbf{L}_{p\ell m}(\mathbf{r}',k)\mathbf{L}_{p\ell m}(\mathbf{r},k)\;\mathrm{d}k.\\
\end{split}
\end{equation}

Finally, we also deal in this manuscript with vector fields that are smooth within a finite radial boundary $a$ but are discontinuous across the boundary. This problem can be attacked in two ways, both of which will produce the same outcome. The more direct but mathematically complicated route is to represent the sharp boundary as the steep limit of a sigmoid function. This route has nice symmetry with our previous discussion as it involves the expansion of the vector field in the full eigenfunction basis of $\mathbb{R}^3$. However, it will require numerical evaluation of complicated overlap integrals involving spherical Bessel functions and will not, in general, produce expressions with advantageous explanatory power.

The second route begins by setting our Sturm-Liouville boundary conditions such that we only use a subset of the total number vector spherical harmonics. More specifically, we will only use vector spherical harmonics in our expansion that have one or more components that go to zero at $r = a$, with the precise boundary requirements set by physical arguments. Because our boundary condition is a function of $r$, it is the radial index $k$ that will be restricted to certain values, and the completeness of the harmonic expansion of the sphere will depend on whether a set of vector harmonics with the ``allowed'' values of $k$ can be generated from a restricted set of scalar eigenfunctions $\psi_{p\ell m}(\mathbf{r},k)$ that is nonetheless complete within $r < a$.

Conveniently, this set of scalar eigenfunctions is simple to define. The physical boundary conditions on the vector harmonics, as described in the main text, require their boundary-parallel components to go to zero at $r = a$ and their radial components to be nonzero. This behavior can be reproduced from scalar eigenfunctions $\psi_{p\ell m}(\mathbf{r},k_{\ell n})$, where $k_{\ell n}a$ is the $n^\mathrm{th}$ nonzero root of the $\ell^\mathrm{th}$ spherical Bessel function. These scalar eigenfunctions therefore all go to zero at the boundary. This is a valid Sturm-Liouville boundary condition, such that they form a complete set within the sphere. Therefore, we can rebuild our Dirac delta from the discrete set of vector harmonics that have the permitted wavenumbers $k_{\ell n}$. Explicitly,
\begin{equation}
\begin{split}
\bm{1}_2\Theta(a - r)\delta(\mathbf{r} - \mathbf{r}') &= \Theta(a - r)\sum_{p\ell m n}\left[\mathbf{A}_{p\ell mn}(\mathbf{r}')\mathbf{L}_{p\ell m}(\mathbf{r},k_{\ell n})\right.\\
&\qquad\left. + \mathbf{B}_{p\ell mn}(\mathbf{r}')\mathbf{M}_{p\ell m}(\mathbf{r},k_{\ell n}) + \mathbf{C}_{p\ell mn}(\mathbf{r}')\mathbf{N}_{p\ell m}(\mathbf{r},k_{\ell n})\right].
\end{split}
\end{equation}
Projecting as before, we can see that, by the orthonormality conditions of Appendix \ref{app:greenFuncDetails},
\begin{equation}
\begin{split}
\mathbf{A}_{p\ell mn}(\mathbf{r}') &= \frac{1}{2\pi a^3j_{\ell + 1}^2(k_{\ell n}a)}\mathbf{L}_{p\ell m}(\mathbf{r},k_{\ell n}),\\
\mathbf{B}_{p\ell mn}(\mathbf{r}') &= \frac{1}{2\pi a^3j_{\ell + 1}^2(k_{\ell n}a)}\mathbf{M}_{p\ell m}(\mathbf{r},k_{\ell n}),\\
\mathbf{C}_{p\ell mn}(\mathbf{r}') &= \frac{1}{2\pi a^3j_{\ell + 1}^2(k_{\ell n}a)}\mathbf{N}_{p\ell m}(\mathbf{r},k_{\ell n}).
\end{split}
\end{equation}
Therefore,
\begin{equation}
\begin{split}
&\bm{1}_2\Theta(a - r)\delta(\mathbf{r} - \mathbf{r}') = \Theta(a - r)\sum_{p\ell m n}\frac{1}{2\pi a^3j_{\ell + 1}^2(k_{\ell n}a)}\\
&\qquad\times\left[\mathbf{L}_{p\ell m}(\mathbf{r}',k_{\ell n})\mathbf{L}_{p\ell m}(\mathbf{r},k_{\ell n}) + \mathbf{M}_{p\ell m}(\mathbf{r}',k_{\ell n})\mathbf{M}_{p\ell m}(\mathbf{r},k_{\ell n}) + \mathbf{N}_{p\ell m}(\mathbf{r}',k_{\ell n})\mathbf{N}_{p\ell m}(\mathbf{r},k_{\ell n})\right].
\end{split}
\end{equation}












\subsection{Useful Orthogonality Relations}\label{sec:simpleOrthogonality}

A list of the useful and simple orthogonality relations useful to our calculations begins with the angular integral
\begin{equation}
\int_0^{2\pi}S_p(m\phi)S_{p'}(m'\phi)\;\mathrm{d}\phi = \pi(1 + \delta_{p0}\delta_{m0} - \delta_{p1}\delta_{m0})\delta_{pp'}\delta_{mm'},
\end{equation}
wherein the convention is used that the replacements $p + 2n\to 0$ for even $p$ and $p + 2n\to1$ for odd $p$ are taken automatically (here $n = 0,1,2,\ldots$ is a nonnegative integer). Similarly, $p + 2n + 1\to 1$ for even $p$ and $p + 2n + 1\to0$ for odd $p$ are implied. 

Two more angular integrals, this time in $\theta$, are of use:
\begin{equation}
\int_0^\pi P_{\ell m}(\cos\theta)P_{\ell'm}(\cos\theta)\sin\theta\;\mathrm{d}\theta = \frac{2}{(2\ell + 1)}\frac{(\ell + m)!}{(\ell - m)!}\delta_{\ell\ell'}\\
\end{equation}
and
\begin{equation}
\begin{split}
\int_0^\pi\left(\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}\frac{\partial P_{\ell'm}(\cos\theta)}{\partial\theta}\right. &+ \left.m^2\frac{P_{\ell m}(\cos\theta)P_{\ell'm}(\cos\theta)}{\sin^2\theta}\right)\sin\theta\;\mathrm{d}\theta\\
&= \int_0^\pi\ell(\ell + 1)P_{\ell m}(\cos\theta)P_{\ell'm}(\cos\theta)\sin\theta\;\mathrm{d}\theta\\
&= \frac{2\ell(\ell + 1)}{(2\ell + 1)}\frac{(\ell + m)!}{(\ell - m)!}\delta_{\ell\ell'},
\end{split}
\end{equation}
for $\ell > 0$, $0 \leq m \leq \ell$. The second identity can be derived using the identity
\begin{equation}
\begin{split}
&\frac{\partial}{\partial\theta}\left\{\sin\theta\frac{\partial P_{\ell'm}(\cos\theta)}{\partial\theta}P_{\ell m}(\cos\theta) + \sin\theta\frac{\partial P_{\ell m}(\cos\theta)}{\partial \theta}P_{\ell' m}(\cos\theta)\right\}\\
&= 2\sin\theta\left(\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}\frac{\partial P_{\ell'm}(\cos\theta)}{\partial\theta} + m^2\frac{P_{\ell m}(\cos\theta)P_{\ell'm}(\cos\theta)}{\sin^2\theta}\right) - 2\ell(\ell + 1)\sin\theta P_{\ell m}(\cos\theta)P_{\ell' m}(\cos\theta),
\end{split}
\end{equation}
which can in turn be derived from the generalized Legendre equation defining the functions $P_{\ell m}(\cos\theta)$,
\begin{equation}
\frac{\partial^2}{\partial\theta^2}P_{\ell m}(\cos\theta) + \frac{\cos\theta}{\sin\theta}\frac{\partial}{\partial\theta}P_{\ell m}(\cos\theta) + \left(\ell(\ell + 1) - \frac{m^2}{\sin^2\theta}\right)P_{\ell m}(\cos\theta) = 0.
\end{equation}

Further,
\begin{equation}
\begin{split}
\int_0^\pi\left[\frac{P_{\ell m}(\cos\theta)}{\sin\theta}\frac{\partial P_{\ell'm}(\cos\theta)}{\partial\theta} + \frac{P_{\ell'm}(\cos\theta)}{\sin\theta}\frac{\partial P_{\ell m}(\cos\theta)}{\partial\theta}\right]\sin\theta\,\mathrm{d}\theta &= \int_0^\pi\frac{\partial}{\partial \theta}\left\{P_{\ell m}(\cos\theta)P_{\ell' m}(\cos\theta)\right\}\mathrm{d}\theta\\
&= \left.P_{\ell m}(\cos\theta)P_{\ell' m}(\cos\theta)\right|_0^\pi\\
&= 2\delta_{m0}\delta_{\mathrm{par}(\ell),1},
\end{split}
\end{equation}
where
\begin{equation}
\mathrm{par}(n) = 
\begin{cases}
0, & |n|\;\mathrm{even},\\
1, & |n|\;\mathrm{odd}
\end{cases}
\end{equation}
is the parity function that returns 0 for even integers and 1 for odd integers.








\subsection{Useful recursion relations}
It is sometimes useful to know that
\begin{equation}
\begin{split}
z_\ell(x) &= \frac{x}{2\ell + 1}\left[z_{\ell - 1}(x) + z_{\ell + 1}(x)\right],\\
\frac{\partial z_\ell(x)}{\partial x} &= z_{\ell - 1}(x) - \frac{\ell + 1}{x}z_\ell(x),\\
\frac{\partial z_\ell(x)}{\partial x} &= -z_{\ell + 1}(x) + \frac{\ell}{x}z_\ell(x),
\end{split}
\end{equation}
and
\begin{equation}
\frac{\partial\{xz_\ell(x)\}}{\partial x} = \frac{x}{2\ell + 1}\left[(\ell + 1)z_{\ell - 1}(x) - \ell z_{\ell + 1}(x)\right]
\end{equation}
where $z_\ell(x)$ is any spherical Bessel or Hankel function. These identities can be combined to give
\begin{equation}
\begin{split}
\ell(\ell + 1)\frac{w_\ell(x_1)z_\ell(x_2)}{x_1x_2} &+ \frac{1}{x_1x_2}\frac{\partial\{x_1w_\ell(x_1)\}}{\partial x_1}\frac{\partial\{x_2z_\ell(x_2)\}}{\partial x_2}\\
&= \frac{1}{2\ell + 1}\left[(\ell + 1)w_{\ell - 1}(x_1)z_{\ell - 1}(x_2) + \ell w_{\ell + 1}(x_1)z_{\ell + 1}(x_2)\right]
\end{split}
\end{equation}
and
\begin{equation}
\frac{\partial z_\ell(x_1)}{\partial x_1}\frac{\partial w_\ell(x_2)}{\partial x_2} = \frac{\ell + 1}{2\ell + 1}z_{\ell + 1}(x_1)w_{\ell + 1}(x_2) + \frac{\ell}{2\ell + 1}z_{\ell - 1}(x_1)w_{\ell - 1}(x_2) - \frac{\ell(\ell + 1)}{x_1x_2}z_\ell(x_1)w_\ell(x_2)
\end{equation}
where $w_\ell$ and $z_\ell$ are any two spherical Bessel or Hankel functions.









\subsection{Finite radial integrals of products of spherical Bessel functions}\label{sec:finiteRadialIntegrals}

Letting $z_\ell(x)$ be a spherical Bessel ($j_\ell(x)$, $y_\ell(x)$) or Hankel ($h_\ell^{(1)}(x)$, $h_\ell^{(2)}(x)$) function, one can see that the Sturm-Liouville equation
\begin{equation}
\frac{\mathrm{d}}{\mathrm{d}r}\left\{r^2\frac{\mathrm{d}z_\ell(kr)}{\mathrm{d}r}\right\} - \ell(\ell + 1)z_\ell(kr) = -k^2r^2z_\ell(kr). 
\end{equation} 
One can then see that a function
\begin{equation}
v_\ell(r) = r^2\left[\frac{\mathrm{d}z_{1\ell}(kr)}{\mathrm{d}r}z_{2\ell}(k'r) - z_{1\ell}(kr)\frac{\mathrm{d}z_{2\ell}(k'r)}{\mathrm{d}r}\right]
\end{equation}
has a derivative
\begin{equation}
\begin{split}
\frac{\mathrm{d}v_\ell(r)}{\mathrm{d}r} &= \frac{\mathrm{d}}{\mathrm{d}r}\left\{r^2\frac{\mathrm{d}z_{1\ell}(kr)}{\mathrm{d}r}\right\}z_{2\ell}(k'r) - z_{1\ell}(kr)\frac{\mathrm{d}}{\mathrm{d}r}\left\{r^2\frac{\mathrm{d}z_{2\ell}(k'r)}{\mathrm{d}r}\right\}\\
&= r^2(k'^2 - k^2)z_{1\ell}(kr)z_{2\ell}(k'r)
\end{split}
\end{equation}
where $z_{1\ell}$ and $z_{2\ell}$ can be any two spherical Bessel or Hankel functions. Therefore,
\begin{equation}
\begin{split}
\int_a^bz_{1\ell}(kr)z_{2\ell}(k'r)r^2 &= \left.\frac{1}{k'^2 - k^2}v_\ell(r)\right|_a^b\\
&= \left.\frac{r^2}{k'^2 - k^2}\left[\frac{\mathrm{d}z_{1\ell}(kr)}{\mathrm{d}r}z_{2\ell}(k'r) - z_{1\ell}(kr)\frac{\mathrm{d}z_{2\ell}(k'r)}{\mathrm{d}r}\right]\right|_a^b.
\end{split}
\end{equation}
We can use the identity 
\begin{equation}
\frac{\mathrm{d}z_\ell(kr)}{\mathrm{d}r} = k\left[z_{\ell-1}(kr) - \frac{\ell + 1}{kr}z_\ell(kr)\right]
\end{equation}
to see that
\begin{equation}
\begin{split}
\frac{\mathrm{d}z_{1\ell}(kr)}{\mathrm{d}r}z_{2\ell}(k'r) - z_{1\ell}(kr)\frac{\mathrm{d}z_{2\ell}(k'r)}{\mathrm{d}r} &= k\left[z_{1,\ell-1}(kr) - \frac{\ell + 1}{kr}z_{1\ell}(kr)\right]z_{2\ell}(k'r)\\
&\qquad- z_{1\ell}(kr)k'\left[z_{2,\ell-1}(k'r) - \frac{\ell + 1}{k'r}z_{2\ell}(k'r)\right]\\[0.5em]
&= kz_{1,\ell-1}(kr)z_{2\ell}(k'r) - k'z_{2,\ell-1}(k'r)z_{1\ell}(kr).
\end{split}
\end{equation}
Therefore, we can simplify our integral to
\begin{equation}
\int_a^bz_{1\ell}(kr)z_{2\ell}(k'r)r^2 = \left.\frac{r^2}{k'^2 - k^2}\left[kz_{1,\ell - 1}(kr)z_{2\ell}(k'r) - k'z_{2,\ell - 1}(k'r)z_{1\ell}(kr)\right]\right|_a^b.
\end{equation}








\subsection{Helmholtz expansion of piecewise-truncated vector spherical harmonics}\label{sec:truncatedHarmonicExpansion}

A useful mathematical exercise that appears in the treatment of quantum optical problems using dyadic Green's functions in spherical coordinates is the expansion of functions of the types
\begin{equation}
\begin{split}
&\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(\pm r\mp r'),\\
&\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\Theta(\pm r\mp r')
\end{split}
\end{equation}
into separated products of functions of the variables $r$ and $r'$. To do so, we can use the expansion of the dyadic Dirac delta $\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')$ from Appendix \ref{app:helmholtzDelta}. This allows us to say
\begin{equation}\label{eq:truncatedVectorHarmonicExpansion1}
\begin{split}
\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r') &= \int\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\Theta(s - r')\cdot\bm{1}_2\delta(\mathbf{s} - \mathbf{r})\;\mathrm{d}^3\mathbf{s}\\
&= \int\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\Theta(s - r')\cdot\left[\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\beta}}\kappa^2\mathbf{X}_{\bm{\beta}}(\mathbf{s},\kappa)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\right.\\
&\qquad\left.+ \frac{1}{4\pi}\sum_{\bm{\beta}}\nabla_\mathbf{r}\nabla_\mathbf{s}\left\{ f_{\bm{\beta}}^>(\mathbf{s})f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) +  f_{\bm{\beta}}^<(\mathbf{s})f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right\}\right]\mathrm{d}^3\mathbf{s}.\\
\end{split}
\end{equation}
We can evaluate the projection integrals using the orthogonality identities of Eqs. \eqref{eq:vectorSphericalHarmonicOrthogonalityConditionFinite} and \eqref{eq:angularMixedOrthogonalityNf} as well as the generalizations of the product rule and divergence theorem
\begin{equation}\label{eq:generalizedProductRule}
g(\mathbf{r})\nabla\cdot\left\{\mathbf{F}(\mathbf{r})f(\mathbf{r})\mathbf{c}\right\} = \left[\mathbf{F}(\mathbf{r})\cdot\nabla \left\{f(\mathbf{r})\mathbf{c}\right\} + \nabla\cdot\mathbf{F}(\mathbf{r})f(\mathbf{r})\mathbf{c}\right]g(\mathbf{r})
\end{equation}
and
\begin{equation}\label{eq:generalizedDivergenceTheorem}
\begin{split}
\int_\mathbb{V}\nabla\cdot\left\{\mathbf{F}(\mathbf{r})f(\mathbf{r})\mathbf{c}\right\}\;\mathrm{d}^3\mathbf{r} &= \mathbf{c}\int_\mathbb{V}\nabla\cdot\left\{\mathbf{F}(\mathbf{r})f(\mathbf{r})\right\}\;\mathrm{d}^3\mathbf{r}\\
&= \mathbf{c}\oint_{\partial\mathbb{V}} f(\mathbf{r})\mathbf{F}(\mathbf{r})\cdot\mathrm{d}^2\mathbf{a},
\end{split}
\end{equation} 
respectively. Explicitly, we can see that
\begin{equation}
\int\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\cdot\mathbf{X}_{\bm{\beta}}(\mathbf{s},\kappa)\Theta(s - r')\;\mathrm{d}^3\mathbf{s} = 4\pi(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\beta}}R^\ll_{T\ell}(k,\kappa;r',\infty)
\end{equation}
such that the transverse part of the truncated vector harmonics are
\begin{equation}
\begin{split}
\left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r')\right]^\perp &= \int\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\Theta(s - r')\cdot\frac{1}{2\pi^2}\sum_{\bm{\beta}}\int_0^\infty\kappa^2\mathbf{X}_{\bm{\beta}}(\mathbf{s},\kappa)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\,\mathrm{d}^3\mathbf{s}\\
&= \sum_{\bm{\beta}}\int_0^\infty \frac{\kappa^2}{2\pi^2}4\pi(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\beta}}R_{T\ell}^\ll(k,\kappa;r',\infty)\mathbf{X}_{\bm{\beta}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty \kappa^2R_{T\ell}^\ll(k,\kappa;r',\infty)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa.
\end{split}
\end{equation}


The longitudinal parts are more difficult to calculate, but we can start by passing through the $\mathbf{r}$-gradient $\nabla_{\mathbf{r}}$ in eq. \eqref{eq:truncatedVectorHarmonicExpansion1} such that
\begin{equation}
\begin{split}
&\left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r')\right]^\parallel\\
&\quad = \int\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\Theta(s - r')\cdot\frac{1}{4\pi}\sum_{\bm{\beta}}\nabla_{\mathbf{s}}\nabla_{\mathbf{r}}\left\{f_{\bm{\beta}}^>(\mathbf{s}) f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right\}\mathrm{d}^3\mathbf{s}\\
&\quad = \int\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\Theta(s - r')\cdot\frac{1}{4\pi}\sum_{\bm{\beta}}\nabla_{\mathbf{s}}\left\{f_{\bm{\beta}}^>(\mathbf{s})\nabla_{\mathbf{r}} f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})\nabla_{\mathbf{r}}f^>(\mathbf{r})\Theta(r - s)\right\}\mathrm{d}^3\mathbf{s},
\end{split}
\end{equation}
wherein terms proportional to gradients of the Heaviside functions cancel as shown in Appendix \ref{app:helmholtzDelta}. From here, we can use the generalized product rule of Eq. \eqref{eq:generalizedProductRule} to replace terms that go like $\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\cdot\nabla_{\mathbf{s}}\{f_{\bm{\beta}}^i(\mathbf{s})\nabla_{\mathbf{r}}f^j(\mathbf{r})\Theta(\pm r \mp s)\}$ with terms that involve divergences, such that
\begin{equation}
\begin{split}
\int&\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\Theta(s - r')\cdot\frac{1}{4\pi}\sum_{\bm{\beta}}\nabla_{\mathbf{s}}\left\{f_{\bm{\beta}}^>(\mathbf{s})\nabla_{\mathbf{r}} f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right\}\mathrm{d}^3\mathbf{s}\\
&= \frac{1}{4\pi}\sum_{\bm{\beta}}\int\Theta(s - r')\nabla_{\mathbf{s}}\cdot\left\{\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\left[f_{\bm{\beta}}^>(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right]\right\}\mathrm{d}^3\mathbf{s}\\
&\qquad- \frac{1}{4\pi}\sum_{\bm{\beta}}\int\Theta(s - r')\nabla_{\mathbf{s}}\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\left[f_{\bm{\beta}}^>(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right]\mathrm{d}^3\mathbf{s}.
\end{split}
\end{equation}
Because the transverse vector spherical harmonics $\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)$ are transverse in $\mathbf{s}$, the second term on the right-hand side above is zero. We can then use the generalized divergence theorem of Eq. \eqref{eq:generalizedDivergenceTheorem} to replace the first term of the right-hand side with an integral across the boundaries of the region set by $\Theta(s - r')$:
\begin{equation}
\begin{split}
\frac{1}{4\pi}&\sum_{\bm{\beta}}\int\Theta(s - r')\nabla_{\mathbf{s}}\cdot\left\{\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\left[f_{\bm{\beta}}^>(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right]\right\}\mathrm{d}^3\mathbf{s}\\
&= \frac{1}{4\pi}\sum_{\bm{\beta}}\oint_{\substack{\partial\mathbb{V}_{s\to r'}\\ + \partial\mathbb{V}_{s\to\infty}}}\mathrm{d}^2\mathbf{a}\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{s},k)\left[f_{\bm{\beta}}^>(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\beta}}^<(\mathbf{s})\nabla_{\mathbf{r}}f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - s)\right]
\end{split}
\end{equation}
One of these boundaries ($\partial\mathbb{V}_{s\to\infty}$) is at infinity, at which the integrand above is zero. In more detail, $\Theta(r - s)$ is clearly zero for all finite $r$ and infinite $s$ as $\Theta(r - s) = 0$ for $s > r$. Additionally, it is zero at infinite $r$ due to the $\sim r^{-\ell_{\bm{\beta}} - 2}$ fall-off of $\nabla_{\mathbf{r}}f_{\bm{\beta}}^>(\mathbf{r})$ (see Eq. \eqref{eq:scalarHarmonics} for details). 

Therefore, the only surface integral that contributes to the total is the integral over $\partial\mathbb{V}_{s\to r'}$. Along this surface, $\mathrm{d}^2\mathbf{a} = -\hat{\mathbf{r}}'r'^2\sin\theta\mathrm{d}\theta\,\mathrm{d}\phi$ such that
\begin{equation}
\begin{split}
\left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r')\right]^\parallel &= 
-\frac{1}{4\pi}\sum_{\bm{\beta}} \int_0^{2\pi}\int_0^\pi\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(r',\theta,\phi;k) \left[f_{\bm{\beta}}^>(r',\theta,\phi)\nabla f_{\bm{\beta}}^<(\mathbf{r})\Theta(r' - r)\right.\\
&\qquad\left.+ f_{\bm{\beta}}^<(r',\theta,\phi)\nabla f_{\bm{\beta}}^>(\mathbf{r})\Theta(r - r')\right]r'^2\sin\theta\mathrm{d}\theta\,\mathrm{d}\phi.
\end{split}
\end{equation}
We have dopped the subscript $\mathbf{r}$ from the gradient symbol as the meaning of $\nabla$ now clearly implies differentiation in $\mathbf{r}$. Further, we can use the orthogonality condition of Eq. \eqref{eq:angularMixedOrthogonalityNf} to substitute
\begin{equation}
\begin{split}
\int_0^{2\pi}\int_0^\pi\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(r',\theta,\phi;k)f_{\bm{\beta}}^>(r',\theta,\phi)\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi &= 4\pi(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\alpha}\bm{\beta}}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\frac{1}{r'^{\ell + 1}},\\
\int_0^{2\pi}\int_0^\pi\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(r',\theta,\phi;k)f_{\bm{\beta}}^<(r',\theta,\phi)\sin\theta\;\mathrm{d}\theta\,\mathrm{d}\phi &= 4\pi(1 - \delta_{p1}\delta_{m0})\delta_{TE}\delta_{\bm{\alpha}\bm{\beta}}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}r'^\ell,
\end{split}
\end{equation}
such that
\begin{equation}
\begin{split}
\left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r')\right]^\parallel &= -(1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\\
&\qquad\times\left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\[0.5em]
&= -(1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r').
\end{split}
\end{equation}

Here, we have defined the regularized longitudinal spherical vector harmonics 
\begin{equation}\label{eq:regularizedLongitudinalHarmonics}
\begin{split}
\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};s) &= \left[s^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(s - r) + s^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - s)\right]\\
&= \nabla\left\{s^{-\ell + 1} f_{\bm{\alpha}}^<(\mathbf{r})\Theta(s - r) + s^{\ell + 2} f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - s)\right\}.
\end{split}
\end{equation}
These obey the orthogonality relation
\begin{equation}
\int\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};s)\cdot\mathbf{Z}_{\bm{\beta}}(\mathbf{r};s)\;\mathrm{d}^3\mathbf{r} = 4\pi s^3\delta_{TE}(1 - \delta_{p1}\delta_{m0})\delta_{\bm{\alpha}\bm{\beta}}
\end{equation}
and, due to the null Laplacian of the scalar harmonics, $\nabla\cdot\nabla f_{\bm{\alpha}}^i(\mathbf{r}) = 0$, have the useful divergence
\begin{equation}
\begin{split}
\nabla\cdot\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};s) &= \nabla\cdot\left\{a^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - s) + s^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(s - r)\right\}\\[0.5em]
&= \left[s^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r}) - s^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\right]\cdot\hat{\mathbf{r}}\delta(r - s)\\
&= \nabla\left\{s^{\ell + 2} f_{\bm{\alpha}}^>(\mathbf{r}) - s^{-\ell + 1} f_{\bm{\alpha}}^<(\mathbf{r})\right\}\cdot\hat{\mathbf{r}}\delta(r - s)
\end{split}
\end{equation}

In conclusion, we have
\begin{equation}
\begin{split}
&\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r') = \left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r')\right]^\perp + \left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r')\right]^\parallel\\
&\quad= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^\ll(k,\kappa;r',\infty)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa - (1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r').
\end{split}
\end{equation}
We can repeat this process for both truncated exterior transverse spherical harmonics and truncations using $\Theta(r' - r)$. The mathematics is cumbersome but straightforward, and results in
\begin{equation}
\begin{split}
\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r' - r) &= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^\ll(k,\kappa;0,r')\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&\qquad + (1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r'),\\[1.0em]
\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r - r') &= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^{><}(k,\kappa;r',\infty)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&\qquad- (1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{h_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r'),\\[1.0em]
\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\Theta(r' - r) &= \frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^{><}(k,\kappa;0,r')\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&\qquad+ (1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{h_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r').
\end{split}
\end{equation}







\subsection{Helmholtz expansion of Dirac-delta dyads}\label{sec:diracDyadExpansion}

Beginning with the ``self-field'' term of the dyadic Green's function, $\hat{\mathbf{r}}\hat{\mathbf{r}}\delta(\mathbf{r} - \mathbf{r}')/k^2$, we can conduct an expansion similar to that of Appendix \ref{sec:truncatedHarmonicExpansion} to produce
\begin{equation}
\begin{split}
\frac{\hat{\mathbf{r}}\hat{\mathbf{r}}}{k^2}\delta(\mathbf{r} - \mathbf{r}') &= \int\frac{\hat{\mathbf{s}}\hat{\mathbf{s}}}{k^2}\delta(\mathbf{s} - \mathbf{r}')\cdot\bm{1}_2\delta(\mathbf{s} - \mathbf{r})\;\mathrm{d}^3\mathbf{s}\\
&= \int\frac{\hat{\mathbf{s}}\hat{\mathbf{s}}}{k^2}\delta(\mathbf{s} - \mathbf{r}')\cdot\left[\frac{1}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{s},\kappa)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\kappa^2\;\mathrm{d}\kappa\right.\\
&\qquad\left.+\frac{1}{4\pi}\sum_{\bm{\alpha}}\nabla_{\mathbf{s}}\nabla\left\{f_{\bm{\alpha}}^>(\mathbf{s})f_{\bm{\alpha}}^<(\mathbf{r})\Theta(s - r) + f_{\bm{\alpha}}^<(\mathbf{s})f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - s)\right\} \vphantom{\int_0^\infty} \right]\mathrm{d}^3\mathbf{s}\\
&= \frac{1}{2\pi^2k^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\kappa^2\;\mathrm{d}\kappa\\
&\qquad+\frac{1}{4\pi k^2}\sum_{\bm{\alpha}}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}'.
\end{split}
\end{equation}







\subsection{Helmholtz expansion of the dyadic Green's function of free space}\label{sec:helmholtzDecompositionFreeSpaceGreenFunction}

In this subsection, we provide the identity given in Eq. \eqref{eq:helmholtzDecompositionFreeSpaceGreenFunction}. Using the results of Appendices \ref{sec:truncatedHarmonicExpansion} and \ref{sec:diracDyadExpansion}, we can see that
\begin{equation}
\begin{split}
\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left[\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\Theta(r - r') + \mathbf{X}_{\bm{\alpha}}(\mathbf{r},k) \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)\Theta(r' - r)\right] - \frac{\hat{\mathbf{r}}\hat{\mathbf{r}}}{k^2}\delta(\mathbf{r} - \mathbf{r}')\\[1.0em]
&= \frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left[\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^{><}(k,\kappa;r',\infty)\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\right.\\
&\qquad- \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)(1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{h_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')\\
&\qquad+ \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)\frac{2}{\pi}(1 - \delta_{p1}\delta_{m0})\int_0^\infty\kappa^2R_{T\ell}^\ll(k,\kappa;0,r')\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\;\mathrm{d}\kappa\\
&\qquad+\left.\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)(1 - \delta_{p1}\delta_{m0})\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\frac{j_\ell(kr')}{kr'}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')\right]\\
&- \frac{1}{2\pi^2k^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\kappa^2\;\mathrm{d}\kappa\\
&\qquad - \frac{1}{4\pi k^2}\sum_{\bm{\alpha}}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}'.
\end{split}
\end{equation}
We can use the identity $\sum_{\bm{\alpha}}\delta_{TE}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k) = \sum_{p\ell m}\mathbf{N}_{p\ell m}(\mathbf{r},k)$ and group terms to rewrite this as
\begin{equation}
\begin{split}
\mathbf{G}_0(&\mathbf{r},\mathbf{r}';\omega) = \frac{\mathrm{i}k}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left( \vphantom{\frac{1}{4\pi k^2}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty) + \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r')\right.\\
&\left. - \frac{1}{\mathrm{i} k^3}\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right)\kappa^2\mathrm{d}\kappa + \frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left(\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r},r')\left[-\frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right.\right.\\
&\left.\left.+ \frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right] -\frac{1}{\mathrm{i} k^3}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}' \vphantom{\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}} \right).
\end{split}
\end{equation}
The first sum over $\bm{\alpha}$ (accompanied by a $\kappa$-integral) is a sum over functions that vary in the observer coordinate $\mathbf{r}$ like $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)$ while the second sum (notably integral-free) is a sum over functions that vary as $\nabla f_{\bm{\alpha}}^<(\mathbf{r})$ or $\nabla f_{\bm{\alpha}}^>(\mathbf{r})$, depending on the relative magnitudes of $r$ and $r'$. Therefore, it is clear that the first sum is divergence-free in $\mathbf{r}$ while the second is curl free. What is nontrivial to show, however, is that the first sum is also divergence-free in $\mathbf{r}'$ and the second is analogously also curl-free in $\mathbf{r}'$.

Showing that the $\mathbf{r}'$-behavior mirrors the $\mathbf{r}$ is important, as we must reproduce the Helmholtz decomposition
\begin{equation}\label{eq:waveEquationDerivativeHelmholtzDecomp}
\begin{split}
&\nabla\times\nabla\times\mathbf{A}(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{A}(\mathbf{r},\omega) = \frac{4\pi}{c}\mathbf{J}(\mathbf{r},\omega)\\[0.5em]
\implies&
\begin{dcases}
\nabla\times\nabla\times\mathbf{A}^\perp(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{A}^\perp(\mathbf{r},\omega) = \frac{4\pi}{c}\mathbf{J}^\perp(\mathbf{r},\omega),\\
\nabla\times\nabla\times\mathbf{A}^\parallel(\mathbf{r},\omega) - \frac{\omega^2}{c^2}\mathbf{A}^\parallel(\mathbf{r},\omega) = \frac{4\pi}{c}\mathbf{J}^\parallel(\mathbf{r},\omega)
\end{dcases}
\end{split}
\end{equation}
within the integral formulation of the wave equation. In other words, we require
\begin{equation}
\mathbf{A}(\mathbf{r},\omega) = \int\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}'
\end{equation}
to imply that
\begin{equation}\label{eq:waveEquationIntegralHelmholtzDecomp}
\begin{split}
\mathbf{A}^\perp(\mathbf{r},\omega) &= \int\mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^\perp(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}',\\
\mathbf{A}^\parallel(\mathbf{r},\omega) &= \int\mathbf{G}_0^\parallel(\mathbf{r},\mathbf{r}';\omega)\cdot\frac{\mathbf{J}^\parallel(\mathbf{r}',\omega)}{c}\;\mathrm{d}^3\mathbf{r}',
\end{split}
\end{equation}
where $\mathbf{G}_0^{\perp,\parallel}(\mathbf{r},\mathbf{r}';\omega)$ are transverse and longitudinal in $\mathbf{r}'$, respectively, such that the integrals in the source coordinate are not null, and are also transverse and longitudinal in $\mathbf{r}$ such that the transverse (longitudinal) part of the vector potential can only be driven by the transverse (longitudinal) part of the current density.

The following proofs of these required properties are long and arduous but necessary. Beginning with the $\mathbf{r}$-transverse part of the Green's function of free space, we can use the product rule $\nabla\cdot\left\{\mathbf{c}\mathbf{F}(\mathbf{r})g(\mathbf{r})\right\} = \mathbf{c}\left[g(\mathbf{r})\nabla\cdot\mathbf{F}(\mathbf{r}) + \mathbf{F}(\mathbf{r})\cdot\nabla g(\mathbf{r})\right]$ and the fundamental theorem of calculus $(\partial/\partial x)\int_x^a f(y)\;\mathrm{d}y = -f(x)$ to say
\begin{equation}
\begin{split}
\nabla'\cdot&\left\{\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty)\right\}\\[0.5em]
&= \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\nabla'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty) + \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\cdot\nabla'R_{M\ell}^{><}(k,\kappa;r',\infty)\right]\\
&= \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[ \vphantom{\frac{\ell}{2\ell + 1}} 0 - \delta_{TM}\mathbf{M}_{p\ell m}(\mathbf{r}',k)\cdot\hat{\mathbf{r}}'h_\ell(kr')j_\ell(\kappa r')r'^2\right.\\
&\left.\qquad- \delta_{TE}\mathbf{N}_{p\ell m}(\mathbf{r}',k)\cdot\hat{\mathbf{r}}'\left(\frac{\ell + 1}{2\ell + 1}h_{\ell - 1}(kr')j_{\ell - 1}(\kappa r') + \frac{\ell}{2\ell + 1}h_{\ell + 1}(kr')j_{\ell + 1}(\kappa r')\right)r'^2\right]\\
&= -\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\delta_{TE}\left(\sqrt{K_{\ell m}}\frac{\ell(\ell + 1)}{2\ell + 1}\left[j_{\ell - 1}(kr') + j_{\ell + 1}(kr')\right]P_{\ell m}(\cos\theta')S_p(m\phi')\right)\\
&\qquad\times\left(\frac{\ell + 1}{2\ell + 1}h_{\ell - 1}(kr')j_{\ell - 1}(\kappa r') + \frac{\ell}{2\ell + 1}h_{\ell + 1}(kr')j_{\ell + 1}(\kappa r')\right)r'^2,
\end{split}
\end{equation}
wherein we have also used the fact that the magnetic-type transverse vector spherical harmonics have no radial component and that the electric-type transverse vector spherical harmonics have a radial component that goes like $j_{\ell}(kr')/kr' = [j_{\ell - 1}(kr') + j_{\ell + 1}(kr')]/(2\ell + 1)$. Similarly,
\begin{equation}
\begin{split}
\nabla'\cdot&\left\{\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r')\right\}\\
&= \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\delta_{TE}\left(\sqrt{K_{\ell m}}\frac{\ell(\ell + 1)}{2\ell + 1}\left[h_{\ell - 1}(kr') + h_{\ell + 1}(kr')\right]P_{\ell m}(\cos\theta')S_p(m\phi')\right)\\
&\qquad\times\left(\frac{\ell + 1}{2\ell + 1}j_{\ell - 1}(kr')j_{\ell - 1}(\kappa r') + \frac{\ell}{2\ell + 1}j_{\ell + 1}(kr')j_{\ell + 1}(\kappa r')\right)r'^2.
\end{split}
\end{equation}
The third derivative identity we will need is the divergence of the term of the (putatively) transverse Green's function that arises from the dyadic Dirac delta. We can succinctly write this as
\begin{equation}
\begin{split}
\nabla'\cdot&\left\{-\frac{1}{\mathrm{i}k^3}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right\}\\
&= \delta_{TE}\nabla'\cdot\left\{-\frac{1}{\mathrm{i}k^3}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{N}_{p\ell m}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right\}\\
&= -\delta_{TE}\frac{1}{\mathrm{i}k^3}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\frac{\partial}{\partial r'}\left\{\sqrt{K_{\ell m}}\frac{j_\ell(\kappa r')}{\kappa r'}P_{\ell m}(\cos\theta')S_p(m\phi')\right\}\\
&= \delta_{TE}\frac{\mathrm{i}}{k^3}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\ell(\ell + 1)P_{\ell m}(\cos\theta')S_p(m\phi')\left[\frac{1}{\kappa r'}\frac{\partial j_\ell(\kappa r')}{\partial r'} - \frac{j_\ell(\kappa r')}{\kappa r'^2}\right]\\
&= \delta_{TE}\mathrm{i}\mathbf{N}_{p\ell m}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\ell(\ell + 1)P_{\ell m}(\cos\theta')S_p(m\phi')\frac{1}{k^3\kappa r'^2}\left[r'\frac{\partial j_\ell(\kappa r')}{\partial r'} - j_\ell(\kappa r')\right]
\end{split}
\end{equation}
using the identity $\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\cdot\hat{\mathbf{r}}' = \delta_{TE}\mathbf{N}_{p\ell m}(\mathbf{r}',\kappa)$. 

Combining the first two derivatives above and using the identity
\begin{equation}
j_{\ell - 1}(kr')h_{\ell + 1}(kr') - j_{\ell + 1}(kr')h_{\ell - 1}(kr') = -\mathrm{i}\frac{2\ell + 1}{(kr')^3},
\end{equation}
one finds, after distribution and reorganization of the products of spherical Bessel and Hankel functions, 
\begin{equation}
\begin{split}
\nabla'\cdot&\left\{\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty)\right\} + \nabla'\cdot\left\{\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r')\right\}\\
&=\delta_{TE}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\frac{\ell(\ell + 1)}{2\ell + 1}P_{\ell m}(\cos\theta')S_p(m\phi')r'^2\\
&\qquad\times\left[j_{\ell - 1}(kr')h_{\ell + 1}(kr')\left(\frac{\ell + 1}{2\ell + 1}j_{\ell - 1}(\kappa r') - \frac{\ell}{2\ell + 1}j_{\ell + 1}(\kappa r')\right)\right.\\
&\qquad-\left.j_{\ell + 1}(kr')h_{\ell - 1}(kr')\left(\frac{\ell + 1}{2\ell + 1}j_{\ell - 1}(\kappa r') - \frac{\ell}{2\ell + 1}j_{\ell + 1}(\kappa r')\right)\right]\\
&= \delta_{TE}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\frac{\ell(\ell + 1)}{2\ell + 1}P_{\ell m}(\cos\theta')S_p(m\phi')r'^2\\
&\qquad\times\left[j_{\ell - 1}(kr')h_{\ell + 1}(kr') - j_{\ell + 1}(kr')h_{\ell - 1}(kr')\right]\frac{1}{\kappa r'}\frac{\partial\{r'j_\ell(\kappa r')\}}{\partial r'}\\
&= -\delta_{TE}\mathrm{i}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\ell(\ell + 1)P_{\ell m}(\cos\theta')S_p(m\phi')\frac{r'^2}{(kr')^3\kappa r'}\left[j_\ell(\kappa r') + r'\frac{\partial\{j_\ell(\kappa r')\}}{\partial r'}\right]
\end{split}
\end{equation}
Therefore, one can see that the sum of the three terms is
\begin{equation}
\begin{split}
\nabla'\cdot&\left\{ \vphantom{\frac{1}{k^3}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty)\right.\\
&\left.+ \mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r') - \frac{1}{\mathrm{i}k^3}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right\}\\
&= \delta_{TE}\mathrm{i}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\ell(\ell + 1)P_{\ell m}(\cos\theta')S_p(m\phi')\frac{1}{k^3\kappa r'^2}\left[r'\frac{\partial j_\ell(\kappa r')}{\partial r'} - j_\ell(\kappa r') - j_\ell(\kappa r') - r'\frac{\partial\{j_\ell(\kappa r')\}}{\partial r'}\right]\\
&= -\delta_{TE}\frac{2\mathrm{i}}{k^3r'}\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\sqrt{K_{\ell m}}\ell(\ell + 1)\frac{j_\ell(\kappa r')}{\kappa r'}P_{\ell m}(\cos\theta')S_p(m\phi')\\
&= -\delta_{TE}\frac{2\mathrm{i}}{k^3r'}\mathbf{N}_{p\ell m}(\mathbf{r},\kappa)\mathbf{N}_{p\ell m}(\mathbf{r}',\kappa)\cdot\hat{\mathbf{r}}'.
\end{split}
\end{equation}
Further, from Appendices \ref{app:helmholtzDelta} and \ref{sec:diracDyadExpansion}, we can see that
\begin{equation}
\begin{split}
\hat{\mathbf{r}}'\delta(\mathbf{r} - \mathbf{r}') &= \left[\hat{\mathbf{r}}'\hat{\mathbf{r}}'\delta(\mathbf{r} - \mathbf{r}')\right]\cdot\hat{\mathbf{r}}'\\
&= \left(\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp\cdot\hat{\mathbf{r}}'\hat{\mathbf{r}}'\right)\cdot\hat{\mathbf{r}}'\\
&= \left(\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\cdot\hat{\mathbf{r}}'\hat{\mathbf{r}}'\right)\cdot\hat{\mathbf{r}}'\\
&= \frac{1}{2\pi^2}\int_0^\infty\sum_{p\ell m}\mathbf{N}_{p\ell m}(\mathbf{r},k)\mathbf{N}_{p\ell m}(\mathbf{r}',k)\cdot\hat{\mathbf{r}}'k^2\;\mathrm{d}k,
\end{split}
\end{equation}
such that we can see that the $\mathbf{r}'$-divergence of the $\mathbf{r}$-transverse part of $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$ is 
\begin{equation}
\begin{split}
&\nabla'\cdot\frac{\mathrm{i}k}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left( \vphantom{\frac{1}{4\pi k^2}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty)\right.\\
&\qquad\left.+ \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r') - \frac{1}{\mathrm{i} k^3}\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right)\kappa^2\mathrm{d}\kappa\\
&= -\frac{2\mathrm{i}}{k^3r'}\frac{\mathrm{i}k}{2\pi^2}\sum_{p\ell m}\int_0^\infty\mathbf{N}_{p\ell m}(\mathbf{r},\kappa)\mathbf{N}_{p\ell m}(\mathbf{r}',\kappa)\cdot\hat{\mathbf{r}}'\kappa^2\;\mathrm{d}\kappa\\
&= \frac{2\hat{\mathbf{r}}'}{k^2r'}\delta(\mathbf{r} - \mathbf{r}'),
\end{split}
\end{equation}
such that the $\mathbf{r}$-transverse part of $\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega)$ is also transverse in $\mathbf{r}'$ for $\mathbf{r}'\neq\mathbf{r}$. We can also see that the $\mathbf{r}'$-divergence of the $\mathbf{r}$-transverse part is irregular at $r' = 0$. 

Both of these cases need to be handled with care, however neither causes insurmountable problems. In the case $\mathbf{r}'\to\mathbf{r}$, the fields are, in general, irregular, and we can safely ignore these points as our solution is meaningless anyway. For $r'\to0$, our expansion into mode functions $\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)$ and $f_{\bm{\alpha}}^{>,<}(\mathbf{r})$ breaks due to the irregularity of the function $R_{T\ell}^{><}(k,\kappa;r',\infty)$ as $r'$ approaches the origin. However, in this case the Green's function simply becomes
\begin{equation}
\lim_{r'\to0}\mathbf{G}(\mathbf{r},\mathbf{r}';\omega) = \lim_{r'\to0}\left(\frac{ik}{4\pi}\sum_{\bm{\alpha}}\bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k) - \frac{\hat{\mathbf{r}}\hat{\mathbf{r}}}{k^2}\delta(\mathbf{r} - \mathbf{r}')\right),
\end{equation}
such that (if we allow derivatives to pass through the limit operator) $\nabla'\cdot\lim_{r'\to0}\mathbf{G}(\mathbf{r},\mathbf{r}';\omega) = \lim_{r'\to0}\nabla'\cdot\hat{\mathbf{r}}'\hat{\mathbf{r}}\delta(\mathbf{r} - \mathbf{r}')/k^2 = \lim_{r'\to0}\hat{\mathbf{r}}(\partial/\partial r')\{\delta(\mathbf{r} - \mathbf{r}')\}/k^2$ as $\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)$ is divergence-free everywhere. We have also let one factor of $\hat{\mathbf{r}}$ become $\hat{\mathbf{r}}'$ due to the equivalence enforced by the Dirac delta $\delta(\mathbf{r} - \mathbf{r}')$. The resulting $r'$-derivative operator acting on $\delta(\mathbf{r} - \mathbf{r}')$ produces more expressions proportional to $\delta(\mathbf{r} - \mathbf{r}')$, such that, even for $r'\to 0$, the $\mathbf{r}'$-divergence of the Green's function is zero except when the observer and source are co-located. Therefore, for $\mathbf{r} \neq \mathbf{r}'$ and $r'>0$, we can see that
\begin{equation}\label{eq:G0transverse}
\begin{split}
\mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}k}{2\pi^2}\sum_{\bm{\alpha}}\int_0^\infty\mathbf{X}_{\bm{\alpha}}(\mathbf{r},\kappa)\left( \vphantom{\frac{1}{4\pi k^2}} \mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^{><}(k,\kappa;r',\infty)\right.\\
&\qquad\left.+ \bm{\mathcal{X}}_{\bm{\alpha}}(\mathbf{r}',k)R_{T\ell}^\ll(k,\kappa;0,r') - \frac{1}{\mathrm{i} k^3}\left[\hat{\mathbf{r}}'\cdot\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',\kappa)\right]\hat{\mathbf{r}}'\right)\kappa^2\mathrm{d}\kappa
\end{split}
\end{equation}
is divergence-free in both $\mathbf{r}$ and $\mathbf{r}'$, and the case of $r' = 0$ requires more thought but produces similarly null divergences.

The $\mathbf{r}$-longitudinal part of the free-space Green's function is easier to analyze than $\mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega)$. We can quickly use the vector calculus identity $\nabla'\times\left\{\nabla f(\mathbf{r})g(\mathbf{r}')\mathbf{F}(\mathbf{r}')\right\} = \nabla f(\mathbf{r})\left[g(\mathbf{r}')\nabla'\times\mathbf{F}(\mathbf{r}') + \nabla'g(\mathbf{r}')\times\mathbf{F}(\mathbf{r}')\right]$ to analyze its three main terms:
\begin{equation}
\begin{split}
\nabla'&\times\left\{\mathbf{Z}_{\bm{\alpha}}(\mathbf{r},r')\left(-\frac{h_\ell(kr')}{kr'}\right)\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right\}\\
&= \left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\left(-\frac{h_\ell(kr')}{kr'}\right)\nabla'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k)\\
&\qquad+ \nabla'\left\{\left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\left(-\frac{h_\ell(kr')}{kr'}\right)\right\}\times\mathbf{N}_{p\ell m}(\mathbf{r}',k)\\
&= -\left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\frac{h_\ell(kr')}{kr'}k\mathbf{M}_{p\ell m}(\mathbf{r}',k)\\
&\qquad - \left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\frac{\partial}{\partial r'}\left\{\frac{h_\ell(kr')}{kr'}\right\}\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k)\\
&\qquad - \left[(-\ell + 1)r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + (\ell + 2)r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\frac{h_\ell(kr')}{kr'}\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k)\\
&= -\left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\frac{h_\ell(kr')}{kr'}k\mathbf{M}_{p\ell m}(\mathbf{r}',k)\\
&\qquad - \left[r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\qquad\times\frac{1}{kr'}\left(-2h_\ell(kr') + \frac{\partial\left\{r'h_\ell(kr')\right\}}{\partial r'}\right)\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k)\\
&\qquad - \left[(-\ell + 1)r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + (\ell + 2)r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\qquad\times\frac{1}{kr'}\left(\frac{\partial}{\partial r'}\left\{r'h_\ell(kr')\right\} - r'\frac{\partial h_\ell(kr')}{\partial r'}\right)\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k),
\end{split}
\end{equation}
and
\begin{equation}
\begin{split}
\nabla'&\times\left\{\mathbf{Z}_{\bm{\alpha}}(\mathbf{r},r')\left(\frac{j_\ell(kr')}{kr'}\right)\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right\}\\
&= \left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\frac{j_\ell(kr')}{kr'}k\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',k)\\
&\qquad + \left[r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\qquad\times\frac{1}{kr'}\left(-2j_\ell(kr') + \frac{\partial\left\{r'j_\ell(kr')\right\}}{\partial r'}\right)\hat{\mathbf{r}}'\times\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\\
&\qquad + \left[(-\ell + 1)r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + (\ell + 2)r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\qquad\times\frac{1}{kr'}\left(\frac{\partial}{\partial r'}\left\{r'j_\ell(kr')\right\} - r'\frac{\partial j_\ell(kr')}{\partial r'}\right)\hat{\mathbf{r}}'\times\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k),
\end{split}
\end{equation}
and
\begin{equation}\label{eq:term3}
\begin{split}
&\nabla'\times\left\{\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}'\right\}\\
&= -\hat{\mathbf{r}}'\times\nabla\nabla'\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\\
&= \delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\left(-\hat{\bm{\phi}}'\frac{1}{r'}\frac{\partial}{\partial\theta'} + \hat{\bm{\theta}}'\frac{1}{r'\sin\theta'}\frac{\partial}{\partial \phi'}\right)\\
&\quad\times\nabla\left\{(-\ell - 1)\frac{1}{r'^{\ell + 2}}P_{\ell m}(\cos\theta')S_p(m\phi')f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \ell r'^{\ell - 1}P_{\ell m}(\cos\theta')S_p(m\phi')f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\\
&= \delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\left(-\frac{\partial P_{\ell m}(\cos\theta')}{\partial \theta'}S_p(m\phi')\hat{\bm{\phi}}' + (-1)^{p+1}m\frac{P_{\ell m}(\cos\theta')}{\sin\theta'}S_{p+1}(m\phi')\hat{\bm{\theta}}'\right)\\
&\quad\times\nabla\left\{-\frac{\ell + 1}{r'^{\ell + 3}}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \ell r'^{\ell - 2}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}.
\end{split}
\end{equation}
The first two of these can be combined to give
\begin{equation}
\begin{split}
&\frac{\mathrm{i}k}{4\pi}\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\nabla'\times\left\{\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')\left(\frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k) - \frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right)\right\}\\
=& \frac{\mathrm{i}k}{4\pi}\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\left( \vphantom{\frac{1}{kr'}} \left[r'^{-\ell + 1}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 2}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\right.\\
&\qquad\times\left[-\frac{h_\ell(kr')}{kr'}k\mathbf{M}_{p\ell m}(\mathbf{r}',k) + \frac{j_\ell(kr')}{kr'}k\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',k)\right]\\
&\;+ \left[r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\times\left[-\frac{1}{kr'}\frac{\partial\{r'h_\ell(kr')\}}{\partial r'}\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k) + \frac{1}{kr'}\frac{\partial\{r'j_\ell(kr')\}}{\partial r'}\hat{\mathbf{r}}'\times\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\\
&\;+ \left[(-\ell + 1)r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + (\ell + 2)r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\times \left[-\frac{1}{kr'}\frac{\partial\{r'h_\ell(kr')\}}{\partial r'}\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k) + \frac{1}{kr'}\frac{\partial\{r'j_\ell(kr')\}}{\partial r'}\hat{\mathbf{r}}'\times\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\\
&\;+ \left[r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\times \left[\left(\frac{2}{kr'}h_\ell(kr') + \frac{2}{kr'}r'\frac{\partial h_\ell(kr')}{\partial r'}\right)\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right.\\
&\qquad\qquad\left.- \left(\frac{2}{kr'}j_\ell(kr') + \frac{2}{kr'}r'\frac{\partial j_\ell(kr')}{\partial r'}\right)\hat{\mathbf{r}}'\times\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\\
&\;+\left[(-\ell - 1)r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \ell r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right]\\
&\qquad\times\left.\left[\frac{1}{kr'}r'\frac{h_\ell(kr')}{\partial r'}\hat{\mathbf{r}}'\times\mathbf{N}_{p\ell m}(\mathbf{r}',k) - \frac{1}{kr'}r'\frac{j_\ell(kr')}{\partial r'}\hat{\mathbf{r}}'\times\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\right).
\end{split}
\end{equation}
The first term in the sum on the right-hand side is zero as $\mathbf{M}_{p\ell m}(\mathbf{r}',k)$ and $\bm{\mathcal{M}}_{p\ell m}(\mathbf{r}',k)$ vary in $r'$ as $j_\ell(kr')$ and $h_\ell(kr')$, respectively, and have identical $\theta'$ and $\phi'$ dependence. The second and third terms can be seen to zero via a similar cancellation, as the $\hat{\bm{\theta}}'$ and $\hat{\bm{\phi}}'$ terms of $\mathbf{N}_{p\ell m}(\mathbf{r}',k)$ and $\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)$, i.e. the terms that survive the cross-product with $\hat{\mathbf{r}}'$, vary in $r'$ as $(\partial\{r' j_\ell(kr')\}/\partial r')/kr'$ and $(\partial\{r' h_\ell(kr')\}/\partial r')/kr'$, respectively, and have the same angular dependence. The fourth term is zero by the same logic, as can be seen using the identities $\partial\{r'j_\ell(kr')\}\partial r' = j_\ell(kr') + r'\partial j_\ell(kr')/\partial r'$ and $\partial\{r'h_\ell(kr')\}\partial r' = h_\ell(kr') + r'\partial h_\ell(kr')/\partial r'$ to simplify the factors in parentheses. The fifth term is the only nonzero contribution to the total and gives, after expansion of the vector harmonics, use of the identities $\partial j_\ell(kr')/\partial r' = -kj_{\ell + 1}(kr') + \ell k j_\ell(kr')/kr'$ and $\partial h_\ell(kr')/\partial r' = -kh_{\ell + 1}(kr') + \ell k h_\ell(kr')/kr'$, and some cancellation,
\begin{equation}
\begin{split}
&\frac{\mathrm{i}k}{4\pi}\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\nabla'\times\left\{\mathbf{Z}_{\bm{\alpha}}(\mathbf{r};r')\left(\frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k) - \frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right)\right\}\\
=& -\frac{1}{4\pi k^2r'^3}\delta_{TE}\sqrt{(2 - \delta_{m0})\frac{(\ell - m)!}{(\ell + m)!}}\left[(-\ell - 1)r'^{-\ell}\nabla f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r - r') + \ell r'^{\ell + 1}\nabla f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r' - r)\right]\\
&\qquad\times\left(\frac{\partial P_{\ell m}(\cos\theta')}{\partial \theta'}S_p(m\phi')\hat{\bm{\phi}}' - \frac{(-1)^{p+1}m}{\sin\theta'}P_{\ell m}(\cos\theta')S_{p+1}(m\phi')\hat{\bm{\theta}}'\right).
\end{split}
\end{equation}
We can see that the above sum is the negative of Eq. \eqref{eq:term3} times a factor of $-1/4\pi k^2$, such that
\begin{equation}
\begin{split}
\nabla'&\times\frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left(\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r},r')\left[-\frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k) + \frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\right.\\
&\left. -\frac{1}{\mathrm{i} k^3}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}' \vphantom{\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}} \right) = 0
\end{split}
\end{equation}
and the $\mathbf{r}$-longitudinal part of the Green's function is also $\mathbf{r}'$-longitudinal. Therefore, we can easily define
\begin{equation}\label{eq:G0longitudinal}
\begin{split}
\mathbf{G}_0^\parallel(\mathbf{r},\mathbf{r}';\omega) &= \frac{\mathrm{i}k}{4\pi}\sum_{\bm{\alpha}}\left(\delta_{TE}\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}\mathbf{Z}_{\bm{\alpha}}(\mathbf{r},r')\left[-\frac{h_\ell(kr')}{kr'}\mathbf{N}_{p\ell m}(\mathbf{r}',k) + \frac{j_\ell(kr')}{kr'}\bm{\mathcal{N}}_{p\ell m}(\mathbf{r}',k)\right]\right.\\
&\left. -\frac{1}{\mathrm{i} k^3}\nabla\left\{\frac{\partial f_{\bm{\alpha}}^>(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^<(\mathbf{r})\Theta(r' - r) + \frac{\partial f_{\bm{\alpha}}^<(\mathbf{r}')}{\partial r'}f_{\bm{\alpha}}^>(\mathbf{r})\Theta(r - r')\right\}\hat{\mathbf{r}}' \vphantom{\sqrt{\frac{\ell(\ell + 1)}{2\ell + 1}}} \right),
\end{split}
\end{equation}
which, alongside the definition of the transverse Green's function in Eq. \eqref{eq:G0transverse}, provides
\begin{equation}
\mathbf{G}_0(\mathbf{r},\mathbf{r}';\omega) = \mathbf{G}_0^\perp(\mathbf{r},\mathbf{r}';\omega) + \mathbf{G}_0^\parallel(\mathbf{r},\mathbf{r}';\omega)
\end{equation}
which satisfies the originally desired conditions of Eqs. \eqref{eq:waveEquationDerivativeHelmholtzDecomp} and \eqref{eq:waveEquationIntegralHelmholtzDecomp}.










\subsection{Derivation of the wave equation satisfied by the polarization density}\label{app:polarizationWaveEquation}

We begin with Maxwell's equations in the Fourier regime,
\begin{equation}
\begin{split}
\nabla\cdot\mathbf{E}(\mathbf{r},\omega) &= 4\pi\rho(\mathbf{r},\omega),\\
\nabla\cdot\mathbf{D}(\mathbf{r},\omega) &= 4\pi\rho_f(\mathbf{r},\omega),\\
\nabla\cdot\mathbf{B}(\mathbf{r},\omega) &= 0,\\
\nabla\times\mathbf{E}(\mathbf{r},\omega) &= \frac{\mathrm{i}\omega}{c}\mathbf{B}(\mathbf{r},\omega),\\
\nabla\times\mathbf{B}(\mathbf{r},\omega) &= \frac{4\pi}{c}\mathbf{J}(\mathbf{r},\omega) - \frac{\mathrm{i}\omega}{c}\mathbf{E}(\mathbf{r},\omega),\\
\nabla\times\mathbf{H}(\mathbf{r},\omega) &= \frac{4\pi}{c}\mathbf{J}_f(\mathbf{r},\omega) - \frac{\mathrm{i}\omega}{c}\mathbf{D}(\mathbf{r},\omega),
\end{split}
\end{equation}
where
\begin{equation}
\begin{split}
\mathbf{D}(\mathbf{r},\omega) &= \epsilon(\mathbf{r},\omega)\mathbf{E}(\mathbf{r},\omega),\\
\mathbf{B}(\mathbf{r},\omega) &= \mu(\mathbf{r},\omega)\mathbf{H}(\mathbf{r},\omega),
\end{split}
\end{equation}
are the electric and magnetic constitutive relations, respectively, and the charge and current distributions have been separated into bound and free contributions such that $\rho(\mathbf{r},\omega) = \rho_b(\mathbf{r},\omega) + \rho_f(\mathbf{r},\omega)$ and $\mathbf{J}(\mathbf{r},\omega) = \mathbf{J}_b(\mathbf{r},\omega) + \mathbf{J}_f(\mathbf{r},\omega)$. Alternatively, the electric and magnetic constitutive relations can be written as
\begin{equation}
\begin{split}
\mathbf{D}(\mathbf{r},\omega) &= \mathbf{E}(\mathbf{r},\omega) + 4\pi\mathbf{P}(\mathbf{r},\omega),\\
\mathbf{B}(\mathbf{r},\omega) &= \mathbf{H}(\mathbf{r},\omega) + 4\pi\mathbf{M}(\mathbf{r},\omega),
\end{split}
\end{equation}
with $\mathbf{P}(\mathbf{r},\omega)$ the polarization density and $\mathbf{M}(\mathbf{r},\omega)$ the magnetization density of the matter. These lead straightforwardly to the definitions of the bound charge and current:
\begin{equation}
\begin{split}
\rho_b(\mathbf{r},\omega) &= -\nabla\cdot\mathbf{P}(\mathbf{r},\omega),\\
\mathbf{J}_b(\mathbf{r},\omega) &= -\mathrm{i}\omega\mathbf{P}(\mathbf{r},\omega) + c\nabla\times\mathbf{M}(\mathbf{r},\omega).
\end{split}
\end{equation}

The constitutive relations are useful for defining a corollary to Faraday's law for the $\mathbf{D}(\mathbf{r},\omega)$- and $\mathbf{H}(\mathbf{r},\omega)$-fields:
\begin{equation}
\begin{split}
\nabla\times\mathbf{D}(\mathbf{r},\omega) &= \epsilon(\mathbf{r},\omega)\nabla\times\mathbf{E}(\mathbf{r},\omega) + \nabla\epsilon(\mathbf{r},\omega)\times\mathbf{E}(\mathbf{r},\omega)\\
&= \frac{\mathrm{i}\omega}{c}\epsilon(\mathbf{r},\omega)\mu(\mathbf{r},\omega)\mathbf{H}(\mathbf{r},\omega) + \nabla\epsilon(\mathbf{r},\omega)\times\mathbf{E}(\mathbf{r},\omega),
\end{split}
\end{equation}
wherein we have used the identity $\nabla\times\left\{f(\mathbf{r})\mathbf{F}(\mathbf{r})\right\} = f(\mathbf{r})\nabla\times\mathbf{F}(\mathbf{r}) + \nabla f(\mathbf{r})\times\mathbf{F}(\mathbf{r})$. Application of the curl operator to Faraday's law and its corollary produces
\begin{equation}\label{eq:waveEquationsEandD}
\begin{split}
\nabla\times\nabla\times\mathbf{E}(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c^2}\mu(\mathbf{r},\omega)\mathbf{J}_f(\mathbf{r},\omega) + \epsilon(\mathbf{r},\omega)\mu(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{E}(\mathbf{r},\omega) + \frac{\mathrm{i}\omega}{c}\nabla\mu(\mathbf{r},\omega)\times\mathbf{H}(\mathbf{r},\omega),\\
\nabla\times\nabla\times\mathbf{D}(\mathbf{r},\omega) &= \frac{4\pi\mathrm{i}\omega}{c^2}\epsilon(\mathbf{r},\omega)\mu(\mathbf{r},\omega)\mathbf{J}_f(\mathbf{r},\omega) + \epsilon(\mathbf{r},\omega)\mu(\mathbf{r},\omega)\frac{\omega^2}{c^2}\mathbf{D}(\mathbf{r},\omega)\\
&\qquad + \frac{\mathrm{i}\omega}{c}\nabla\left\{\epsilon(\mathbf{r},\omega)\mu(\mathbf{r},\omega)\right\}\times\mathbf{H}(\mathbf{r},\omega) + \nabla\times\left\{\nabla\epsilon(\mathbf{r},\omega)\times\mathbf{E}(\mathbf{r},\omega)\right\}.
\end{split}
\end{equation}
The last term on the right-hand side of the first equation and the last two terms on the right-hand side of the second equation are nonzero for any system with space-dependent (i.e. interesting) material properties. These terms also act as sources that depend on the state of the field at any given frequency, such that, on the surface, they appear to make our lives quite complicated. However, in the special case where the dielectric and diamagnetic functions are piece-wise constant in space, these terms disappear. To see this, we can begin with the first line of Eq. \eqref{eq:waveEquationsEandD} and let
\begin{equation}
\mathbf{E}(\mathbf{r},\omega) = \sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\mathbf{E}_i(\mathbf{r},\omega).
\end{equation}
Here, space is divided into a number of regions $i$ that each contain a set of points $\mathbb{V}_i$. Each volume $\mathbb{V}_i$ borders any other number neighboring of volumes $\mathbb{V}_j$ and possibly infinity. Each volume $\mathbb{V}_i$ shares a set of points along the surface $\partial\mathbb{V}_{ij}$ with its neighbor $\mathbb{V}_j$ along which the dielectric functions, diamagnetic functions, and fields are undefined. Letting $\partial\mathbb{V}_i$ be the total set of surface points surrounding the volume $\mathbb{V}_i$, we can define the Heaviside function
\begin{equation}
\Theta(\mathbf{r}\in\mathbb{V}_i) = 
\begin{cases}
\mathbf{r}\in\mathbb{V}_i\setminus\partial\mathbb{V}_i, & 1,\\
\mathbf{r}\notin\mathbb{V}_i, & 0,\\
\mathbf{r}\in\partial\mathbb{V}_i, & \mathrm{undefined}.
\end{cases}
\end{equation}
Further, 
\begin{equation}
\mathbf{E}_i(\mathbf{r},\omega) = 
\begin{cases}
\mathbf{E}(\mathbf{r},\omega), & \mathbf{r}\in\mathbb{V}_i,\\
0, & \mathrm{otherwise},
\end{cases}
\end{equation}
such that our piece-wise definition of the electric field serves to ``stitch together'' the electric field in each separate region of space by connecting it along the system's boundaries to its neighbors. The dielectric and diamagnetic functions follow as
\begin{equation}
\begin{split}
\epsilon(\mathbf{r},\omega) &= \sum_i\epsilon_i(\omega)\Theta(\mathbf{r}\in\mathbb{V}_i),\\
\mu(\mathbf{r},\omega) &= \sum_i\mu_i(\omega)\Theta(\mathbf{r}\in\mathbb{V}_i),
\end{split}
\end{equation}
but, in contrast with the definition of the electric field, are space-independent within each region.

Using these definitions, we can apply the double-curl operator on the left-hand side of the first line of Eq. \eqref{eq:waveEquationsEandD} to find
\begin{equation}\label{eq:waveEqEseparated}
\begin{split}
&\sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\nabla\times\nabla\times\mathbf{E}_i(\mathbf{r},\omega) + \sum_i\delta(\mathbf{r}\in\partial\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\nabla\times\mathbf{E}_i(\mathbf{r},\omega)\\
&\qquad + \sum_i\nabla\times\left\{\delta(\mathbf{r}\in\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{E}_i(\mathbf{r},\omega)\right\} = \sum_i\frac{4\pi\mathrm{i}\omega}{c}\mu_i(\omega)\mathbf{J}_{fi}(\mathbf{r},\omega)\Theta(\mathbf{r}\in\mathbb{V}_i)\\
&\qquad + \frac{\omega^2}{c^2}\sum_i\mu_i(\omega)\epsilon_i(\omega)\mathbf{E}_i(\mathbf{r},\omega)\Theta(\mathbf{r}\in\mathbb{V}_i) + \sum_i\frac{\mathrm{i}\omega}{c}\mu_i(\omega)\delta(\mathbf{r}\in\partial\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{H}_i(\mathbf{r},\omega).
\end{split}
\end{equation}
Here, we have used the identity $\nabla\Theta(\mathbf{r}\in\mathbb{V}_i) = \hat{\mathbf{n}}_i(\mathbf{r})\delta(\mathbf{r}\in\partial\mathbb{V}_i)$ to evaluate the derivatives, where $\hat{\mathbf{n}}_i(\mathbf{r})$ is the outward-facing surface-normal unit vector of the boundary of $\mathbb{V}_i$. Because the fields and material functions are not defined on the boundary exactly, we will take the Dirac deltas to imply limits as one approaches a point on a boundary from inside the associated bounded volume. In this case, we have let $\Theta(\mathbf{r}\in\mathbb{V}_i)\delta(\mathbf{r}\in\partial\mathbb{V}_i) = \delta(\mathbf{r}\in\partial\mathbb{V}_i)$. Moreover, we can see that along each shared boundary $\partial\mathbb{V}_{ij}$,
\begin{equation}
\hat{\mathbf{n}}_i(\mathbf{r}\in\partial\mathbb{V}_{ij})\times\mathbf{E}_i(\mathbf{r}\in\partial\mathbb{V}_{ij},\omega) = -\hat{\mathbf{n}}_j(\mathbf{r}\in\partial\mathbb{V}_{ij})\times\mathbf{E}_j(\mathbf{r}\in\partial\mathbb{V}_{ij},\omega)
\end{equation}
as the surface-parallel components of the electric fields are equal and the surface-normal vectors are equal and opposite. Therefore, we can see that
\begin{equation}
\sum_i\delta(\mathbf{r}\in\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{E}_i(\mathbf{r},\omega) = 0
\end{equation}
and, accordingly, $\sum_i\nabla\times\left\{\delta(\mathbf{r}\in\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{E}_i(\mathbf{r},\omega)\right\} = 0$. Moreover, we can see from Faraday's law that
\begin{equation}
\sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\nabla\times\mathbf{E}_i(\mathbf{r},\omega) + \sum_i\delta(\mathbf{r}\in\partial\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{E}_i(\mathbf{r},\omega) = \sum_i\frac{\mathrm{i}\omega}{c}\mathbf{B}_i(\mathbf{r},\omega)\Theta(\mathbf{r}\in\mathbb{V}_i).
\end{equation}
Since the second term on the left-hand side is zero, we can equate the remaining quantities point-wise within their respective regions:
\begin{equation}
\nabla\times\mathbf{E}_i(\mathbf{r},\omega) = \frac{\mathrm{i}\omega}{c}\mathbf{B}_i(\mathbf{r},\omega).
\end{equation}
\sloppy Combined with the definition $\mu_i(\omega)\mathbf{H}_i(\mathbf{r},\omega) = \mathbf{B}_i(\mathbf{r},\omega)$, we can use the region-separated form of Faraday's law to see that $\nabla\times\mathbf{E}_i(\mathbf{r},\omega) = \mathrm{i}\omega\mu_i(\omega)\mathbf{H}_i(\mathbf{r},\omega)/c$. We can then cancel the remaining terms on either side of Eq. \eqref{eq:waveEqEseparated} proportional to Dirac deltas. Further, as the rest of the terms feature sums of independent quantities, we can drop the sums and Heaviside functions as we did with Faraday's law, such that the double curl of $\mathbf{E}(\mathbf{r},\omega)$ provides
\begin{equation}\label{eq:waveEqEseparated2}
\nabla\times\nabla\times\mathbf{E}_i(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c}\mu_i(\omega)\mathbf{J}_{fi}(\mathbf{r},\omega) + \frac{\omega^2}{c^2}\mu_i(\omega)\epsilon_i(\omega)\mathbf{E}_i(\mathbf{r},\omega).
\end{equation}
This is simply the wave equation for the electric field within region $i$. Therefore, we have proved that the wave equation for the electric field in Eq. \eqref{eq:waveEquationsEandD} can be decomposed into a series of wave equations in each region that must be solved individually and do \textit{not} contain any anomalous boundary terms proportional to $\nabla\mu(\mathbf{r},\omega)$.

A similar process can be used to find the region-separated form of the wave equation of the $\mathbf{D}$-field. Letting
\begin{equation}
\begin{split}
\mathbf{D}(\mathbf{r},\omega) &= \sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\epsilon_i(\omega)\mathbf{E}_i(\mathbf{r},\omega),\\
\epsilon(\mathbf{r},\omega)\mu(\mathbf{r},\omega) &= \sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\epsilon_i(\omega)\mu_i(\omega),
\end{split}
\end{equation}
we arrive at
\begin{equation}
\begin{split}
&\sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\nabla\times\nabla\times\mathbf{D}_i(\mathbf{r},\omega) + \sum_i\epsilon_i(\omega)\delta(\mathbf{r}\in\partial\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\nabla\times\mathbf{E}_i(\mathbf{r},\omega)\\
&\qquad + \nabla\times\left\{\sum_i\epsilon_i(\omega)\delta(\mathbf{r}\in\partial\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{E}_i(\mathbf{r},\omega)\right\} = \sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\frac{4\pi\mathrm{i}\omega}{c^2}\epsilon_i(\omega)\mu_i(\omega)\mathbf{J}_{fi}(\mathbf{r},\omega)\\
&\qquad + \sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\epsilon_i(\omega)\mu_i(\omega)\frac{\omega^2}{c^2}\mathbf{D}_i(\mathbf{r},\omega) + \sum_i\frac{\mathrm{i}\omega}{c}\epsilon_i(\omega)\mu_i(\omega)\delta(\mathbf{r}\in\delta\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{H}_i(\mathbf{r},\omega)\\
&\qquad + \nabla\times\left\{\sum_i\epsilon_i(\omega)\delta(\mathbf{r}\in\partial\mathbb{V}_i)\hat{\mathbf{n}}_i(\mathbf{r})\times\mathbf{E}_i(\mathbf{r},\omega)\right\},
\end{split}
\end{equation}
wherein $\mathbf{D}_i(\mathbf{r},\omega) = \epsilon_i(\omega)\mathbf{E}_i(\mathbf{r},\omega)$. We can immediately see that the last terms on both the left- and right-hand sides of the equation cancel. The second-to-last terms on either side of the equation can be seen to cancel using Faraday's law as was done in the previous paragraph, such that, after dropping sums and Heaviside functions, we find
\begin{equation}\label{eq:waveEqDseparated2}
\nabla\times\nabla\times\mathbf{D}_i(\mathbf{r},\omega) = \frac{4\pi\mathrm{i}\omega}{c^2}\epsilon_i(\omega)\mu_i(\omega)\mathbf{J}_{fi}(\mathbf{r},\omega) + \epsilon_i(\omega)\mu_i(\omega)\frac{\omega^2}{c^2}\mathbf{D}_i(\mathbf{r},\omega).
\end{equation}

We can now define the polarization field in each region as $\mathbf{P}_i(\mathbf{r},\omega)$ such that
\begin{equation}
\mathbf{P}(\mathbf{r},\omega) = \sum_i\Theta(\mathbf{r}\in\mathbb{V}_i)\mathbf{P}_i(\mathbf{r},\omega).
\end{equation}
This paves the wave for the identity
\begin{equation}
\mathbf{P}_i(\mathbf{r},\omega) = \frac{\mathbf{D}_i(\mathbf{r},\omega) - \mathbf{E}_i(\mathbf{r},\omega)}{4\pi}.
\end{equation}
Therefore, subtracting Eq. \eqref{eq:waveEqEseparated2} from Eq. \eqref{eq:waveEqDseparated2} and dividing by $4\pi$, we find
\begin{equation}
\nabla\times\nabla\times\mathbf{P}_i(\mathbf{r},\omega) - \epsilon_i(\omega)\mu_i(\omega)\frac{\omega^2}{c^2}\mathbf{P}_i(\mathbf{r},\omega) = \frac{\mathrm{i}\omega}{c}\mu_i(\omega)\left[\epsilon_i(\omega) - 1\right]\mathbf{J}_{fi}(\mathbf{r},\omega).
\end{equation}
Therefore, the polarization field in each region obeys the same wave equation as do the electric and $\mathbf{D}$-fields, modulo a space-independent prefactor in front of the free current source term on the right-hand side.














\subsection{Miscellaneous Work In-Progress}

% through Helmholtz decomposition in the usual way:
% \begin{equation}
% \bm{1}_2\delta(\mathbf{r} - \mathbf{r}') = -\frac{1}{4\pi}\nabla\int\frac{\nabla''\delta(\mathbf{r}''-\mathbf{r}')}{|\mathbf{r} - \mathbf{r}''|}\;\mathrm{d}^3\mathbf{r}'' + \frac{1}{4\pi}\nabla\times\int\frac{\nabla''\times\left\{\bm{1}_2\delta(\mathbf{r}'' - \mathbf{r}')\right\}}{|\mathbf{r} - \mathbf{r}''|}\;\mathrm{d}^3\mathbf{r}'',
% \end{equation}
% with
% \begin{equation}
% \begin{split}
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\parallel &= -\frac{1}{4\pi}\nabla\int\frac{\nabla''\delta(\mathbf{r}''-\mathbf{r}')}{|\mathbf{r} - \mathbf{r}''|}\;\mathrm{d}^3\mathbf{r}'',\\
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp &= \frac{1}{4\pi}\nabla\times\int\frac{\nabla''\times\left\{\bm{1}_2\delta(\mathbf{r}'' - \mathbf{r}')\right\}}{|\mathbf{r} - \mathbf{r}''|}\;\mathrm{d}^3\mathbf{r}''.
% \end{split}
% \end{equation}
% The longitudinal component is easily expanded with the identities
% \begin{equation}
% \nabla\int\frac{\nabla''\delta(\mathbf{r}''-\mathbf{r}')}{|\mathbf{r} - \mathbf{r}''|}\;\mathrm{d}^3\mathbf{r}'' = -\nabla\nabla'\left\{\frac{1}{|\mathbf{r} - \mathbf{r}'|}\right\}
% \end{equation}
% and
% \begin{equation}
% \frac{1}{|\mathbf{r} - \mathbf{r}'|} = \sum_{p\ell m}\left[f_{p\ell m}^>(\mathbf{r})f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') + f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right]
% \end{equation}
% such that
% \begin{equation}
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\parallel = \frac{1}{4\pi}\sum_{p\ell m}\nabla\nabla'\left\{f_{p\ell m}^>(\mathbf{r}) f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') + f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right\}.
% \end{equation}
% To simplify, we can see that $f_{p\ell m}^>(\mathbf{r}) f_{p\ell m}^<(\mathbf{r}') = f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')$ at $r = r'$. Further, with $\nabla\Theta(\pm\mathbf{r} \mp \mathbf{r}') = \pm\hat{\mathbf{r}}\delta(\mathbf{r} - \mathbf{r}')$, we can see that the product rule gives
% \begin{equation}
% \begin{split}
% \frac{1}{4\pi}\sum_{p\ell m}\nabla\nabla'&\left\{f_{p\ell m}^>(\mathbf{r}) f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') + f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right\}\\
% &= \frac{1}{4\pi}\sum_{p\ell m}\nabla\left\{f_{p\ell m}^>(\mathbf{r})\nabla'f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') - f_{p\ell m}^>(\mathbf{r})f_{p\ell m}^<(\mathbf{r}')\hat{\mathbf{r}}'\delta(r - r')\right.\\
% &\hspace{0.05\textwidth}\left.+ f_{p\ell m}^<(\mathbf{r})\nabla'f_{p\ell m}^>(\mathbf{r}')\Theta(r - r') + f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')\hat{\mathbf{r}}'\delta(r - r')\right\}\\[1.0em]
% &= \frac{1}{4\pi}\sum_{p\ell m}\nabla\left\{f_{p\ell m}^>(\mathbf{r})\nabla'f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') + f_{p\ell m}^<(\mathbf{r})\nabla'f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right\}.
% \end{split}
% \end{equation}
% The application of the $\mathbf{r}$-gradient can of course be performed first instead, such that
% \begin{equation}
% \begin{split}
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\parallel &= \frac{1}{4\pi}\sum_{p\ell m}\nabla\left\{f_{p\ell m}^>(\mathbf{r})\nabla'f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') + f_{p\ell m}^<(\mathbf{r})\nabla'f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right\}\\
% &= \frac{1}{4\pi}\sum_{p\ell m}\nabla'\left\{\nabla f_{p\ell m}^>(\mathbf{r})f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') + \nabla f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right\}.
% \end{split}
% \end{equation}

% The transverse component is more difficult to transform, but can be expanded using the identities
% \begin{equation}
% \begin{split}
% \nabla\times\left\{\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right\} &= \frac{1}{2\pi^2}\int_0^\infty\sum_{p\ell m}k^3\left[\mathbf{N}_{p\ell m}(\mathbf{r},k)\mathbf{M}_{p\ell m}(\mathbf{r}',k) + \mathbf{M}_{p\ell m}(\mathbf{r},k)\mathbf{N}_{p\ell m}(\mathbf{r}',k)\right]\;\mathrm{d}k\\
% &= \nabla\times\left\{\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\right\},
% \end{split}
% \end{equation}
% $\nabla\times\{\mathbf{A}(\mathbf{r})f(\mathbf{r})\} = f(\mathbf{r})\nabla\times\mathbf{A}(\mathbf{r}) - \mathbf{A}(\mathbf{r})\times\nabla f(\mathbf{r})$, and $\nabla\times\{\mathbf{c}\times \mathbf{A}(\mathbf{r})\} = \mathbf{c}\nabla\cdot \mathbf{A}(\mathbf{r}) - \mathbf{c}\cdot\nabla \mathbf{A}(\mathbf{r})$ to give
% \begin{equation}
% \begin{split}
% \nabla\times\int\frac{\nabla''\times\left\{\bm{1}_2\delta(\mathbf{r}'' - \mathbf{r}')\right\}}{|\mathbf{r} - \mathbf{r}''|}&\;\mathrm{d}^3\mathbf{r}'' = \int\left[\nabla\times\nabla''\times\left\{\frac{1}{|\mathbf{r} - \mathbf{r}''|}\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r}'',k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\right\}\right.\\
% &+\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r}'',k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\left(\nabla\cdot\nabla''\left\{\frac{1}{|\mathbf{r} - \mathbf{r}''|}\right\}\right)\\
% &\left.-\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r}'',k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\cdot\nabla\nabla''\left\{\frac{1}{|\mathbf{r} - \mathbf{r}''|}\right\}\right]\mathrm{d}^3\mathbf{r}''
% \end{split}
% \end{equation}
% The third term above contains a rank-2 tensor $\nabla\nabla''\{1/|\mathbf{r} - \mathbf{r}''|\}$ that, while tensor valued, is still curl-free with respect to the $\mathbf{r}''$ coordinate system. In other words, $\nabla''\times\nabla\nabla''\{1/|\mathbf{r} - \mathbf{r}''|\} = 0$. Moreover, $\mathbf{X}_{\bm{\alpha}}(\mathbf{r}'',k)$ is transverse such that the volume integral over $\mathbf{r}''$ produces zero as can be proved through a modified version of the vector-field orthogonality condition in Section \ref{sec:helmholtzOrthogonality}.

% The first term above can be simplified through Gauss' law for curls, i.e. $\int\nabla\times\mathbf{F}(\mathbf{r})\;\mathrm{d}^3\mathbf{r} = \oint\mathrm{d}^2\mathbf{s}\times\mathbf{F}(\mathbf{r})$. The integrand is clearly zero at all points on the boundary at infinity such that the first term is also zero. Finally, we can let $\nabla''\{1/|\mathbf{r} - \mathbf{r}''|\} = -\nabla\{1/|\mathbf{r} - \mathbf{r}''|\}$ and $\nabla\cdot\nabla\{1/|\mathbf{r} - \mathbf{r}''|\} = -4\pi\delta(\mathbf{r} - \mathbf{r}'')$ in the second term to produce
% \begin{equation}
% \nabla\times\int\frac{\nabla''\times\left\{\bm{1}_2\delta(\mathbf{r}'' - \mathbf{r}')\right\}}{|\mathbf{r} - \mathbf{r}''|}\;\mathrm{d}^3\mathbf{r}'' = 4\pi\frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k
% \end{equation}
% and, therefore,
% \begin{equation}
% \left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp = \frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k.
% \end{equation}
% Note that, through the identity $\nabla\cdot\{\mathbf{A}(\mathbf{r})\mathbf{B}(\mathbf{r}')\} = [\nabla\cdot\mathbf{A}(\mathbf{r})]\mathbf{B}(\mathbf{r}')$, one can see that $\left[\bm{1}_2\delta(\mathbf{r} - \mathbf{r}')\right]_\perp$ is clearly transverse in both $\mathbf{r}$ and $\mathbf{r}'$ due to the lack of divergence of both vector harmonics. Therefore, in conclusion,
% \begin{equation}
% \begin{split}
% \bm{1}_2\delta(\mathbf{r} - \mathbf{r}') &= \frac{1}{2\pi^2}\int_0^\infty\sum_{\bm{\alpha}}k^2\mathbf{X}_{\bm{\alpha}}(\mathbf{r},k)\mathbf{X}_{\bm{\alpha}}(\mathbf{r}',k)\;\mathrm{d}k\\
% &+ \frac{1}{4\pi}\sum_{p\ell m}\nabla\nabla'\left\{ f_{p\ell m}^>(\mathbf{r})f_{p\ell m}^<(\mathbf{r}')\Theta(r - r') +  f_{p\ell m}^<(\mathbf{r})f_{p\ell m}^>(\mathbf{r}')\Theta(r' - r)\right\}.
% \end{split}
% \end{equation}


% \subsection{Expansion Coefficient Definitions}

% The expansion coefficients of the Green's function are divided into two sets, one for a source coordinate $\mathbf{r}'\in\mathbb{V}_2$ confined inside the sphere and denoted by the superscript ``$<$'', and another for $\mathbf{r}'\in\mathbb{V}_1$ and denoted by ``$>$''. Within these sets, the coefficients $A$ and $B$ are reserved for Green's function terms for which the observer is outside the sphere surface, and the coefficients $C$ and $D$ are used for terms in which the observer coordinate is inside. Explicitly, the coefficients are defined as
% \begin{equation}
% \begin{split}
% A_{p\ell m}^>(\mathcal{k}) &= \frac{j_\ell(\mathcal{k}a)\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right) - j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\psi_\ell(\mathcal{k}a)}{j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\xi_\ell(\mathcal{k}a) - h_\ell^{(1)}(\mathcal{k}a)\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},\\[1.0em]
% B_{p\ell m}^>(\mathcal{k}) &= \frac{j_\ell(\mathcal{k}a)\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right) - \epsilon(\omega) j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\psi_\ell(\mathcal{k}a)}{\epsilon(\omega) j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\xi_\ell(\mathcal{k}a) - h_\ell^{(1)}(\mathcal{k}a)\xi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},\\[1.0em]
% C_{p\ell m}^>(\mathcal{k}) &= \frac{j_\ell(\mathcal{k}a)\xi_\ell(\mathcal{k}a) - h_\ell^{(1)}(\mathcal{k}a)\psi_\ell(\mathcal{k}a)}{j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\xi_\ell(\mathcal{k}a) - h_\ell^{(1)}(\mathcal{k}a)\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},\\[1.0em]
% D_{p\ell m}^>(\mathcal{k}) &= \frac{\sqrt{\epsilon(\omega)}\left[j_\ell(\mathcal{k}a)\xi_\ell(\mathcal{k}a) - h_\ell^{(1)}(\mathcal{k}a)\psi_\ell(\mathcal{k}a)\right]}{\epsilon(\omega) j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\xi_\ell(\mathcal{k}a) - h_\ell^{(1)}(\mathcal{k}a)\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},
% \end{split}
% \end{equation}
% and
% \begin{equation}
% \begin{split}
% A_{p\ell m}^<(\mathcal{k}) &= \frac{\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right) - \xi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)}{\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}(\mathcal{k}a) - \xi_\ell(\mathcal{k}a)j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},\\[1.0em]
% B_{p\ell m}^<(\mathcal{k}) &= \frac{\sqrt{\epsilon(\omega)}\left[\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right) - \xi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)\right]}{\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}(\mathcal{k}a) - \epsilon(\omega)\xi_\ell(\mathcal{k}a)j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},\\[1.0em]
% C_{p\ell m}^<(\mathcal{k}) &= \frac{\xi_\ell(\mathcal{k}a)h_\ell^{(1)}\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right) - \xi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}(\mathcal{k}a)}{\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}(\mathcal{k}a) - \xi_\ell(\mathcal{k}a)j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)},\\[1.0em]
% D_{p\ell m}^<(\mathcal{k}) &= \frac{\epsilon(\omega)\xi_\ell(\mathcal{k}a)h_\ell^{(1)}\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right) - \xi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}(\mathcal{k}a)}{\psi_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)h_\ell^{(1)}(\mathcal{k}a) - \epsilon(\omega)\xi_\ell(\mathcal{k}a)j_\ell\left(\sqrt{\epsilon(\omega)}\mathcal{k}a\right)}.
% \end{split}
% \end{equation}
% Here, in addition to the spherical Bessel and Hankel functions we use the Riccati-Bessel function derivatives
% \begin{equation}
% \begin{split}
% \psi_\ell(x) &= \frac{\mathrm{d}}{\mathrm{d}x}\left\{xj_\ell(x)\right\}\\
% &= \frac{x}{2\ell + 1}\left[(\ell + 1)j_{\ell - 1}(x) - \ell j_{\ell + 1}(x)\right], \\[0.5em]
% \xi_\ell(x) &= \frac{\mathrm{d}}{\mathrm{d}x}\left\{xh_\ell^{(1)}(x)\right\}\\
% &= \frac{x}{2\ell + 1}\left[(\ell + 1)h_{\ell - 1}^{(1)}(x) - \ell h_{\ell + 1}^{(1)}(x)\right].
% \end{split}
% \end{equation}

% These expansion coefficients transform under frequency inversion as
% \begin{equation}
% \begin{split}
% A_{p\ell m}^i(-k) &= A_{p\ell m}^{i*}(k),\\
% B_{p\ell m}^i(-k) &= B_{p\ell m}^{i*}(k),\\
% C_{p\ell m}^i(-k) &= C_{p\ell m}^{i*}(k),\\
% D_{p\ell m}^i(-k) &= D_{p\ell m}^{i*}(k)\\
% \end{split}
% \end{equation}
% where the $i$ can be replaced with either $<$ or $>$.












% \section{The Power-Zienau-Woolley Lagrangian and Hamiltonian}\label{sec:PZWderivation}

% We begin with a set of $N$ classical particles with positions $\mathbf{x}_i(t)$, velocities $\dot{\mathbf{x}}_i(t)$, and charges $q_i$ that are well-separated from a second set of $N_0$ particles with positions $\mathbf{x}_{0j}(t)$, velocities $\dot{\mathbf{x}}_{0j}(t)$, and charges $q_{0j}$. The first set of particles will be assumed to be sensitive to the influence of the system's electromagnetic fields, while the second set will be assumed to have their trajectories fixed, to good approximation, by forces outside of the system. The simplest Lagrangian density that defines such a system is
% \begin{equation}
% \begin{split}
% \mathcal{L}&\left[\mathbf{x}_1,\ldots,\mathbf{x}_N,\dot{\mathbf{x}}_1,\ldots,\dot{\mathbf{x}}_N;\mathbf{A},\dot{\mathbf{A}},\Phi,\dot{\Phi};\mathbf{A}_0,\dot{\mathbf{A}}_0,\Phi_0,\dot{\Phi}_0;\mathbf{r},t\right] = \sum_{i = 1}^N\frac{1}{2}m_i\dot{\mathbf{x}}_i^2(t)\delta[\mathbf{r} - \mathbf{x}_i(t)]\\
% & + \frac{1}{8\pi}\left[\mathbf{E}^2(\mathbf{r},t) - \mathbf{B}^2(\mathbf{r},t)\right] + \frac{1}{8\pi}\left[\mathbf{E}_0^2(\mathbf{r},t) - \mathbf{B}_0^2(\mathbf{r},t)\right]\\
% &+ \sum_{i = 1}^N\frac{q_i}{c}\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)]\cdot\left[\mathbf{A}(\mathbf{r},t) + \mathbf{A}_0(\mathbf{r},t)\right] - \sum_{i = 1}^Nq_i\delta[\mathbf{r} - \mathbf{x}_i(t)]\left[\Phi(\mathbf{r},t) + \Phi_0(\mathbf{r},t)\right]\\
% &+\sum_{j = 1}^{N_0}\frac{q_{0j}}{c}\dot{\mathbf{x}}_{0j}(t)\delta[\mathbf{r} - \mathbf{x}_{0j}(t)]\cdot\mathbf{A}_0(\mathbf{r},t) - \sum_{j = 1}^{N_0}q_{0j}\Phi_0(\mathbf{r},t).
% %+ \sum_{j = 1}^{N_0}\frac{1}{2}m_{0j}\dot{\mathbf{x}}_{0j}^2(t)\delta[\mathbf{r} - \mathbf{x}_{0j}(t)]
% \end{split}
% \end{equation}
% Here, $\mathbf{A}(\mathbf{r},t)$ and $\Phi(\mathbf{r},t)$ are the vector and scalar potentials of the dynamical set of particles ($\{i\}$), respectively, with associated electric and magnetic fields $\mathbf{E}(\mathbf{r},t) = -\nabla\Phi(\mathbf{r},t) - (1/c)\dot{\mathbf{A}}(\mathbf{r},t)$ and $\mathbf{B}(\mathbf{r},t) = \nabla\times\mathbf{A}(\mathbf{r},t)$. The analogous fields of the nondynamical particles ($\{j\}$) are $\mathbf{A}_0(\mathbf{r},t)$, $\Phi_0(\mathbf{r},t)$, $\mathbf{E}_0(\mathbf{r},t) = -\nabla\Phi_0(\mathbf{r},t) - (1/c)\dot{\mathbf{A}}_0(\mathbf{r},t)$, and $\mathbf{B}_0(\mathbf{r},t) = \nabla\times\mathbf{A}_0(\mathbf{r},t)$. Importantly, however, in contrast to the fields of the nondynamical particles, the particles' positions and momenta $\mathbf{x}_{0j}(t)$ and $\dot{\mathbf{x}}_{0j}(t)$ are not included in the Lagrangian density's list of independent variables. Therefore, $\partial\mathcal{L}/\partial\mathbf{x}_{0j}(t) = 0$ and $\partial\mathcal{L}/\partial\dot{\mathbf{x}}_{0j}(t) = 0$.

% These last two properties are important for understanding how the equations of motion for the various quantities of the system are constructed. In particular, the Maxwell-Lorentz equations for the dynamical particles can be found via the Lagrangian $L[\ldots;t] = \int\mathcal{L}[\ldots;\mathbf{r},t]\;\mathrm{d}^3\mathbf{r}$ via the Euler-Lagrange equations
% \begin{equation}
% \frac{\mathrm{d}}{\mathrm{d}t}\left\{\frac{\partial L}{\partial \dot{\mathbf{x}}_i(t)}\right\} = \frac{\partial L}{\partial \mathbf{x}_i(t)}.
% \end{equation}
% Explicitly, these imply
% \begin{equation}\label{eq:ELcoord1}
% \begin{split}
% \frac{\mathrm{d}}{\mathrm{d}t}\left\{m_i\dot{\mathbf{x}}_i(t) + \frac{q_i}{c}\left(\mathbf{A}[\mathbf{x}_i(t),t] + \mathbf{A}_0[\mathbf{x}_i(t),t]\right)\right\} &= \frac{q_i}{c}\frac{\partial}{\partial\mathbf{x}_i(t)}\left\{\dot{\mathbf{x}}_i(t)\cdot\left(\mathbf{A}[\mathbf{x}_i(t),t] + \mathbf{A}_0[\mathbf{x}_i(t),t]\right)\right\}\\
% &- q_i\frac{\partial}{\partial\mathbf{x}_i(t)}\left\{\Phi[\mathbf{x}_i(t),t] + \Phi_0[\mathbf{x}_i(t),t]\right\},
% \end{split}
% \end{equation}
% where $\partial/\partial\mathbf{z}$ is simply another way to write $\nabla_{\mathbf{z}} = \sum_{k = 1}^3\hat{\mathbf{e}}_k\partial/\partial z_k$. Further, we have used the property $(\partial/\partial\mathbf{x})\{\mathbf{a}\cdot\mathbf{x}\} = \mathbf{a}$. Using the identities
% \begin{equation}
% \begin{split}
% \nabla\left\{\mathbf{a}\cdot\mathbf{F}(\mathbf{r})\right\} &= \mathbf{a}\times\left\{\nabla\times\mathbf{F}(\mathbf{r})\right\} + (\mathbf{a}\cdot\nabla)\left\{\mathbf{F}(\mathbf{r})\right\},\\
% \frac{\mathrm{d}}{\mathrm{d}t}\left\{\mathbf{A}[\mathbf{x}_i(t),t]\right\} &= \dot{\mathbf{A}}[\mathbf{x}_i(t),t] + \left(\dot{\mathbf{x}}_i(t)\cdot\nabla_{\mathbf{x}_i(t)}\right)\mathbf{A}[\mathbf{x}_i(t),t],
% \end{split}
% \end{equation}
% Eq. \eqref{eq:ELcoord1} simplifies to
% \begin{equation}
% \begin{split}
% m_i\ddot{\mathbf{x}}_i(t) &+ \frac{q_i}{c}\left(\dot{\mathbf{A}}[\mathbf{x}_i(t),t] + \dot{\mathbf{A}}_0[\mathbf{x}_i(t),t]\right) = -\frac{q_i}{c}\left([\dot{\mathbf{x}}_i(t)\cdot\nabla_{\mathbf{x}_i(t)}]\left\{\mathbf{A}[\mathbf{x}_i(t),t] + \mathbf{A}_0[\mathbf{x}_i(t),t]\right\}\right)\\
% &+ \frac{q_i}{c}\nabla_{\mathbf{x}_i(t)}\left\{\dot{\mathbf{x}}_i(t)\cdot\left(\mathbf{A}[\mathbf{x}_i(t),t] + \mathbf{A}_0[\mathbf{x}_i(t),t]\right)\right\} - q_i\nabla_{\mathbf{x}_i(t)}\left\{\Phi[\mathbf{x}_i(t),t] + \Phi_0[\mathbf{x}_i(t),t]\right\}\\
% &= \frac{q_i}{c}\dot{\mathbf{x}}_i(t)\times\left(\nabla_{\mathbf{x}_i(t)}\times\left\{\mathbf{A}[\mathbf{x}_i(t),t] + \mathbf{A}_0[\mathbf{x}_i(t),t]\right\}\right) - q_i\nabla_{\mathbf{x}_i(t)}\left\{\Phi[\mathbf{x}_i(t),t] + \Phi_0[\mathbf{x}_i(t),t]\right\}
% \end{split}
% \end{equation}
% such that, after rearranging to construct the electric and magnetic fields
% \begin{equation}
% \begin{split}
% -\nabla_{\mathbf{x}_i(t)}\left\{\Phi[\mathbf{x}_i(t),t] + \Phi_0[\mathbf{x}_i(t),t]\right\} - \frac{1}{c}\left(\dot{\mathbf{A}}[\mathbf{x}_i(t),t] + \dot{\mathbf{A}}_0[\mathbf{x}_i(t),t]\right) &= \mathbf{E}[\mathbf{x}_i(t),t] + \mathbf{E}_0[\mathbf{x}_i(t),t],\\
% \nabla_{\mathbf{x}_i(t)}\times\left\{\mathbf{A}[\mathbf{x}_i(t),t] + \mathbf{A}_0[\mathbf{x}_i(t),t]\right\} &= \mathbf{B}[\mathbf{x}_i(t),t] + \mathbf{B}_0[\mathbf{x}_i(t),t],
% \end{split}
% \end{equation}
% one finds the correct Maxwell-Lorentz force for the dynamical particle $i$:
% \begin{equation}
% m_i\ddot{\mathbf{x}}_i(t) = q_i\left(\mathbf{E}[\mathbf{x}_i(t),t] + \frac{\dot{\mathbf{x}}_i(t)}{c}\times\mathbf{B}[\mathbf{x}_i(t),t]\right).
% \end{equation}
% In contrast, the Euler-Lagrange equations return the tautology $0 = 0$ when searching for the equation of motion of $\mathbf{x}_{0j}(t)$ such that the motion of the nondynamical particles is beyond the scope of our Lagrangian.

% The motion of the nondynamical particles' fields, however, \textit{is} described by the Lagrangian. To see this, we can use the Euler-Lagrange equations for a general field $\mathbf{F}(\mathbf{r},t)$,
% \begin{equation}
% \frac{\mathrm{d}}{\mathrm{d}t}\left\{\frac{\partial \mathcal{L}}{\partial \dot{F}_\mu(\mathbf{r},t)}\right\} = \frac{\partial \mathcal{L}}{\partial F_\mu(\mathbf{r},t)} - \sum_{\nu = 1}^3\frac{\partial}{\partial r_\nu}\frac{\partial \mathcal{L}}{\partial\!\left(\frac{\partial F_\mu(\mathbf{r},t)}{\partial r_\nu}\right)},
% \end{equation}
% where $\mu\in\{1,2,3\}$ is a Cartesian index. The Euler-Lagrange equations for the components of $\mathbf{A}_0(\mathbf{r},t)$ give
% \begin{equation}
% \begin{split}
% \sum_\mu&\frac{\mathrm{d}}{\mathrm{d}t}\left(\frac{\partial}{\partial\dot{A}_{0\mu}(\mathbf{r},t)}\left\{\frac{1}{8\pi}\left[\frac{2}{c}\nabla\Phi_0(\mathbf{r},t)\cdot\dot{\mathbf{A}}_0(\mathbf{r},t) + \frac{1}{c^2}\dot{\mathbf{A}}_0^2(\mathbf{r},t)\right]\right\}\right)\hat{\mathbf{e}}_\mu = \sum_{i}\frac{q_i}{c}\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)]\\
% &+ \sum_j\frac{q_{0j}}{c}\dot{\mathbf{x}}_{0j}(t)\delta[\mathbf{r} - \mathbf{x}_{0j}(t)] - \sum_{\mu,\nu}\frac{\partial}{\partial r_\nu}\frac{\partial}{\partial\!\left(\frac{\partial A_{0\mu}(\mathbf{r},t)}{\partial r_\nu}\right)}\left\{-\frac{1}{8\pi}\left[\nabla\times\mathbf{A}(\mathbf{r},t)\right]^2\right\}\hat{\mathbf{e}}_\mu.
% \end{split}
% \end{equation}
% The equations simplify with the identity
% \begin{equation}
% \begin{split}
% \sum_{\mu,\nu}\frac{\partial}{\partial r_\nu}\frac{\partial}{\partial\!\left(\frac{\partial F_\mu(\mathbf{r},t)}{\partial r_\nu}\right)}\left\{\left[\nabla\times\mathbf{F}(\mathbf{r},t)\right]^2\right\}\hat{\mathbf{e}}_\mu &= -2\nabla\times\nabla\times\mathbf{F}(\mathbf{r},t),
% \end{split}
% \end{equation}
% such that
% \begin{equation}\label{eq:ELfield1}
% \frac{1}{4\pi c}\nabla\dot{\Phi}_0(\mathbf{r},t) + \frac{1}{4\pi c^2}\ddot{\mathbf{A}}_0(\mathbf{r},t) = \sum_{i}\frac{q_i}{c}\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] + \sum_j\frac{q_{0j}}{c}\dot{\mathbf{x}}_{0j}(t)\delta[\mathbf{r} - \mathbf{x}_{0j}(t)] - \frac{1}{4\pi}\nabla\times\nabla\times\mathbf{A}_0(\mathbf{r},t).
% \end{equation}
% With the definitions of the bound and free currents
% \begin{equation}
% \begin{split}
% \mathbf{J}_b(\mathbf{r},t) &= \sum_iq_i\dot{\mathbf{x}}_i(t)\delta[\mathbf{r} - \mathbf{x}_i(t)],\\
% \mathbf{J}_0(\mathbf{r},t) &= \sum_jq_{0j}\dot{\mathbf{x}}_{0j}(t)\delta[\mathbf{r} - \mathbf{x}_{0j}(t)],
% \end{split}
% \end{equation}
% one can rearrange Eq. \eqref{eq:ELfield1} to find the Amp\`{e}re-Maxwell equation
% \begin{equation}
% \nabla\times\mathbf{B}_0(\mathbf{r},t) = \frac{4\pi}{c}\left[\mathbf{J}_b(\mathbf{r},t) + \mathbf{J}_0(\mathbf{r},t)\right] + \frac{1}{c}\dot{\mathbf{E}}_0(\mathbf{r},t).
% \end{equation}
% We will, in what follows, use the approximation $\mathbf{J}_0(\mathbf{r},t)\gg\mathbf{J}_b(\mathbf{r},t)$ in the driving term of the fields of the nondynamical particles. In other words, we will assume that these fields are influenced minimally by the dynamical charges of the system such that
% \begin{equation}
% \nabla\times\mathbf{B}_0(\mathbf{r},t) \approx \frac{4\pi}{c}\mathbf{J}_0(\mathbf{r},t) + \frac{1}{c}\dot{\mathbf{E}}_0(\mathbf{r},t).
% \end{equation}
% Further, we will call thee fields of nondynamical particles ``free fields'' from here on to emphasize their independence from the complicated system motion.

% The Euler-Lagrange equation for the free scalar potential is simpler than the equations of the free vector potential:
% \begin{equation}
% \frac{\mathrm{d}}{\mathrm{d}t}\left\{\frac{\partial \mathcal{L}}{\partial \dot{\Phi}_0(\mathbf{r},t)}\right\} = \frac{\partial \mathcal{L}}{\partial \Phi_0(\mathbf{r},t)} - \sum_{\nu = 1}^3\frac{\partial}{\partial r_\nu}\frac{\partial \mathcal{L}}{\partial\!\left(\frac{\partial \Phi_0(\mathbf{r},t)}{\partial r_\nu}\right)}.
% \end{equation}
% It simplifies to
% \begin{equation}
% \begin{split}
% 0 &= -\sum_iq_i\delta[\mathbf{r} - \mathbf{x}_i(t)] - \sum_jq_{0j}\delta[\mathbf{r} - \mathbf{x}_{0j}(t)] - \nabla\cdot\frac{\partial}{\partial\!\left(\nabla\Phi_0(\mathbf{r},t)\right)}\left\{\frac{1}{8\pi}\left([\nabla\Phi_0(\mathbf{r},t)]^2 + \frac{2}{c}\nabla\Phi_0(\mathbf{r},t)\cdot\dot{\mathbf{A}}_0(\mathbf{r},t)\right)\right\}\\
% &= -\sum_iq_i\delta[\mathbf{r} - \mathbf{x}_i(t)] - \sum_jq_{0j}\delta[\mathbf{r} - \mathbf{x}_{0j}(t)] - \nabla\cdot\left\{\frac{1}{4\pi}\nabla\Phi_0(\mathbf{r},t) + \frac{1}{4\pi c}\dot{\mathbf{A}}_0(\mathbf{r},t)\right\}
% \end{split}
% \end{equation}
% which, using the identities of the bound and free charge densities
% \begin{equation}
% \begin{split}
% \rho_b(\mathbf{r},t) &= \sum_iq_i\delta[\mathbf{r} - \mathbf{x}_i(t)],\\
% \rho_0(\mathbf{r},t) &= \sum_jq_{0j}\delta[\mathbf{r} - \mathbf{x}_{0j}(t)],\\
% \end{split}
% \end{equation}
% becomes Gauss' law,
% \begin{equation}
% \nabla\cdot\mathbf{E}_0(\mathbf{r},t) = 4\pi\left[\rho_b(\mathbf{r},t) + \rho_0(\mathbf{r},t)\right].
% \end{equation}
% Under the same approximation as above, the bound charges are assumed to contribute negligibly to the free field's divergence such that
% \begin{equation}
% \nabla\cdot\mathbf{E}_0(\mathbf{r},t) \approx 4\pi\rho_0(\mathbf{r},t).
% \end{equation}

% The Euler-Lagrange equations for the system potentials provides through an entirely analogous process the Amp\`{e}re-Maxwell and Gauss laws for the system fields,
% \begin{equation}
% \begin{split}
% \nabla\times\mathbf{B}(\mathbf{r},t) &= \frac{4\pi}{c}\mathbf{J}_b(\mathbf{r},t) + \frac{1}{c}\dot{\mathbf{E}}(\mathbf{r},t),\\
% \nabla\cdot\mathbf{E}(\mathbf{r},t) &= 4\pi\rho_b(\mathbf{r},t).
% \end{split}
% \end{equation}
% As opposed to the free fields, we will allow the system fields to be driven both the bound and free (dynamical and nondynamical) sources. The other two Maxwell equations, i.e. Faraday's law and the magnetic nondivergence law, are satisfied identically by our choice of potentials, so we can omit their derivations. 

% In systems where the total charge of all of the particles is zero, i.e. where $\sum_iq_i = 0$, it is often convenient to represent the bound current density as a polarization density $\mathbf{P}(\mathbf{r},t)$ rather than through the individual motion of each charge. In general, this can be done through
% \begin{equation}
% \mathbf{J}_b(\mathbf{r},t) = \dot{\mathbf{P}}(\mathbf{r},t) + c\nabla\times\mathbf{M}(\mathbf{r},t),
% \end{equation}
% however in nonmagnetic systems the last term containing the magnetization density $\mathbf{M}(\mathbf{r},t)$ is often neglected. To rewrite our Lagrangian in terms of a polarization density, it is simplest to use the (slightly modified) Power-Zienau-Woolley transformation
% \begin{equation}
% L_{PZW} = L - \frac{\mathrm{d}}{\mathrm{d}t}\left\{\int\mathbf{P}(\mathbf{r},t)\cdot\left[\mathbf{A}(\mathbf{r},t) + \mathbf{A}_0(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\right\}.
% \end{equation}
% Because adding a total time derivative to a Lagrangian leaves the action invariant and does not modify the Euler-Lagrange equations or equations of motion of the system, we can be confident that both the Maxwell-Lorentz forces and Maxwell equations implied by the Lagrangian are unchanged by the new term. Using the relationships between $\dot{\mathbf{x}}_i(t)$, $\mathbf{J}_b(\mathbf{r},t)$, and $\mathbf{P}(\mathbf{r},t)$, the PZW Lagrangian density simplifies to
% \begin{equation}
% \begin{split}
% \mathcal{L}_{PZW} &= \sum_i\frac{1}{2}m_i\dot{\mathbf{x}}_i^2(t)\delta[\mathbf{r} - \mathbf{x}_i(t)] + \frac{1}{8\pi}\left[\mathbf{E}^2(\mathbf{r},t) - \mathbf{B}^2(\mathbf{r},t)\right] + \frac{1}{8\pi}\left[\mathbf{E}_0^2(\mathbf{r},t) - \mathbf{B}_0^2(\mathbf{r},t)\right]\\
% & - \rho_b(\mathbf{r},t)\left[\Phi(\mathbf{r},t) + \Phi_0(\mathbf{r},t)\right] + \frac{\mathbf{J}_0(\mathbf{r},t)}{c}\cdot\mathbf{A}_0(\mathbf{r},t) - \rho_0(\mathbf{r},t)\Phi_0(\mathbf{r},t)\\
% & - \frac{1}{c}\mathbf{P}(\mathbf{r},t)\cdot\left[\dot{\mathbf{A}}(\mathbf{r},t) + \dot{\mathbf{A}}_0(\mathbf{r},t)\right]
% %+ \sum_j\frac{1}{2}m_{0j}\dot{\mathbf{x}}_{0j}^2(t)\delta[\mathbf{r} - \mathbf{x}_{0j}(t)]
% \end{split}
% \end{equation}
% with the assumption that $\mathbf{M}(\mathbf{r},t) = 0$.

% The conjugate momenta associated with $L_{PZW}$ are
% \begin{equation}
% \begin{split}
% \mathbf{p}_i(t) &= \frac{\partial L_{PZW}}{\partial \dot{\mathbf{x}}(t)} = m_i\dot{\mathbf{x}}_i(t),\\
% \bm{\pi}(\mathbf{r},t) &= \frac{\partial \mathcal{L}_{PZW}}{\partial \dot{\mathbf{A}}(\mathbf{r},t)} = -\frac{1}{4\pi c}\mathbf{E}(\mathbf{r},t) - \frac{1}{c}\mathbf{P}(\mathbf{r},t),\\
% \bm{\pi}_0(\mathbf{r},t) &= \frac{\partial \mathcal{L}_{PZW}}{\partial \dot{\mathbf{A}}_0(\mathbf{r},t)} = -\frac{1}{4\pi c}\mathbf{E}_0(\mathbf{r},t) - \frac{1}{c}\mathbf{P}(\mathbf{r},t),
% \end{split}
% \end{equation}
% such that, using the identities $\dot{\mathbf{A}}(\mathbf{r},t) = -c[\mathbf{E}(\mathbf{r},t) + \nabla\Phi(\mathbf{r},t)]$ and $\dot{\mathbf{A}}_0(\mathbf{r},t) = -c[\mathbf{E}_0(\mathbf{r},t) + \nabla\Phi_0(\mathbf{r},t)]$, the associated Hamiltonian is
% \begin{equation}
% \begin{split}
% H_{PZW} &= \sum_i\mathbf{p}_i(t)\cdot\dot{\mathbf{x}}_i(t) + \int\bm{\pi}(\mathbf{r},t)\cdot\dot{\mathbf{A}}(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \int\bm{\pi}_0(\mathbf{r},t)\cdot\dot{\mathbf{A}}_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} - L_{PZW}\\
% &= \sum_i\frac{1}{2}m_i\dot{\mathbf{x}}_i^2(t) + \frac{1}{8\pi}\int\left[\mathbf{E}^2(\mathbf{r},t) + \mathbf{B}^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} + \frac{1}{8\pi}\int\left[\mathbf{E}_0^2(\mathbf{r},t) + \mathbf{B}_0^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
% &\qquad+\int\mathbf{P}(\mathbf{r},t)\cdot\left[\mathbf{E}(\mathbf{r},t) + \mathbf{E}_0(\mathbf{r},t) + \nabla\Phi(\mathbf{r},t) + \nabla\Phi_0(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
% &\qquad+ \frac{1}{4\pi}\int\mathbf{E}(\mathbf{r},t)\cdot\nabla\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \frac{1}{4\pi}\int\mathbf{E}_0(\mathbf{r},t)\cdot\nabla\Phi_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
% &\qquad+ \int\rho_b(\mathbf{r},t)\left[\Phi(\mathbf{r},t) + \Phi_0(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} + \int\rho_0(\mathbf{r},t)\Phi_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
% &\qquad - \frac{1}{c}\int\mathbf{J}_0(\mathbf{r},t)\cdot\mathbf{A}_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} + \frac{1}{c}\int\mathbf{P}(\mathbf{r},t)\cdot\left[\dot{\mathbf{A}}(\mathbf{r},t) + \dot{\mathbf{A}}_0(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}.
% \end{split}
% \end{equation}
% One can see through substitution of the potential form of the electric field that the fourth term of the second sum above cancels with the last term, i.e.
% \begin{equation}
% \int\mathbf{P}(\mathbf{r},t)\cdot\left[\mathbf{E}(\mathbf{r},t) + \mathbf{E}_0(\mathbf{r},t) + \nabla\Phi(\mathbf{r},t) + \nabla\Phi_0(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} = -\frac{1}{c}\int\mathbf{P}(\mathbf{r},t)\cdot\left[\dot{\mathbf{A}}(\mathbf{r},t) + \dot{\mathbf{A}}_0(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}.
% \end{equation}
% Further, integration by parts and use of the identities $\nabla\cdot\mathbf{E}(\mathbf{r},t) = 4\pi\rho_b(\mathbf{r},t)$ and $\nabla\cdot\mathbf{E}_0(\mathbf{r},t)\approx4\pi\rho_0(\mathbf{r},t)$ can be used to show that
% \begin{equation}
% \begin{split}
% \frac{1}{4\pi}\int\mathbf{E}(\mathbf{r},t)\cdot\nabla\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} &= -\int\rho_b(\mathbf{r},t)\Phi(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r},\\
% \frac{1}{4\pi}\int\mathbf{E}_0(\mathbf{r},t)\cdot\nabla\Phi_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} &= -\int\rho_0(\mathbf{r},t)\Phi_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}.
% \end{split}
% \end{equation}
% Finally, with $\mathbf{E}^2(\mathbf{r},t) = \mathbf{E}(\mathbf{r},t)\cdot\mathbf{D}(\mathbf{r},t) - 4\pi\mathbf{E}(\mathbf{r},t)\cdot\mathbf{P}(\mathbf{r},t)$, the Hamiltonian simplifies to
% \begin{equation}\label{eq:Hpzw}
% \begin{split}
% H_{PZW} &= \sum_i\frac{1}{2}m_i\dot{\mathbf{x}}_i^2(t) - \frac{1}{2}\int\mathbf{E}(\mathbf{r},t)\cdot\mathbf{P}(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}\\
% & + \frac{1}{8\pi}\int\left[\mathbf{E}(\mathbf{r},t)\cdot\mathbf{D}(\mathbf{r},t) + \mathbf{B}^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r} + \frac{1}{8\pi}\int\left[\mathbf{E}_0^2(\mathbf{r},t) + \mathbf{B}_0^2(\mathbf{r},t)\right]\mathrm{d}^3\mathbf{r}\\
% & + \int\rho_b(\mathbf{r},t)\Phi_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r} - \frac{1}{c}\int\mathbf{J}_0(\mathbf{r},t)\cdot\mathbf{A}_0(\mathbf{r},t)\;\mathrm{d}^3\mathbf{r}.
% \end{split}
% \end{equation}

% This form of the Hamiltonian is conceptually convenient because it includes the energy bound in the macroscopic electromagnetic fields, $(1/8\pi)\int[\mathbf{E}(\mathbf{r,t})\cdot\mathbf{D}(\mathbf{r},t) + \mathbf{B}^2(\mathbf{r},t)]\;\mathrm{d}^3\mathbf{r}$, of a system that includes materials. However, as the conjugate momentum of the system vector potential is proportional to the displacement field, $\bm{\pi}(\mathbf{r},t) = -(1/4\pi c)\mathbf{D}(\mathbf{r},t)$, we need to eliminate the extraneous factor of $\mathbf{E}(\mathbf{r},t)$ inside the integral to bring the Hamiltonian into its canonical form.







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Bibliography %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\bibliography{fieldAlgebraRefs}
\bibliographystyle{unsrtnat}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% End document %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}